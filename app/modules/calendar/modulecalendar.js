/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2019. All Rights reserved)*/
"use strict";var __decorate=this&&this.__decorate||function(e,t,s,n){var a,r=arguments.length,i=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,s):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,s,n);else for(var o=e.length-1;0<=o;o--)(a=e[o])&&(i=(r<3?a(i):3<r?a(t,s,i):a(t,s))||i);return 3<r&&i&&Object.defineProperty(t,s,i),i},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),services_1=require("../../services/services"),objectfields_1=require("../../objectfields/objectfields"),globalcomponents_1=require("../../globalcomponents/globalcomponents"),objectcomponents_1=require("../../objectcomponents/objectcomponents"),systemcomponents_1=require("../../systemcomponents/systemcomponents"),directives_1=require("../../directives/directives"),rxjs_1=require("rxjs"),operators_1=require("rxjs/operators"),router_1=require("@angular/router"),calendar=function(){function e(e,t,s,n,a,r,i){var o=this;this.backend=e,this.session=t,this.broadcast=s,this.modal=n,this.language=a,this.modelutilities=r,this.userPreferences=i,this.usersCalendars$=new core_1.EventEmitter,this.otherCalendars$=new core_1.EventEmitter,this.addingEvent$=new core_1.EventEmitter,this.color$=new core_1.EventEmitter,this.usersCalendars=[],this.otherCalendars=[],this.sysUICalendars=[],this.calendardate={},this.calendars={},this.currentStart={},this.currentEnd={},this.sidebarwidth=300,this.sheetTimeWidth=50,this.sheetHourHeight=80,this.weekstartday=0,this.weekDaysCount=7,this.startHour=0,this.endHour=23,this.todayColor="#eb7092",this.absenceColor="#727272",this.eventColor="#039be5",this.googleColor="#db4437",this.loggedByGoogle=!1,this.asPicker=!1,this.isAllToken=!1,this.isMobileView=!1,this.isDashlet=!1,this.sheetType="Week",this.duration={Day:"d",Three_Days:"d",Week:"w",Month:"M",Schedule:"M"},this.subscriptions=new rxjs_1.Subscription;var l=this.language.currentlanguage$.subscribe(function(e){return o.calendarDate=moment(o.calendarDate)});this.subscriptions.add(l),this.loadPreferences(),this.isMobileView||this.isDashlet||this.getOtherCalendars(),this.modelChangesSubscriber()}return Object.defineProperty(e.prototype,"calendarDate",{get:function(){return this.calendardate},set:function(e){this.calendardate=new moment(e).locale(this.language.currentlanguage.substring(0,2))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sidebarWidth",{get:function(){return this.isMobileView||this.isDashlet?0:this.sidebarwidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multiEventHeight",{get:function(){return this.isMobileView?20:25},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.session.authData.userId},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekStartDay",{get:function(){return this.weekstartday},set:function(e){this.weekstartday=e},enumerable:!0,configurable:!0}),e.prototype.refresh=function(){this.currentStart={},this.currentEnd={},this.calendarDate=new moment(this.calendarDate)},e.prototype.shiftPlus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this.calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this.calendarDate=new moment(this.calendarDate.add(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.add(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.shiftMinus=function(){var e=7-this.weekDaysCount;"Day"==this.sheetType&&this.calendarDate.day()==this.weekStartDay&&(this.calendarDate=new moment(this.calendarDate.subtract(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.subtract(moment.duration("Three_Days"==this.sheetType?3:1,this.duration[this.sheetType])))},e.prototype.doReload=function(e,t,s){var n=!this.calendars[s]||this.calendars[s]&&0==this.calendars[s].length,a=!(this.currentStart[s]&&this.currentEnd[s]&&this.currentStart[s].isSame(e)&&this.currentEnd[s].isSame(t));return n||a},e.prototype.loadEvents=function(a,e,r,t){var i=this;if(void 0===r&&(r=this.owner),void 0===t&&(t=!1),this.doReload(a,e,r)){var o=new rxjs_1.Subject,s="YYYY-MM-DD HH:mm:ss",n={start:a.format(s),end:e.format(s)},l=t?"calendar/other/":"calendar/";return this.currentEnd[r]=e,this.currentStart[r]=a,this.backend.getRequest(l+r,n).subscribe(function(e){i.calendars[r]=[];for(var t=0,s=e;t<s.length;t++){var n=s[t];switch(n.data=i.modelutilities.backendModel2spice(n.module,n.data),n.type){case"event":n.start=moment(n.start).tz(moment.tz.guess()).add(moment().utcOffset(),"m"),n.end=moment(n.end).tz(moment.tz.guess()).add(moment().utcOffset(),"m"),n.isMulti=0<+n.end.diff(n.start,"days"),n.color=i.eventColor;break;case"absence":n.start=moment(n.start).second(1),n.end=moment(n.end).second(1),n.isMulti=!0,n.color=i.absenceColor;break;case"other":n.start=moment(n.start).year(a.year()).second(1),n.end=moment(n.end).year(a.year()).second(1),n.isMulti=!0}"UserAbsences"==n.module&&("other"==n.type&&(n.data.summary_text=n.data.user_name),i.absenceExists(n))||i.calendars[r].push(n)}o.next(i.calendars[r]),o.complete()}),o.asObservable()}for(var d=[],c=0,h=this.calendars[r];c<h.length;c++){var u=h[c];u.start<e&&u.end>a&&d.push(u)}return rxjs_1.of(d)},e.prototype.loadGoogleEvents=function(e,t){var a=this;if(!this.loggedByGoogle)return rxjs_1.of([]);if(this.doReload(e,t,"google")){var r=new rxjs_1.Subject,s="YYYY-MM-DD HH:mm:ss",n={startdate:e.format(s),enddate:t.format(s)};return this.calendars.google=[],this.currentEnd.google=t,this.currentStart.google=e,this.backend.getRequest("google/calendar/getgoogleevents",n).subscribe(function(e){if(e.events&&0<e.events.length)for(var t=0,s=e.events;t<s.length;t++){var n=s[t];n.start=moment(n.start.dateTime).format("YYYY-MM-DD HH:mm:ss"),n.end=moment(n.end.dateTime).format("YYYY-MM-DD HH:mm:ss"),n.start=moment(n.start),n.end=moment(n.end),n.isMulti=0<+n.end.diff(n.start,"days"),n.data={},n.data.summary_text=n.summary,n.data.assigned_user_id=null,n.color=a.googleColor,a.calendars.google.push(n)}r.next(a.calendars.google),r.complete()}),r.asObservable()}for(var i=[],o=0,l=this.calendars.google;o<l.length;o++){var d=l[o];d.start<t&&d.end>e&&i.push(d)}return rxjs_1.of(i)},e.prototype.getEvents=function(e){return void 0===e&&(e=this.owner),this.calendars[e]?this.calendars[e]:[]},e.prototype.addOtherCalendar=function(){var s=this;if(!(this.isAllToken||this.isMobileView||this.isDashlet)){var t=this.sysUICalendars.filter(function(t){return!s.otherCalendars.some(function(e){return e.id==t.id})});this.modal.openModal("CalendarAddCalendar").subscribe(function(e){e.instance.calendars=t,e.instance.addCalendar.pipe(operators_1.take(1)).subscribe(function(e){if(!1!==e){var t=s.otherCalendars;t.push({id:e.id,name:e.name,visible:!0,color:s.getRandomColor()}),s.setOtherCalendars(t.slice())}})})}},e.prototype.removeOtherCalendar=function(t){if(!this.isMobileView&&!this.isDashlet){var e=this.otherCalendars.filter(function(e){return e.id!=t});this.setOtherCalendars(e)}},e.prototype.setOtherCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.otherCalendars=e,t&&this.userPreferences.setPreference("Other",this.otherCalendars,!0,"Calendar"),this.otherCalendars$.emit(this.otherCalendars),this.isAllToken=this.sysUICalendars.length==this.otherCalendars.length)},e.prototype.addUserCalendar=function(e,t){if(!this.isMobileView&&!this.isDashlet){var s=this.usersCalendars,n="#"+(4095*Math.random()<<0).toString(16).toLowerCase()=="fff"?"eee":(4095*Math.random()<<0).toString(16);s.push({id:e,name:t,visible:!0,color:n}),this.setUserCalendars(s.slice())}},e.prototype.removeUserCalendar=function(t){if(!this.isMobileView&&!this.isDashlet){var e=this.usersCalendars.filter(function(e){return e.id!=t});this.setUserCalendars(e)}},e.prototype.setUserCalendars=function(e,t){void 0===t&&(t=!0),e&&(this.usersCalendars=e,t&&this.userPreferences.setPreference("Users",this.usersCalendars,!0,"Calendar"),this.usersCalendars$.emit(this.usersCalendars))},e.prototype.setColor=function(t,s,e){var n=this;switch(e){case"Users":this.usersCalendars.some(function(e){if(e.id==t)return e.color=s,n.setUserCalendars(n.usersCalendars),!0});break;case"Other":this.otherCalendars.some(function(e){if(e.id==t)return e.color=s,n.setOtherCalendars(n.otherCalendars),!0})}this.color$.emit({id:t,color:s})},e.prototype.arrangeEvents=function(e){(e=e.map(function(e){return e.start=moment(e.start).second(0),e.end=moment(e.end).second(0),e})).sort(function(e,t){return e.start<t.start?-1:e.start===t.start&&e.end>t.end?-1:1});for(var t={},s=0,n=e;s<n.length;s++){for(var a=n[s],r=[],i=0,o=e;i<o.length;i++){var l=o[i];a.id!==l.id&&l.start<a.end&&l.end>a.start&&r.push({id:l.id,start:l.start,end:l.end})}var d=0;if(0<r.length){for(var c=0,h=r;c<h.length;c++){for(var u=h[c],p=0,g=0,m=r;g<m.length;g++){var v=m[g];v.start<u.end&&v.end>u.start&&p++}d<p&&(d=p)}d++}t[a.id]={maxOverlay:d,elementsOverlaid:r}}for(var y=[],f=0,b=e;f<b.length;f++){a=b[f];for(var _=0,C=[],D=0,E=e;D<E.length;D++){l=E[D];if(-1!==y.indexOf(l.id)&&l.start<a.end&&l.end>a.start)for(-1===C.indexOf(t[l.id].displayIndex)&&C.push(t[l.id].displayIndex);-1!==C.indexOf(_);)_++}t[a.id].displayIndex=_,y.push(a.id)}for(var w in t)for(var x=0,M=t[w].elementsOverlaid;x<M.length;x++){var S=M[x];t[w].maxOverlay<t[S.id].maxOverlay&&(t[w].maxOverlay=t[S.id].maxOverlay)}for(var k=0,H=e;k<H.length;k++){(a=H[k]).displayIndex=t[a.id].displayIndex,a.maxOverlay=t[a.id].maxOverlay}return e},e.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe()},e.prototype.absenceExists=function(e){var t=!1;for(var s in this.calendars)if(this.calendars.hasOwnProperty(s)&&this.calendars[s].some(function(e){return e.id})){t=!0;break}return t},e.prototype.getRandomColor=function(){for(var e="#",t=0;t<6;t++)e+="0123456789ABCDEF"[Math.floor(16*Math.random())];return e},e.prototype.modelChangesSubscriber=function(){var r=this,e=this.broadcast.message$.subscribe(function(e){var t=e.messagedata.id,s=e.messagedata.module,n=e.messagedata.data;if("Meetings"==s||"Calls"==s)switch(e.messagetype){case"model.save":var a=n.assigned_user_id;if(!r.calendars[a])return;r.modifyEvent(t,s,n,a)||r.isValid(n.date_end)&&r.isValid(n.date_start)&&(r.calendars[a].push({id:t,module:s,type:"event",start:n.date_start,end:n.date_end,data:n}),r.calendarDate=moment(r.calendarDate));break;case"model.delete":if(!r.calendars[r.owner])return;r.deleteEvent(t,s),r.calendarDate=moment(r.calendarDate)}});this.subscriptions.add(e)},e.prototype.modifyEvent=function(t,s,n,e){var a=this;return!this.isValid(n.date_start)||!this.isValid(n.date_end)||(n.date_start>this.currentEnd&&n.date_end<this.currentStart?(this.deleteEvent(t,s),!0):this.calendars[e].some(function(e){if(e.id==t&&s==e.module)return e.data=n,e.start=n.date_start,e.end=n.date_end,a.calendarDate=moment(a.calendarDate),!0}))},e.prototype.deleteEvent=function(e,s){var n=this;this.calendars[this.owner].some(function(t){if(t.id==e&&s==t.module)return n.calendars[n.owner]=n.calendars[n.owner].filter(function(e){return e.id!=t.id}),n.calendarDate=moment(n.calendarDate),!0})},e.prototype.isValid=function(e){return e&&"object"==typeof e&&e.isValid()},e.prototype.loadPreferences=function(){var e=this.userPreferences.unchangedPreferences.global;this.weekStartDay="Monday"==e.week_day_start?1:this.weekStartDay,this.weekDaysCount=+e.week_days_count||this.weekDaysCount,this.startHour=+e.calendar_day_start_hour||this.startHour,this.endHour=+e.calendar_day_end_hour||this.endHour,this.calendarDate=moment(this.calendarDate)},e.prototype.getOtherCalendars=function(){var t=this;this.userPreferences.loadPreferences("Calendar").pipe(operators_1.take(1)).subscribe(function(e){t.setUserCalendars(e.Users,!1),t.setOtherCalendars(e.Other,!1),t.getSysUICalendars()}),this.session.authData.googleToken&&(this.loggedByGoogle=!0)},e.prototype.getSysUICalendars=function(){var t=this;this.backend.getRequest("calendar/calendars").subscribe(function(e){t.sysUICalendars=e,t.isAllToken=t.sysUICalendars.length==t.otherCalendars.length})},e=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.session,services_1.broadcast,services_1.modal,services_1.language,services_1.modelutilities,services_1.userpreferences])],e)}();exports.calendar=calendar;var CalendarHeader=function(){function e(e,t,s,n,a){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=a,this.openPicker=!1,this.scheduleUntilDate={},this.showTypeSelector=!1,this.datePicked=new core_1.EventEmitter,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}return Object.defineProperty(e.prototype,"sheetType",{get:function(){return this.calendar.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isMobileView",{get:function(){return this.calendar.isMobileView},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekStartDay",{get:function(){return this.calendar.weekStartDay},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"weekDaysCount",{get:function(){return this.calendar.weekDaysCount},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},set:function(e){this.calendar.calendarDate=new moment(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"asPicker",{get:function(){return this.calendar.asPicker},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pickerClass",{get:function(){return this.openPicker&&this.isMobileView?"":"slds-hidden"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"titleClass",{get:function(){return this.isMobileView?"slds-m-bottom--xx-small":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"headerClass",{get:function(){return this.isMobileView?"slds-p-around--x-small":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"typeDropdownClass",{get:function(){return this.showTypeSelector?"slds-is-open":""},enumerable:!0,configurable:!0}),e.prototype.ngOnDestroy=function(){this.clickListener&&this.clickListener()},e.prototype.toggleClosed=function(){this.openPicker=!1,this.clickListener&&this.clickListener()},e.prototype.handleDatePicked=function(e){this.datePicked.emit(e)},e.prototype.shiftPlus=function(){var e=7-this.weekDaysCount;"Day"==this.calendar.sheetType&&this.calendarDate.day()==this.weekStartDay+(this.weekDaysCount-1)&&(this.calendarDate=new moment(this.calendarDate.add(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.add(moment.duration("Three_Days"==this.calendar.sheetType?3:1,this.calendar.duration[this.calendar.sheetType])))},e.prototype.shiftMinus=function(){var e=7-this.weekDaysCount;"Day"==this.calendar.sheetType&&this.calendarDate.day()==this.weekStartDay&&(this.calendarDate=new moment(this.calendarDate.subtract(moment.duration(e,"d")))),this.calendarDate=new moment(this.calendarDate.subtract(moment.duration("Three_Days"==this.calendar.sheetType?3:1,this.calendar.duration[this.calendar.sheetType])))},e.prototype.addOtherCalendar=function(){this.calendar.addOtherCalendar()},e.prototype.getCalendarHeader=function(){var e=new moment(this.calendarDate);switch(this.calendar.sheetType){case"Week":return this.getFirstDayOfWeek()+" - "+this.getLastDayOfWeek();case"Month":return e.format("MMMM YYYY");case"Day":return e.format("MMMM D");case"Schedule":return e.format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY");case"Three_Days":return e.format("MMM D")+" - "+moment(e.add(2,"d")).format("MMM D")}},e.prototype.getCompactCalendarHeader=function(){return new moment(this.calendarDate).format("MMM, YYYY")},e.prototype.getFirstDayOfWeek=function(){var e=new moment(this.calendarDate);return e.day(this.weekStartDay),e.format("MMM D")},e.prototype.getLastDayOfWeek=function(){var e=new moment(this.calendarDate);return e.day(this.weekDaysCount),e.format("MMM D")},e.prototype.toggleTypeSelector=function(){this.showTypeSelector=!this.showTypeSelector},e.prototype.setType=function(e){this.calendar.sheetType=e,this.calendar.refresh(),this.showTypeSelector=!1},e.prototype.goToday=function(){this.calendarDate=new moment},e.prototype.zoomin=function(){this.calendar.sheetHourHeight+=10},e.prototype.zoomout=function(){this.calendar.sheetHourHeight-=10},e.prototype.resetzoom=function(){this.calendar.sheetHourHeight=80},e.prototype.toggleOpen=function(t,s){var n=this;this.openPicker=!this.openPicker,this.openPicker&&(this.clickListener=this.renderer.listen("document","click",function(e){return n.onDocumentClick(e,t,s)}))},e.prototype.onDocumentClick=function(e,t,s){!this.openPicker||t.contains(e.target)||s.contains(e.target)||(this.openPicker=!1,this.clickListener())},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"datePicked",void 0),e=__decorate([core_1.Component({selector:"calendar-header",template:'<div class="slds-page-header" style="border-bottom-left-radius: 0; border-bottom-right-radius: 0;" [ngClass]="headerClass"><div class="slds-grid"><div *ngIf="!isMobileView" class="slds-col" [ngClass]="titleClass"><div class="slds-media slds-no-space slds-grow"><object-icon [module]="\'Calendar\'"></object-icon><div class="slds-media__body"><p class="slds-text-title--caps slds-line-height--reset">{{language.getModuleName(\'Calendar\')}}</p><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate">{{getCalendarHeader()}}</h1></div></div></div><div *ngIf="isMobileView" class="slds-col slds-grid"><button #pickerbuttoncontainer class="slds-button slds-button--icon-border" (click)="toggleOpen(pickerontainer, pickerbuttoncontainer)"><system-utility-icon icon="event" size="x-small"></system-utility-icon></button><div class="slds-page-header__title slds-m-horizontal--x-small slds-align-middle slds-truncate">{{getCompactCalendarHeader()}}</div></div><div class="slds-align-top slds-col slds-grid slds-no-flex slds-col--bump-left"><div *ngIf="!isMobileView || asPicker" class="slds-button-group" role="group"><button class="slds-button slds-button--icon-border" (click)="shiftMinus()"><system-button-icon [icon]="\'chevronleft\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="shiftPlus()"><system-button-icon [icon]="\'chevronright\'"></system-button-icon></button></div><ng-container *ngIf="!isMobileView && !asPicker"><button class="slds-button slds-button--neutral slds-p-horizontal--small" (click)="addOtherCalendar()" [disabled]="calendar.isAllToken"><system-button-icon [icon]="\'add\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="calendar.refresh()"><system-button-icon [icon]="\'refresh\'"></system-button-icon></button><div class="slds-button-group slds-m-left--x-small" role="group"><button class="slds-button slds-button--icon-border" (click)="zoomout()" [disabled]="calendar.sheetHourHeight <=50 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomout\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="resetzoom()" [disabled]="calendar.sheetHourHeight ==80 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'undo\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="zoomin()" [disabled]="calendar.sheetHourHeight >=120 || sheetType == \'Month\' || sheetType == \'Schedule\'"><system-button-icon [icon]="\'zoomin\'"></system-button-icon></button></div><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="goToday()">{{language.getLabel(\'LBL_TODAY\')}}</button></ng-container><div *ngIf="!asPicker" class="slds-dropdown-trigger slds-dropdown-trigger--click slds-m-left--xx-small" [ngClass]="typeDropdownClass"><button class="slds-button slds-button--neutral slds-p-horizontal--x-small" (click)="toggleTypeSelector()">{{language.getLabel(\'LBL_\'+ sheetType | uppercase )}}<system-button-icon [icon]="\'down\'"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown--x-small"><ul class="slds-dropdown__list" role="menu"><li class="slds-dropdown__item" role="presentation"><a href="javascript:void(0);" role="menuitem" (click)="setType(\'Day\')"><span class="slds-truncate">{{language.getLabel(\'LBL_DAY\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Three_Days\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_THREE_DAYS\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Week\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_WEEK\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Month\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_MONTH\')}}</span></a></li><li class="slds-dropdown__item" role="presentation" (click)="setType(\'Schedule\')"><a href="javascript:void(0);" role="menuitem"><span class="slds-truncate">{{language.getLabel(\'LBL_SCHEDULE\')}}</span></a></li></ul></div></div></div></div></div><div #pickerontainer [ngClass]="pickerClass" aria-hidden="false" class="slds-datepicker slds-dropdown slds-dropdown_left" role="dialog"><system-input-date-picker *ngIf="openPicker" [setDate]="calendarDate" [weekStartDay]="weekStartDay" (datePicked)="handleDatePicked($event)"></system-input-date-picker></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,calendar])],e)}();exports.CalendarHeader=CalendarHeader;var Calendar=function(){function Calendar(e,t,s,n,a){var r=this;this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=a,this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.subscriptions=new rxjs_1.Subscription,this.xDown=null,this.yDown=null,this.self={},this.navigation.setActiveModule("Calendar");var i=this.calendar.usersCalendars$.subscribe(function(e){return r.usersCalendars=e});this.subscriptions.add(i);var o=this.calendar.otherCalendars$.subscribe(function(e){return r.otherCalendars=e});this.subscriptions.add(o),this.resizeListener=this.renderer.listen("window","resize",function(){r.calendar.isMobileView=r.calendarContainer.element.nativeElement.getBoundingClientRect().width<768}),this.touchStartListener=this.renderer.listen("document","touchstart",function(e){return r.handleTouchStart(e)})}return Object.defineProperty(Calendar.prototype,"isMobileView",{get:function(){return this.calendar.isMobileView},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sheetType",{get:function(){return this.calendar.sheetType},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sidebarWidth",{get:function(){return this.calendar.sidebarWidth},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"weekStartDay",{get:function(){return this.calendar.weekStartDay},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"asPicker",{get:function(){return this.calendar.asPicker},set:function(e){e?(this.calendar.sheetType="Three_Days",this.calendar.asPicker=e):this.closeModal()},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sidebarStyle",{get:function(){return{width:this.calendar.sidebarwidth+"px","z-index":1}},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"mainContainerClass",{get:function(){return this.asPicker?"slds-modal slds-fade-in-open slds-modal_large":"slds-theme--default"},enumerable:!0,configurable:!0}),Object.defineProperty(Calendar.prototype,"sheetStyle",{get:function(){return{width:"calc(100% - "+this.sidebarWidth+"px)",height:"100%"}},enumerable:!0,configurable:!0}),Calendar.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){return e.calendar.isMobileView=e.calendarContainer.element.nativeElement.getBoundingClientRect().width<768},10)},Calendar.prototype.ngOnDestroy=function(){this.subscriptions.unsubscribe(),this.resizeListener&&this.resizeListener(),this.touchStartListener&&this.touchStartListener()},Calendar.prototype.handleUntiDate=function(e){this.calendarHeader.scheduleUntilDate=e},Calendar.prototype.setDateChanged=function(e){this.calendarHeader.toggleClosed(),this.calendar.calendarDate=new moment(e),this.calendar.refresh()},Calendar.prototype.handleGoogleIsVisible=function(e){this.googleIsVisible=e},Calendar.prototype.gotToDayView=function(e){this.calendar.calendarDate=new moment(e),this.calendar.refresh(),this.calendar.sheetType="Day"},Calendar.prototype.closeModal=function(){this.self.destroy()},Calendar.prototype.handleTouchStart=function(e){var t=this,s=e.touches||e.originalEvent.touches;this.xDown=s[0].clientX,this.yDown=s[0].clientY,this.touchMoveListener=this.renderer.listen("document","touchmove",function(e){return t.handleTouchMove(e)})},Calendar.prototype.handleTouchMove=function(e){if(this.touchMoveListener(),this.xDown&&this.yDown){var t=this.xDown-e.touches[0].clientX;Math.abs(t)>Math.abs(this.yDown-e.touches[0].clientY)&&(t<0?this.calendar.shiftMinus():this.calendar.shiftPlus()),this.xDown=null,this.yDown=null}},__decorate([core_1.ViewChild("calendarcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],Calendar.prototype,"calendarContainer",void 0),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],Calendar.prototype,"calendarcontent",void 0),__decorate([core_1.ViewChild(CalendarHeader),__metadata("design:type",CalendarHeader)],Calendar.prototype,"calendarHeader",void 0),Calendar=__decorate([core_1.Component({selector:"calendar",template:'<div #calendarcontainer [ngClass]="mainContainerClass" [class.slds-text-body--small]="isMobileView" [attr.role]="!asPicker ? \'none\' : \'dialog\'"><div [class.slds-modal__container]="asPicker"><calendar-header (datePicked)="setDateChanged($event)"></calendar-header><div #calendarcontent tobottom class="slds-grid slds-theme_default slds-border--right"><div *ngIf="!isMobileView" tobottom [ngStyle]="sidebarStyle" class="slds-border--right slds-p-top--xx-small spicecrm-scrollbar slds-scrollable--y slds-size--1-of-1 slds-theme--default"><system-input-date-picker [setDate]="calendarDate" [showTodayButton]="false" [weekStartDay]="weekStartDay" (datePicked)="setDateChanged($event)"></system-input-date-picker><calendar_other_calendars_monitor (googleIsVisible$)="handleGoogleIsVisible($event)" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars"></calendar_other_calendars_monitor></div><div [ngStyle]="sheetStyle"><calendar-sheet-day *ngIf="sheetType === \'Day\'" [googleisvisible]="googleIsVisible" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars" [setdate]="calendarDate"></calendar-sheet-day><calendar-sheet-three-days *ngIf="sheetType === \'Three_Days\'" [googleisvisible]="googleIsVisible" [calendarcontent]="calendarcontent" [footercontainer]="footercontainer" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars" [setdate]="calendarDate" (navigateday)="gotToDayView($event)"></calendar-sheet-three-days><calendar-sheet-week *ngIf="sheetType === \'Week\'" [googleisvisible]="googleIsVisible" [calendarcontent]="calendarcontent" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars" [setdate]="calendarDate" (navigateday)="gotToDayView($event)"></calendar-sheet-week><calendar-sheet-month *ngIf="sheetType === \'Month\'" [googleisvisible]="googleIsVisible" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars" [setdate]="calendarDate" (navigateday)="gotToDayView($event)"></calendar-sheet-month><calendar-sheet-schedule *ngIf="sheetType === \'Schedule\'" [googleisvisible]="googleIsVisible" [userscalendars]="usersCalendars" [othercalendars]="otherCalendars" [setdate]="calendarDate" (navigateday)="gotToDayView($event)" (untildate$)="handleUntiDate($event)"></calendar-sheet-schedule></div></div><div #footercontainer><footer *ngIf="asPicker" class="slds-modal__footer"><button class="slds-button slds-button--neutral" (click)="closeModal()">{{language.getLabel(\'LBL_CLOSE\')}}</button></footer></div></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,calendar])],Calendar)}();exports.Calendar=Calendar;var CalendarSheetDay=function(){function e(e,t,s,n,a,r,i,o){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=a,this.cdr=r,this.session=i,this.calendar=o,this.navigateweek=new core_1.EventEmitter,this.setdate={},this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.sheetTopMargin=0,this.sheetDay={},this.sheetHours=[],this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.otherEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.buildHours()}return Object.defineProperty(e.prototype,"sheetStyle",{get:function(){return{height:"calc(100% - "+this.headerContainer.element.nativeElement.clientHeight+"px)","margin-top":"-1px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDashlet",{get:function(){return this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(moment.tz.guess()).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.otherEvents,this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(this.calendar.endHour-this.calendar.startHour,"h")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextContainerClass",{get:function(){return this.isDashlet?"slds-grid slds-grid--vertical-align-center":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextDayClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-body--regular"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTextDateClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-heading--large"},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.calendarsheet.element.nativeElement.scrollTop=8*this.calendar.sheetHourHeight},e.prototype.ngOnChanges=function(e){e.setdate&&(this.sheetDay={date:e.setdate.currentValue},this.getEvents()),(e.usersCalendars||e.setdate)&&this.getUsersEvents(),(e.otherCalendars||e.setdate)&&this.getOtherEvents(),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnHours=function(e,t){return e},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}))})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}))})},e.prototype.getUsersEvents=function(){var s=this;if(this.userEvents=[],this.userMultiEvents=[],!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate,n.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.color=t.color,e.visible=t.visible,e.isMulti?s.userMultiEvents.push(e):s.userEvents.push(e)}))})},n=this,t=0,a=this.calendar.usersCalendars;t<a.length;t++){e(a[t])}},e.prototype.getOtherEvents=function(){var s=this;if(this.otherEvents=[],!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate.hour(0).minute(0).second(0),n.endDate.hour(23).minute(0).second(0),t.id,!0).subscribe(function(e){0<e.length&&e.forEach(function(e){e.color=t.color,e.visible=t.visible,s.otherEvents.push(e)})})},n=this,t=0,a=this.calendar.otherCalendars;t<a.length;t++){e(a[t])}},e.prototype.filterEvents=function(e){var t=this;return e.filter(function(e){return e.end.hour()>t.calendar.startHour||e.start.hour()<t.calendar.endHour||"absence"==e.type})},e.prototype.displayDate=function(e){switch(e){case"day":return this.setdate.format("ddd");case"date":return this.setdate.format(this.isDashlet?"D, MMMM":"D")}},e.prototype.getEventStyle=function(e){var t=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),s=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),n=(this.calendarsheet.element.nativeElement.clientWidth-this.sheetTimeWidth)/(0<e.maxOverlay?e.maxOverlay:1);return{left:this.sheetTimeWidth+n*e.displayIndex+"px",width:n+"px",top:this.calendar.sheetHourHeight/60*t+"px",height:this.calendar.sheetHourHeight/60*(s-t)+"px","z-index":e.resizing?20:15,"border-bottom":e.resizing?"1px dotted #fff":0}},e.prototype.getMultiEventStyle=function(e){var t=this.multiEventsContainer.element.nativeElement.getBoundingClientRect();return{height:this.calendar.multiEventHeight+"px",width:t.width+"px",top:t.top+this.calendar.multiEventHeight*e+"px",left:t.left+"px"}},e.prototype.getMultiEventsContainerStyle=function(){return{height:0<this.allMultiEvents.length?this.calendar.multiEventHeight*this.allMultiEvents.length+"px":this.calendar.multiEventHeight+"px"}},e.prototype.getTimeColStyle=function(){return{width:this.sheetTimeWidth+"px"}},e.prototype.getDayColStyle=function(){return{width:"calc(100% - "+this.sheetTimeWidth+"px)"}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.isTodayStyle=function(){var e=new moment;return{color:e.year()===this.setdate.year()&&e.month()===this.setdate.month()&&e.date()==this.setdate.date()?this.calendar.todayColor:"inherit"}},e.prototype.getHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px"}},e.prototype.getHalfHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+this.calendar.sheetHourHeight/2+"px",left:this.sheetTimeWidth+"px",width:"calc(100% - "+this.sheetTimeWidth+"px)"}},e.prototype.getHourLabelStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",width:this.sheetTimeWidth+"px"}},e.prototype.getDayDividerStyle=function(){return{left:this.sheetTimeWidth+"px",top:"0px",height:this.calendar.sheetHourHeight*this.sheetHours.length+"px"}},e.prototype.gotoWeek=function(){this.navigateweek.emit()},e.prototype.getDropTargetStyle=function(e){return{left:this.sheetTimeWidth+"px",width:"calc(100% - "+this.sheetTimeWidth+"px)",top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",height:this.calendar.sheetHourHeight+"px"}},e.prototype.notLastHour=function(e){return e<this.sheetHours.length},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateweek",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.ViewChild("multieventscontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"multiEventsContainer",void 0),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"headerContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-day",template:'<div #headercontainer class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [ngStyle]="getTimeColStyle()">{{offset}}</div><div class="slds-size--1-of-1 slds-border--left slds-p-top--xx-small" [ngStyle]="getDayColStyle()"><div class="slds-p-bottom--xx-small" [ngClass]="dayTextContainerClass"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextDayClass" [ngStyle]="isTodayStyle()">{{displayDate(\'day\')}}</div><h1 class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextDateClass" [ngStyle]="isTodayStyle()">{{displayDate(\'date\')}}</h1></div><div #multieventscontainer class="slds-text-align--center slds-border--top slds-p-around--xxx-small slds-text-body--small" [ngStyle]="getMultiEventsContainerStyle()"><ng-container *ngFor="let event of allMultiEvents; let index = index; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getMultiEventStyle(index)" [event]="event"></calendar-sheet-event></ng-container></div></div></div><div #calendarsheet [ngStyle]="sheetStyle" class="slds-scrollable--y spicecrm-scrollbar slds-is-relative"><ng-container *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByFnHours"><div class="slds-is-absolute slds-border--top slds-size--1-of-1" [ngStyle]="getHourDividerStyle(index + 1)"></div><ng-container *ngIf="notLastHour(index)"><div class="slds-is-absolute slds-border--top" [ngStyle]="getHalfHourDividerStyle(index)"></div><div class="slds-is-absolute slds-text-align--center" [ngStyle]="getHourLabelStyle(index)">{{sheetHour}}:00</div><calendar-sheet-drop-target [hour]="sheetHour" class="slds-is-absolute" [ngStyle]="getDropTargetStyle(index)"></calendar-sheet-drop-target></ng-container></ng-container><ng-container><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle()"></div></ng-container><ng-container *ngFor="let event of allEvents; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" [event]="event"></calendar-sheet-event></ng-container></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.backend,core_1.ChangeDetectorRef,services_1.session,calendar])],e)}();exports.CalendarSheetDay=CalendarSheetDay;var CalendarSheetThreeDays=function(){function e(e,t,s,n,a,r,i){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.cdr=a,this.backend=r,this.calendar=i,this.navigateday=new core_1.EventEmitter,this.sheetDays=[],this.setdate={},this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.footerContainer=void 0,this.calendarContent=void 0,this.sheetHours=[],this.sheetTopMargin=0,this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.otherEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.buildHours(),this.sheetDays=this.buildSheetDays()}return Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(moment.tz.guess()).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDashlet",{get:function(){return this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.otherEvents,this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(2,"d")).hour(this.calendar.endHour)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextContainerClass",{get:function(){return this.isDashlet?"slds-grid slds-grid--vertical-align-center":""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dayTextClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-body--regular"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dateTextClass",{get:function(){return this.isDashlet?"slds-text-heading--medium":"slds-text-heading--large"},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.sheetDays=this.buildSheetDays(),e.setdate&&this.getEvents(),(e.usersCalendars||e.setdate)&&this.getUsersEvents(),(e.otherCalendars||e.setdate)&&this.getOtherEvents(),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngAfterViewInit=function(){this.calendarsheet.element.nativeElement.scrollTop=8*this.calendar.sheetHourHeight},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.arrangeMultiEvents=function(){var e=this;this.sheetDays.forEach(function(e){return e.items=[]});for(var t=function(t){for(var e=0,s=r.sheetDays;e<s.length;e++)for(var n=s[e],a=moment(t.start);a.diff(t.end)<=0;a.add(1,"days"))a.date()!=n.date.date()||n.items.some(function(e){return e.id==t.id})||n.items.push(t)},r=this,s=0,n=this.allMultiEvents;s<n.length;s++){t(n[s])}this.sheetDays.forEach(function(e){e.items=e.items.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),e.items.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}),this.allMultiEvents.forEach(function(n){var a=null;e.sheetDays.forEach(function(s){s.items.forEach(function(e,t){e.id==n.id&&(null!=a&&0<n.end.diff(n.start,"days")?(s.items.splice(t,1),s.items.splice(a,0,n)):a=t)})})})},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.arrangeMultiEvents(),this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.arrangeMultiEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getUsersEvents=function(){var s=this;if(this.userEvents=[],this.userMultiEvents=[],this.arrangeMultiEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate,n.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.color=t.color,e.visible=t.visible,e.isMulti?(s.userMultiEvents.push(e),s.arrangeMultiEvents()):s.userEvents.push(e)}))})},n=this,t=0,a=this.calendar.usersCalendars;t<a.length;t++){e(a[t])}},e.prototype.getOtherEvents=function(){var s=this;if(this.otherEvents=[],this.arrangeMultiEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate.hour(0).minute(0).second(0),n.endDate.hour(0).minute(0).second(0),t.id,!0).subscribe(function(e){0<e.length&&e.forEach(function(e){e.color=t.color,e.visible=t.visible,s.otherEvents.push(e),s.arrangeMultiEvents()})})},n=this,t=0,a=this.calendar.otherCalendars;t<a.length;t++){e(a[t])}},e.prototype.filterEvents=function(e,t){var s=this;return void 0===t&&(t=void 0),e.filter(function(e){return e.end.hour()>s.calendar.startHour||e.start.hour()<s.calendar.endHour||"absence"==e.type})},e.prototype.buildSheetDays=function(){for(var e=[],t=0;t<3;){var s=new moment(this.setdate);s=s.add(t,"days"),e.push({index:t,date:moment(s),day:moment(s).day(),items:[]}),t++}return e},e.prototype.isTodayStyle=function(e){var t=new moment;return{color:t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()?this.calendar.todayColor:"inherit"}},e.prototype.getEventStyle=function(t){var e=this.buildSheetDays().find(function(e){return e.day==t.start.day()})||0,s=60*(t.start.hour()-this.calendar.startHour)+t.start.minute(),n=60*(t.end.hour()-this.calendar.startHour)+t.end.minute(),a=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.calendarContent.clientWidth-this.calendar.sidebarWidth-a,i=(r-this.sheetTimeWidth)/3/(0<t.maxOverlay?t.maxOverlay:1);return{left:this.sheetTimeWidth+(r-this.sheetTimeWidth)/3*e.index+i*t.displayIndex+"px",width:i+"px",top:this.calendar.sheetHourHeight/60*s+"px",height:this.calendar.sheetHourHeight/60*(n-s)+"px","z-index":t.resizing?20:15,"border-bottom":t.resizing?"1px dotted #fff":0}},e.prototype.getMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.calendarContent.clientWidth-this.calendar.sidebarWidth-e-this.sheetTimeWidth)/3,a=new moment(this.setdate).hour(0).minute(0).second(0),r=new moment(a).add(moment.duration(3,"d")),i=0<+t.start.diff(a,"days")?+t.start.diff(a,"days"):0,o=i*n,l=(3-(i+(0<+t.end.diff(r,"days")?0:Math.abs(+t.end.diff(r,"days")))))*n;return this.sheetDays.some(function(e){if(-1<e.items.indexOf(t))return s=e.items.indexOf(t),!0}),{width:l+"px",left:o+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.getMultiEventsContainerStyle=function(){for(var e=1,t=0,s=this.sheetDays;t<s.length;t++){var n=s[t];e=n.items.length>e?n.items.length:e}return{height:this.calendar.multiEventHeight*e+"px"}},e.prototype.displayDate=function(e,t){switch(e){case"day":return t.format("ddd");case"date":return t.format(this.isDashlet?"D, MMM":"D")}},e.prototype.getTimeColStyle=function(){return{width:this.sheetTimeWidth+"px"}},e.prototype.getDayColStyle=function(){return{width:"calc(100% / 3)"}},e.prototype.getDaysContainerStyle=function(){var e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width;return{width:this.calendarContent.clientWidth-this.calendar.sidebarWidth-e-this.sheetTimeWidth+"px"}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.getSheetStyle=function(){return this.footerContainer&&this.calendar.asPicker?{height:this.footerContainer.offsetTop-this.calendarsheet.element.nativeElement.offsetTop+"px","margin-top":"-1px"}:{height:"calc(100% - "+this.headerContainer.element.nativeElement.clientHeight+"px)","margin-top":"-1px"}},e.prototype.getHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px"}},e.prototype.getHalfHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+this.calendar.sheetHourHeight/2+"px",left:this.sheetTimeWidth+"px",width:"calc(100% - "+this.sheetTimeWidth+"px)"}},e.prototype.getHourLabelStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",width:this.sheetTimeWidth+"px"}},e.prototype.getDayDividerStyle=function(e){var t=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,s=this.calendarContent.clientWidth-this.calendar.sidebarWidth-t;return{left:this.sheetTimeWidth+(s-this.sheetTimeWidth)/3*e+"px",top:"0px",height:this.calendar.sheetHourHeight*this.sheetHours.length+"px"}},e.prototype.gotoDay=function(e){if(!this.calendar.asPicker){var t=moment(e);this.navigateday.emit(t)}},e.prototype.getDropTargetStyle=function(e,t){var s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=this.calendarContent.clientWidth-this.calendar.sidebarWidth-s;return{left:this.sheetTimeWidth+(n-this.sheetTimeWidth)/3*t+"px",width:(n-this.sheetTimeWidth)/3+"px",top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",height:this.calendar.sheetHourHeight+"px"}},e.prototype.notLastHour=function(e){return e<this.sheetHours.length},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"headerContainer",void 0),__decorate([core_1.ViewChild("scrollcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"scrollContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),__decorate([core_1.Input("footercontainer"),__metadata("design:type",Object)],e.prototype,"footerContainer",void 0),__decorate([core_1.Input("calendarcontent"),__metadata("design:type",Object)],e.prototype,"calendarContent",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-three-days",template:'<div #headercontainer class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [ngStyle]="getTimeColStyle()">{{offset}}</div><div class="slds-border--right" [ngStyle]="getDaysContainerStyle()"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" class="slds-border--left" [ngStyle]="getDayColStyle()"><div class="slds-p-vertical--xx-small slds-border--bottom" [ngClass]="dayTextContainerClass"><div class="slds-p-left--x-small slds-truncate" [ngClass]="dayTextClass" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'day\', sheetDay.date)}}</div><div class="slds-p-left--x-small slds-truncate" [ngClass]="dateTextClass"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.date)" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'date\',sheetDay.date)}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of allMultiEvents; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getMultiEventStyle(event)" [event]="event"></calendar-sheet-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" [ngStyle]="getDayColStyle()" [style.min-height]="calendar.multiEventHeight + \'px\'" class="slds-border--left"><div *ngFor="let item of sheetDay.items; trackBy: trackByFn" [style.height]="calendar.multiEventHeight + \'px\'"></div></div></div></div><div #scrollcontainer aria-hidden="true" class="spicecrm-scrollbar" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div #calendarsheet [ngStyle]="getSheetStyle()" class="slds-scrollable spicecrm-scrollbar slds-is-relative"><ng-container *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--top slds-size--1-of-1" [ngStyle]="getHourDividerStyle(index)"></div><ng-container *ngIf="notLastHour(index)"><div class="slds-is-absolute slds-border--top" [ngStyle]="getHalfHourDividerStyle(index)"></div><div class="slds-is-absolute slds-text-align--center" [ngStyle]="getHourLabelStyle(index)">{{sheetHour}}:00</div><calendar-sheet-drop-target [hour]="sheetHour" [day]="sheetDay" class="slds-is-absolute" *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" [ngStyle]="getDropTargetStyle(index, sheetDay.index)">{{sheetHour + \',\' + sheetDay.index}}</calendar-sheet-drop-target></ng-container></ng-container><ng-container *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle(sheetDay.index)"></div></ng-container><ng-container *ngFor="let event of allEvents; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" [event]="event"></calendar-sheet-event></ng-container></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,core_1.ChangeDetectorRef,services_1.backend,calendar])],e)}();exports.CalendarSheetThreeDays=CalendarSheetThreeDays;var CalendarSheetWeek=function(){function e(e,t,s,n,a,r,i){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.cdr=a,this.backend=r,this.calendar=i,this.navigateday=new core_1.EventEmitter,this.sheetDays=[],this.setdate={},this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.calendarContent=void 0,this.sheetHours=[],this.sheetTopMargin=0,this.ownerEvents=[],this.ownerMultiEvents=[],this.userEvents=[],this.userMultiEvents=[],this.otherEvents=[],this.googleEvents=[],this.googleMultiEvents=[],this.buildHours(),this.sheetDays=this.buildSheetDays()}return Object.defineProperty(e.prototype,"sheetTimeWidth",{get:function(){return this.calendar.sheetTimeWidth},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"offset",{get:function(){return moment.tz(moment.tz.guess()).format("z Z")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.calendar.arrangeEvents(this.ownerEvents.concat(this.userEvents,this.googleEvents))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"allMultiEvents",{get:function(){return this.ownerMultiEvents.concat(this.otherEvents,this.userMultiEvents,this.googleMultiEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).day(this.calendar.weekStartDay).hour(this.calendar.startHour).minute(0).second(0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"endDate",{get:function(){return new moment(this.startDate).add(moment.duration(this.calendar.weekDaysCount-1,"d")).hour(this.calendar.endHour)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){this.sheetDays=this.buildSheetDays(),e.setdate&&this.getEvents(),(e.usersCalendars||e.setdate)&&this.getUsersEvents(),(e.otherCalendars||e.setdate)&&this.getOtherEvents(),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngAfterViewInit=function(){this.calendarsheet.element.nativeElement.scrollTop=8*this.calendar.sheetHourHeight},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.arrangeMultiEvents=function(){var e=this;this.sheetDays.forEach(function(e){return e.items=[]});for(var t=function(t){for(var e=0,s=r.sheetDays;e<s.length;e++)for(var n=s[e],a=moment(t.start);a.diff(t.end)<=0;a.add(1,"days"))a.date()!=n.date.date()||n.items.some(function(e){return e.id==t.id})||n.items.push(t)},r=this,s=0,n=this.allMultiEvents;s<n.length;s++){t(n[s])}this.sheetDays.forEach(function(e){e.items=e.items.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),e.items.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}),this.allMultiEvents.forEach(function(n){var a=null;e.sheetDays.forEach(function(s){s.items.forEach(function(e,t){e.id==n.id&&(null!=a&&0<n.end.diff(n.start,"days")?(s.items.splice(t,1),s.items.splice(a,0,n)):a=t)})})})},e.prototype.correctHours=function(e){var n=this;return e.forEach(function(e){if(!e.isMulti){var t=e.end.hour()>n.calendar.startHour&&e.start.hour()<n.calendar.startHour,s=e.start.hour()<n.calendar.endHour&&e.end.hour()>n.calendar.endHour;t&&(e.start=e.start.hour(n.calendar.startHour).minute(0)),s&&(e.end=e.end.hour(n.calendar.endHour).minute(59))}}),e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.ownerMultiEvents=[],this.arrangeMultiEvents(),this.calendar.loadEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.ownerEvents=e.filter(function(e){return!e.isMulti}),t.ownerMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleMultiEvents=[],this.arrangeMultiEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate,this.endDate).subscribe(function(e){0<e.length&&(e=t.correctHours(e),e=t.filterEvents(e),t.googleEvents=e.filter(function(e){return!e.isMulti}),t.googleMultiEvents=e.filter(function(e){return e.isMulti}),t.arrangeMultiEvents())})},e.prototype.getUsersEvents=function(){var s=this;if(this.userEvents=[],this.userMultiEvents=[],this.arrangeMultiEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate,n.endDate,t.id).subscribe(function(e){0<e.length&&(e=s.correctHours(e),(e=s.filterEvents(e)).forEach(function(e){e.color=t.color,e.visible=t.visible,e.isMulti?(s.userMultiEvents.push(e),s.arrangeMultiEvents()):s.userEvents.push(e)}))})},n=this,t=0,a=this.calendar.usersCalendars;t<a.length;t++){e(a[t])}},e.prototype.getOtherEvents=function(){var s=this;if(this.otherEvents=[],this.arrangeMultiEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate.hour(0).minute(0).second(0),n.endDate.hour(0).minute(0).second(0),t.id,!0).subscribe(function(e){0<e.length&&e.forEach(function(e){e.color=t.color,e.visible=t.visible,s.otherEvents.push(e),s.arrangeMultiEvents()})})},n=this,t=0,a=this.calendar.otherCalendars;t<a.length;t++){e(a[t])}},e.prototype.filterEvents=function(e,t){var s=this;return void 0===t&&(t=void 0),e.filter(function(e){return e.end.hour()>s.calendar.startHour||e.start.hour()<s.calendar.endHour||"absence"==e.type})},e.prototype.buildSheetDays=function(){for(var e=[],t=0,s=this.calendar.weekStartDay;t<this.calendar.weekDaysCount;){var n=new moment(this.setdate);n.day(s),e.push({index:t,date:moment(n),day:s,items:[]}),t++,s++}return e},e.prototype.isTodayStyle=function(e){var t=new moment;return{color:t.year()===e.year()&&t.month()===e.month()&&t.date()==e.date()?this.calendar.todayColor:"inherit"}},e.prototype.getEventStyle=function(e){var t=1==this.calendar.weekStartDay&&0==e.start.day()?6:e.start.day()-this.calendar.weekStartDay,s=60*(e.start.hour()-this.calendar.startHour)+e.start.minute(),n=60*(e.end.hour()-this.calendar.startHour)+e.end.minute(),a=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,r=this.calendarContent.clientWidth-this.calendar.sidebarWidth-a,i=(r-this.sheetTimeWidth)/this.calendar.weekDaysCount/(0<e.maxOverlay?e.maxOverlay:1);return{left:this.sheetTimeWidth+(r-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+i*e.displayIndex+"px",width:i+"px",top:this.calendar.sheetHourHeight/60*s+"px",height:this.calendar.sheetHourHeight/60*(n-s)+"px","z-index":e.resizing?20:15,"border-bottom":e.resizing?"1px dotted #fff":0}},e.prototype.getMultiEventStyle=function(t){var s=null,e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=(this.calendarContent.clientWidth-this.calendar.sidebarWidth-e-this.sheetTimeWidth)/this.calendar.weekDaysCount,a=new moment(this.setdate).day(this.calendar.weekStartDay).hour(0).minute(0).second(0),r=new moment(a).add(moment.duration(this.calendar.weekDaysCount,"d")),i=0<+t.start.diff(a,"days")?+t.start.diff(a,"days"):0,o=0<+t.end.diff(r,"days")?0:Math.abs(+t.end.diff(r,"days")),l=i*n,d=(this.calendar.weekDaysCount-(i+o))*n;return this.sheetDays.some(function(e){if(-1<e.items.indexOf(t))return s=e.items.indexOf(t),!0}),{width:d+"px",left:l+"px",height:this.calendar.multiEventHeight+"px",top:this.calendar.multiEventHeight*s+"px"}},e.prototype.displayDate=function(e,t){return t.format(e)},e.prototype.getTimeColStyle=function(){return{width:this.sheetTimeWidth+"px"}},e.prototype.getDayColStyle=function(){return{width:"calc(100% / "+this.calendar.weekDaysCount+")"}},e.prototype.getDaysContainerStyle=function(){var e=this.scrollContainer.element.nativeElement.getBoundingClientRect().width;return{width:this.calendarContent.clientWidth-this.calendar.sidebarWidth-e-this.sheetTimeWidth+"px"}},e.prototype.buildHours=function(){this.sheetHours=[];for(var e=this.calendar.startHour;e<=this.calendar.endHour;)this.sheetHours.push(e),e++},e.prototype.getSheetStyle=function(){return{height:this.calendarContent.getBoundingClientRect().height-this.headerContainer.element.nativeElement.getBoundingClientRect().height+"px","margin-top":"-1px"}},e.prototype.getHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px"}},e.prototype.getHalfHourDividerStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+this.calendar.sheetHourHeight/2+"px",left:this.sheetTimeWidth+"px",width:"calc(100% - "+this.sheetTimeWidth+"px)"}},e.prototype.getHourLabelStyle=function(e){return{top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",width:this.sheetTimeWidth+"px"}},e.prototype.getDayDividerStyle=function(e){var t=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,s=this.calendarContent.clientWidth-this.calendar.sidebarWidth-t;return{left:this.sheetTimeWidth+(s-this.sheetTimeWidth)/this.calendar.weekDaysCount*e+"px",top:"0px",height:this.calendar.sheetHourHeight*this.sheetHours.length+"px"}},e.prototype.gotoDay=function(e){var t=moment(this.setdate);t.day(e),this.navigateday.emit(t)},e.prototype.getDropTargetStyle=function(e,t){var s=this.scrollContainer.element.nativeElement.getBoundingClientRect().width,n=this.calendarContent.clientWidth-this.calendar.sidebarWidth-s;return{left:this.sheetTimeWidth+(n-this.sheetTimeWidth)/this.calendar.weekDaysCount*t+"px",width:(n-this.sheetTimeWidth)/this.calendar.weekDaysCount+"px",top:this.sheetTopMargin+this.calendar.sheetHourHeight*e+"px",height:this.calendar.sheetHourHeight+"px"}},e.prototype.notLastHour=function(e){return e<this.sheetHours.length},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"headerContainer",void 0),__decorate([core_1.ViewChild("scrollcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"scrollContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),__decorate([core_1.Input("calendarcontent"),__metadata("design:type",Object)],e.prototype,"calendarContent",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-week",template:'<div #headercontainer class="slds-grid slds-border--bottom"><div class="slds-align--absolute-center slds-m-around--none slds-p-vertical--x-small slds-text-align--center" [ngStyle]="getTimeColStyle()">{{offset}}</div><div class="slds-border--right" [ngStyle]="getDaysContainerStyle()"><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" class="slds-border--left" [ngStyle]="getDayColStyle()"><div class="slds-p-top--xx-small"><div class="slds-text-body--regular slds-p-left--x-small" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'ddd\', sheetDay.date)}}</div><div class="slds-p-left--x-small slds-p-bottom--xx-small slds-border--bottom slds-text-heading--large"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay.day)" [ngStyle]="isTodayStyle(sheetDay.date)">{{displayDate(\'D\',sheetDay.date)}}</a></div></div></div></div><div class="slds-is-relative"><ng-container *ngFor="let event of allMultiEvents; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getMultiEventStyle(event)" [event]="event"></calendar-sheet-event></ng-container></div><div class="slds-grid"><div *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" [ngStyle]="getDayColStyle()" [style.min-height]="calendar.multiEventHeight + \'px\'" class="slds-border--left"><div *ngFor="let item of sheetDay.items; trackBy: trackByFn" [style.height]="calendar.multiEventHeight + \'px\'"></div></div></div></div><div #scrollcontainer class="spicecrm-scrollbar" aria-hidden="true" style="overflow: scroll; visibility: hidden; flex: none"></div></div><div #calendarsheet [ngStyle]="getSheetStyle()" class="slds-scrollable spicecrm-scrollbar slds-is-relative"><ng-container *ngFor="let sheetHour of sheetHours; let index = index; trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--top slds-size--1-of-1" [ngStyle]="getHourDividerStyle(index + 1)"></div><ng-container *ngIf="notLastHour(index)"><div class="slds-is-absolute slds-border--top" [ngStyle]="getHalfHourDividerStyle(index)"></div><div class="slds-is-absolute slds-text-align--center" [ngStyle]="getHourLabelStyle(index)">{{sheetHour}}:00</div><calendar-sheet-drop-target *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate" [hour]="sheetHour" [day]="sheetDay" [ngStyle]="getDropTargetStyle(index, sheetDay.index)">{{sheetHour + \',\' + sheetDay.index}}</calendar-sheet-drop-target></ng-container></ng-container><ng-container *ngFor="let sheetDay of sheetDays; trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle(sheetDay.index)"></div></ng-container><ng-container *ngFor="let event of allEvents; trackBy: trackByFn"><calendar-sheet-event [ngStyle]="getEventStyle(event)" [event]="event"></calendar-sheet-event></ng-container></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,core_1.ChangeDetectorRef,services_1.backend,calendar])],e)}();exports.CalendarSheetWeek=CalendarSheetWeek;var CalendarSheetMonth=function(){function e(e,t,s,n,a,r,i,o){var l=this;this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=a,this.renderer=r,this.cdr=i,this.calendar=o,this.navigateday=new core_1.EventEmitter,this.setdate={},this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.currentGrid=[],this.offsetHeight=20,this.maxEventsPerBox=1,this.resizeHandler={},this.ownerEvents=[],this.otherEvents=[],this.userEvents=[],this.googleEvents=[],this.resizeHandler=this.renderer.listen("window","resize",function(){return l.setMaxEvents()})}return Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.ownerEvents.concat(this.userEvents,this.otherEvents,this.googleEvents)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventHeight",{get:function(){return this.calendar.isMobileView?20:25},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.setMaxEvents(),this.cdr.detectChanges()},e.prototype.ngOnChanges=function(e){this.buildGrid(),e.setdate&&this.getEvents(),(e.usersCalendars||e.setdate)&&this.getUsersEvents(),(e.otherCalendars||e.setdate)&&this.getOtherEvents(),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.ngOnDestroy=function(){this.cdr.detach(),this.resizeHandler&&this.resizeHandler()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.startDate=function(){return new moment(this.setdate).date(1).hour(0).minute(0).second(0)},e.prototype.endDate=function(){return new moment(this.startDate()).endOf("month")},e.prototype.setMaxEvents=function(){var e=this.boxContainer.element.nativeElement.clientHeight;this.maxEventsPerBox=Math.floor((e-2*this.offsetHeight)/this.eventHeight)},e.prototype.getSheetDays=function(){for(var e=[],t=0,s=this.calendar.weekStartDay,n=moment.weekdaysShort();t<this.calendar.weekDaysCount;)e.push({index:t,text:n[s]}),t++,6<++s&&(s=0);return e},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.arrangeEvents(),this.calendar.loadEvents(this.startDate(),this.endDate()).subscribe(function(e){0<e.length&&(e.forEach(function(e){e.start=t.resetTime(e.start),e.end=t.resetTime(e.end)}),t.ownerEvents=e,t.arrangeEvents())})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.arrangeEvents(),this.googleIsVisible&&!this.calendar.isMobileView&&this.calendar.loadGoogleEvents(this.startDate(),this.endDate()).subscribe(function(e){0<e.length&&(e=e.map(function(e){return e.start=t.resetTime(e.start),e.end=t.resetTime(e.end),e}),t.googleEvents=e,t.arrangeEvents())})},e.prototype.getUsersEvents=function(){var s=this;if(this.userEvents=[],this.arrangeEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate(),n.endDate(),t.id).subscribe(function(e){0<e.length&&e.forEach(function(e){e.color=t.color,e.visible=t.visible,e.start=s.resetTime(e.start),e.end=s.resetTime(e.end),s.userEvents.push(e),s.arrangeEvents()})})},n=this,t=0,a=this.calendar.usersCalendars;t<a.length;t++){e(a[t])}},e.prototype.getOtherEvents=function(){var s=this;if(this.otherEvents=[],this.arrangeEvents(),!this.calendar.isMobileView)for(var e=function(t){if(!t.visible)return"continue";n.calendar.loadEvents(n.startDate(),n.endDate(),t.id,!0).subscribe(function(e){0<e.length&&e.forEach(function(e){e.color=t.color,e.visible=t.visible,e.start=s.resetTime(e.start),e.end=s.resetTime(e.end),s.otherEvents.push(e),s.arrangeEvents()})})},n=this,t=0,a=this.calendar.otherCalendars;t<a.length;t++){e(a[t])}},e.prototype.resetTime=function(e){return e=moment(e.hour(0).minute(0).second(0)).format("YYYY-MM-DD HH:mm:ss"),moment(e)},e.prototype.arrangeEvents=function(){for(var i=this,e=function(r){a.currentGrid[r].forEach(function(e){return e.items=[]});for(var e=function(t){t.hasOwnProperty("weeksI")||(t.weeksI=[]);for(var e=0;e<a.currentGrid[r].length;e++){for(var s=a.currentGrid[r][e],n=moment(t.start);n.diff(t.end)<=0;n.add(1,"days"))n.date()==s.day&&s.month==n.month()&&(s.items.some(function(e){return e.id==t.id})||s.items.push(t),-1==t.weeksI.indexOf(r)&&t.weeksI.push(r));s.items=s.items.filter(function(e){return e.hasOwnProperty("visible")&&e.visible||!e.hasOwnProperty("visible")}),s.items.sort(function(e,t){return e.start.isBefore(t.start)?-1:e.start.diff(e.end,"days")<t.start.diff(t.end,"days")?-1:0})}},t=0,s=a.allEvents;t<s.length;t++){e(s[t])}a.allEvents.forEach(function(n){var a=null;i.currentGrid[r].forEach(function(s){s.items.forEach(function(e,t){e.id==n.id&&(null!=a&&0<n.end.diff(n.start,"days")?(s.items.splice(t,1),s.items.splice(a,0,n)):a=t)})})})},a=this,t=0;t<this.currentGrid.length;t++)e(t);return this.allEvents},e.prototype.gotoDay=function(e){var t=moment(this.setdate);t.month(e.month).date(e.day),this.navigateday.emit(t)},e.prototype.getDayColStyle=function(e){var t=new moment,s=t.format("ddd"),n=this.calendar.calendarDate,a=n.year()==t.year()&&n.month()==t.month()&&s==e;return{width:"calc(100% / "+this.calendar.weekDaysCount+")",color:a?this.calendar.todayColor:"inherit","font-weight":a?"600":"inherit"}},e.prototype.getSheetStyle=function(){return{height:"calc(100vh - "+(this.calendarsheet.element.nativeElement.offsetTop+20)+"px)"}},e.prototype.getDayDividerStyle=function(e){return{left:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount*e+"px",top:"0px",height:"100%"}},e.prototype.buildGrid=function(){this.currentGrid=[];var e=new moment(this.setdate);e.date(1),e.day(this.calendar.weekStartDay);for(var t=0;t<6;){var s=0,n=[];if(e.year()<this.setdate.year()||e.month()<=this.setdate.month()){for(;s<this.calendar.weekDaysCount;){n.push({day:e.date(),month:e.month(),items:[]});var a=7-this.calendar.weekDaysCount;s==this.calendar.weekDaysCount-1&&this.calendar.weekDaysCount<7&&e.add(a,"d"),e.add(1,"d"),s++}this.currentGrid.push(n)}t++}},e.prototype.notLastWeek=function(e){return e<this.currentGrid.length},e.prototype.notThisMonth=function(e){return e!==this.setdate.month()},e.prototype.getWeekDividerStyle=function(e){return{top:"calc((100% / "+this.currentGrid.length+") * "+e+" )"}},e.prototype.getBoxStyle=function(e,t,s){return{left:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount*t+"px",top:"calc((100% / "+this.currentGrid.length+") * "+e+" )",color:this.notThisMonth(s)?"#9faab5":"inherit","background-color":this.notThisMonth(s)?"#f4f6f9":"transparent",width:this.calendarsheet.element.nativeElement.clientWidth/this.calendar.weekDaysCount+"px",height:"calc(100% / "+this.currentGrid.length+")"}},e.prototype.getEventStyle=function(s,e){var n=this,a=null,r=null,i=0,o="block",t=this.calendarsheet.element.nativeElement;return this.currentGrid[e].forEach(function(e,t){-1<e.items.indexOf(s)&&(i++,a=null==a?t:a,t,r=null==r?e.items.indexOf(s):r,o=r>=n.maxEventsPerBox?"none":o)}),{left:t.clientWidth/this.calendar.weekDaysCount*a+"px",width:t.clientWidth/this.calendar.weekDaysCount*i+"px",top:this.offsetHeight+t.clientHeight/this.currentGrid.length*e+this.eventHeight*r+"px",height:this.eventHeight+"px",display:o}},e.prototype.isTodayStyle=function(e,t){var s=this.calendar.calendarDate.year(),n=new moment,a=s===n.year()&&n.month()===t&&n.date()==e;return{"border-radius":"50%","line-height":"1rem","text-align":"center",width:"1rem",height:"1rem",display:"block",color:a?"#fff":"inherit","background-color":a?this.calendar.todayColor:"inherit"}},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.ViewChild("boxcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"boxContainer",void 0),__decorate([core_1.ViewChild("morecontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"moreContainer",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-month",template:'<div class="slds-border--bottom"><div class="slds-grid"><div class="slds-text-align--center slds-p-vertical--small slds-border--left" *ngFor="let sheetDay of getSheetDays(); trackBy: trackByFnDate" [ngStyle]="getDayColStyle(sheetDay.text)">{{sheetDay.text}}</div></div></div><div #calendarsheet [ngStyle]="getSheetStyle()" class="slds-scrollable slds-p-vertical--medium slds-is-relative"><ng-container *ngFor="let sheetWeek of currentGrid; let i = index; trackBy: trackByFnDate"><div #boxcontainer *ngFor="let sheetDay of sheetWeek; let j = index; trackBy: trackByFn" class="slds-is-absolute slds-truncate" [ngStyle]="getBoxStyle(i, j, sheetDay.month)"><div class="slds-p-around--xx-small" [style.height]="offsetHeight + \'px\'"><a href="javascript:void(0);" class="slds-text-link--reset" (click)="gotoDay(sheetDay)" [ngStyle]="isTodayStyle(sheetDay.day, sheetDay.month)">{{sheetDay.day}}</a></div><div class="slds-grid slds-grid--align-center slds-is-absolute" style="bottom: 0;width: 100%" [style.height]="offsetHeight + \'px\'"><calendar-more-button *ngIf="sheetDay.items.length > 0 && sheetDay.items.length > maxEventsPerBox" [sheetday]="sheetDay" [moreevents]="sheetDay.items" [ismobileview]="calendar.isMobileView"></calendar-more-button></div></div><div *ngIf="notLastWeek(i)" class="slds-is-absolute slds-border--bottom slds-size--1-of-1" [ngStyle]="getWeekDividerStyle(i)"></div></ng-container><ng-container *ngFor="let sheetDay of getSheetDays(); trackBy: trackByFnDate"><div class="slds-is-absolute slds-border--left" [ngStyle]="getDayDividerStyle(sheetDay.index)"></div></ng-container><ng-container *ngFor="let event of allEvents; trackBy: trackByFn"><ng-container *ngFor="let week of event.weeksI; trackBy: trackByFn"><calendar-sheet-event [event]="event" [ismonthsheet]="true" style="padding: 1px 0" [ngStyle]="getEventStyle(event, week)"></calendar-sheet-event></ng-container></ng-container></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.backend,core_1.Renderer2,core_1.ChangeDetectorRef,calendar])],e)}();exports.CalendarSheetMonth=CalendarSheetMonth;var CalendarSheetSchedule=function(){function e(e,t,s,n,a,r,i){this.language=e,this.broadcast=t,this.navigation=s,this.elementRef=n,this.backend=a,this.session=r,this.calendar=i,this.navigateday=new core_1.EventEmitter,this.untildate$=new core_1.EventEmitter,this.setdate={},this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.allevents=[],this.ownerEvents=[],this.otherEvents=[],this.userEvents=[],this.googleEvents=[],this.untilDate={},this.untilDate=(new moment).hour(0).minute(0).second(0).add(1,"M")}return Object.defineProperty(e.prototype,"allEvents",{get:function(){return this.allevents},set:function(e){var t=this.groupByDay(this.ownerEvents.concat(this.userEvents,this.otherEvents,this.googleEvents));t.sort(function(e,t){return e.date-t.date}),this.allevents=t},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"showNoneMsg",{get:function(){return 0==this.allEvents.length&&this.calendar.isDashlet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"startDate",{get:function(){return new moment(this.setdate).hour(0).minute(0).second(0)},enumerable:!0,configurable:!0}),e.prototype.ngOnChanges=function(e){e.setdate&&(this.setUntilDate(),this.getEvents()),(e.usersCalendars||e.setdate)&&this.getUsersEvents(),(e.otherCalendars||e.setdate)&&this.getOtherEvents(),(e.googleIsVisible||e.setdate)&&this.getGoogleEvents()},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.trackByFnDate=function(e,t){return e},e.prototype.setUntilDate=function(){this.untilDate=moment(this.setdate).add(1,"M"),this.untildate$.emit(this.untilDate)},e.prototype.getUntilDate=function(){return this.untilDate.format("MMM D, Y")},e.prototype.groupByDay=function(e){for(var a=[],r=new moment(this.setdate).hour(0).minute(0).second(0),t=0,s=e;t<s.length;t++)for(var i=s[t],n=new moment(i.start).hour(0).minute(0).second(0),o=new moment(i.end).hour(0).minute(0).second(0),l=function(s){var e=r.year()==s.year()&&r.month()==s.month()&&r.date()==s.date();if(s.isAfter(r)||e){var t={year:s.year(),month:s.month(),day:s.date(),date:moment(s),events:[i]},n=-1;a.some(function(e,t){if(e.year==s.year()&&e.month==s.month()&&e.day==s.date())return n=t,!0}),0<a.length&&-1<n?a[n].events.push(i):a.push(t)}},d=moment(n);d.diff(o,"days")<=0;d.add(1,"days"))l(d);return a},e.prototype.getEvents=function(){var t=this;this.ownerEvents=[],this.allEvents=this.allevents.slice(),this.calendar.loadEvents(this.startDate,this.untilDate).subscribe(function(e){0<e.length&&(t.ownerEvents=e),t.allEvents=t.allevents.slice()})},e.prototype.getGoogleEvents=function(){var t=this;this.googleEvents=[],this.googleIsVisible&&!this.calendar.isMobileView?this.calendar.loadGoogleEvents(this.startDate,this.untilDate).subscribe(function(e){t.googleEvents=e,t.allEvents=t.allevents.slice()}):this.allEvents=this.allevents.slice()},e.prototype.getUsersEvents=function(){var n=this;if(this.userEvents=[],this.allEvents=this.allevents.slice(),!this.calendar.isMobileView)for(var e=function(e){var t=a.calendar.usersCalendars[e],s=a.calendar.usersCalendars.length==e+1;a.calendar.loadEvents(a.startDate,a.untilDate,t.id).subscribe(function(e){0<e.length?e.forEach(function(e){e.color=t.color,e.visible=t.visible,t.visible&&n.userEvents.push(e),s&&(n.allEvents=n.allevents.slice())}):s&&(n.allEvents=n.allevents.slice())})},a=this,t=0;t<this.calendar.usersCalendars.length;t++)e(t)},e.prototype.getOtherEvents=function(){var n=this;if(this.otherEvents=[],this.allEvents=this.allevents.slice(),!this.calendar.isMobileView)for(var e=function(e){var t=a.calendar.otherCalendars[e],s=a.calendar.otherCalendars.length==e+1;a.calendar.loadEvents(a.startDate,a.untilDate,t.id,!0).subscribe(function(e){0<e.length?e.forEach(function(e){e.color=t.color,e.visible=t.visible,t.visible&&n.otherEvents.push(e),s&&(n.allEvents=n.allevents.slice())}):s&&(n.allEvents=n.allevents.slice())})},a=this,t=0;t<this.calendar.otherCalendars.length;t++)e(t)},e.prototype.getShortDay=function(e){return new moment(e).format("ddd")},e.prototype.getMonthDayYear=function(e){return new moment(e).format("MMM D, YYYY")},e.prototype.goToDay=function(e){this.navigateday.emit(e)},e.prototype.getTime=function(e,t,s){return s?"All Day":e.format("HH:mm")+" - "+t.format("HH:mm")+" "},e.prototype.loadMore=function(){this.untilDate=moment(this.untilDate).add(1,"M"),this.untildate$.emit(this.untilDate),this.getEvents(),this.getGoogleEvents(),this.getUsersEvents(),this.getOtherEvents()},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"navigateday",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"untildate$",void 0),__decorate([core_1.ViewChild("calendarsheet",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarsheet",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"setdate",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),__decorate([core_1.Input("googleisvisible"),__metadata("design:type",Boolean)],e.prototype,"googleIsVisible",void 0),e=__decorate([core_1.Component({selector:"calendar-sheet-schedule",template:'<div style="height: 100%" class="slds-scrollable--y spicecrm-scrollbar"><div *ngFor="let day of allEvents; trackBy: trackByFnDate" class="slds-grid slds-border--bottom"><div class="slds-border--right slds-p-around--xx-small slds-size--1-of-4"><div>{{getShortDay(day.date)}}</div><div><a style="cursor: pointer" class="slds-text-link" (click)="goToDay(day.date)">{{getMonthDayYear(day.date)}}</a></div></div><div class="slds-p-around--xx-small slds-size--3-of-4"><div *ngFor="let event of day.events; trackBy: trackByFn" class="slds-grid slds-grid--vertical-align-center" [style.height]="calendar.multiEventHeight + \'px\'"><div class="slds-button slds-button--icon slds-m-right--x-small slds-p-top--xxx-small" style="height: 100%" [style.color]="event.color"><system-button-icon icon="user" size="small"></system-button-icon></div><div class="slds-truncate slds-size--1-of-4" style="height: 100%;" [title]="getTime(event.start, event.end, event.isMulti)">{{getTime(event.start, event.end, event.isMulti)}}</div><div class="slds-size--3-of-4"><calendar-sheet-event [event]="event" [isschedulesheet]="true" style="position: initial"></calendar-sheet-event></div></div></div></div><div *ngIf="!showNoneMsg" class="slds-grid slds-p-around--small">{{language.getLabel(\'MSG_SHOWING_EVENTS_UNTIL\')}} {{getUntilDate()}} <a style="cursor: pointer" class="slds-text-link slds-m-left--xx-small" (click)="loadMore()">{{language.getLabel(\'LBL_MORE\')}}</a></div><div *ngIf="showNoneMsg" class="slds-align_absolute-center slds-m-top--medium">{{language.getLabel(\'MSG_NO_RECORDS_FOUND\')}}</div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.backend,services_1.session,calendar])],e)}();exports.CalendarSheetSchedule=CalendarSheetSchedule;var CalendarSheetEvent=function(){function e(e,t,s,n,a,r,i){var o=this;this.language=e,this.metadata=t,this.broadcast=s,this.calendar=n,this.elementRef=a,this.model=r,this.renderer=i,this.rearrange=new core_1.EventEmitter,this.fields=[],this.event={},this.isMonthSheet=!1,this.isScheduleSheet=!1,this.mouseMoveListener=void 0,this.mouseUpListener=void 0,this.mouseStart=void 0,this.mouseLast=void 0,this.hidden=!1,this.subscription=new rxjs_1.Subscription,this.lastMoveTimeSpan=0,this.subscription=this.calendar.color$.subscribe(function(e){o.calendar.calendars[e.id]&&o.calendar.calendars[e.id].some(function(e){return o.event.id==e.id})&&(o.event.color=e.color)})}return Object.defineProperty(e.prototype,"isAbsense",{get:function(){return"absence"==this.event.type||"UserAbsences"==this.event.module},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDraggable",{get:function(){return this.canEdit&&!this.event.isMulti&&!this.isMonthSheet},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventClass",{get:function(){return"slds-is-absolute slds-p-bottom--xxx-small"+(this.hidden?" slds-hidden":"")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canEdit",{get:function(){return!(this.owner!=this.event.data.assigned_user_id||this.isScheduleSheet||"event"!=this.event.type&&"absence"!=this.event.type||this.calendar.asPicker||this.calendar.isMobileView||this.calendar.isDashlet)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.calendar.owner},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventStyle",{get:function(){return{height:"100%","border-radius":"2px","background-color":this.isScheduleSheet?"transparent":this.event.color}},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.model.module=this.event.module,this.model.id=this.event.id,this.model.data=this.event.data,this.event.hasOwnProperty("color")||(this.event.color=this.calendar.eventColor)},e.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},e.prototype.dragStart=function(e){var t=this;e.stopPropagation(),this.canEdit?(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("event","cross browser dumb"),this.event.dragging=!0,setTimeout(function(){return t.hidden=!0},0)):e.preventDefault()},e.prototype.dragEnd=function(){this.hidden=!1},e.prototype.onMouseDown=function(e){var t=this;this.mouseStart=e,this.mouseLast=e,this.event.resizing=!0,this.mouseUpListener=this.renderer.listen("document","mouseup",function(e){return t.onMouseUp()}),this.mouseMoveListener=this.renderer.listen("document","mousemove",function(e){return t.onMouseMove(e)}),e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,e.returnValue=!1},e.prototype.onMouseMove=function(e){if(this.canEdit){this.mouseLast=e;var t=this.mouseLast.pageY-this.mouseStart.pageY,s=Math.floor(t/15);if(this.lastMoveTimeSpan!==s){this.lastMoveTimeSpan=s;var n=new moment(this.event.start).add(60*this.event.data.duration_hours+this.event.data.duration_minutes+15*this.lastMoveTimeSpan,"m");this.event.start.hours()===n.hours()&&this.event.start.minutes()===n.minutes()||n.hours()<this.event.start.hours()?(this.event.end=new moment(this.event.start).add(15,"m"),this.lastMoveTimeSpan=this.lastMoveTimeSpan-(60*this.event.data.duration_hours+this.event.data.duration_minutes+15*this.lastMoveTimeSpan)/15+1):this.event.end=n}}},e.prototype.onMouseUp=function(){var t=this;if(this.mouseUpListener(),this.mouseMoveListener(),this.canEdit){if(this.mouseLast.pageY!=this.mouseStart.pageY){var e=60*+this.event.data.duration_hours+ +this.event.data.duration_minutes+15*this.lastMoveTimeSpan;this.event.data.duration_hours=Math.floor(e/60),this.event.data.duration_minutes=e-60*this.event.data.duration_hours,this.model.data.duration_minutes=this.event.data.duration_minutes,this.model.data.duration_hours=this.event.data.duration_hours,this.event.saving=!0,this.model.save().subscribe(function(e){t.event.saving=!1}),this.rearrange.emit()}this.mouseStart=void 0,this.mouseLast=void 0,this.event.resizing=!1,this.lastMoveTimeSpan=0}},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"rearrange",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"event",void 0),__decorate([core_1.Input("ismonthsheet"),__metadata("design:type",Boolean)],e.prototype,"isMonthSheet",void 0),__decorate([core_1.Input("isschedulesheet"),__metadata("design:type",Boolean)],e.prototype,"isScheduleSheet",void 0),__decorate([core_1.HostBinding("class"),__metadata("design:type",Object),__metadata("design:paramtypes",[])],e.prototype,"eventClass",null),__decorate([core_1.HostListener("dragstart",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],e.prototype,"dragStart",null),__decorate([core_1.HostListener("dragend"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"dragEnd",null),e=__decorate([core_1.Component({selector:"calendar-sheet-event",template:'<div class="slds-m-around--xxx-small slds-p-horizontal--xx-small" [class.slds-p-vertical--xx-small]="event.saving" [ngStyle]="eventStyle" [draggable]="isDraggable"><ng-container *ngIf="!event.saving; else saving"><div class="slds-grid slds-grid--align-spread"><div class="slds-truncate" style="height: 100%;"><calendar-event-summary [ismulti]="event.isMulti" [isabsence]="isAbsense" [isschedulesheet]="isScheduleSheet"></calendar-event-summary></div><object-action-menu *ngIf="canEdit" class="slds-m-top--xxx-small" [buttonsize]="\'xx-small\'"></object-action-menu></div><div *ngIf="!event.isMulti && !isMonthSheet && canEdit" draggable="false" class="slds-is-absolute" style="bottom: 0; left: calc(50% - 8px);cursor: ns-resize;" (mousedown)="onMouseDown($event)"><system-utility-icon colorclass="slds-icon-text-white" icon="threedots" size="x-small"></system-utility-icon></div></ng-container><ng-template #saving><system-spinner inverse="true" style="opacity: 0.5;"></system-spinner></ng-template></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.language,services_1.metadata,services_1.broadcast,calendar,core_1.ElementRef,services_1.model,core_1.Renderer2])],e)}();exports.CalendarSheetEvent=CalendarSheetEvent;var CalendarEventSummary=function(){function e(e,t){this.model=e,this.userpreferences=t,this.isMulti=!1,this.isAbsence=!1,this.isScheduleSheet=!1}return Object.defineProperty(e.prototype,"startHour",{get:function(){return this.model.data.date_start?moment(this.model.data.date_start).tz(moment.tz.guess()).add(moment().utcOffset(),"m").format(this.userpreferences.getTimeFormat()):void 0},enumerable:!0,configurable:!0}),e.prototype.getTextClass=function(){return this.isScheduleSheet?"":"slds-text-color--inverse"},__decorate([core_1.Input("ismulti"),__metadata("design:type",Boolean)],e.prototype,"isMulti",void 0),__decorate([core_1.Input("isabsence"),__metadata("design:type",Boolean)],e.prototype,"isAbsence",void 0),__decorate([core_1.Input("isschedulesheet"),__metadata("design:type",Boolean)],e.prototype,"isScheduleSheet",void 0),e=__decorate([core_1.Component({selector:"calendar-event-summary",template:'<span *ngIf="model.module" modelPopOver class="slds-text-link--reset" [ngClass]="getTextClass()">{{model.data.summary_text}}</span> <span *ngIf="!model.module" [title]="model.data.summary_text" class="slds-text-link--reset" [ngClass]="getTextClass()">{{model.data.summary_text}}</span> <span *ngIf="isMulti && startHour && !isAbsence" [ngClass]="getTextClass()">, {{startHour}}</span>'}),__metadata("design:paramtypes",[services_1.model,services_1.userpreferences])],e)}();exports.CalendarEventSummary=CalendarEventSummary;var CalendarSheetDropTarget=function(){function e(e,t){this.calendar=e,this.model=t,this.rearrange=new core_1.EventEmitter,this.hour="",this.day=void 0,this.isDropTarget=!1,this.showPlus=!1}return Object.defineProperty(e.prototype,"content",{get:function(){return this.hour+" "+this.day},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"targetClass",{get:function(){return this.isDropTarget?"slds-is-absolute slds-theme--shade":"slds-is-absolute"},enumerable:!0,configurable:!0}),e.prototype.addEvent=function(){this.day&&this.calendar.addingEvent$.emit(moment(this.day.date).hour(this.hour).minute(0).second(0))},e.prototype.mouseEnter=function(){this.calendar.asPicker&&(this.showPlus=!0)},e.prototype.mouseLeave=function(){this.showPlus=!1},e.prototype.dragOver=function(e){e.preventDefault(),e.stopPropagation()},e.prototype.dragEnter=function(){this.isDropTarget=!0},e.prototype.dragLeave=function(){this.isDropTarget=!1},e.prototype.drop=function(e){var t;e.preventDefault(),e.stopPropagation(),this.calendar.getEvents().some(function(e){if(e.dragging)return t=e,!0}),t&&(t.dragging=!1,this.day&&(t.data.date_start.date(this.day.date.date()),t.data.date_start.month(this.day.date.month()),t.data.date_start.year(this.day.date.year())),t.data.date_start.hour(this.hour),t.data.date_start.minutes(0),t.data.date_end=new moment(t.data.date_start).add(t.data.duration_minutes+60*t.data.duration_hours,"m"),this.day&&(t.start.date(this.day.date.date()),t.start.month(this.day.date.month()),t.start.year(this.day.date.year())),t.start.hour(this.hour),t.start.minutes(0),t.end=new moment(t.start).add(t.data.duration_minutes+60*t.data.duration_hours,"m"),this.saveEvent(t),this.rearrange.emit()),this.isDropTarget=!1,e.preventDefault()},e.prototype.saveEvent=function(t){this.model.module=t.module,this.model.id=t.id,this.model.data=t.data,t.saving=!0,this.model.save().pipe(operators_1.take(1)).subscribe(function(e){t.saving=!1})},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"rearrange",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"hour",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"day",void 0),__decorate([core_1.HostBinding("class"),__metadata("design:type",Object),__metadata("design:paramtypes",[])],e.prototype,"targetClass",null),__decorate([core_1.HostListener("mouseenter"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"mouseEnter",null),__decorate([core_1.HostListener("mouseleave"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"mouseLeave",null),__decorate([core_1.HostListener("dragover",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],e.prototype,"dragOver",null),__decorate([core_1.HostListener("dragenter"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"dragEnter",null),__decorate([core_1.HostListener("dragleave"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"dragLeave",null),__decorate([core_1.HostListener("drop",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],e.prototype,"drop",null),e=__decorate([core_1.Component({selector:"calendar-sheet-drop-target",template:'\n        <div *ngIf="showPlus" style="cursor: pointer" (click)="addEvent()"\n             class="slds-align--absolute-center spice-h-full slds-theme_shade slds-text-heading_medium slds-text-color--inverse-weak">\n            +\n        </div>',providers:[services_1.model]}),__metadata("design:paramtypes",[calendar,services_1.model])],e)}();exports.CalendarSheetDropTarget=CalendarSheetDropTarget;var CalendarMorePopover=function(){function CalendarMorePopover(e,t,s){this.metadata=e,this.calendar=t,this.language=s,this.events=[],this.popoverside="right",this.popoverpos="top",this.styles=null,this.isMobileView=!1,this.sheetDay={},this.parentElementRef=null,this.self=null,this.hidePopoverTimeout={},this.heightcorrection=30,this.widthcorrection=30}return Object.defineProperty(CalendarMorePopover.prototype,"shortDate",{get:function(){return moment(this.calendar.calendarDate).month(this.sheetDay.month).date(this.sheetDay.day).format("D MMM,")},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarMorePopover.prototype,"popoverStyle",{get:function(){if(this.isMobileView)return{left:0,bottom:0,width:"100%"};var e=this.parentElementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return e.left<t.width?this.popoverside="right":this.popoverside="left",e.top-30+t.height>window.innerHeight&&0<e.top-t.height+this.heightcorrection?(this.popoverpos="bottom",{top:e.top-t.height+this.heightcorrection+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-this.widthcorrection+"px"}):(this.popoverpos="top",{top:e.top-this.heightcorrection+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-this.widthcorrection+"px"})},enumerable:!0,configurable:!0}),CalendarMorePopover.prototype.ngOnInit=function(){this.styles=this.popoverStyle},CalendarMorePopover.prototype.closePopover=function(e){var t=this;void 0===e&&(e=!1),e?this.self.destroy():this.hidePopoverTimeout=window.setTimeout(function(){return t.self.destroy()},500)},CalendarMorePopover.prototype.trackByFn=function(e,t){return t.id},CalendarMorePopover.prototype.onMouseOver=function(){this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)},CalendarMorePopover.prototype.onMouseOut=function(){this.closePopover(!0)},CalendarMorePopover.prototype.getNubbinClass=function(){return("left"==this.popoverside?"slds-nubbin--right-":"slds-nubbin--left-")+this.popoverpos},__decorate([core_1.ViewChild("popover",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],CalendarMorePopover.prototype,"popover",void 0),CalendarMorePopover=__decorate([core_1.Component({template:'<div class="slds-popover slds-popover--panel slds-is-fixed" [ngStyle]="popoverStyle" [ngClass]="getNubbinClass()" role="dialog" (mouseenter)="onMouseOver()" (mouseleave)="onMouseOut()"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popover><div class="slds-popover__header" style="padding: .5rem"><header class="slds-text-heading--small slds-m-bottom--x-small">{{shortDate}} {{\'(\'+ events.length +\')\'}} {{language.getLabel(\'LBL_EVENTS\')}}</header><div class="slds-scrollable--y" style="height: 120px"><calendar-more-popover-event *ngFor="let event of events; trackBy: trackByFn" [event]="event" (action$)="closePopover(true)"></calendar-more-popover-event></div></div></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.metadata,calendar,services_1.language])],CalendarMorePopover)}();exports.CalendarMorePopover=CalendarMorePopover;var CalendarMorePopoverEvent=function(){function e(e,t,s,n){var a=this;this.model=e,this.session=t,this.userpreferences=s,this.router=n,this.event={},this.action$=new core_1.EventEmitter,this.modeSubscriber=new rxjs_1.Subscription,this.modeSubscriber=this.model.mode$.subscribe(function(e){return a.action$.emit(e)})}return e.prototype.ngOnInit=function(){this.model.module=this.event.module,this.model.id=this.event.id,this.model.data=this.event.data},e.prototype.ngOnDestroy=function(){this.modeSubscriber.unsubscribe()},e.prototype.goDetails=function(e,t){this.router.navigate(["/module/"+t+"/"+e]),this.action$.emit(!0)},e.prototype.canEdit=function(e){return this.session.authData.userId==e},e.prototype.getStartHour=function(e){return e.data.date_start?moment(e.data.date_start).tz(moment.tz.guess()).add(moment().utcOffset(),"m").format(this.userpreferences.getTimeFormat()):"00:00"},__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"calendarcontent",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"event",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"action$",void 0),e=__decorate([core_1.Component({selector:"calendar-more-popover-event",template:'<div class="slds-m-around--xxx-small slds-p-horizontal--xx-small" style="height: 20px; border-radius: 2px;" [style.background-color]="event.color"><div class="slds-grid slds-grid--align-spread"><div class="slds-truncate" style="height: 100%;" (click)="goDetails(event.id, event.module)"><span [title]="event.data.summary_text" class="slds-text-link--reset slds-text-color--inverse">{{event.data.summary_text}}</span> <span class="slds-text-color--inverse" *ngIf="isMulti">, {{getStartHour(event)}}</span></div><object-action-menu *ngIf="canEdit(event.data.assigned_user_id)" class="slds-m-top--xxx-small" [buttonsize]="\'xx-small\'"></object-action-menu></div></div>',providers:[services_1.view,services_1.model]}),__metadata("design:paramtypes",[services_1.model,services_1.session,services_1.userpreferences,router_1.Router])],e)}();exports.CalendarMorePopoverEvent=CalendarMorePopoverEvent;var CalendarMoreButton=function(){function e(e,t,s,n){this.elementRef=e,this.language=t,this.footer=s,this.metadata=n,this.events=[],this.isMobileView=!1,this.sheetDay={},this.popoverCmp=null,this.showPopoverTimeout={}}return e.prototype.ngOnDestroy=function(){this.popoverCmp&&this.popoverCmp.closePopover(!0)},e.prototype.onMouseOver=function(){var e=this;this.showPopoverTimeout=window.setTimeout(function(){return e.renderPopover()},500)},e.prototype.onMouseOut=function(){this.showPopoverTimeout&&window.clearTimeout(this.showPopoverTimeout),this.popoverCmp&&this.popoverCmp.closePopover()},e.prototype.renderPopover=function(){var t=this;this.metadata.addComponent("CalendarMorePopover",this.footer.modalcontainer).subscribe(function(e){e.instance.events=t.events,e.instance.isMobileView=t.isMobileView,e.instance.sheetDay=t.sheetDay,e.instance.parentElementRef=t.elementRef,t.popoverCmp=e.instance})},__decorate([core_1.Input("moreevents"),__metadata("design:type",Array)],e.prototype,"events",void 0),__decorate([core_1.Input("ismobileview"),__metadata("design:type",Boolean)],e.prototype,"isMobileView",void 0),__decorate([core_1.Input("sheetday"),__metadata("design:type",Object)],e.prototype,"sheetDay",void 0),__decorate([core_1.HostListener("mouseenter"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOver",null),__decorate([core_1.HostListener("mouseleave"),__metadata("design:type",Function),__metadata("design:paramtypes",[]),__metadata("design:returntype",void 0)],e.prototype,"onMouseOut",null),e=__decorate([core_1.Component({selector:"calendar-more-button",template:"<span style=\"cursor: pointer\">{{language.getLabel('LBL_MORE')}}</span>"}),__metadata("design:paramtypes",[core_1.ElementRef,services_1.language,services_1.footer,services_1.metadata])],e)}();exports.CalendarMoreButton=CalendarMoreButton;var CalendarAddCalendar=function(){function CalendarAddCalendar(e,t){this.language=e,this.backend=t,this.calendars=[],this.addCalendar=new core_1.EventEmitter,this.self={}}return CalendarAddCalendar.prototype.getIcon=function(e){return e&&e.split(":")[1]?e.split(":")[1]:e},CalendarAddCalendar.prototype.getSprite=function(e){return e&&e.split(":")[1]?e.split(":")[0]:"standard"},CalendarAddCalendar.prototype.close=function(){this.addCalendar.emit(!1),this.self.destroy()},CalendarAddCalendar.prototype.save=function(e){this.addCalendar.emit(e),this.self.destroy()},CalendarAddCalendar.prototype.trackByFn=function(e,t){return t.id},CalendarAddCalendar=__decorate([core_1.Component({template:'<system-modal size="small"><system-modal-header (close)="close()">{{language.getLabel(\'LBL_ADD_CALENDAR\')}}</system-modal-header><system-modal-content><div class="slds-form-element"><div class="slds-grid slds-wrap"><div *ngFor="let calendar of calendars; trackBy: trackByFn" class="slds-size--1-of-3 slds-p-around--xx-small"><a href="javascript:void(0);" (click)="save(calendar)" class="slds-box slds-box_link slds-box_x-small slds-media"><system-icon [icon]="getIcon(calendar.icon)" [sprite]="getSprite(calendar.icon)" size="large" class="slds-align_absolute-center"></system-icon><div class="slds-media__body slds-p-around_small"><h2 class="slds-truncate slds-text-heading_small slds-truncate">{{language.getLabel(calendar.name)}}</h2></div></a></div></div></div></system-modal-content><system-modal-footer><button class="slds-button slds-button--neutral" (click)="close()">{{language.getLabel(\'LBL_CANCEL\')}}</button></system-modal-footer></system-modal>'}),__metadata("design:paramtypes",[services_1.language,services_1.backend])],CalendarAddCalendar)}();exports.CalendarAddCalendar=CalendarAddCalendar;var CalendarOtherCalendarsMonitor=function(){function e(e,t,s,n){this.language=e,this.recent=t,this.calendar=s,this.fts=n,this.googleIsVisible$=new core_1.EventEmitter,this.searchterm="",this.searchopen=!1,this.resultsList=[],this.recentUsers=[],this.timeout=void 0,this.isLoading=!1,this.usersCalendars=[],this.otherCalendars=[],this.googleIsVisible=!0,this.getRecent()}return Object.defineProperty(e.prototype,"loggedByGoogle",{get:function(){return this.calendar.loggedByGoogle},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"owner",{get:function(){return this.calendar.owner},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchOpen",{get:function(){return this.searchopen},set:function(e){(this.searchopen=e)&&this.getRecent()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lookupMenuStyle",{get:function(){return{display:this.searchOpen?"block":"none",width:this.inputContainer.element.nativeElement.getBoundingClientRect().width+"px"}},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"searchTerm",{get:function(){return this.searchterm},set:function(e){var t=this;clearTimeout(this.timeout),this.timeout=setTimeout(function(){return t.searchterm=e},500),""!=e&&(this.isLoading=!0,this.fts.searchByModules(this.searchterm,["Users"],5,"",{sortfield:"name"}).subscribe(function(e){t.filterResultsList(e.Users.hits.map(function(e){return e._source})),t.isLoading=!1},function(e){return t.isLoading=!1}))},enumerable:!0,configurable:!0}),e.prototype.getRecent=function(){var t=this;this.recent.getModuleRecent("Users").subscribe(function(e){return t.filterRecent(e)})},e.prototype.filterRecent=function(e){var t=this;this.recentUsers=e.filter(function(e){return e.item_id!=t.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.item_id})})},e.prototype.filterResultsList=function(e){var t=this;this.resultsList=e.filter(function(e){return e.id!=t.owner&&null==_.findWhere(t.calendar.usersCalendars,{id:e.id})})},e.prototype.trackByFn=function(e,t){return t.id},e.prototype.addUserCalendar=function(e,t){this.calendar.addUserCalendar(e,t),this.filterRecent(this.recentUsers),this.filterResultsList(this.resultsList)},e.prototype.removeUserCalendar=function(e){this.calendar.removeUserCalendar(e)},e.prototype.removeOtherCalendar=function(e){this.calendar.removeOtherCalendar(e)},e.prototype.toggleVisible=function(t,e){var s=this;switch(e){case"Users":this.calendar.usersCalendars.some(function(e){if(e.id==t)return e.visible=!e.visible,s.calendar.setUserCalendars(s.calendar.usersCalendars.slice()),!0});break;case"Other":this.calendar.otherCalendars.some(function(e){if(e.id==t)return e.visible=!e.visible,s.calendar.setOtherCalendars(s.calendar.otherCalendars.slice()),!0});break;case"Google":this.googleIsVisible=!this.googleIsVisible,this.googleIsVisible$.emit(this.googleIsVisible)}},e.prototype.setColor=function(e,t,s){this.calendar.setColor(e,t,s)},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"googleIsVisible$",void 0),__decorate([core_1.ViewChild("inputcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"inputContainer",void 0),__decorate([core_1.Input("userscalendars"),__metadata("design:type",Array)],e.prototype,"usersCalendars",void 0),__decorate([core_1.Input("othercalendars"),__metadata("design:type",Array)],e.prototype,"otherCalendars",void 0),e=__decorate([core_1.Component({selector:"calendar_other_calendars_monitor",template:'<div class="slds-border--bottom"><label class="slds-form-element__label slds-text-heading--small slds-p-horizontal--small">{{language.getLabel(\'LBL_OTHER_CALENDARS\')}}</label><div class="slds-p-vertical--xx-small"><div *ngIf="loggedByGoogle" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = \'google\'" (mouseleave)="hovered = \'\'" [ngClass]="hovered == \'google\' ? \'slds-theme--shade\' : \'\'"><div class="slds-grid" (click)="toggleVisible(null, \'Google\')" style="cursor: pointer"><img src="https://developers.google.com/identity/images/g-logo.png" style="height: 13px;width:13px;margin-right: 2px; margin-top: 2px" [ngStyle]="!googleIsVisible ? {\'-webkit-filter\': \'grayscale(1)\',\'filter\': \'grayscale(1)\'} : {}"> <a class="slds-text-body--regular slds-truncate" [style.color]="!googleIsVisible ? \'#dddbda\' : \'initial\'">{{language.getLabel(\'MY_GOOGLE_CALENDAR\')}}</a></div></div><div *ngFor="let otherCalendar of otherCalendars; trackBy: trackByFn" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = otherCalendar.id" (mouseleave)="hovered = \'\'" [class.slds-theme--shade]="hovered == otherCalendar.id"><div class="slds-grid" (click)="toggleVisible(otherCalendar.id, \'Other\')" style="cursor: pointer"><div class="slds-button slds-button--icon slds-m-right--xx-small slds-p-top--xxx-small" [style.color]="otherCalendar.visible ? otherCalendar.color : \'#dddbda\'"><system-button-icon icon="choice" size="small"></system-button-icon></div><a class="slds-text-body--regular slds-truncate" [style.color]="otherCalendar.visible ? otherCalendar.color : \'#dddbda\'">{{language.getLabel(otherCalendar.name)}}</a></div><div><calendar-color-picker *ngIf="hovered == otherCalendar.id" (color$)="setColor(otherCalendar.id, $event, \'Other\')"></calendar-color-picker><button class="slds-button slds-button--icon" (click)="removeOtherCalendar(otherCalendar.id)"><system-button-icon icon="clear" size="small"></system-button-icon></button></div></div><div *ngFor="let usersCalendar of usersCalendars; trackBy: trackByFn" class="slds-form-element slds-grid slds-grid--align-spread slds-p-horizontal--small slds-p-vertical--xxx-small" (mouseenter)="hovered = usersCalendar.id" (mouseleave)="hovered = \'\'" [class.slds-theme--shade]="hovered == usersCalendar.id"><div class="slds-grid" (click)="toggleVisible(usersCalendar.id, \'Users\')" style="cursor: pointer"><div class="slds-button slds-button--icon slds-m-right--xx-small slds-p-top--xxx-small" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'"><system-button-icon icon="user" size="small"></system-button-icon></div><a class="slds-text-body--regular slds-truncate" [style.color]="usersCalendar.visible ? usersCalendar.color : \'#dddbda\'">{{usersCalendar.name}}</a></div><div><calendar-color-picker *ngIf="hovered == usersCalendar.id" (color$)="setColor(usersCalendar.id, $event, \'Users\')"></calendar-color-picker><button class="slds-button slds-button--icon" (click)="removeUserCalendar(usersCalendar.id)"><system-button-icon icon="clear" size="small"></system-button-icon></button></div></div></div></div><div class="slds-form-element__control slds-p-around--x-small slds-border--bottom slds-theme--default" style="height: 52px"><div #inputcontainer class="slds-form-element slds-lookup"><div class="slds-form-element__control slds-grid slds-box--border slds-m-vertical--xxx-small"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="searchTerm" (focus)="searchOpen = true" (blur)="searchOpen = false" [placeholder]="language.getLabel(\'LBL_ADD\') + \' \' + language.getLabel(\'LBL_USER\') + \' \' + language.getLabel(\'LBL_CALENDAR\')" role="combobox"></div></div></div><div *ngIf="searchOpen" class="slds-lookup__menu slds-size--1-of-4 slds-p-vertical--none" [ngStyle]="lookupMenuStyle"><div *ngIf="searchTerm.length > 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom">{{resultsList.length}} {{language.getLabel(\'LBL_USERS\')}} {{language.getLabel(\'LBL_FOUND\')}}</div><div *ngIf="searchTerm.length == 0" class="slds-theme--shade slds-p-around--xx-small slds-text-body--small slds-text-title--caps slds-border--bottom">{{language.getLabel(\'LBL_RECENTLYVIEWED\')}}</div><ul class="slds-lookup__list" style="height: 175px" role="listbox"><ng-container *ngIf="searchTerm.length > 0"><li *ngFor="let user of resultsList; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.id, user.summary_text)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.summary_text}}</span></div></li></ng-container><ng-container *ngIf="searchTerm.length == 0"><li *ngFor="let user of recentUsers; trackBy: trackByFn" role="presentation" (mousedown)="addUserCalendar(user.item_id, user.item_summary)"><div class="slds-lookup__item-action slds-media" role="option"><system-icon icon="user" size="x-small" divClass="slds-p-around--xxx-small slds-m-right--xxx-small"></system-icon><span class="slds-lookup__result-text">{{user.item_summary}}</span></div></li></ng-container></ul><system-spinner [size]="16" *ngIf="isLoading && resultsList.length == 0"></system-spinner></div></div>'}),__metadata("design:paramtypes",[services_1.language,services_1.recent,calendar,services_1.fts])],e)}();exports.CalendarOtherCalendarsMonitor=CalendarOtherCalendarsMonitor;var CalendarColorPicker=function(){function e(e){this.language=e,this.colors=["e3abec","c2dbf7","9fd6ff","9de7da","9df0c0","fff099","fed49a","d073e0","86baf3","5ebbff","44d8be","3be282","ffe654","ffb758","bd35bd","5779c1","5ebbff","00aea9","3cba4c","f5bc25","f99221","580d8c","001970","0a2399","0b7477","0b6b50","b67e11","b85d0d"],this.color$=new core_1.EventEmitter,this.isOpen=!1}return e.prototype.pickColor=function(e){this.color$.emit("#"+e),this.isOpen=!1},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"color$",void 0),e=__decorate([core_1.Component({selector:"calendar-color-picker",template:'<div class="slds-dropdown-trigger slds-dropdown-trigger_click slds-m-right--x-small" [class.slds-is-open]="isOpen"><button class="slds-button slds-button--icon" aria-haspopup="true" (click)="isOpen = !isOpen"><system-button-icon icon="palette" size="small"></system-button-icon></button><div class="slds-dropdown slds-dropdown--right slds-dropdown_bottom"><div class="slds-color-picker slds-color-picker_swatches-only"><div class="slds-color-picker__selector"><ul class="slds-color-picker__swatches" role="menu"><li *ngFor="let color of colors" class="slds-color-picker__swatch" role="presentation"><a class="slds-color-picker__swatch-trigger slds-is-selected" role="menuitem" (click)="pickColor(color)"><span class="slds-swatch" [style.background-color]="\'#\' + color"><span class="slds-assistive-text">#{{color}}</span></span></a></li></ul></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.language])],e)}();exports.CalendarColorPicker=CalendarColorPicker;var CalendarScheduleDashlet=function(){function CalendarScheduleDashlet(e,t,s,n,a){this.language=e,this.navigation=t,this.elementRef=s,this.renderer=n,this.calendar=a,this.scheduleUntilDate={},this.calendar.isDashlet=!0,this.scheduleUntilDate=(new moment).minute(0).second(0).add(1,"M")}return Object.defineProperty(CalendarScheduleDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"contentStyle",{get:function(){return{height:"calc(100% - "+this.headerContainer.element.nativeElement.offsetHeight+"px)",width:"100%"}},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarScheduleDashlet.prototype,"title",{get:function(){return new moment(this.calendarDate).format("MMM D, YYYY")+" - "+this.scheduleUntilDate.format("MMM D, YYYY")},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],CalendarScheduleDashlet.prototype,"calendarcontent",void 0),__decorate([core_1.ViewChild("headercontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],CalendarScheduleDashlet.prototype,"headerContainer",void 0),CalendarScheduleDashlet=__decorate([core_1.Component({selector:"calendar-schedule-dashlet",template:'<div class="slds-height_full"><div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium slds-truncate">{{title}}</h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-schedule [setdate]="calendarDate" (untildate$)="scheduleUntilDate = $event"></calendar-sheet-schedule></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,services_1.navigation,core_1.ElementRef,core_1.Renderer2,calendar])],CalendarScheduleDashlet)}();exports.CalendarScheduleDashlet=CalendarScheduleDashlet;var CalendarDayDashlet=function(){function CalendarDayDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.dashletconfig=null,this.dashletLabel=null,this.icon=null,this.calendar.isDashlet=!0,this.calendar.sheetHourHeight=50}return Object.defineProperty(CalendarDayDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarDayDashlet.prototype,"contentStyle",{get:function(){return{height:this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop+"px"}},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],CalendarDayDashlet.prototype,"calendarContent",void 0),CalendarDayDashlet=__decorate([core_1.Component({selector:"calendar-day-dashlet",template:'<div class="slds-height_full"><div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium">{{language.getLabel(dashletLabel)}}</h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-day [setdate]="calendarDate"></calendar-sheet-day></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,core_1.ElementRef,calendar])],CalendarDayDashlet)}();exports.CalendarDayDashlet=CalendarDayDashlet;var CalendarThreeDaysDashlet=function(){function CalendarThreeDaysDashlet(e,t,s){this.language=e,this.elementRef=t,this.calendar=s,this.titleUntilDate={},this.calendar.isDashlet=!0,this.calendar.sheetHourHeight=50,this.titleUntilDate=moment(this.calendar.calendarDate).add(2,"d")}return Object.defineProperty(CalendarThreeDaysDashlet.prototype,"calendarDate",{get:function(){return this.calendar.calendarDate},enumerable:!0,configurable:!0}),Object.defineProperty(CalendarThreeDaysDashlet.prototype,"contentStyle",{get:function(){return{height:this.elementRef.nativeElement.getBoundingClientRect().height-this.calendarContent.element.nativeElement.offsetTop+"px"}},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("calendarcontent",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],CalendarThreeDaysDashlet.prototype,"calendarContent",void 0),CalendarThreeDaysDashlet=__decorate([core_1.Component({selector:"calendar-three-days-dashlet",template:'<div class="slds-height_full"><div #headercontainer class="slds-grid slds-grid--vertical-align-center slds-border--bottom slds-p-around--x-small"><system-icon module="Calendar" size="small"></system-icon><h2 class="slds-text-heading--medium">{{language.getLabel(dashletLabel)}}</h2></div><div #calendarcontent [ngStyle]="contentStyle" class="slds-size--1-of-1"><calendar-sheet-three-days [calendarcontent]="calendarcontent" [setdate]="calendarDate"></calendar-sheet-three-days></div></div>',providers:[calendar]}),__metadata("design:paramtypes",[services_1.language,core_1.ElementRef,calendar])],CalendarThreeDaysDashlet)}();exports.CalendarThreeDaysDashlet=CalendarThreeDaysDashlet;var ModuleCalendar=function(){function ModuleCalendar(e){this.vms=e,this.version="1.0",this.build_date="2019-04-10",this.vms.registerModule(this)}return ModuleCalendar=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,objectfields_1.ObjectFields,globalcomponents_1.GlobalComponents,objectcomponents_1.ObjectComponents,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[Calendar,CalendarHeader,CalendarSheetDay,CalendarSheetThreeDays,CalendarSheetWeek,CalendarSheetMonth,CalendarSheetSchedule,CalendarSheetEvent,CalendarEventSummary,CalendarSheetDropTarget,CalendarMorePopover,CalendarMorePopoverEvent,CalendarMoreButton,CalendarAddCalendar,CalendarOtherCalendarsMonitor,CalendarColorPicker,CalendarScheduleDashlet,CalendarDayDashlet,CalendarThreeDaysDashlet],providers:[services_1.userpreferences]}),__metadata("design:paramtypes",[services_1.VersionManagerService])],ModuleCalendar)}();exports.ModuleCalendar=ModuleCalendar;