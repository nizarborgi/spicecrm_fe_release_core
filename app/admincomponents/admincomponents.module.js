/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2019. All Rights reserved)*/
"use strict";var __decorate=this&&this.__decorate||function(t,e,s,i){var a,n=arguments.length,o=n<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,s,i);else for(var l=t.length-1;0<=l;l--)(a=t[l])&&(o=(n<3?a(o):3<n?a(e,s,o):a(e,s))||o);return 3<n&&o&&Object.defineProperty(e,s,o),o},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),forms_1=require("@angular/forms"),core_1=require("@angular/core"),services_1=require("../services/services"),router_1=require("@angular/router"),directives_1=require("../directives/directives"),systemcomponents_1=require("../systemcomponents/systemcomponents"),rxjs_1=require("rxjs"),http_1=require("@angular/common/http"),administrationconfigurator=function(){function t(t,e){this.backend=t,this.modelutilities=e,this.dictionary="",this.entries=[],this.sorting={field:"",direction:""},this.fielddefobj={}}return t.prototype.loadEntries=function(l){var d=this;void 0===l&&(l=[]),this.backend.getRequest("configurator/entries/"+this.dictionary).subscribe(function(t){d.fielddefobj={};for(var e=0,s=l;e<s.length;e++){var i=s[e];d.fielddefobj[i.name]=i.type?i.type:""}for(var a=0,n=t;a<n.length;a++){var o=n[a];d.entries.push({id:o.id,mode:"",data:d.mapData(o)})}})},t.prototype.mapData=function(t){for(var e in this.fielddefobj)switch(this.fielddefobj[e]){case"bool":case"boolean":t[e]="1"==t[e]}return t},t.prototype.remapData=function(t){var e={};for(var s in this.fielddefobj)switch(this.fielddefobj[s]){case"bool":case"boolean":e[s]="true"==t[s]?"1":"0";break;default:e[s]=t[s]}return e},t.prototype.addEntry=function(){var t=this.modelutilities.generateGuid();this.entries.unshift({id:t,mode:"new",data:{id:t}})},t.prototype.saveEntry=function(t){var s=this;this.entries.some(function(e){if(e.id===t)return delete e.backup,s.backend.postRequest("configurator/"+s.dictionary+"/"+t,{},s.remapData(e.data)).subscribe(function(t){e.mode=""}),!0})},t.prototype.deleteEntry=function(s){var i=this;this.entries.some(function(t,e){if(t.id===s)return delete t.backup,i.backend.deleteRequest("configurator/"+i.dictionary+"/"+s).subscribe(function(t){i.entries.splice(e,1)}),!0})},t.prototype.setEditMode=function(e){this.entries.some(function(t){if(t.id===e)return t.mode="edit",t.backup=JSON.parse(JSON.stringify(t.data)),!0})},t.prototype.cancelEditMode=function(s){var i=this;this.entries.some(function(t,e){if(t.id===s)return"new"===t.mode?i.entries.splice(e,1):(t.data=JSON.parse(JSON.stringify(t.backup)),delete t.backup,t.mode=""),!0})},t.prototype.isEditMode=function(e){var s=!1;return this.entries.some(function(t){if(t.id===e)return s="edit"===t.mode||"new"===t.mode,!0}),s},t.prototype.copy=function(s){var i=this;this.entries.some(function(t){if(t.id===s){var e={};return e.data=JSON.parse(JSON.stringify(t.data)),e.mode="new",e.id=i.modelutilities.generateGuid(),e.data.id=e.id,i.entries.unshift(e),!0}})},t.prototype.sort=function(t){var s=this;this.sorting.field===t?this.sorting.direction="asc"==this.sorting.direction?"dsc":"asc":(this.sorting.field=t,this.sorting.direction="asc"),this.entries.sort(function(t,e){return t.data[s.sorting.field]==e.data[s.sorting.field]?0:"asc"==s.sorting.direction?t.data[s.sorting.field]<e.data[s.sorting.field]?-1:1:t.data[s.sorting.field]<e.data[s.sorting.field]?1:-1})},t=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.modelutilities])],t)}();exports.administrationconfigurator=administrationconfigurator;var ftsconfiguration=function(){function t(t,e,s,i){this.backend=t,this.metadata=e,this.language=s,this.toast=i,this.module="",this.moduleFtsFields=[],this.moduleFtsSettings={},this.indexing=!1}return t.prototype.setModule=function(t){this.module=t,this.getModuleFtsFields(),this.getModuleSettings()},t.prototype.getModuleFtsFields=function(){var e=this;this.moduleFtsFields=[],this.backend.getRequest("ftsmanager/"+this.module+"/fields").subscribe(function(t){e.moduleFtsFields=t})},t.prototype.getModuleSettings=function(){var e=this;this.moduleFtsFields=[],this.backend.getRequest("ftsmanager/"+this.module+"/settings").subscribe(function(t){e.moduleFtsSettings=t})},t.prototype.getFieldDetails=function(e){var s={};return this.moduleFtsFields.some(function(t){if(t.id===e)return s=t,!0}),s},t.prototype.save=function(){var e=this,t={fields:this.moduleFtsFields,settings:this.moduleFtsSettings};this.backend.postRequest("ftsmanager/"+this.module,{},t).subscribe(function(t){t?e.toast.sendToast(e.language.getLabel("LBL_DATA_SAVED"),"success"):e.toast.sendToast(e.language.getLabel("ERR_NETWORK"),"error")})},t.prototype.searchPath=function(e){var s=!1;return this.moduleFtsFields.some(function(t){if(t.path===e)return s=!0}),s},t.prototype.putMapping=function(){var e=this;this.indexing=!0,this.backend.deleteRequest("ftsmanager/"+this.module).subscribe(function(t){e.backend.postRequest("ftsmanager/"+e.module+"/map").subscribe(function(t){e.indexing=!1})})},t.prototype.indexModule=function(){var e=this;this.indexing=!0,this.backend.postRequest("ftsmanager/"+this.module+"/index").subscribe(function(t){e.indexing=!1},function(t){e.indexing=!1})},t.prototype.indexModuleBulk=function(){var e=this;this.indexing=!0,this.backend.postRequest("ftsmanager/"+this.module+"/index",{bulk:!0}).subscribe(function(t){e.indexing=!1},function(t){e.indexing=!1})},t.prototype.initialize=function(){var e=this;this.indexing=!0,this.backend.postRequest("ftsmanager/core/initialize").subscribe(function(t){e.indexing=!1},function(t){e.indexing=!1})},t.prototype.resetModule=function(){var e=this;this.indexing=!0,this.backend.postRequest("ftsmanager/"+this.module+"/resetindex").subscribe(function(t){e.indexing=!1},function(t){e.indexing=!1})},t=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[services_1.backend,services_1.metadata,services_1.language,services_1.toast])],t)}();exports.ftsconfiguration=ftsconfiguration;var dictionary=function(){function t(t,e,s,i){this.http=t,this.configurationService=e,this.session=s,this.metadata=i,this.data=[],this.dictionaryitem="",this.dictionaryfields=[]}return t.prototype.load=function(t){var e=this,s=new rxjs_1.Subject;return this.dictionaryitem=t,this.http.get(this.configurationService.getBackendUrl()+"/dictionary/list/"+t+"?sessionid="+this.session.authData.sessionId).subscribe(function(t){e.data=t.items,e.dictionaryfields=t.fields,s.next(t),s.complete()}),s.asObservable()},t.prototype.getFields=function(){for(var t=[],e=0,s=this.dictionaryfields;e<s.length;e++){var i=s[e];"id"!==i&&t.push(i)}return t},t=__decorate([core_1.Injectable(),__metadata("design:paramtypes",[http_1.HttpClient,services_1.configurationService,services_1.session,services_1.metadata])],t)}();exports.dictionary=dictionary;var AdministrationMenu=function(){function t(t,e,s,i,a,n,o,l){var d=this;this.router=t,this.metadata=e,this.language=s,this.backend=i,this.broadcast=a,this.navigation=n,this.elementref=o,this.session=l,this.admincontentObject=null,this.adminNavigation={},this.itemfilter="",this.opened_itemid={},this.loadNavigation(),this.navigation.setActiveModule("Administration"),this.broadcastsubscription=this.broadcast.message$.subscribe(function(t){d.handleMessage(t)})}return t.prototype.ngOnDestroy=function(){this.broadcastsubscription.unsubscribe()},t.prototype.handleMessage=function(t){switch(t.messagetype){case"loader.reloaded":this.loadNavigation()}},t.prototype.loadNavigation=function(){var e=this;this.backend.getRequest("spiceui/admin/navigation").subscribe(function(t){e.adminNavigation=t})},t.prototype.getContainerStyle=function(){return{height:"calc(100vh - "+this.elementref.nativeElement.offsetTop+"px)"}},t.prototype.getNavigationBlocks=function(){function t(t){var s=""==a.itemfilter;s||a.adminNavigation[t].some(function(t){var e=t.adminaction;if(t.admin_label&&(e=i.language.getLabel(t.admin_label)),0<=e.toLowerCase().indexOf(i.itemfilter.toLowerCase()))return s=!0}),s&&e.push(t)}var i=this,e=[],a=this;for(var s in this.adminNavigation)t(s);return e.sort()},t.prototype.getNavigationItems=function(t){for(var e=[],s=0,i=this.adminNavigation[t];s<i.length;s++){var a=i[s];a.componentconfig.onlyForDevs&&!this.session.isDev||(a.name=a.adminaction,a.admin_label&&(a.name=this.language.getLabel(a.admin_label)),(""==this.itemfilter||0<=a.name.toLowerCase().indexOf(this.itemfilter.toLowerCase()))&&e.push(a))}return e},t.prototype.openContent=function(t,e){var s=this;if(this.opened_itemid==e.id)return!0;this.opened_itemid=e.id,this.admincontentObject&&this.admincontentObject.destroy();var i={};if(!this.adminNavigation[t])return!1;this.adminNavigation[t].some(function(t){if(t.id==e.id)return i=t,!0}),i.component&&this.metadata.addComponent(i.component,this.admincontentcontainer).subscribe(function(t){t.instance.componentconfig=i.componentconfig,s.admincontentObject=t})},__decorate([core_1.ViewChild("admincontentcontainer",{read:core_1.ViewContainerRef,static:!0}),__metadata("design:type",core_1.ViewContainerRef)],t.prototype,"admincontentcontainer",void 0),t=__decorate([core_1.Component({selector:"[administration-menu]",template:'<div class="slds-grid" [ngStyle]="getContainerStyle()"><div class="slds-grid slds-grid--vertical slds-navigation-list--vertical slds-navigation-list--vertical-inverse slds-border--right" style="height:100%;width: 250px;"><div class="slds-p-horizontal--xx-small slds-p-vertical--small slds-border--bottom"><div class="slds-form-element__control slds-input-has-icon slds-input-has-icon_right slds-input-has-icon_group-right slds-m-vertical--xx-small"><input type="text" class="slds-input" [placeholder]="language.getLabel(\'LBL_SEARCH\')" [(ngModel)]="itemfilter"><system-utility-icon *ngIf="itemfilter == \'\'" [icon]="\'search\'" [addclasses]="\'slds-input__icon slds-input__icon--left\'"></system-utility-icon><div *ngIf="itemfilter != \'\'" class="slds-input__icon-group slds-input__icon-group_right" style="margin-top: initial;"><button class="slds-input__icon slds-input__icon_right slds-button slds-button_icon" (click)="itemfilter = \'\'" tabindex="-1"><system-button-icon [icon]="\'clear\'"></system-button-icon></button></div></div></div><div tobottom><ng-container *ngFor="let adminNavigationBlock of getNavigationBlocks()"><h2 class="slds-text-title--caps slds-p-around--medium">{{adminNavigationBlock}}</h2><ul><li *ngFor="let item of getNavigationItems(adminNavigationBlock)"><a href="javascript:void(0);" class="slds-navigation-list--vertical__action slds-text-link--reset" (click)="openContent(adminNavigationBlock, item)" [ngClass]="{\'slds-theme_inverse\': item.id == opened_itemid}">{{item.name}}</a></li></ul></ng-container></div></div><div style="width:100%; height: 100%;" class="slds-scrollable"><div #admincontentcontainer></div></div></div>'}),__metadata("design:paramtypes",[router_1.Router,services_1.metadata,services_1.language,services_1.backend,services_1.broadcast,services_1.navigation,core_1.ElementRef,services_1.session])],t)}();exports.AdministrationMenu=AdministrationMenu;var AdministrationMenuRouteItem=function(){function AdministrationMenuRouteItem(t){this.router=t,this.componentconfig={},this.self={}}return AdministrationMenuRouteItem.prototype.ngOnInit=function(){this.componentconfig.route&&this.router.navigate([this.componentconfig.route])},AdministrationMenuRouteItem=__decorate([core_1.Component({template:""}),__metadata("design:paramtypes",[router_1.Router])],AdministrationMenuRouteItem)}();exports.AdministrationMenuRouteItem=AdministrationMenuRouteItem;var AdministrationConfigurator=function(){function AdministrationConfigurator(t,e,s){this.metadata=t,this.administrationconfigurator=e,this.language=s,this.componentconfig={},this.displayFilters=!1,this.filters={}}return AdministrationConfigurator.prototype.ngOnInit=function(){this.administrationconfigurator.dictionary=this.componentconfig.dictionary,this.administrationconfigurator.loadEntries(this.componentconfig.fields)},Object.defineProperty(AdministrationConfigurator.prototype,"count",{get:function(){return this.administrationconfigurator.entries.length},enumerable:!0,configurable:!0}),AdministrationConfigurator.prototype.trackByFn=function(t,e){return e.id},AdministrationConfigurator.prototype.getEntries=function(){for(var t=[],e=0,s=this.administrationconfigurator.entries;e<s.length;e++){var i=s[e],a=!1;if(this.displayFilters)for(var n in this.filters)!this.administrationconfigurator.isEditMode(i.id)&&this.filters[n]&&i.data[n]&&-1==i.data[n].indexOf(this.filters[n])&&(a=!0);a||t.push(i)}return t},AdministrationConfigurator.prototype.getFields=function(){for(var t=[],e=0,s=this.componentconfig.fields;e<s.length;e++){var i=s[e];!0!==i.hidden&&t.push(i)}return t},AdministrationConfigurator.prototype.addEntry=function(){this.administrationconfigurator.addEntry()},AdministrationConfigurator.prototype.sort=function(t){this.administrationconfigurator.sort(t)},AdministrationConfigurator.prototype.toggleFilter=function(){this.displayFilters=!this.displayFilters},AdministrationConfigurator.prototype.clearFilter=function(){this.filters={}},AdministrationConfigurator=__decorate([core_1.Component({selector:"administration-configurator",template:'<div class="slds-grid slds-grid--align-spread slds-p-around--medium"><h2 class="slds-text-heading--medium">{{language.getLabel(\'LBL_DICTIONARY_ITEM\')}}: {{componentconfig.dictionary}} ({{count}} {{language.getLabel(\'LBL_RECORDS\')}})</h2><button class="slds-button slds-button--neutral" (click)="addEntry()">{{language.getLabel(\'LBL_ADD\')}}</button></div><table class="slds-table slds-table--bordered slds-table--cell-buffer"><thead><tr class="slds-text-title--caps"><th *ngFor="let field of getFields()" scope="col" (click)="sort(field.name)"><div class="slds-truncate slds-p-horizontal--small">{{field.name}}<ng-container *ngIf="administrationconfigurator.sorting.field == field.name"><system-utility-icon *ngIf="administrationconfigurator.sorting.direction == \'asc\'" [icon]="\'arrowup\'" [size]="\'x-small\'"></system-utility-icon><system-utility-icon *ngIf="administrationconfigurator.sorting.direction == \'dsc\'" [icon]="\'arrowdown\'" [size]="\'x-small\'"></system-utility-icon></ng-container></div></th><th scope="col" style="width:2rem;"><div class="slds-button-group slds-float--right" role="group"><button class="slds-button slds-button--icon-border" (click)="toggleFilter()"><system-button-icon [icon]="\'filterList\'" [size]="\'small\'"></system-button-icon></button></div></th></tr><tr *ngIf="displayFilters" class="slds-theme--shade"><td *ngFor="let field of getFields()"><div class="slds-form-element"><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="filters[field.name]"></div></div></td><td><div class="slds-button-group slds-float--right" role="group"><button class="slds-button slds-button--icon-border" (click)="clearFilter()"><system-button-icon [icon]="\'clear\'" [size]="\'small\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="toggleFilter()"><system-button-icon [icon]="\'chevronup\'" [size]="\'small\'"></system-button-icon></button></div></td></tr></thead><tbody><tr style="vertical-align: middle" class="slds-align-top" administration-configurator-item *ngFor="let entry of getEntries(); trackBy: trackByFn" [entry]="entry" [fields]="getFields()"></tr></tbody></table>',providers:[administrationconfigurator]}),__metadata("design:paramtypes",[services_1.metadata,administrationconfigurator,services_1.language])],AdministrationConfigurator)}();exports.AdministrationConfigurator=AdministrationConfigurator;var AdministrationConfiguratorItem=function(){function t(t){this.administrationconfigurator=t,this.fields=[],this.entry={}}return t.prototype.ngOnInit=function(){},t.prototype.setEditMode=function(){this.administrationconfigurator.setEditMode(this.entry.id)},t.prototype.isEditMode=function(t){return void 0===t&&(t=null),t?!t.readonly&&this.administrationconfigurator.isEditMode(this.entry.id):this.administrationconfigurator.isEditMode(this.entry.id)},t.prototype.setViewMode=function(){this.administrationconfigurator.cancelEditMode(this.entry.id)},t.prototype.save=function(){this.administrationconfigurator.saveEntry(this.entry.id)},t.prototype.delete=function(){this.administrationconfigurator.deleteEntry(this.entry.id)},t.prototype.copy=function(t){this.administrationconfigurator.copy(t)},t.prototype.getJSON=function(e){try{var t=JSON.parse(e);return JSON.stringify(t,null,2)}catch(t){return e}},__decorate([core_1.Input(),__metadata("design:type",Array)],t.prototype,"fields",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],t.prototype,"entry",void 0),t=__decorate([core_1.Component({selector:"[administration-configurator-item]",template:'<td *ngFor="let field of fields"><div *ngIf="!isEditMode(field);else editfield" class="slds-truncate slds-p-horizontal--small" style="max-width: 200px;" [ngSwitch]="field.type"><span *ngSwitchCase="\'json\'"><pre class="slds-m-vertical--none">{{getJSON(entry.data[field.name])}}</pre></span> <span *ngSwitchCase="\'text\'" class="slds-truncate_container_25" style="max-width: 200px;">{{entry.data[field.name]}}</span><div *ngSwitchCase="\'bool\'" class="slds-checkbox"><input disabled type="checkbox" [id]="entry.data.id + field.name" [(ngModel)]="entry.data[field.name]"> <label class="slds-checkbox__label" [attr.for]="entry.data.id + field.name"><span class="slds-checkbox_faux"></span></label></div><administration-configurator-item-role *ngSwitchCase="\'role\'" [editmode]="false" [fieldvalue]="entry.data[field.name]"></administration-configurator-item-role><span *ngSwitchDefault>{{entry.data[field.name]}}</span></div><ng-template #editfield><div class="slds-form-element"><div class="slds-form-element__control" [ngSwitch]="field.type"><textarea *ngSwitchCase="\'json\'" class="slds-textarea slds-scrollable--y slds-m-vertical--xx-small" [(ngModel)]="entry.data[field.name]"></textarea> <textarea *ngSwitchCase="\'text\'" class="slds-textarea slds-scrollable--y slds-m-vertical--xx-small" [(ngModel)]="entry.data[field.name]"></textarea><div *ngSwitchCase="\'bool\'" class="slds-checkbox slds-p-horizontal--small"><input type="checkbox" [id]="entry.data.id + field.name" [(ngModel)]="entry.data[field.name]"> <label class="slds-checkbox__label" [attr.for]="entry.data.id + field.name"><span class="slds-checkbox_faux"></span></label></div><administration-configurator-item-role *ngSwitchCase="\'role\'" [editmode]="true" [(fieldvalue)]="entry.data[field.name]"></administration-configurator-item-role><input *ngSwitchDefault type="text" class="slds-input" [(ngModel)]="entry.data[field.name]"></div></div></ng-template></td><td><div *ngIf="!isEditMode()" class="slds-button-group slds-float--right" role="group"><button class="slds-button slds-button--icon-border" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'" [size]="\'small\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="copy(entry.id)"><system-button-icon [icon]="\'copy\'" [size]="\'small\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="delete()"><system-button-icon [icon]="\'delete\'" [size]="\'small\'"></system-button-icon></button></div><div *ngIf="isEditMode()" class="slds-button-group slds-float--right" role="group"><button class="slds-button slds-button--icon-border" (click)="setViewMode()"><system-button-icon [icon]="\'close\'" [size]="\'small\'"></system-button-icon></button> <button class="slds-button slds-button--icon-border" (click)="save()"><system-button-icon [icon]="\'check\'" [size]="\'small\'"></system-button-icon></button></div></td>'}),__metadata("design:paramtypes",[administrationconfigurator])],t)}();exports.AdministrationConfiguratorItem=AdministrationConfiguratorItem;var AdministrationConfiguratorItemRole=function(){function t(t){this.metadata=t,this.editmode=!1,this.fieldvalue={},this.fieldvalueChange=new core_1.EventEmitter,this.roles=[]}return t.prototype.loadRoles=function(){var t=this.metadata.getRoles();t.sort(function(t,e){return t.name>e.name?1:-1});for(var e=0,s=t;e<s.length;e++){var i=s[e];this.roles.push(i)}},t.prototype.ngOnInit=function(){!this.editmode&&"*"==this.fieldvalue||this.loadRoles()},Object.defineProperty(t.prototype,"roleValue",{get:function(){return this.fieldvalue},set:function(t){this.fieldvalue=t,this.fieldvalueChange.emit(t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rolename",{get:function(){for(var t=0,e=this.roles;t<e.length;t++){var s=e[t];if(s.id==this.fieldvalue)return s.name}return this.fieldvalue},enumerable:!0,configurable:!0}),__decorate([core_1.Input(),__metadata("design:type",Boolean)],t.prototype,"editmode",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],t.prototype,"fieldvalue",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],t.prototype,"fieldvalueChange",void 0),t=__decorate([core_1.Component({selector:"administration-configurator-item-role",template:'<div *ngIf="!editmode"><div class="slds-truncate">{{rolename}}</div></div><div *ngIf="editmode" class="slds-form-element"><div class="slds-form-element__control"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="roleValue"><option value="*">*</option><option *ngFor="let role of roles" [value]="role.id">{{role.name}}</option></select></div></div></div>'}),__metadata("design:paramtypes",[services_1.metadata])],t)}();exports.AdministrationConfiguratorItemRole=AdministrationConfiguratorItemRole;var AdministrationQuotaManager=function(){function AdministrationQuotaManager(t){this.backend=t,this.users=[],this.monthlyQuotas={},this.quotas=[],this.yearlyQuotas={},this.year=(new Date).getFullYear(),this.monthNamesList=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],this.yearsList=[]}return AdministrationQuotaManager.prototype.ngOnInit=function(){this.getYears(),this.getQuotaUsers()},AdministrationQuotaManager.prototype.getYears=function(){for(var t=(new Date).getFullYear(),e=t-2;e<t+7;e++)this.yearsList.push(e)},AdministrationQuotaManager.prototype.getQuotaUsers=function(){var a=this;this.backend.getRequest("quotamanager/users").subscribe(function(t){for(var e=0,s=t;e<s.length;e++){var i=s[e];a.users.push({id:i.id,mode:"",data:i}),0}a.getQuotas().subscribe()})},AdministrationQuotaManager.prototype.getQuotas=function(){var r=this,c=new rxjs_1.Subject;return this.backend.getRequest("quotamanager/quotas/"+this.year).subscribe(function(t){r.quotas=t,r.monthlyQuotas={},r.yearlyQuotas={};for(var e=0,s=t;e<s.length;e++){var i=s[e],a=i.assigned_user_id,n=Math.round(i.sales_quota),o=i.period-1;r.monthlyQuotas[a]||(r.monthlyQuotas[a]=new Array(12)),r.monthlyQuotas[a][o]=n,r.yearlyQuotas[a]||(r.yearlyQuotas[a]=0),r.yearlyQuotas[a]+=n}c.next(r.users),c.complete();for(var l=0,d=r.users;l<d.length;l++){a=d[l].data.id;r.monthlyQuotas[a]||(r.monthlyQuotas[a]=new Array(12)),r.yearlyQuotas[a]||(r.yearlyQuotas[a]=0)}}),c.asObservable()},AdministrationQuotaManager.prototype.updateQuota=function(t,e,s){var i=t.target.value?+t.target.value:0,a=this.monthlyQuotas[e][s];a=a||0,this.yearlyQuotas[e]-=a-i,0<i?(this.monthlyQuotas[e][s]=i,this.backend.postRequest("quotamanager/quota/"+e+"/"+this.year+"/"+(s+1)+"/"+i)):(delete this.monthlyQuotas[e][s],this.backend.deleteRequest("quotamanager/quota/"+e+"/"+this.year+"/"+(s+1)))},AdministrationQuotaManager=__decorate([core_1.Component({selector:"administration-quotamanager",template:'<div class="slds-page-header"><div class="slds-grid slds-grid_vertical-align-center slds-grid--align-spread"><div class="slds-media"><div class="slds-media__body"><h1 class="slds-page-header__title slds-truncate slds-align-middle">Quota Manager</h1></div></div><div class="slds-p-top--small"><label for="year-select">Year</label><select id="year-select" [(ngModel)]="year" (change)="getQuotas()"><option *ngFor="let aYear of yearsList">{{aYear}}</option></select></div></div></div><div class="slds-scrollable--x"><table class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr class="slds-text-title_caps"><th scope="col">Name</th><th scope="col">Total</th><th scope="col" *ngFor="let monthName of monthNamesList">{{monthName}}</th></tr></thead><tbody><tr *ngFor="let quotaUser of users" class="slds-text-title_caps"><td>{{quotaUser.data.last_name}} {{quotaUser.data.first_name}} ({{quotaUser.data.user_name}})</td><td>{{yearlyQuotas[quotaUser.data.id]}}</td><td *ngFor="let quota of monthlyQuotas[quotaUser.data.id]; let monthIndex = index"><administration-quotamanager-field [userid]="quotaUser.data.id" [data]="quotas" [monthindex]="monthIndex" [year]="year"></administration-quotamanager-field></td></tr></tbody></table></div>'}),__metadata("design:paramtypes",[services_1.backend])],AdministrationQuotaManager)}();exports.AdministrationQuotaManager=AdministrationQuotaManager;var AdministrationQuotaManagerField=function(){function t(t){this.backend=t,this.userid="",this.monthindex=0,this.year=0,this.data=[]}return Object.defineProperty(t.prototype,"value",{get:function(){for(var t=0,e=this.data;t<e.length;t++){var s=e[t];if(s&&s.assigned_user_id===this.userid&&s.period===""+(this.monthindex+1))return""+Math.round(s.sales_quota)}return""},set:function(t){for(var e=0,s=+t,i=0,a=this.data;i<a.length;i++){var n=a[i];n&&n.assigned_user_id===this.userid&&n.period===""+(this.monthindex+1)&&(0<s?this.data[e].sales_quota=t:delete this.data[e]),e++}0<s?this.backend.postRequest("quotamanager/quota/"+this.userid+"/"+this.year+"/"+(this.monthindex+1)+"/"+t).subscribe(function(t){}):this.backend.deleteRequest("quotamanager/quota/"+this.userid+"/"+this.year+"/"+(this.monthindex+1))},enumerable:!0,configurable:!0}),t.prototype.changeValue=function(t){},__decorate([core_1.Input(),__metadata("design:type",String)],t.prototype,"userid",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],t.prototype,"monthindex",void 0),__decorate([core_1.Input(),__metadata("design:type",Number)],t.prototype,"year",void 0),__decorate([core_1.Input(),__metadata("design:type",Array)],t.prototype,"data",void 0),t=__decorate([core_1.Component({selector:"administration-quotamanager-field",template:'<input style="width:80px;" [(ngModel)]="value" (ngModelChange)="changeValue($event)">'}),__metadata("design:paramtypes",[services_1.backend])],t)}();exports.AdministrationQuotaManagerField=AdministrationQuotaManagerField;var AdministrationFTSManager=function(){function AdministrationFTSManager(t,e,s){this.metadata=t,this.language=e,this.ftsconfiguration=s,this.activeTab="fields"}return Object.defineProperty(AdministrationFTSManager.prototype,"modules",{get:function(){return this.metadata.getModules().sort()},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationFTSManager.prototype,"module",{get:function(){return this.ftsconfiguration.module},set:function(t){this.ftsconfiguration.setModule(t)},enumerable:!0,configurable:!0}),AdministrationFTSManager.prototype.setActiveTab=function(t){this.activeTab=t},AdministrationFTSManager.prototype.save=function(){this.ftsconfiguration.save()},AdministrationFTSManager.prototype.putIndex=function(){this.ftsconfiguration.putMapping()},AdministrationFTSManager.prototype.indexModule=function(){this.ftsconfiguration.indexModule()},AdministrationFTSManager.prototype.indexModuleBulk=function(){this.ftsconfiguration.indexModuleBulk()},AdministrationFTSManager.prototype.resetModule=function(){this.ftsconfiguration.resetModule()},AdministrationFTSManager.prototype.initialize=function(){confirm("Are you sure you want to initialize your FTS? It recreates new indices, so indexed data will be lost and have to be rebuild!")&&this.ftsconfiguration.initialize()},AdministrationFTSManager=__decorate([core_1.Component({selector:"[administration-ftsmanager]",template:'<div class="slds-grid slds-form--inline slds-p-around--small slds-border--bottom"><div class="slds-form-element"><label class="slds-form-element__label">{{language.getLabel(\'LBL_MODULE\')}}</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="module"><option *ngFor="let module of modules" [value]="module">{{module}}</option></select></div></div></div><div class="slds-form-element slds-col--bump-left"><div class="slds-button-group" role="group" *ngIf="!ftsconfiguration.indexing; else indexing"><button type="button" class="slds-button slds-button--neutral" (click)="initialize()">Initialize</button> <button type="button" class="slds-button slds-button--neutral" [disabled]="!module" (click)="putIndex()">Put Mapping</button> <button type="button" class="slds-button slds-button--neutral" [disabled]="!module" (click)="resetModule()">Reset</button> <button type="button" class="slds-button slds-button--neutral" [disabled]="!module" (click)="indexModule()">Index</button> <button type="button" class="slds-button slds-button--neutral" [disabled]="!module" (click)="indexModuleBulk()">Index Bulk</button> <button type="button" class="slds-button slds-button--brand" [disabled]="!module" (click)="save()">{{language.getLabel(\'LBL_SAVE\')}}</button></div><ng-template #indexing><system-spinner></system-spinner></ng-template></div></div><div class="slds-tabs--default slds-p-top--xx-small"><div *ngIf="module; else selectmodule"><ul class="slds-tabs--default__nav" role="tablist"><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab === \'fields\'}" role="presentation" (click)="setActiveTab(\'fields\')"><a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" aria-selected="false">Fields</a></li><li class="slds-tabs--default__item slds-text-title--caps" [ngClass]="{\'slds-active\': activeTab === \'details\'}" role="presentation" (click)="setActiveTab(\'details\')"><a class="slds-tabs--default__link" href="javascript:void(0);" role="tab" aria-selected="false">Details</a></li></ul><administration-ftsmanager-fields *ngIf="activeTab===\'fields\'"></administration-ftsmanager-fields><administration-ftsmanager-details *ngIf="activeTab===\'details\'"></administration-ftsmanager-details></div><ng-template #selectmodule><div class="slds-p-around--small slds-text-align--center">select a module</div></ng-template></div>',providers:[ftsconfiguration]}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,ftsconfiguration])],AdministrationFTSManager)}();exports.AdministrationFTSManager=AdministrationFTSManager;var AdministrationFTSManagerFields=function(){function t(t,e,s){this.metadata=t,this.language=e,this.ftsconfiguration=s,this.currentfield="",this.fieldDetails={},this.displayAddFieldModal=!1}return t.prototype.selectField=function(t){this.currentfield=t,this.fieldDetails=this.ftsconfiguration.getFieldDetails(t)},Object.defineProperty(t.prototype,"moduleFtsFields",{get:function(){return this.ftsconfiguration.moduleFtsFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregateaddparams",{get:function(){return this.fieldDetails.aggregateaddparams?atob(this.fieldDetails.aggregateaddparams):""},set:function(t){this.fieldDetails.aggregateaddparams=t?btoa(t):""},enumerable:!0,configurable:!0}),t.prototype.showAddFields=function(){this.displayAddFieldModal=!0},t.prototype.closeAddFields=function(t){this.displayAddFieldModal=!1},t=__decorate([core_1.Component({selector:"administration-ftsmanager-fields",template:'<div class="slds-grid"><div class="slds-size--1-of-2 slds-p-right--x-small"><table class="slds-table slds-table--cell-buffer"><thead><tr class="slds-text-title--caps slds-theme--shade slds-border--bottom"><th scope="col"><div class="slds-truncate">Field</div></th><th scope="col"><div class="slds-truncate">Name</div></th></tr></thead><tbody><tr class="slds-border--bottom" *ngFor="let moduleFtsField of moduleFtsFields" (click)="selectField(moduleFtsField.id)" [ngClass]="{\'slds-theme--shade\': moduleFtsField.id == currentfield}"><td><div class="slds-truncate">{{moduleFtsField.displaypath}}->{{moduleFtsField.fieldname}}</div></td><td><div class="slds-truncate">{{moduleFtsField.name}}</div></td></tr></tbody></table><div class="slds-p-around--small slds-text-align--center"><a href="javascript:void(0)" (click)="showAddFields()">Add Fields</a></div></div><div class="slds-size--1-of-2"><div *ngIf="currentfield; else selectfield"><h2 class="slds-text-heading--small slds-p-vertical--x-small">Field Details: {{fieldDetails.displaypath}}->{{fieldDetails.fieldname}}</h2><div class="slds-form-element"><label class="slds-form-element__label">Name</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="fieldDetails.name"></div></div><div class="slds-form-element"><label class="slds-form-element__label">IndexType</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_DATATYPE\')"></system-icon-help-text><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="fieldDetails.indextype"><option></option><option value="string">string</option><option value="text">text</option><option value="keyword">keyword</option><option value="date">date</option><option value="double">double</option><option value="parentid">parentid</option><option value="activitydate">activitydate</option></select></div></div></div><div class="slds-form-element"><label class="slds-form-element__label">Aggregate</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_AGGREGATE\')"></system-icon-help-text><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="fieldDetails.aggregate"><option></option><option value="term">Term</option><option value="range">Range</option><option value="datew">Date Week</option><option value="datem">Date Month</option><option value="dateq">Date Quarter</option><option value="datey">Date Year</option></select></div></div></div><div class="slds-form-element" *ngIf="fieldDetails.aggregate"><label class="slds-form-element__label">Aggregate Params</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_AGGREGATE_PARAMS\')"></system-icon-help-text><div class="slds-form-element__control"><textarea class="slds-textarea" [(ngModel)]="aggregateaddparams"></textarea></div></div><div class="slds-form-element"><label class="slds-form-element__label">Aggregate Size</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_AGGREGATE_SIZE\')"></system-icon-help-text><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="fieldDetails.aggregatesize"></div></div><div class="slds-form-element"><label class="slds-form-element__label">Aggregate Priority</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="fieldDetails.aggregatepriority"></div></div><div class="slds-form-element"><label class="slds-form-element__label">Boost</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_BOOST\')"></system-icon-help-text><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="fieldDetails.boost"></div></div><div class="slds-form-element slds-m-top--x-small"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="enablesort" [(ngModel)]="fieldDetails.enablesort"> <label class="slds-checkbox__label" for="enablesort"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Sort</span></label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_ENABLE_SORT\')"></system-icon-help-text></span></div></div><div class="slds-form-element"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="search" [(ngModel)]="fieldDetails.search"> <label class="slds-checkbox__label" for="search"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Search</span></label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_ENABLE_SEARCH\')"></system-icon-help-text></span></div></div><div class="slds-form-element"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="emailfield" [(ngModel)]="fieldDetails.email"> <label class="slds-checkbox__label" for="emailfield"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Email</span></label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_ENABLE_EMAIL\')"></system-icon-help-text></span></div></div><div class="slds-form-element"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="duplicatecheck" [(ngModel)]="fieldDetails.duplicatecheck"> <label class="slds-checkbox__label" for="duplicatecheck"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Duplicate Check</span></label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_DUPLICATE_CHECK\')"></system-icon-help-text></span></div></div><div *ngIf="fieldDetails.duplicatecheck" class="slds-grid slds-grid_vertical-align-center slds-gutters"><div class="slds-col slds-size--1-of-2 slds-form-element"><label class="slds-form-element__label">Duplicate Query</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_DUPLICATE_QUERY\')"></system-icon-help-text><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="fieldDetails.duplicatequery"><option>match (or)</option><option value="match_and">match (and)</option><option value="term">term</option></select></div></div></div><div class="slds-col slds-size--1-of-2 slds-form-element"><label class="slds-form-element__label">Duplicate Fuzziness</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_DUPLICATE_FUZZINESS\')"></system-icon-help-text><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="fieldDetails.duplicatefuzz"></div></div></div><div class="slds-form-element"><label class="slds-form-element__label">Analyzer</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_ANALYZER\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_STANDARD\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_NGRAM\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_HTML\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_EDGENGRAM\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_EMAIL\')"></system-icon-help-text><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="fieldDetails.analyzer"><option>standard</option><option value="spice_standard_all">standard all charatcers</option><option value="spice_ngram">NGram</option><option value="spice_ngram_all">NGram all charatcers</option><option value="spice_html">HTML</option><option value="spice_edgengram">Edge NGram</option><option value="spice_email">email Address</option></select></div></div></div><div class="slds-form-element"><label class="slds-form-element__label">Search Analyzer</label><system-icon-help-text [helpText]="language.getLabel(\'HLP_FTS_SEARCHANALYZER\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_STANDARD\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_NGRAM\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_HTML\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_EDGENGRAM\') + \'\\n\' + language.getLabel(\'HLP_FTS_ANALYZER_EMAIL\')"></system-icon-help-text><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="fieldDetails.search_analyzer"><option>standard</option><option value="spice_standard_all">standard all charatcers</option><option value="spice_ngram">NGram</option><option value="spice_ngram_all">NGram all charatcers</option><option value="spice_html">HTML</option><option value="spice_edgengram">Edge NGram</option><option value="spice_email">email Address</option></select></div></div></div></div><ng-template #selectfield><div class="slds-p-around--small slds-text-align--center">select a field</div></ng-template></div></div><administration-ftsmanager-fields-add *ngIf="displayAddFieldModal" (closeModal)="closeAddFields($event)"></administration-ftsmanager-fields-add>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,ftsconfiguration])],t)}();exports.AdministrationFTSManagerFields=AdministrationFTSManagerFields;var AdministrationFTSManagerDetails=function(){function t(t,e,s){this.metadata=t,this.language=e,this.ftsconfiguration=s}return t=__decorate([core_1.Component({selector:"administration-ftsmanager-details",template:'<div class="slds-p-top--x-small slds-p-horizontal--x-small"><div class="slds-form-element"><label class="slds-form-element__label">Index Priority</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="ftsconfiguration.moduleFtsSettings.index_priority"></div></div><div class="slds-form-element"><label class="slds-form-element__label">fuzziness</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="ftsconfiguration.moduleFtsSettings.fuzziness"></div></div><div class="slds-form-element"><label class="slds-form-element__label">Operator</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="ftsconfiguration.moduleFtsSettings.operator"><option value="and">and</option><option value="or">or</option></select></div></div></div><div class="slds-form-element"><label class="slds-form-element__label">Minimum Should Match</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="ftsconfiguration.moduleFtsSettings.minimum_should_match"></div></div><div class="slds-form-element"><label class="slds-form-element__label">Multimatch Type</label><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="ftsconfiguration.moduleFtsSettings.multimatch_type"><option>default</option><option value="best_fields">Best Fields</option><option value="most_fields">Most Fields</option><option value="phrase">Phrase</option><option value="phrase_prefix">Phrase Prefix</option><option value="cross_fields">Cross Fields</option></select></div></div></div><div class="slds-form-element"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="globalsearch" [(ngModel)]="ftsconfiguration.moduleFtsSettings.globalsearch"> <label class="slds-checkbox__label" for="globalsearch"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Global Search</span></label></span></div></div><div class="slds-form-element"><div class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" name="options" id="emailsearch" [(ngModel)]="ftsconfiguration.moduleFtsSettings.emailsearch"> <label class="slds-checkbox__label" for="emailsearch"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">Email Search</span></label></span></div></div><div class="slds-border--top slds-p-vertical--x-small"><div class="slds-form-element slds-grid slds-grid--vertical-align-center slds-gutters_direct-small"><div class="slds-form-element__control slds-col slds-size--1-of-3"><span class="slds-checkbox"><input type="checkbox" name="options" id="activitiessearch" [(ngModel)]="ftsconfiguration.moduleFtsSettings.activitiessearch"> <label class="slds-checkbox__label" for="activitiessearch"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">include in Activities</span></label></span></div><div class="slds-col slds-size--2-of-3 slds-grid slds-grid--vertical-align-center"><label class="slds-form-element__label">Filter</label><system-input-module-filter class="slds-grow" [(ngModel)]="ftsconfiguration.moduleFtsSettings.activitiesfilter"></system-input-module-filter></div></div><div class="slds-form-element slds-grid slds-grid--vertical-align-center slds-gutters_direct-small"><div class="slds-form-element__control slds-col slds-size--1-of-3"><span class="slds-checkbox"><input type="checkbox" name="options" id="historysearch" [(ngModel)]="ftsconfiguration.moduleFtsSettings.historysearch"> <label class="slds-checkbox__label" for="historysearch"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">include in History</span></label></span></div><div class="slds-col slds-size--2-of-3 slds-grid slds-grid--vertical-align-center"><label class="slds-form-element__label">Filter</label><system-input-module-filter class="slds-grow" [(ngModel)]="ftsconfiguration.moduleFtsSettings.historyfilter"></system-input-module-filter></div></div><div class="slds-form-element slds-grid slds-grid--vertical-align-center slds-gutters_direct-small"><div class="slds-col slds-size--1-of-1 slds-grid slds-grid--vertical-align-center"><label class="slds-form-element__label">global Filter</label><system-input-module-filter class="slds-grow" [(ngModel)]="ftsconfiguration.moduleFtsSettings.globalfilter"></system-input-module-filter></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,ftsconfiguration])],t)}();exports.AdministrationFTSManagerDetails=AdministrationFTSManagerDetails;var AdministrationFTSManagerFieldsAdd=function(){function t(t,e,s,i,a){this.metadata=t,this.language=e,this.ftsconfiguration=s,this.backend=i,this.modelutilities=a,this.closeModal=new core_1.EventEmitter,this.path=[],this.links=[],this.fields=[],this.selectedFields={},this.path.push({type:"root",module:this.ftsconfiguration.module,path:"root:"+this.ftsconfiguration.module}),this.getLinks(),this.getFields()}return t.prototype.chooseBreadcrumb=function(t){this.path=this.path.slice(0,t+1),this.getLinks(),this.getFields()},t.prototype.getLinks=function(){var e=this;this.links=[],this.backend.getRequest("ftsmanager/core/nodes",{node:"root",nodeid:this.buildNodeid()}).subscribe(function(t){e.links=t})},t.prototype.setLink=function(t){this.path.push(t),this.getLinks(),this.getFields()},t.prototype.getFields=function(){var n=this;this.fields=[],this.backend.getRequest("ftsmanager/core/fields",{nodeid:this.buildNodeid()}).subscribe(function(t){for(var e=n.buildNodeid(),s=0,i=t;s<i.length;s++){var a=i[s];n.ftsconfiguration.searchPath(e+"::field:"+a.name)&&(a.exists=!0),n.fields.push(a)}})},t.prototype.buildNodeid=function(){for(var t=[],e=0,s=this.path;e<s.length;e++){var i=s[e];t.push(i.path)}return t.join("::")},t.prototype.getFieldLabel=function(t){var e=this.path[this.path.length-1].path.split(":");return this.language.getFieldDisplayName(e[1],t)},t.prototype.selectField=function(t){if(this.selectedFields[this.buildNodeid()+"::field:"+t.name])delete this.selectedFields[this.buildNodeid()+"::field:"+t.name];else{for(var e="",s=0,i=this.path;s<i.length;s++){""!=e&&(e+="->"),e+=i[s].module}t.displaypath=e,t.fieldname=t.name,t.name=this.getFieldLabel(t.name),this.selectedFields[this.buildNodeid()+"::field:"+t.fieldname]=t}},t.prototype.fieldSelected=function(t){return!!this.selectedFields[this.buildNodeid()+"::field:"+t]},t.prototype.canSave=function(){var t=0;for(var e in this.selectedFields)t++;return 0<t},t.prototype.close=function(){this.closeModal.emit(!1)},t.prototype.save=function(){for(var t in this.selectedFields){for(var e=this.modelutilities.generateGuid(),s="",i=0,a=t.split("::");i<a.length;i++){var n=a[i].split(":");n&&3===n.length&&(s+=n[2]+"->")}this.ftsconfiguration.moduleFtsFields.push({id:e,fieldid:e,fieldname:this.selectedFields[t].fieldname,name:this.selectedFields[t].name,indexfieldname:s+this.selectedFields[t].fieldname,displaypath:this.selectedFields[t].displaypath,path:t,search:!0,indextype:"string",index:"analyzed"})}this.closeModal.emit(!0)},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],t.prototype,"closeModal",void 0),t=__decorate([core_1.Component({selector:"administration-ftsmanager-fields-add",template:'<div role="dialog" class="slds-modal slds-fade-in-open slds-modal--large" style="min-height: 90%;"><div class="slds-modal__container"><div class="slds-modal__header"><button class="slds-button slds-modal__close slds-button--icon-inverse" (click)="close()"><system-button-icon [icon]="\'close\'" [size]="\'large\'"></system-button-icon></button><h2 class="slds-text-heading--medium">Add Field</h2></div><div class="slds-modal__content" style="height: 80%"><div class="slds-grid"><div class="slds-size--1-of-3 slds-scrollable" style="height: 100%;"><nav class="slds-p-around--small" role="navigation"><ol class="slds-breadcrumb slds-list--horizontal"><li class="slds-breadcrumb__item slds-text-title--caps" *ngFor="let item of path; let i = index"><a href="javascript:void(0);" (click)="chooseBreadcrumb(i)">{{item.module}}</a></li></ol></nav><ul class="slds-p-horizontal--small"><li class="slds-item slds-p-vertical--xxx-small" *ngFor="let link of links"><a href="javascript:void(0)" (click)="setLink(link)">{{link.module}}</a></li></ul></div><div class="slds-size--2-of-3 slds-border--left slds-scrollable" style="height: 100%;"><table class="slds-table slds-table--cell-buffer"><thead><tr class="slds-text-title--caps slds-theme--shade"><th>Add</th><th scope="col"><div class="slds-truncate">Fieldname</div></th><th scope="col"><div class="slds-truncate">Fieldlabel</div></th></tr></thead><tbody><tr class="slds-border--bottom" *ngFor="let field of fields"><td><button class="slds-button slds-button--icon-border" [disabled]="field.exists" [ngClass]="{\'slds-is-selected\': fieldSelected(field.name)}" (click)="selectField(field)"><system-button-icon [icon]="field.exists || fieldSelected(field.fieldname) ? \'check\' : \'add\'"></system-button-icon></button></td><td data-label="Account Name"><div class="slds-truncate">{{field.name}}</div></td><td data-label="Account Name"><div class="slds-truncate">{{getFieldLabel(field.name)}}</div></td></tr></tbody></table></div></div></div><div class="slds-modal__footer"><button class="slds-button slds-button--neutral" (click)="close()">{{language.getLabel(\'LBL_CANCEL\')}}</button> <button class="slds-button slds-button--brand" [disabled]="!canSave()" (click)="save()">{{language.getLabel(\'LBL_SAVE\')}}</button></div></div></div><div class="slds-backdrop slds-backdrop--open"></div>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,ftsconfiguration,services_1.backend,services_1.modelutilities])],t)}();exports.AdministrationFTSManagerFieldsAdd=AdministrationFTSManagerFieldsAdd;var AdministrationFTSStats=function(){function AdministrationFTSStats(t,e,s){var i=this;this.metadata=t,this.language=e,this.backend=s,this.stats={},this.indices=[],this.backend.getRequest("fts/stats").subscribe(function(t){for(var e in(i.stats=t).indices)i.indices.push({name:e,size:t.indices[e].total.store.size_in_bytes,documents:t.indices[e].total.docs.count});i.indices.sort(function(t,e){return t.name>e.name?1:-1})})}return AdministrationFTSStats=__decorate([core_1.Component({template:'<h2 class="slds-text-heading_medium slds-p-around--small">FTS Stats</h2><table class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr class="slds-text-title_caps"><th scope="col"><div class="slds-truncate">Name</div></th><th scope="col"><div class="slds-truncate">Size</div></th><th scope="col"><div class="slds-truncate">Documents</div></th></tr></thead><tbody><tr *ngFor="let index of indices"><td><div class="slds-truncate">{{index.name}}</div></td><td><div class="slds-truncate">{{index.size}}</div></td><td><div class="slds-truncate">{{index.documents}}</div></td></tr></tbody></table>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.backend])],AdministrationFTSStats)}();exports.AdministrationFTSStats=AdministrationFTSStats;var AdministrationSystemStats=function(){function AdministrationSystemStats(t,e,s,i){this.metadata=t,this.language=e,this.backend=s,this.helper=i,this.loaded=!1,this.stats={},this.totaldbrecords=0,this.totaldbsize=0,this.loadStats()}return AdministrationSystemStats.prototype.loadStats=function(){var e=this;this.loaded=!1,this.backend.getRequest("admin/systemstats").subscribe(function(t){e.stats=t,e.calculateTotalsDB(),e.loaded=!0})},AdministrationSystemStats.prototype.refresh=function(){this.loadStats()},Object.defineProperty(AdministrationSystemStats.prototype,"totalelasticrecords",{get:function(){try{return this.stats.elastic._all.total.docs.count}catch(t){return 0}},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationSystemStats.prototype,"totalelasticsize",{get:function(){try{return this.stats.elastic._all.total.store.size_in_bytes}catch(t){return 0}},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationSystemStats.prototype,"uploadcount",{get:function(){try{return this.stats.uploadfiles.count}catch(t){return 0}},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationSystemStats.prototype,"uploadsize",{get:function(){try{return this.stats.uploadfiles.size}catch(t){return 0}},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationSystemStats.prototype,"totalsize",{get:function(){return this.totaldbsize+this.totalelasticsize+this.uploadsize},enumerable:!0,configurable:!0}),AdministrationSystemStats.prototype.sortby=function(s,i){void 0===i&&(i=!0),this.stats.database.sort(function(t,e){return t[s]>e[s]?i?-1:1:i?1:-1})},AdministrationSystemStats.prototype.calculateTotalsDB=function(){this.totaldbrecords=0;for(var t=this.totaldbsize=0,e=this.stats.database;t<e.length;t++){var s=e[t];this.totaldbrecords+=parseInt(s.records,10),this.totaldbsize+=parseInt(s.size,10)}},AdministrationSystemStats.prototype.humanReadableSize=function(t){return this.helper.humanFileSize(t)},AdministrationSystemStats.prototype.ftsDocumentCount=function(t){try{return this.stats.elastic.indices[this.stats.elastic._prefix+t].total.docs.count}catch(t){return""}},AdministrationSystemStats.prototype.ftsIndexSize=function(t){try{return this.humanReadableSize(this.stats.elastic.indices[this.stats.elastic._prefix+t].total.store.size_in_bytes)}catch(t){return""}},AdministrationSystemStats=__decorate([core_1.Component({template:'<ng-container *ngIf="loaded; else loading"><div class="slds-grid slds-grid_vertical-align-center slds-grid--align-spread slds-p-around--small"><h2 class="slds-text-heading_medium">System and Storage Statistics Summary</h2><button class="slds-button slds-button_icon slds-button_icon-border-filled" (click)="refresh()"><system-button-icon icon="refresh"></system-button-icon></button></div><table class="slds-table slds-table_bordered slds-table_cell-buffer slds-m-bottom--medium"><thead><tr class="slds-text-title_caps"><th scope="col">Object</th><th scope="col">Records</th><th scope="col">Size</th></tr></thead><tbody><tr><td><div class="slds-truncate">Database</div></td><td><div class="slds-truncate">{{totaldbrecords}}</div></td><td><div class="slds-truncate">{{humanReadableSize(totaldbsize)}}</div></td></tr><tr><td><div class="slds-truncate">Elasticsearch</div></td><td><div class="slds-truncate">{{totalelasticrecords}}</div></td><td><div class="slds-truncate">{{humanReadableSize(totalelasticsize)}}</div></td></tr><tr><td><div class="slds-truncate">Uploadfiles</div></td><td><div class="slds-truncate">{{uploadcount}}</div></td><td><div class="slds-truncate">{{humanReadableSize(uploadsize)}}</div></td></tr></tbody><tfoot><tr class="slds-theme--shade slds-text-title_caps"><th><div class="slds-truncate">total</div></th><th><div class="slds-truncate"></div></th><th><div class="slds-truncate">{{humanReadableSize(totalsize)}}</div></th></tr></tfoot></table><h2 class="slds-p-around--small">System and Storage Statistics Details</h2><div tobottom><table class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr class="slds-text-title_caps"><th scope="col"><div class="slds-truncate" (click)="sortby(\'name\', false)">Table</div></th><th scope="col"><div class="slds-truncate" (click)="sortby(\'records\')">Records</div></th><th scope="col"><div class="slds-truncate" (click)="sortby(\'size\')">Size</div></th><th scope="col"><div class="slds-truncate">indexed Records</div></th><th scope="col"><div class="slds-truncate">Index Size</div></th></tr></thead><tbody><tr *ngFor="let table of stats.database"><td><div class="slds-truncate">{{table.name}}</div></td><td><div class="slds-truncate">{{table.records}}</div></td><td><div class="slds-truncate">{{humanReadableSize(table.size)}}</div></td><td><div class="slds-truncate">{{ftsDocumentCount(table.name)}}</div></td><td><div class="slds-truncate">{{ftsIndexSize(table.name)}}</div></td></tr></tbody></table></div></ng-container><ng-template #loading><div class="slds-align--absolute-center slds-height_full slds-size--1-of-1"><system-spinner></system-spinner></div></ng-template>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.backend,services_1.helper])],AdministrationSystemStats)}();exports.AdministrationSystemStats=AdministrationSystemStats;var AdministrationSysTrashcanManager=function(){function AdministrationSysTrashcanManager(t,e,s,i,a){this.metadata=t,this.backend=e,this.language=s,this.userpreferences=i,this.footer=a,this.records=[],this.loaddate={},this.loading=!0}return AdministrationSysTrashcanManager.prototype.ngOnInit=function(){this.getEntries()},AdministrationSysTrashcanManager.prototype.getEntries=function(){var e=this;this.backend.getRequest("systrashcan").subscribe(function(t){e.records=t,e.loaddate=new moment,e.loading=!1})},AdministrationSysTrashcanManager.prototype.reload=function(){this.loading=!0,this.records=[],this.getEntries()},AdministrationSysTrashcanManager.prototype.getUserDate=function(t){return this.userpreferences.formatDateTime(t)},AdministrationSysTrashcanManager.prototype.recoverRecord=function(s){var i=this;this.metadata.addComponent("AdministrationSysTrashcanRecover",this.footer.footercontainer).subscribe(function(t){t.instance.record=s,t.instance.recovered.subscribe(function(t){t&&i.records.some(function(t,e){if(t.id==s.id)return i.records.splice(e,1),!0})})})},AdministrationSysTrashcanManager.prototype.getModule=function(t){return this.metadata.getModuleFromSingular(t)},Object.defineProperty(AdministrationSysTrashcanManager.prototype,"loadDate",{get:function(){return this.loaddate?this.getUserDate(this.loaddate):"---"},enumerable:!0,configurable:!0}),AdministrationSysTrashcanManager=__decorate([core_1.Component({selector:"administration-systrashcan-manager",template:'<div class="slds-page-header"><div class="slds-media"><div class="slds-media__figure"><span class="slds-icon_container slds-icon-action-recall"><svg class="slds-icon slds-page-header__icon" aria-hidden="true"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="./sldassets/icons/action-sprite/svg/symbols.svg#recall"></use></svg></span></div><div class="slds-media__body"><h1 class="slds-page-header__title slds-truncate slds-align-middle">Record Recovery</h1><div class="slds-text-body_small slds-line-height_reset slds-p-vertical--xx-small" (click)="reload()">{{loadDate}}</div></div></div></div><div><div><table class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr class="slds-text-title_caps"><th scope="col" colspan="2"><div class="slds-truncate" title="Opportunity Name">Object</div></th><th scope="col"><div class="slds-truncate" title="Account Name">Name</div></th><th scope="col"><div class="slds-truncate" title="Close Date">deleted date</div></th><th scope="col"><div class="slds-truncate" title="Stage">deleted by</div></th><th scope="col" style="width: 3.25rem;"><div class="slds-th__action"><span class="slds-assistive-text">Actions</span></div></th></tr></thead><tbody><tr *ngFor="let record of records"><td role="gridcell" class="slds-cell-shrink"><system-icon [module]="getModule(record.recordmodule)" size="small"></system-icon></td><td scope="row"><div class="slds-truncate">{{record.recordmodule}}</div></td><td><div class="slds-truncate">{{record.recordname}}</div></td><td><div class="slds-truncate">{{getUserDate(record.date_deleted)}}</div></td><td><div class="slds-truncate">{{record.user_name}}</div></td><td role="gridcell"><button class="slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-x-small" (click)="recoverRecord(record)"><system-button-icon [icon]="\'undelete\'"></system-button-icon></button></td></tr></tbody><tbody system-table-stencils [columns]="5" [select]="false" [tools]="true" [rows]="5" *ngIf="loading"></tbody></table><div *ngIf="!loading && records.length == 0" class="slds-p-around--medium slds-align--absolute-center"><h2 class="slds-text-heading--small">no records found</h2></div></div></div>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.backend,services_1.language,services_1.userpreferences,services_1.footer])],AdministrationSysTrashcanManager)}();exports.AdministrationSysTrashcanManager=AdministrationSysTrashcanManager;var AdministrationSysTrashcanRecover=function(){function AdministrationSysTrashcanRecover(t,e,s,i){this.metadata=t,this.backend=e,this.language=s,this.toast=i,this.record={},this.self={},this.relatedRecords=[],this.loading=!0,this.recoverrelated=!1,this.recovering=!1,this.recovered=new core_1.EventEmitter}return AdministrationSysTrashcanRecover.prototype.ngOnInit=function(){var e=this;this.backend.getRequest("/systrashcan/related/"+this.record.transactionid+"/"+this.record.recordid).subscribe(function(t){e.relatedRecords=t,0<e.relatedRecords.length&&(e.recoverrelated=!0),e.loading=!1})},AdministrationSysTrashcanRecover.prototype.close=function(){this.recovered.emit(!1),this.self.destroy()},AdministrationSysTrashcanRecover.prototype.getModule=function(t){return this.metadata.getModuleFromSingular(t)},Object.defineProperty(AdministrationSysTrashcanRecover.prototype,"recorverDisabled",{get:function(){return 0==this.relatedRecords.length},enumerable:!0,configurable:!0}),AdministrationSysTrashcanRecover.prototype.doRecover=function(){var e=this;this.recovering=!0,this.backend.postRequest("/systrashcan/recover/"+this.record.id,{recoverrelated:this.recoverrelated}).subscribe(function(t){e.toast.sendToast("record "+e.record.recordname+" recovered"),e.recovered.emit(!0),e.self.destroy()})},__decorate([core_1.Input(),__metadata("design:type",Object)],AdministrationSysTrashcanRecover.prototype,"record",void 0),AdministrationSysTrashcanRecover=__decorate([core_1.Component({template:'<section *ngIf="!recovering" role="dialog" class="slds-modal slds-fade-in-open"><div class="slds-modal__container"><header class="slds-modal__header"><button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" (click)="close()"><system-button-icon [icon]="\'close\'" [size]="\'large\'" [inverse]="true"></system-button-icon></button><h2 class="slds-text-heading_medium slds-hyphenate">Recover {{record.recordmodule}} {{record.recordname}}</h2></header><div class="slds-modal__content" style="height: 50%;"><div><table *ngIf="relatedRecords.length > 0; else norelatedrecords" class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr class="slds-text-title_caps"><th scope="col" colspan="2"><div class="slds-truncate" title="Opportunity Name">Object</div></th><th scope="col"><div class="slds-truncate" title="Account Name">Name</div></th><th scope="col"><div class="slds-truncate" title="Account Name">link</div></th></tr></thead><tbody><tr *ngFor="let relatedRecord of relatedRecords"><td role="gridcell" class="slds-cell-shrink"><system-icon [module]="getModule(relatedRecord.linkmodule)" size="small"></system-icon></td><td scope="row"><div class="slds-truncate">{{relatedRecord.linkmodule}}</div></td><td><div class="slds-truncate">{{relatedRecord.recordname}}</div></td><td><div class="slds-truncate">{{relatedRecord.linkname}}</div></td></tr></tbody></table><ng-template #norelatedrecords><div style="height: 100%;" class="slds-p-around--medium slds-align--absolute-center"><h2 class="slds-text-heading--small">no related records found</h2></div></ng-template></div><ng-template #loadspinner><div style="height: 100%;" class="slds-p-around--medium slds-align--absolute-center"><system-spinner></system-spinner></div></ng-template></div><footer class="slds-modal__footer"><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread"><div><div [ngClass]="{\'slds-hide\': recorverDisabled}" class="slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" [(ngModel)]="recoverrelated" id="recoverrelated"> <label class="slds-checkbox__label" for="recoverrelated"><span class="slds-checkbox_faux"></span> <span class="slds-form-element__label">recover Related</span></label></span></div></div><div><button class="slds-button slds-button--neutral" (click)="close()">Cancel</button> <button class="slds-button slds-button--brand" [disabled]="loading" (click)="doRecover()">Recover</button></div></div></footer></div></section><div class="slds-backdrop slds-backdrop_open slds-align--absolute-center"><div class="slds-box slds-theme--default slds-p-around--medium"><div>recovering record</div><system-spinner></system-spinner></div></div>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.backend,services_1.language,services_1.toast])],AdministrationSysTrashcanRecover)}();exports.AdministrationSysTrashcanRecover=AdministrationSysTrashcanRecover;var AdministrationDictRepair=function(){function AdministrationDictRepair(t){this.backend=t,this.loading=!0,this.repairsql="",this.lastDBError=""}return AdministrationDictRepair.prototype.ngOnInit=function(){this.getRepairSQL()},AdministrationDictRepair.prototype.getRepairSQL=function(){var e=this;this.loading=!0,this.backend.getRequest("dictionary/repair").subscribe(function(t){e.repairsql=t.sql,e.loading=!1})},AdministrationDictRepair.prototype.doRepair=function(){var e=this;this.backend.postRequest("dictionary/repair",{},{sql:btoa(this.repairsql)}).subscribe(function(t){e.lastDBError=t.response})},AdministrationDictRepair=__decorate([core_1.Component({selector:"administration-dict-repair",template:'<div class="slds-grid slds-grid--align-spread slds-p-around--medium"><h2 class="slds-text-heading--medium">Repair Dictionary</h2></div><div *ngIf="!loading" class="slds-p-around--small slds-theme--default"><div *ngIf="repairsql !=\'\'"><div class="slds-form-element"><label class="slds-form-element__label">SQL</label><div class="slds-form-element__control"><textarea class="slds-textarea" style="min-height: 400px;" [(ngModel)]="repairsql"></textarea></div></div><div class="slds-text-align_right slds-p-vertical--x-small"><button class="slds-button slds-button--brand" (click)="doRepair()">Execute</button></div><div><div class="slds-form-element"><label class="slds-form-element__label">Last Error</label><div class="slds-form-element__control"><textarea disabled class="slds-textarea" style="min-height: 400px;" [(ngModel)]="lastDBError"></textarea></div></div></div></div><div *ngIf="repairsql ==\'\'" class="slds-box slds-p-around--medium slds-align--absolute-center">no changes required</div></div><div *ngIf="loading" class="slds-p-around--medium"><system-spinner></system-spinner></div>'}),__metadata("design:paramtypes",[services_1.backend])],AdministrationDictRepair)}();exports.AdministrationDictRepair=AdministrationDictRepair;var AdministrationConfigEditor=function(){function AdministrationConfigEditor(t,e,s,i){this.metadata=t,this.language=e,this.backend=s,this.modal=i,this.componentconfig={},this.configvalues={},this.loading=!0}return AdministrationConfigEditor.prototype.ngOnInit=function(){var s=this;this.modal.openModal("SystemLoadingModal").subscribe(function(e){s.backend.getRequest("configurator/editor/"+s.componentconfig.category).subscribe(function(t){s.configvalues=t,s.loading=!1,e.instance.self.destroy()})})},Object.defineProperty(AdministrationConfigEditor.prototype,"items",{get:function(){for(var t=[],e=0,s=this.componentconfig.items;e<s.length;e++){var i=s[e];!0!==i.hidden&&t.push(i)}return t},enumerable:!0,configurable:!0}),AdministrationConfigEditor.prototype.save=function(){var s=this;this.loading=!0,this.modal.openModal("SystemLoadingModal").subscribe(function(e){e.instance.messagelabel="LBL_SAVING_DATA",s.backend.postRequest("configurator/editor/"+s.componentconfig.category,[],s.configvalues).subscribe(function(t){s.loading=!1,e.instance.self.destroy()})})},AdministrationConfigEditor=__decorate([core_1.Component({selector:"administration-configeditor",template:'<div class="slds-grid slds-grid--align-spread slds-p-around--medium"><h2 class="slds-text-heading--medium">editor</h2><button class="slds-button slds-button--neutral" (click)="save()">{{language.getLabel(\'LBL_SAVE\')}}</button></div><table class="slds-table slds-table--bordered slds-table--cell-buffer"><thead><tr class="slds-text-title--caps"><th scope="col">name</th><th scope="col">value</th></tr></thead><tbody><tr style="vertical-align: middle" class="slds-align-top" *ngFor="let item of items"><td>{{item.name}}</td><td><div class="slds-form-element__control"><input type="text" class="slds-input" [disabled]="loading" [(ngModel)]="configvalues[item.name]"></div></td></tr></tbody></table>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.language,services_1.backend,services_1.modal])],AdministrationConfigEditor)}();exports.AdministrationConfigEditor=AdministrationConfigEditor;var AdministrationSchedulerJobsEnum=function(){function AdministrationSchedulerJobsEnum(t,e,s,i,a,n){var o=this;this.model=t,this.view=e,this.language=s,this.metadata=i,this.router=a,this.backend=n,this.jobsList=[],this.backend.getRequest("module/Schedulers/jobslist").subscribe(function(t){for(var e in t)o.jobsList.push({key:e,name:t[e]});o.language.sortObjects(o.jobsList,"name")})}return AdministrationSchedulerJobsEnum.prototype.ngOnInit=function(){var e=this;this.model.data$.subscribe(function(t){return e.splitJob()}),this.model.isLoading||this.splitJob()},AdministrationSchedulerJobsEnum.prototype.splitJob=function(){var t=this.model.getField("job");t&&0===t.indexOf("url::",0)?(this._job="url::",this._url=t.slice(5)):(this._job=t,this._url="")},AdministrationSchedulerJobsEnum.prototype.trackByFn=function(t,e){return t},Object.defineProperty(AdministrationSchedulerJobsEnum.prototype,"job",{get:function(){return this._job},set:function(t){this.model.setField("job",t+("url::"===t?this._url:""))},enumerable:!0,configurable:!0}),Object.defineProperty(AdministrationSchedulerJobsEnum.prototype,"url",{get:function(){return this._url},set:function(t){"url::"===this._job&&this.model.setField("job","url::"+t)},enumerable:!0,configurable:!0}),AdministrationSchedulerJobsEnum=__decorate([core_1.Component({selector:"administration-scheduler-jobs-enum",template:'<system-section [titlelabel]="language.getLabel(\'LBL_JOB_TASK\')"><div *ngIf="!view.isEditMode()" class="slds-p-around--xx-small"><system-stencil *ngIf="model.isLoading"></system-stencil><div *ngIf="!model.isLoading" class="slds-has-divider--bottom slds-p-vertical--x-small spicecrm-fieldminheight"><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread" style="min-height:19px;"><div class="slds-truncate" style="width:100%">{{job}}<ng-container *ngIf="job===\'url::\'">{{url}}</ng-container></div><button style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" (click)="view.setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></div></div></div><div *ngIf="view.isEditMode()"><div class="slds-grid slds-grid--align-spread slds-p-around--xx-small"><div class="slds-form-element slds-p-horizontal--xx-small slds-size--1-of-2"><label class="slds-form-element__label"><abbr class="slds-required ng-star-inserted">*</abbr> {{language.getLabel(\'LBL_JOB_TASK\')}}</label><div class="slds-form-element__control slds-m-vertical--xx-small"><div class="slds-select_container"><select id="moduleselect1" class="slds-select" [(ngModel)]="job"><option *ngIf="!job">{{language.getLabel(\'LBL_SELECT\')}} &hellip;</option><option *ngFor="let job of jobsList; trackBy: trackByFn" [value]="job.key">{{job.name}}</option></select></div></div></div><div class="slds-form-element slds-p-horizontal--xx-small slds-size--1-of-2"><label class="slds-form-element__label" for="text-input-id-1"><abbr *ngIf="job===\'url::\'" class="slds-required ng-star-inserted">*</abbr> {{language.getLabel(\'LBL_URL\')}}</label><div class="slds-form-element__control slds-m-vertical--xx-small"><input type="text" id="text-input-id-1" class="slds-input" [(ngModel)]="url" [disabled]="job!==\'url::\'"></div></div></div></div></system-section>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],AdministrationSchedulerJobsEnum)}();exports.AdministrationSchedulerJobsEnum=AdministrationSchedulerJobsEnum;var AdministrationSchedulerJobLog=function(){function AdministrationSchedulerJobLog(t,e,s,i,a,n,o){var l=this;this.model=t,this.language=e,this.metadata=s,this.broadcast=i,this.elementRef=a,this.userpreferences=n,this.backend=o,this.schedulerLogs=[],this.isLoading=!1,this.isReLoading=!1,this.subscription=new rxjs_1.Subscription,this.subscription=this.broadcast.message$.subscribe(function(t){"scheduler.run"==t.messagetype&&l.reloadData()})}return AdministrationSchedulerJobLog.prototype.ngOnInit=function(){this.getData()},AdministrationSchedulerJobLog.prototype.getData=function(){var e=this;this.totalLimit=10,this.isLoading=!0,this.backend.getRequest("module/Schedulers/"+this.model.id+"/related/schedulers_times",{sort:{sortfield:"execute_time",sortdirection:"DESC"},offset:0,limit:10,getcount:!0}).subscribe(function(t){e.schedulerLogs=_.values(t.list),e.sortList(),e.totalLines=t.count,e.isLoading=!1},function(t){return e.isLoading=!1})},AdministrationSchedulerJobLog.prototype.getMoreData=function(){var e=this,t={sort:{sortfield:"execute_time",sortdirection:"DESC"},offset:this.schedulerLogs.length,limit:10,getcount:!0};this.totalLimit+=10,this.isLoading=!0,this.backend.getRequest("module/Schedulers/"+this.model.id+"/related/schedulers_times",t).subscribe(function(t){e.schedulerLogs=e.schedulerLogs.concat(_.values(t.list)),e.sortList(),e.totalLines=t.count,e.isLoading=!1},function(t){return e.isLoading=!1})},AdministrationSchedulerJobLog.prototype.reloadData=function(){var e=this,t={sort:{sortfield:"execute_time",sortdirection:"DESC"},offset:0,limit:this.totalLimit,getcount:!0};this.isLoading=this.isReLoading=!0,this.backend.getRequest("module/Schedulers/"+this.model.id+"/related/schedulers_times",t).subscribe(function(t){e.schedulerLogs=_.values(t.list),e.sortList(),e.totalLines=t.count,e.isLoading=e.isReLoading=!1},function(t){return e.isLoading=e.isReLoading=!1})},AdministrationSchedulerJobLog.prototype.ngOnDestroy=function(){this.subscription.unsubscribe()},AdministrationSchedulerJobLog.prototype.getResolutionClass=function(t){switch(t){case"failure":return"slds-text-color_error";case"success":return"slds-text-color_success";default:return"slds-text-color--default"}},AdministrationSchedulerJobLog.prototype.displayDateValue=function(t){return t?((t=moment(t).tz(this.userpreferences.toUse.timezone)).add(t.utcOffset(),"m"),t.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat())):""},AdministrationSchedulerJobLog.prototype.trackByFn=function(t,e){return e.id},AdministrationSchedulerJobLog.prototype.sortList=function(){this.schedulerLogs.sort(function(t,e){return t.execute_time<e.execute_time?1:t.execute_time>e.execute_time?-1:0})},AdministrationSchedulerJobLog=__decorate([core_1.Component({selector:"administration-scheduler-jobs-enum",template:'<div *ngIf="schedulerLogs.length" class="slds-grid slds-grid_align-spread slds-m-bottom--medium"><div>{{language.ucFirst(language.getLabel(\'LBL_RECENT_ENTRIES\'))}} ({{schedulerLogs.length}} {{language.getLabel(\'LBL_FROM\')}} {{totalLines}} {{language.getLabel(\'LBL_TOTAL\')}}):</div><system-button-icon class="slds-p-horizontal--xxx-small" [icon]="\'refresh\'" (click)="!isLoading && reloadData()"></system-button-icon></div><table class="slds-table slds-table--bordered slds-table--cell-buffer slds-table--fixed-layout" role="grid"><thead><tr class="slds-line-height_reset"><th scope="col"><div class="slds-truncate">{{language.getLabel(\'LBL_EXECUTE_TIME\')}}</div></th><th scope="col"><div class="slds-truncate">{{language.getLabel(\'LBL_STATUS\')}}</div></th><th scope="col"><div class="slds-truncate">{{language.getLabel(\'LBL_RESOLUTION\')}}</div></th><th scope="col"><div class="slds-truncate">{{language.getLabel(\'LBL_MESSAGE\')}}</div></th></tr></thead><tbody><tr *ngFor="let scheduler of schedulerLogs; trackBy: trackByFn" class="slds-hint-parent" [ngStyle]="{\'opacity\':isReLoading?0.33:1}"><td scope="row"><div class="slds-truncate">{{displayDateValue(scheduler.execute_time)}}</div></td><td scope="row"><div class="slds-truncate">{{scheduler.status}}</div></td><td scope="row"><div class="slds-truncate" [ngClass]="getResolutionClass(scheduler.resolution)">{{scheduler.resolution}}</div></td><td scope="row" class="slds-grid"><div class="slds-truncate" aria-describedby="more" [title]="scheduler.message">{{scheduler.message}}&nbsp;</div></td></tr><tr *ngIf="schedulerLogs.length == 0"><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td><td>&nbsp;</td></tr></tbody></table><div class="slds-grid slds-grid--align-spread slds-grid--vertical-align-center slds-m-top--medium"><div class="slds-text-align--center" style="width:100%"><system-spinner *ngIf="isLoading"></system-spinner></div><button class="slds-button slds-button_neutral" [disabled]="isLoading" (click)="getMoreData()">{{language.getLabel(\'LBL_MORE\')}}</button></div>',providers:[services_1.relatedmodels]}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.metadata,services_1.broadcast,core_1.ElementRef,services_1.userpreferences,services_1.backend])],AdministrationSchedulerJobLog)}();exports.AdministrationSchedulerJobLog=AdministrationSchedulerJobLog;var AdministrationSchedulerRunButton=function(){function AdministrationSchedulerRunButton(t,e,s,i,a,n,o){this.model=t,this.language=e,this.metadata=s,this.broadcast=i,this.toast=a,this.modal=n,this.backend=o}return AdministrationSchedulerRunButton.prototype.execute=function(){var s=this;this.modal.openModal("SystemLoadingModal",!1).subscribe(function(e){s.backend.postRequest("module/Schedulers/"+s.model.id+"/runjob").subscribe(function(t){e.instance.self.destroy(),t?s.toast.sendToast(s.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):s.toast.sendToast(s.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),s.broadcast.broadcastMessage("scheduler.run")},function(t){e.instance.self.destroy(),s.toast.sendToast(s.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),s.broadcast.broadcastMessage("scheduler.run")})})},AdministrationSchedulerRunButton=__decorate([core_1.Component({selector:"administration-scheduler-run-button",template:"<span>{{language.getLabel('LBL_RUN_NOW')}}</span>"}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.metadata,services_1.broadcast,services_1.toast,services_1.modal,services_1.backend])],AdministrationSchedulerRunButton)}();exports.AdministrationSchedulerRunButton=AdministrationSchedulerRunButton;var AdministrationSchedulerScheduleButton=function(){function AdministrationSchedulerScheduleButton(t,e,s,i,a,n,o){this.model=t,this.language=e,this.metadata=s,this.broadcast=i,this.toast=a,this.modal=n,this.backend=o}return AdministrationSchedulerScheduleButton.prototype.execute=function(){var s=this;this.modal.openModal("SystemLoadingModal",!1).subscribe(function(e){s.backend.postRequest("module/Schedulers/"+s.model.id+"/runjob").subscribe(function(t){e.instance.self.destroy(),t?s.toast.sendToast(s.language.getLabel("MSG_SUCCESSFULLY_EXECUTED"),"success"):s.toast.sendToast(s.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),s.broadcast.broadcastMessage("scheduler.run")},function(t){e.instance.self.destroy(),s.toast.sendToast(s.language.getLabel("ERR_FAILED_TO_EXECUTE"),"error"),s.broadcast.broadcastMessage("scheduler.run")})})},AdministrationSchedulerScheduleButton=__decorate([core_1.Component({selector:"administration-scheduler-schedule-button",template:"<span>{{language.getLabel('LBL_SCHEDULE_NOW')}}</span>"}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.metadata,services_1.broadcast,services_1.toast,services_1.modal,services_1.backend])],AdministrationSchedulerScheduleButton)}();exports.AdministrationSchedulerScheduleButton=AdministrationSchedulerScheduleButton;var AdministrationDictionaryManagerItemField=function(){function t(t){this.dictionary=t,this.field="",this.id="",this.inputvalue="",this.editMode=!1}return Object.defineProperty(t.prototype,"fieldvalue",{get:function(){return this.inputvalue},set:function(t){},enumerable:!0,configurable:!0}),t.prototype.isEditMode=function(){return this.editMode},t.prototype.setEditMode=function(){this.editMode=!0},t.prototype.closeEdit=function(){this.editMode=!1},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnInit=function(){},__decorate([core_1.Input(),__metadata("design:type",String)],t.prototype,"field",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],t.prototype,"id",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],t.prototype,"inputvalue",void 0),t=__decorate([core_1.Component({selector:"[administration-dictionarymanager-item-field]",template:'<p *ngIf="!isEditMode()" class="slds-text-body--regular slds-truncate spicecrm-fieldbody"><span>{{fieldvalue}}</span> <button style="float: right" class="slds-button slds-button--icon" (click)="setEditMode()"><svg aria-hidden="true" class="slds-button__icon"><use xlink:href="./sldassets/icons/utility-sprite/svg/symbols.svg#edit"></use></svg></button></p><div *ngIf="isEditMode()" class="slds-form-element__control"><input class="slds-input" type="text" [(ngModel)]="fieldvalue"></div>'}),__metadata("design:paramtypes",[dictionary])],t)}();exports.AdministrationDictionaryManagerItemField=AdministrationDictionaryManagerItemField;var AdministrationDictionaryManager=function(){function t(t){this.dictionary=t,this.dictionaryitem=""}return t.prototype.ngAfterViewInit=function(){this.dictionary.load(this.dictionaryitem).subscribe(function(t){})},t.prototype.isEditMode=function(){},t.prototype.closeEditMode=function(){},__decorate([core_1.Input(),__metadata("design:type",String)],t.prototype,"dictionaryitem",void 0),t=__decorate([core_1.Component({selector:"administration-dictionarymanager",template:'<div class="slds-page-header" role="banner"><div class="slds-grid"><div class="slds-col slds-has-flexi-truncate"><div class="slds-media slds-no-space slds-grow"><div class="slds-media__body"><h1 class="slds-page-header__title slds-m-right--small slds-align-middle slds-truncate">Dictionary {{dictionaryitem}}</h1><p class="slds-text-title--caps slds-line-height--reset">{{dictionary.data.length}} Items</p></div></div></div></div></div><table class="slds-table slds-table--bordered slds-table--fixed-layout" role="grid"><thead><tr class="slds-text-title--caps"><th *ngFor="let field of dictionary.getFields()" class="slds-is-sortable slds-is-resizable" scope="col"><a href="javascript:void(0);" class="slds-th__action slds-text-link--reset"><span class="slds-truncate">{{field}}</span></a></th></tr></thead><tbody><tr administration-dictionarymanager-item class="slds-hint-parent" *ngFor="let item of dictionary.data" [item]="item"></tr></tbody></table><footer class="slds-utility-bar_container" role="footer" *ngIf="isEditMode()"><ul class="slds-utility-bar"><li class="slds-utility-bar__item"><button class="slds-button slds-utility-bar__action slds-button--brand">Save</button></li><li class="slds-utility-bar__item"><button class="slds-button slds-utility-bar__action slds-button--brand" (click)="closeEditMode()">Cancel</button></li></ul></footer>',providers:[dictionary]}),__metadata("design:paramtypes",[dictionary])],t)}();exports.AdministrationDictionaryManager=AdministrationDictionaryManager;var AdministrationDictionaryManagerItem=function(){function t(t){this.dictionary=t,this.item={},this.editMode=!1}return t.prototype.isEditMode=function(){return this.editMode},t.prototype.setEditMode=function(){this.editMode=!0},t.prototype.closeEdit=function(){this.editMode=!1},t.prototype.ngAfterViewInit=function(){},t.prototype.ngOnInit=function(){},__decorate([core_1.Input(),__metadata("design:type",Object)],t.prototype,"item",void 0),t=__decorate([core_1.Component({selector:"[administration-dictionarymanager-item]",template:'<td scope="row" *ngFor="let field of dictionary.getFields()"><div administration-dictionarymanager-item-field [field]="field" [id]="item.id" [inputvalue]="item[field]" class="slds-truncate"></div></td>'}),__metadata("design:paramtypes",[dictionary])],t)}();exports.AdministrationDictionaryManagerItem=AdministrationDictionaryManagerItem;var VersionControllerComponent=function(){function VersionControllerComponent(t,e){this.metadata=t,this.vms=e}return Object.defineProperty(VersionControllerComponent.prototype,"module_versions",{get:function(){return this.vms.module_versions},enumerable:!0,configurable:!0}),Object.defineProperty(VersionControllerComponent.prototype,"modules",{get:function(){return this.metadata.getAppModules()},enumerable:!0,configurable:!0}),VersionControllerComponent=__decorate([core_1.Component({selector:"version-controller",template:'<article class="slds-card slds-m-around--medium"><div class="slds-card__header"><h2>Version Control</h2></div><div class="slds-card__body"><table class="slds-table slds-table_bordered slds-table_cell-buffer"><thead><tr><th>Name</th><th>Version</th><th>Builddate</th></tr></thead><tbody><tr *ngFor="let m of modules"><ng-container *ngVar="vms.getModule(m.module) as mv"><th>{{m.module}}</th><ng-container *ngIf="mv else not_loaded"><td>{{mv.version}}</td><td>{{mv.build_date}}</td></ng-container><ng-template #not_loaded><td colspan="2" class="slds-text-color--weak">not loaded...</td></ng-template></ng-container></tr></tbody></table></div></article>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.VersionManagerService])],VersionControllerComponent)}();exports.VersionControllerComponent=VersionControllerComponent;var AdministrationMain=function(){function AdministrationMain(){}return AdministrationMain=__decorate([core_1.Component({selector:"administration-main",template:"<div administration-menu></div>"})],AdministrationMain)}();exports.AdministrationMain=AdministrationMain;var AdminComponentsModule=function(){function AdminComponentsModule(t){this.vms=t,this.version="1.0",this.build_date="2019-10-02",t.registerModule(this)}return AdminComponentsModule=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,systemcomponents_1.SystemComponents,directives_1.DirectivesModule,router_1.RouterModule.forChild([{path:"",component:AdministrationMain}])],declarations:[AdministrationMain,AdministrationMenu,AdministrationMenuRouteItem,AdministrationConfigurator,AdministrationConfiguratorItem,AdministrationConfiguratorItemRole,AdministrationQuotaManager,AdministrationQuotaManagerField,AdministrationFTSManager,AdministrationFTSManagerFields,AdministrationFTSManagerDetails,AdministrationFTSManagerFieldsAdd,AdministrationFTSStats,AdministrationDictionaryManager,AdministrationDictionaryManagerItem,AdministrationDictionaryManagerItemField,AdministrationSysTrashcanManager,AdministrationSysTrashcanRecover,AdministrationDictRepair,VersionControllerComponent,AdministrationConfigEditor,AdministrationSchedulerJobsEnum,AdministrationSchedulerJobLog,AdministrationSchedulerRunButton,AdministrationSchedulerScheduleButton,AdministrationSystemStats],entryComponents:[AdministrationMain,AdministrationMenu,AdministrationConfigurator,AdministrationQuotaManager,AdministrationQuotaManagerField,AdministrationFTSManager,AdministrationDictionaryManager,AdministrationDictionaryManagerItem,AdministrationDictionaryManagerItemField],exports:[]}),__metadata("design:paramtypes",[services_1.VersionManagerService])],AdminComponentsModule)}();exports.AdminComponentsModule=AdminComponentsModule;