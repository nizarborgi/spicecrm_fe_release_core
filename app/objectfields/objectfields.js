/*
SpiceUI 2018.10.001

Copyright (c) 2016-present, aac services.k.s - All rights reserved.
Redistribution and use in source and binary forms, without modification, are permitted provided that the following conditions are met:
- Redistributions of source code must retain this copyright and license notice, this list of conditions and the following disclaimer.
- Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
- If used the SpiceCRM Logo needs to be displayed in the upper left corner of the screen in a minimum dimension of 31x31 pixels and be clearly visible, the icon needs to provide a link to http://www.spicecrm.io
THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.

*/

/*(c) aac services 2019. All Rights reserved)*/
"use strict";var __extends=this&&this.__extends||function(){var i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var s in t)t.hasOwnProperty(s)&&(e[s]=t[s])})(e,t)};return function(e,t){function s(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(s.prototype=t.prototype,new s)}}(),__assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,s=1,i=arguments.length;s<i;s++)for(var l in t=arguments[s])Object.prototype.hasOwnProperty.call(t,l)&&(e[l]=t[l]);return e}).apply(this,arguments)},__decorate=this&&this.__decorate||function(e,t,s,i){var l,o=arguments.length,a=o<3?t:null===i?i=Object.getOwnPropertyDescriptor(t,s):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,s,i);else for(var d=e.length-1;0<=d;d--)(l=e[d])&&(a=(o<3?l(a):3<o?l(t,s,a):l(t,s))||a);return 3<o&&a&&Object.defineProperty(t,s,a),a},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},__param=this&&this.__param||function(s,i){return function(e,t){i(e,t,s)}};Object.defineProperty(exports,"__esModule",{value:!0});var common_1=require("@angular/common"),core_1=require("@angular/core"),forms_1=require("@angular/forms"),services_1=require("../services/services"),systemcomponents_1=require("../systemcomponents/systemcomponents"),directives_1=require("../directives/directives"),router_1=require("@angular/router"),platform_browser_1=require("@angular/platform-browser"),rxjs_1=require("rxjs"),fieldGeneric=function(){function fieldGeneric(e,t,s,i,l){var o=this;this.model=e,this.view=t,this.language=s,this.metadata=i,this.router=l,this.fieldname="",this.fieldconfig={},this.fielddisplayclass={},this.fieldid="",this.fieldlength=999,this._css_classes=[],this.fieldid=this.model.generateGuid(),this.view.mode$.subscribe(function(e){"edit"==e&&o.view.editfieldid&&o.view.editfieldid==o.fieldid&&o.setFocus()})}return fieldGeneric.prototype.ngOnInit=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);e&&e.len&&(this.fieldlength=e.len)},Object.defineProperty(fieldGeneric.prototype,"modelOptions",{get:function(){return{updateOn:"blur"}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldGeneric.prototype,"value",{get:function(){return this.model.getField(this.fieldname)},set:function(e){this.model.setField(this.fieldname,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldGeneric.prototype,"errors",{get:function(){return this.model.getFieldMessages(this.fieldname,"error")},enumerable:!0,configurable:!0}),Object.defineProperty(fieldGeneric.prototype,"css_classes",{get:function(){return this.getStati().invalid?this.addCssClass("slds-has-error"):this.removeCssClass("slds-has-error"),this._css_classes},enumerable:!0,configurable:!0}),Object.defineProperty(fieldGeneric.prototype,"field_defs",{get:function(){return this._field_defs||(this._field_defs=this.metadata.getFieldDefs(this.model.module,this.fieldname)),this._field_defs},enumerable:!0,configurable:!0}),fieldGeneric.prototype.setFocus=function(){var e=this;setTimeout(function(){e.focuselement&&(e.focuselement.element.nativeElement.tabIndex||(e.focuselement.element.nativeElement.tabIndex="-1"),e.focuselement.element.nativeElement.focus())})},fieldGeneric.prototype.getStati=function(e){void 0===e&&(e=this.fieldname);var t=this.model.getFieldStati(e);return!t.editable||this.view.isEditable&&!this.fieldconfig.readonly||(t.editable=!1),t},fieldGeneric.prototype.isEditable=function(e){return void 0===e&&(e=this.fieldname),this.getStati(e).editable&&!this.getStati(e).readonly&&!this.getStati(e).disabled&&!this.getStati(e).hidden},fieldGeneric.prototype.isEditMode=function(){return!(!this.view.isEditMode()||!this.isEditable())},fieldGeneric.prototype.displayLink=function(){try{return this.view.displayLinks&&this.fieldconfig.link&&this.model.data.acl.detail}catch(e){return!1}},fieldGeneric.prototype.setEditMode=function(){this.model.startEdit(),this.view.setEditMode()},fieldGeneric.prototype.getFieldClass=function(){return this.css_classes},fieldGeneric.prototype.fieldHasError=function(e){return this.hasFieldErrors(e)},fieldGeneric.prototype.hasFieldErrors=function(e){return void 0===e&&(e=this.fieldname),!(!this.getStati(e).invalid&&!this.errors)},fieldGeneric.prototype.goRecord=function(){this.router.navigate(["/module/"+this.model.module+"/"+this.model.id])},fieldGeneric.prototype.addCssClass=function(e){return this._css_classes.includes(e)||this._css_classes.push(e),!0},fieldGeneric.prototype.removeCssClass=function(e){return this._css_classes.includes(e)&&this._css_classes.splice(this._css_classes.indexOf(e),1),!0},fieldGeneric.prototype.toggleCssClass=function(e){return this._css_classes.includes(e)?this.removeCssClass(e):this.addCssClass(e),!0},fieldGeneric.prototype.setFieldError=function(e){return this.model.setFieldMessage("error",e,this.fieldname,this.fieldid)},fieldGeneric.prototype.clearFieldError=function(){return this.model.resetFieldMessages(this.fieldname,"error",this.fieldid)},__decorate([core_1.ViewChild("focus",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldGeneric.prototype,"focuselement",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],fieldGeneric.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],fieldGeneric.prototype,"fieldconfig",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],fieldGeneric.prototype,"fielddisplayclass",void 0),fieldGeneric=__decorate([core_1.Component({selector:"field-generic",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [title]="value" [fieldid]="fieldid">{{value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="css_classes"><input #focus type="text" class="slds-input" [(ngModel)]="value" [maxlength]="fieldlength" [ngModelOptions]="modelOptions"><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldGeneric)}();exports.fieldGeneric=fieldGeneric;var fieldSet=function(){function e(e){this.metadata=e,this.fieldset="",this.fieldsetconfig={},this.fieldsetItems=[]}return e.prototype.ngOnInit=function(){this.fieldsetItems=this.metadata.getFieldSetItems(this.fieldset)},e.prototype.getFormClass=function(){if(this.fieldsetconfig.formclass)return this.fieldsetconfig.formclass},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldset",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldsetconfig",void 0),e=__decorate([core_1.Component({selector:"field-set",template:'<div [ngClass]="getFormClass()"><ng-container *ngFor="let item of fieldsetItems"><field *ngIf="item.field" [field]="item"></field><field-set *ngIf="!item.field" [fieldset]="item.fieldset" [fieldsetconfig]="item.fieldconfig"></field-set></ng-container></div>',host:{"[class.slds-form-element]":"true"}}),__metadata("design:paramtypes",[services_1.metadata])],e)}();exports.fieldSet=fieldSet;var field=function(){function e(){this.field={}}return __decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"field",void 0),e=__decorate([core_1.Component({selector:"field",template:'<div class="slds-form-element"><field-label *ngIf="field.fieldconfig.hidelabel !== true" [fieldname]="field.field" [fieldconfig]="field.fieldconfig"></field-label><div class="slds-form-element__control"><field-container [field]="field.field" [fieldconfig]="field.fieldconfig"></field-container></div></div>',host:{"[class.slds-form-element]":"true"}})],e)}();exports.field=field;var fieldBlank=function(){function fieldBlank(){}return fieldBlank=__decorate([core_1.Component({selector:"field-blank",template:'<div class="slds-truncate"></div>'})],fieldBlank)}();exports.fieldBlank=fieldBlank;var fieldLabel=function(){function fieldLabel(e,t,s){this.model=e,this.view=t,this.language=s,this.fieldname="",this.fieldconfig={},this.addclasses="slds-form-element__label"}return Object.defineProperty(fieldLabel.prototype,"stati",{get:function(){var e=this.model.getFieldStati(this.fieldname);return!e.editable||this.view.isEditable&&!this.fieldconfig.readonly||(e.editable=!1),this.fieldconfig.required&&(e.required=!0),e},enumerable:!0,configurable:!0}),fieldLabel.prototype.isRequired=function(){return this.stati.editable&&this.stati.required},fieldLabel.prototype.isEditable=function(){return this.stati.editable},fieldLabel.prototype.isEditMode=function(){return!(!this.view.isEditMode()||!this.isEditable())},Object.defineProperty(fieldLabel.prototype,"hidden",{get:function(){return!!this.fieldconfig.hidelabel},enumerable:!0,configurable:!0}),Object.defineProperty(fieldLabel.prototype,"label",{get:function(){if(this.fieldconfig.label){if(0<this.fieldconfig.label.indexOf(":")){var e=this.fieldconfig.label.split(":");return this.language.getLabel(e[1],e[0],this.view.labels)}return this.language.getLabel(this.fieldconfig.label,this.model.module,this.view.labels)}return this.language.getFieldDisplayName(this.model.module,this.fieldname,this.fieldconfig,this.view.labels)},enumerable:!0,configurable:!0}),__decorate([core_1.Input(),__metadata("design:type",String)],fieldLabel.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],fieldLabel.prototype,"fieldconfig",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],fieldLabel.prototype,"addclasses",void 0),fieldLabel=__decorate([core_1.Component({selector:"field-label",template:'<label class="slds-truncate" [ngClass]="addclasses"><abbr *ngIf="isRequired()" class="slds-required">*</abbr>{{label}}</label>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language])],fieldLabel)}();exports.fieldLabel=fieldLabel;var fieldContainer=function(){function e(e,t,s){this.model=e,this.language=t,this.metadata=s,this.fieldconfig={},this.fielddisplayclass="slds-text-body--regular slds-truncate slds-m-vertical--small spicecrm-fieldbody"}return Object.defineProperty(e.prototype,"fieldname",{get:function(){return this.field},set:function(e){this.field=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stati",{get:function(){return this.model.getFieldStati(this.field)},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.buildContainer()},e.prototype.buildContainer=function(){var t=this;this.metadata.addComponent(this.getFieldType(),this.fieldcontainer).subscribe(function(e){e.instance.fieldname=t.field,e.instance.fieldconfig=t.fieldconfig,e.instance.fielddisplayclass=t.fielddisplayclass})},e.prototype.getFieldType=function(){var e="";if(this.model.data&&this.model.data.acl_fieldcontrol&&this.model.data.acl_fieldcontrol[this.field]&&"1"==this.model.data.acl_fieldcontrol[this.field])return"fieldNotAuthorized";e="blank"===this.field?"blank":this.fieldconfig.fieldtype?this.fieldconfig.fieldtype:this.metadata.getFieldType(this.model.module,this.field);var t=this.metadata.getFieldTypeComponent(e);return t||"fieldGeneric"},__decorate([core_1.ViewChild("fieldcontainer",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"fieldcontainer",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"field",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldconfig",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fielddisplayclass",void 0),__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],e.prototype,"fieldname",null),e=__decorate([core_1.Component({selector:"field-container",template:"<div [ngClass]=\"{'slds-hidden': stati.hidden}\"><div #fieldcontainer></div></div>"}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.metadata])],e)}();exports.fieldContainer=fieldContainer;var fieldGenericDisplay=function(){function e(e,t,s){this.model=e,this.view=t,this.language=s,this.editable=!1,this.fieldconfig={},this.fielddisplayclass="",this.fieldid=""}return e.prototype.isEditMode=function(){return!(!this.view.isEditMode()||!this.editable)},Object.defineProperty(e.prototype,"link",{get:function(){try{return this.view.displayLinks&&this.fieldconfig.link&&this.model.data.acl.detail}catch(e){return!1}},enumerable:!0,configurable:!0}),e.prototype.setEditMode=function(){this.model.startEdit(),this.view.setEditMode(this.fieldid)},e.prototype.goRecord=function(){this.link&&this.model.goDetail()},__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"editable",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldconfig",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fielddisplayclass",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldid",void 0),e=__decorate([core_1.Component({selector:"field-generic-display",template:'<div [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread" style="min-height: 19px;"><div class="slds-truncate" style="width:100%"><ng-container *ngIf="link;else nolink"><a href="javascript:void(0);" (click)="goRecord()"><ng-container *ngTemplateOutlet="content"></ng-container></a></ng-container><ng-template #nolink><ng-container *ngTemplateOutlet="content"></ng-container></ng-template></div><button *ngIf="editable" style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></div></ng-template><ng-template #content><ng-content></ng-content></ng-template></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language])],e)}();exports.fieldGenericDisplay=fieldGenericDisplay;var fieldText=function(d){function fieldText(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.modalservice=o,a.speechRecognition=!1,a.browserIsChrome=!!window.chrome&&!!window.chrome.webstore,a}return __extends(fieldText,d),fieldText.prototype.ngOnInit=function(){this.browserIsChrome&&(this.speechRecognition=this.fieldconfig.speechRecognition,this.speechRecognition=!0)},fieldText.prototype.getTextAreaStyle=function(){var e={};return this.fieldconfig.minheight&&(e["min-height"]=this.fieldconfig.minheight),this.fieldconfig.maxheight&&(e["max-height"]=this.fieldconfig.maxheight),e},fieldText.prototype.speechRecognitionStart=function(e){var t=this;this.modalservice.openModal("SpeechRecognition",!1).subscribe(function(e){e.instance.textfield=t.textField})},__decorate([core_1.ViewChild("textField",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldText.prototype,"textField",void 0),fieldText=__decorate([core_1.Component({selector:"field-text",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><div style="white-space: pre-line;">{{value}}</div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()" style="position:relative;"><textarea #focus #textField class="slds-textarea slds-scrollable--y slds-m-vertical--xx-small" [(ngModel)]="value" [ngStyle]="getTextAreaStyle()"></textarea> <button *ngIf="speechRecognition" style="position:absolute;margin-top:-26px;right:0.35rem;top:0" class="slds-button slds-button_small slds-button_icon" (click)="speechRecognitionStart($event)"><system-button-icon [size]="\'small\'" [icon]="\'unmuted\'"></system-button-icon></button><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.modal])],fieldText)}(fieldGeneric);exports.fieldText=fieldText;var fieldNumber=function(a){function fieldNumber(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldNumber,a),Object.defineProperty(fieldNumber.prototype,"min",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(fieldNumber.prototype,"max",{get:function(){return 120},enumerable:!0,configurable:!0}),fieldNumber=__decorate([core_1.Component({selector:"field-number",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><div class="slds-text-align_right">{{value}}</div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-around--xx-small" [ngClass]="getFieldClass()"><input class="slds-input slds-text-align_right" type="number" [min]="min" [max]="max" [(ngModel)]="value"><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldNumber)}(fieldGeneric);exports.fieldNumber=fieldNumber;var fieldHtml=function(r){function fieldHtml(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.zone=o,n.sanitized=a,n.modal=d,n.stylesheetField="",n.stylesheetToUse="",n.fullValue="",n.stylesheets=n.metadata.getHtmlStylesheetNames(),n}return __extends(fieldHtml,r),fieldHtml.prototype.ngOnInit=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);_.isEmpty(e.stylesheet_id_field)||(this.stylesheetField=e.stylesheet_id_field),this.useStylesheets=!_.isEmpty(this.stylesheetField)&&!_.isEmpty(this.stylesheets),this.useStylesheets&&(1===this.stylesheets.length?this.stylesheetToUse=this.stylesheets[0].id:_.isEmpty(this.fieldconfig.stylesheetId)?this.stylesheetToUse=this.metadata.getHtmlStylesheetToUse(this.model.module,this.fieldname):this.stylesheetToUse=this.fieldconfig.stylesheetId),this.useStylesheetSwitcher=this.useStylesheets&&_.isEmpty(this.stylesheetToUse)},Object.defineProperty(fieldHtml.prototype,"styleTag",{get:function(){return this.useStylesheets&&!_.isEmpty(this.model.data[this.stylesheetField])?"<style>"+this.metadata.getHtmlStylesheetCode(this.model.data[this.stylesheetField])+"</style>":""},enumerable:!0,configurable:!0}),Object.defineProperty(fieldHtml.prototype,"sanitizedValue",{get:function(){return this.value&&(this.value.includes("</html>")?this.fullValue=this.value:this.fullValue="<html><head>"+this.styleTag+'</head><body class="spice">'+this.value+"</body></html>"),this.fullValue!=this.fullValue_cached&&(this._sanitizedValue=this.sanitized.bypassSecurityTrustResourceUrl(this.fullValue?"data:text/html;charset=UTF-8,"+encodeURIComponent(this.fullValue):""),this.fullValue_cached=this.fullValue),this._sanitizedValue},enumerable:!0,configurable:!0}),Object.defineProperty(fieldHtml.prototype,"stylesheetId",{get:function(){return _.isEmpty(this.model.data[this.stylesheetField])?this.stylesheetId=this.stylesheetToUse:this.model.data[this.stylesheetField]},set:function(e){e&&this.model.setField(this.stylesheetField,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldHtml.prototype,"asiframe",{get:function(){return!(!this.fieldconfig.asiframe&&_.isEmpty(this.fieldconfig.stylesheetId)&&_.isEmpty(this.stylesheetField))},enumerable:!0,configurable:!0}),fieldHtml.prototype.updateField=function(e){this.value=e,this.zone.run(function(){})},fieldHtml.prototype.updateStylesheet=function(e){!_.isEmpty(this.stylesheetField)&&_.isString(e)&&this.model.setField(this.stylesheetField,e)},fieldHtml.prototype.expand=function(){var t=this;this.modal.openModal("SystemTinyMCEModal",!1).subscribe(function(e){e.instance.title=t.getLabel(),e.instance.content=t.value,e.instance.stylesheetId=t.stylesheetId,e.instance.updateContent.subscribe(function(e){t.value=e})})},fieldHtml.prototype.eventHandler=function(e){this.value=e.srcElement.innerHTML},fieldHtml.prototype.getLabel=function(){if(this.fieldconfig.label){if(0<this.fieldconfig.label.indexOf(":")){var e=this.fieldconfig.label.split(":");return this.language.getLabel(e[1],e[0],this.view.labels)}return this.language.getLabel(this.fieldconfig.label,this.model.module,this.view.labels)}return this.language.getFieldDisplayName(this.model.module,this.fieldname,this.fieldconfig,this.view.labels)},fieldHtml.prototype.print=function(){this.printframe.element.nativeElement.contentWindow.print()},__decorate([core_1.ViewChild("printframe",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldHtml.prototype,"printframe",void 0),fieldHtml=__decorate([core_1.Component({selector:"field-html",template:'<div style="position:relative"><div style="position:absolute;right:0px;top:-21px;"><button class="slds-button slds-button--icon" (click)="print()"><system-custom-icon size="x-small" icon="print"></system-custom-icon></button><iframe #printframe [src]="sanitizedValue" style="width:0;height:0;border:0"></iframe><button *ngIf="isEditable() && !isEditMode()" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button> <button *ngIf="isEditMode()" class="slds-button slds-button--icon" (click)="expand()" style="z-index: 1"><system-button-icon [icon]="\'expand\'"></system-button-icon></button></div></div><div *ngIf="!isEditMode()" class="slds-scrollable--y" style="max-height: 300px;" [ngClass]="fielddisplayclass"><div *ngIf="!asiframe" class="slds-size--1-of-1 html-text" [innerHTML]="htmlValue"></div><iframe *ngIf="asiframe" [src]="sanitizedValue" width="100%" frameborder="0" height="100%" seamless></iframe></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><field-html-editor [fieldid]="fieldid" [fieldvalue]="value" [fieldconfig]="fieldconfig" [useStylesheets]="useStylesheets" [useStylesheetSwitcher]="useStylesheetSwitcher" [(stylesheetId)]="stylesheetId" (contentchange)="updateField($event)"></field-html-editor><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.NgZone,platform_browser_1.DomSanitizer,services_1.modal])],fieldHtml)}(fieldGeneric);exports.fieldHtml=fieldHtml;var fieldHtmlEditor=function(){function e(e,t,s,i){var l=this;this.metadata=e,this.footer=t,this.configurationService=s,this.modal=i,this.fieldvalue="",this.fieldid="",this.fieldconfig={},this.editor=null,this.stylesheetIdValue="",this.tinymceConfig={remove_script_host:!0,relative_urls:!1,menubar:!1,statusbar:!0,resize:!0,browser_spellcheck:!0,image_advtab:!0,paste_as_text:!0,paste_filter_drop:!0,plugins:["link","code","image","lists","paste","table"],toolbar:"undo redo | formatselect | styleselect bold italic removeformat | bullist numlist | link image table | code",skin_url:"vendor/tinymce/skins/lightgray",setup:function(t){(l.editor=t).on("change",function(){var e=t.getContent();l.content=e}),t.on("init",function(){l.fieldvalue&&l.editor.setContent(l.fieldvalue)})},formats:{alignleft:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"align-left"},aligncenter:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"align-center"},alignright:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"align-right"},alignjustify:{selector:"p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table,img",classes:"align-justify"},strikethrough:{inline:"del"}},style_formats:[{title:"Inline",items:[{title:"fett",icon:"bold",format:"bold"},{title:"kursiv",icon:"italic",format:"italic"},{title:"unterstrichen",icon:"underline",format:"underline"},{title:"strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"hochgestellt",icon:"superscript",format:"superscript"},{title:"tiefgestellt",icon:"subscript",format:"subscript"}]},{title:"Ausrichtung",items:[{title:"links",icon:"alignleft",format:"alignleft"},{title:"mittig",icon:"aligncenter",format:"aligncenter"},{title:"rechts",icon:"alignright",format:"alignright"},{title:"Blocksatz",icon:"alignjustify",format:"alignjustify"}]}],style_formats_merge:!1,body_class:"spice"},this.oldStylesheetId="",this.contentchange=new core_1.EventEmitter,this.stylesheetIdChange=new core_1.EventEmitter,this.stylesheets=this.metadata.getHtmlStylesheetNames()}return Object.defineProperty(e.prototype,"content",{get:function(){return this.fieldvalue},set:function(e){this.fieldvalue=e,this.contentchange.emit(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"input_stylesheetId",{set:function(e){this.stylesheetIdValue=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"stylesheetId",{get:function(){return this.stylesheetIdValue},set:function(e){this.stylesheetIdValue=e,this.stylesheetIdChange.emit(e)},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.tinymceConfig.selector="#"+this.fieldid,this.tinymceConfig.document_base_url=this.configurationService.getFrontendUrl()},e.prototype.ngAfterViewInit=function(){var t=this;this.metadata.loadLibs("tinymce").subscribe(function(e){t.useStylesheets&&t.setStylesheet(),tinymce.init(t.tinymceConfig)})},e.prototype.changeStylesheet=function(){this.editor&&tinymce.remove(this.editor),this.setStylesheet(),tinymce.init(this.tinymceConfig)},e.prototype.setStylesheet=function(){var e=[];if(this.oldStylesheetId=this.stylesheetId,_.isEmpty(this.stylesheetId))delete this.tinymceConfig.content_style;else{if((e=this.metadata.getHtmlFormats(this.stylesheetId)).length){var t=0;this.tinymceConfig.block_formats="",this.tinymceConfig.extended_valid_elements=[],this.tinymceConfig.custom_elements=[],this.tinymceConfig.block_formats+="Absatz=p;",this.tinymceConfig.style_formats.push({title:"Weiteres",items:[]});for(var s=0,i=e;s<i.length;s++){var l=i[s];if(_.isEmpty(l.block))this.tinymceConfig.style_formats[2].items.push({title:l.name,inline:l.inline,classes:l.classes,styles:l.styles});else{t++;var o;this.tinymceConfig.formats[o="custom_format_"+t]={title:l.name,inline:l.inline,block:l.block,classes:l.classes,styles:l.styles,wrapper:Boolean(Number(l.wrapper))},this.tinymceConfig.block_formats+=l.name+"="+o+";",this.tinymceConfig.extended_valid_elements.indexOf(l.block)&&this.tinymceConfig.extended_valid_elements.push(l.block),this.tinymceConfig.custom_elements.indexOf(l.block)&&this.tinymceConfig.custom_elements.push(l.block)}}0===this.tinymceConfig.style_formats[2].items.length&&this.tinymceConfig.style_formats.splice(2,1)}this.tinymceConfig.content_style=this.metadata.getHtmlStylesheetCode(this.stylesheetId)}},e.prototype.fullScreen=function(){var t=this;this.modal.openModal("SystemTinyMCEModal").subscribe(function(e){e.instance.content=t.fieldvalue,e.instance.updateContent.subscribe(function(e){t.fieldvalue=e,t.editor.setContent(e)})})},e.prototype.ngOnDestroy=function(){tinymce.remove(this.editor)},e.prototype.ngOnChanges=function(){this.editor&&this.fieldvalue&&this.editor.getContent()!==this.fieldvalue&&this.editor.setContent(this.fieldvalue),this.oldStylesheetId.length&&this.oldStylesheetId!=this.stylesheetId&&this.changeStylesheet()},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldvalue",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldid",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldconfig",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"useStylesheetSwitcher",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"useStylesheets",void 0),__decorate([core_1.Input("stylesheetId"),__metadata("design:type",String),__metadata("design:paramtypes",[String])],e.prototype,"input_stylesheetId",null),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"contentchange",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"stylesheetIdChange",void 0),e=__decorate([core_1.Component({selector:"field-html-editor",template:'<div class="slds-m-vertical--xx-small"><textarea style="height:250px" class="slds-textarea slds-scrollable--y slds-m-vertical--xx-small" [id]="fieldid"></textarea><select *ngIf="useStylesheetSwitcher" class="slds-select slds-m-top--x-small" [(ngModel)]="stylesheetId" (change)="changeStylesheet()"><option></option><option *ngFor="let sheet of stylesheets" value="{{sheet.id}}">{{sheet.name}}</option></select></div>',styles:[":host >>> .mce-ico{font-size: 12px; color: #54698d;}",":host >>> .mce-text{font-size: 12px; color: #54698d;}",":host >>> .mce-btn button{font-size: 12px; color: #54698d;}",":host >>> .mce-tinymce{border-radius: 4px}",":host >>> .mce-widget{font-family: 'Titillium Web', sans-serif;}"]}),__metadata("design:paramtypes",[services_1.metadata,services_1.footer,services_1.configurationService,services_1.modal])],e)}();exports.fieldHtmlEditor=fieldHtmlEditor;var fieldWYSIWYGEditor=function(){function e(e,t,s){this.model=e,this.view=t,this.language=s,this.fieldname="",this.fieldSelection=void 0}return Object.defineProperty(e.prototype,"fieldcontent",{get:function(){return this.model.data[this.fieldname]},enumerable:!0,configurable:!0}),e.prototype.ngAfterViewInit=function(){this.editor.element.nativeElement.innerHTML=this.model.data[this.fieldname]},e.prototype.eventHandler=function(e){this.fieldSelection=window.getSelection(),this.model.data[this.fieldname]=e.srcElement.innerHTML},e.prototype.onBlur=function(e){console.log(e)},__decorate([core_1.ViewChild("editor",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],e.prototype,"editor",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldname",void 0),e=__decorate([core_1.Component({selector:"field-wysiwyg-editor",template:'<div class="demo-only" style="min-height:180px;"><div class="slds-rich-text-editor slds-form-element slds-grid slds-grid_vertical slds-nowrap"><div role="toolbar" class="slds-rich-text-editor__toolbar slds-shrink-none"><ul aria-label="Format text" class="slds-button-group-list"><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="0" title="Provide description of action"><system-button-icon [icon]="\'bold\'"></system-button-icon><span class="slds-assistive-text">Bold</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'italic\'"></system-button-icon><span class="slds-assistive-text">Italic</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'underline\'"></system-button-icon><span class="slds-assistive-text">Underline</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'strikethrough\'"></system-button-icon><span class="slds-assistive-text">Strike Through</span></button></li></ul><ul aria-label="Format body" class="slds-button-group-list"><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'richtextbulletedlist\'"></system-button-icon><span class="slds-assistive-text">Bulleted List</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'richtextnumberedlist\'"></system-button-icon><span class="slds-assistive-text">Numbered List</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'richtextindent\'"></system-button-icon><span class="slds-assistive-text">Indent</span></button></li><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'richtextoutdent\'"></system-button-icon><span class="slds-assistive-text">Outdent</span></button></li></ul><ul aria-label="Remove Formatting" class="slds-button-group-list"><li><button class="slds-button slds-button_icon slds-button_icon-border-filled" tabindex="-1" title="Provide description of action"><system-button-icon [icon]="\'remove_formatting\'"></system-button-icon><span class="slds-assistive-text">Remove Formatting</span></button></li></ul></div><div class="slds-rich-text-editor__textarea slds-grid"><div #editor aria-label="Compose text" contenteditable="true" class="slds-rich-text-area__content slds-text-color_weak slds-grow" (input)="eventHandler($event)" (change)="onBlur($event)"></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language])],e)}();exports.fieldWYSIWYGEditor=fieldWYSIWYGEditor;var fieldFloat=function(d){function fieldFloat(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.userpreferences=o,a.textvalue="",a}return __extends(fieldFloat,d),fieldFloat.prototype.ngOnInit=function(){var e=this;this.textvalue=this.getValAsText(),this.model.data$.subscribe(function(){e.textvalue=e.getValAsText()})},fieldFloat.prototype.getValAsText=function(){if(void 0===this.value)return"";var e=parseFloat(this.value);return isNaN(e)?"":this.userpreferences.formatMoney(e)},fieldFloat.prototype.changed=function(){var e=this.textvalue;e=(e=e.split(this.userpreferences.toUse.num_grp_sep).join("")).split(this.userpreferences.toUse.dec_sep).join("."),isNaN(e=parseFloat(e))?this.value="":this.value=Math.floor(e*Math.pow(10,this.userpreferences.toUse.default_currency_significant_digits))/Math.pow(10,this.userpreferences.toUse.default_currency_significant_digits),this.textvalue=this.getValAsText()},fieldFloat=__decorate([core_1.Component({selector:"field-float",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><div class="slds-text-align_right"><span>{{getValAsText()}}</span></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-form-element"><input class="slds-input slds-text-align--right" type="text" [(ngModel)]="textvalue" (change)="changed()"></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.userpreferences])],fieldFloat)}(fieldGeneric);exports.fieldFloat=fieldFloat;var fieldCurrency=function(n){function fieldCurrency(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.currency=o,d.userpreferences=a,d.currencies=[],d.currencyidfield="",d.textvalue="",d.currencies=d.currency.getCurrencies(),d}return __extends(fieldCurrency,n),fieldCurrency.prototype.ngOnInit=function(){var e=this;this.currencyidfield=this.fieldconfig.field_currencyid,this.textvalue=this.getValAsText(),this.model.data$.subscribe(function(){e.textvalue=e.getValAsText()})},fieldCurrency.prototype.getCurrencySymbol=function(){var t,s=-99;if(this.currencyidfield){if(!this.model.data[this.currencyidfield])return"";s=this.model.data[this.currencyidfield]}return this.currencies.some(function(e){if(e.id==s)return t=e.symbol,!0}),t},fieldCurrency.prototype.getValAsText=function(){if(void 0===this.value)return"";var e=parseFloat(this.value);return isNaN(e)?"":this.userpreferences.formatMoney(e)},fieldCurrency.prototype.changed=function(){var e=this.textvalue;e=(e=e.split(this.userpreferences.toUse.num_grp_sep).join("")).split(this.userpreferences.toUse.dec_sep).join("."),isNaN(e=parseFloat(e))?this.value="":this.value=Math.floor(e*Math.pow(10,this.userpreferences.toUse.default_currency_significant_digits))/Math.pow(10,this.userpreferences.toUse.default_currency_significant_digits),this.textvalue=this.getValAsText()},fieldCurrency=__decorate([core_1.Component({selector:"field-currency",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><div class="slds-grid slds-grid--align-end"><div>{{getCurrencySymbol()}}&nbsp;</div><div><span>{{getValAsText()}}</span></div></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-grid slds-m-vertical--xx-small"><div *ngIf="currencyidfield" class="slds-form-element slds-p-right--x-small" [ngClass]="{\'slds-size--1-of-4\':!fieldconfig.currencyReadonly}"><div *ngIf="fieldconfig.currencyReadonly" class="slds-input slds-p-around--none" style="border-color:transparent">{{getCurrencySymbol()}}&nbsp;</div><div *ngIf="!fieldconfig.currencyReadonly" class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="model.data[currencyidfield]"><option *ngFor="let currency of currencies" [value]="currency.id">{{currency.iso}} ({{currency.symbol}})</option></select></div></div></div><div class="slds-form-element slds-grow"><input class="slds-input slds-text-align--right" type="text" [(ngModel)]="textvalue" (change)="changed()"></div></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.currency,services_1.userpreferences])],fieldCurrency)}(fieldGeneric),fieldWeightedAmount=function(n){function fieldWeightedAmount(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l,o,a)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.currency=o,d.userpreferences=a,d.currencies=[],d.currencies=d.currency.getCurrencies(),d}return __extends(fieldWeightedAmount,n),Object.defineProperty(fieldWeightedAmount.prototype,"amountfield",{get:function(){return this.fieldconfig.field_amount?this.fieldconfig.field_amount:"amount"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldWeightedAmount.prototype,"probabilityfield",{get:function(){return this.fieldconfig.field_probability?this.fieldconfig.field_probability:"probability"},enumerable:!0,configurable:!0}),fieldWeightedAmount.prototype.getValue=function(){try{var e=this.model.getFieldValue("amount")?parseFloat(this.model.getFieldValue(this.amountfield)):0,t=this.model.getFieldValue("amount")?parseFloat(this.model.getFieldValue(this.probabilityfield)):0;return this.userpreferences.formatMoney(e*t/100)}catch(e){return 0}},fieldWeightedAmount=__decorate([core_1.Component({selector:"field-currency",template:'<field-generic-display [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="false"><div class="slds-grid slds-grid--align-spread"><div>{{getCurrencySymbol()}}</div><div cass="slds-text-align--right"><span>{{getValue()}}</span></div></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.currency,services_1.userpreferences])],fieldWeightedAmount)}(exports.fieldCurrency=fieldCurrency);exports.fieldWeightedAmount=fieldWeightedAmount;var fieldTotalAmount=function(n){function fieldTotalAmount(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l,o,a)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.currency=o,d.userpreferences=a,d.currencies=[],d.currencies=d.currency.getCurrencies(),d}return __extends(fieldTotalAmount,n),Object.defineProperty(fieldTotalAmount.prototype,"sumfields",{get:function(){var e=[];if(this.fieldconfig.sumfields)for(var t=0,s=this.fieldconfig.sumfields.split(",");t<s.length;t++){var i=s[t];e.push(i.trim())}return e},enumerable:!0,configurable:!0}),fieldTotalAmount.prototype.getValue=function(){for(var e=0,t=0,s=this.sumfields;t<s.length;t++){var i=s[t],l=this.model.getFieldValue(i);l&&(e+=parseFloat(l))}return this.model.data[this.fieldname]=e,this.userpreferences.formatMoney(e)},fieldTotalAmount=__decorate([core_1.Component({selector:"field-currency",template:'<field-generic-display [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="false"><div class="slds-grid slds-grid--align-spread"><div>{{getCurrencySymbol()}}</div><div cass="slds-text-align--right"><span>{{getValue()}}</span></div></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.currency,services_1.userpreferences])],fieldTotalAmount)}(fieldCurrency);exports.fieldTotalAmount=fieldTotalAmount;var fieldEnum=function(a){function fieldEnum(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.options=[],o.language.currentlanguage$.subscribe(function(e){o.getOptions()}),o}return __extends(fieldEnum,a),fieldEnum.prototype.ngOnInit=function(){this.getOptions()},fieldEnum.prototype.getValue=function(){return this.language.getFieldDisplayOptionValue(this.model.module,this.fieldname,this.value)},fieldEnum.prototype.getOptions=function(){var e=[],t=this.language.getFieldDisplayOptions(this.model.module,this.fieldname);for(var s in t)e.push({value:s,display:t[s]});this.options=e},fieldEnum=__decorate([core_1.Component({selector:"field-enum",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid">{{getValue()}}</field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select #focus class="slds-select" [(ngModel)]="value"><option *ngFor="let o of options" [value]="o.value">{{o.display}}</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldEnum)}(fieldGeneric);exports.fieldEnum=fieldEnum;var fieldLanguage=function(a){function fieldLanguage(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.options=[],o}return __extends(fieldLanguage,a),fieldLanguage.prototype.getValue=function(){for(var e=0,t=this.options;e<t.length;e++){var s=t[e];if(s.value==this.value)return s.display}return this.value},fieldLanguage.prototype.ngOnInit=function(){this.getOptions()},fieldLanguage.prototype.getOptions=function(){for(var e=0,t=this.language.getAvialableLanguages();e<t.length;e++){var s=t[e];this.options.push({value:s.language,display:s.text})}},fieldLanguage=__decorate([core_1.Component({selector:"field-enum",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{getValue()}}</field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="value"><ng-container *ngFor="let o of options"><option [value]="o.value">{{o.display}}</option></ng-container></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldLanguage)}(fieldGeneric);exports.fieldLanguage=fieldLanguage;var fieldMailboxes=function(d){function fieldMailboxes(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.backend=o,a.options=[],a.loadingOptions=!1,a.loaded=!1,a}return __extends(fieldMailboxes,d),Object.defineProperty(fieldMailboxes.prototype,"scope",{get:function(){return this.fieldconfig.scope?this.fieldconfig.scope:"outboundsingle"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldMailboxes.prototype,"isDisabled",{get:function(){return 0==this.options.length},enumerable:!0,configurable:!0}),fieldMailboxes.prototype.getValue=function(){this.getOptions();for(var e=0;e<this.options.length;e++)if(this.options[e].value==this.model.data[this.fieldname])return this.options[e].display},fieldMailboxes.prototype.getOptions=function(){var t=this;if(!this.loadingOptions){if(this.loaded)return this.options;this.loadingOptions=!0,this.backend.getRequest("mailboxes/getmailboxes",{scope:this.scope}).subscribe(function(e){return t.options=e,t.loadingOptions=!1,0<t.options.length&&!t.value&&t.model.setField(t.fieldname,t.options[0].value),t.loaded=!0,t.options})}},Object.defineProperty(fieldMailboxes.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),fieldMailboxes=__decorate([core_1.Component({selector:"field-mailboxes",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{getValue()}}</field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [disabled]="isDisabled" [(ngModel)]="model.data[fieldname]"><ng-container *ngFor="let o of getOptions()"><option [value]="o.value">{{o.display}}</option></ng-container></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],fieldMailboxes)}(fieldGeneric);exports.fieldMailboxes=fieldMailboxes;var fieldEmailTo=function(d){function fieldEmailTo(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.backend=o,a.loadingOptions=!1,a}return __extends(fieldEmailTo,d),fieldEmailTo=__decorate([core_1.Component({selector:"field-email-to",template:'<div class="slds-form-element"><field-label [fieldname]="\'to_addrs_names\'"></field-label><div class="slds-form-element__control"><div class="slds-pill_container" *ngFor="let toAddr of model.data.to_addrs_names"><span class="slds-pill"><a href="javascript:void(0);" class="slds-pill__label">{{toAddr.displayname}}</a> <button class="slds-button slds-button--icon slds-pill__remove"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],fieldEmailTo)}(fieldGeneric);exports.fieldEmailTo=fieldEmailTo;var fieldEmailTemplates=function(n){function fieldEmailTemplates(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.backend=o,d.modal=a,d.isLoaded=!1,d.availableTemplates=[],d}return __extends(fieldEmailTemplates,n),Object.defineProperty(fieldEmailTemplates.prototype,"subjectField",{get:function(){return this.fieldconfig.subject?this.fieldconfig.subject:"name"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailTemplates.prototype,"bodyField",{get:function(){return this.fieldconfig.body?this.fieldconfig.body:"body"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailTemplates.prototype,"templatetype",{get:function(){return this.fieldconfig.templatetype?this.fieldconfig.templatetype:"email"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailTemplates.prototype,"isDisabled",{get:function(){return!this.model.getFieldValue("parent_type")||""==this.model.getFieldValue("parent_type")||!this.isLoaded||0==this.availableTemplates.length},enumerable:!0,configurable:!0}),fieldEmailTemplates.prototype.getValue=function(){for(var e=0,t=this.availableTemplates;e<t.length;e++){var s=t[e];if(s.id==this.value)return s.name}},fieldEmailTemplates.prototype.ngOnInit=function(){var t=this,e={searchfields:JSON.stringify({join:"AND",conditions:[{field:"type",operator:"=",value:this.templatetype},{field:"for_bean",operator:"=",value:this.model.getFieldValue("parent_type")}]})};this.backend.getRequest("module/EmailTemplates",e).subscribe(function(e){t.availableTemplates=e.list,t.isLoaded=!0})},fieldEmailTemplates.prototype.chooseTemplate=function(e){var s=this;""!=this.value&&this.modal.openModal("SystemLoadingModal",!1).subscribe(function(t){s.backend.getRequest("EmailTemplates/parse/"+s.value+"/"+s.model.getFieldValue("parent_type")+"/"+s.model.getFieldValue("parent_id")).subscribe(function(e){s.model.data[s.subjectField]||s.model.setField(s.subjectField,e.subject),s.model.setField(s.bodyField,e.body_html),t.instance.self.destroy()})})},fieldEmailTemplates=__decorate([core_1.Component({selector:"field-email-templates",template:'<div *ngIf="!isEditMode()"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid" [ngClass]="fielddisplayclass"><div class="slds-truncate">{{getValue()}}</div><button *ngIf="isEditable()" class="slds-button slds-button--icon slds-col_bump-left slds-p-left--xx-small" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></div></ng-template></div><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [disabled]="isDisabled" [(ngModel)]="value" (change)="chooseTemplate($event)"><option *ngFor="let template of availableTemplates" [ngValue]="template.id">{{template.name}}</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.modal])],fieldEmailTemplates)}(fieldGeneric);exports.fieldEmailTemplates=fieldEmailTemplates;var fieldMailRelais=function(d){function fieldMailRelais(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.backend=o,a.options=[],a.loadingOptions=!1,a}return __extends(fieldMailRelais,d),fieldMailRelais.prototype.getValue=function(){this.getOptions();for(var e=0;e<this.options.length;e++)if(this.options[e].value==this.model.data[this.fieldname])return this.options[e].display},fieldMailRelais.prototype.getOptions=function(){var t=this;if(!this.loadingOptions){if(0<this.options.length)return this.options;this.loadingOptions=!0,this.backend.getRequest("campaigns/getMailRelais").subscribe(function(e){return t.options=e,t.loadingOptions=!1,t.options})}},Object.defineProperty(fieldMailRelais.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),fieldMailRelais.prototype.getDisplay=function(){return!(this.model.data.acl&&!this.model.data.acl.edit)&&("Email"===this.model.data.campaign_type&&!this.model.isEditing)},fieldMailRelais.prototype.getEditDisplay=function(){return"Email"===this.model.data.campaign_type},fieldMailRelais=__decorate([core_1.Component({selector:"field-mail-relais",template:'<div *ngIf="!isEditMode() && getDisplay()" [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><span>{{getValue()}}</span> <button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></ng-template></div><div *ngIf="isEditMode() && isEditable() && getEditDisplay()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="model.data[fieldname]"><ng-container *ngFor="let o of getOptions()"><option [value]="o.value">{{o.display}}</option></ng-container></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],fieldMailRelais)}(fieldGeneric);exports.fieldMailRelais=fieldMailRelais;var fieldMultienum=function(a){function fieldMultienum(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.options=[],o.language.currentlanguage$.subscribe(function(e){o.buildOptions()}),o}return __extends(fieldMultienum,a),fieldMultienum.prototype.ngOnInit=function(){this.buildOptions()},Object.defineProperty(fieldMultienum.prototype,"columns",{get:function(){return this.fieldconfig.columns?parseInt(this.fieldconfig.columns,10):4},enumerable:!0,configurable:!0}),Object.defineProperty(fieldMultienum.prototype,"displayCheckboxes",{get:function(){return!!this.fieldconfig.displaycheckboxes},enumerable:!0,configurable:!0}),fieldMultienum.prototype.getValue=function(){for(var e=[],t=0,s=this.getValueArray();t<s.length;t++){var i=s[t],l=this.language.getFieldDisplayOptionValue(this.model.module,this.fieldname,i);l&&e.push(l)}return e.join(", ")},fieldMultienum.prototype.getValueArray=function(){try{return this.model.data[this.fieldname].substring(1,this.model.data[this.fieldname].length-1).split("^,^")}catch(e){return[]}},fieldMultienum.prototype.buildOptions=function(){this.options=[];var e=this.language.getFieldDisplayOptions(this.model.module,this.fieldname),t=0;for(var s in e)t++;var i=t/this.columns,l=[];for(var o in e)l.push({id:this.model.generateGuid(),value:o,display:e[o]}),l.length>=i&&(this.options.push(l),l=[]);0<l.length&&this.options.push(l)},fieldMultienum=__decorate([core_1.Component({selector:"field-multienum",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><span *ngIf="!displayCheckboxes">{{getValue()}}</span><div *ngIf="displayCheckboxes" class="slds-grid slds-grid--align-spread"><div class="slds-form-element__control" *ngFor="let row of options" [ngClass]="getFieldClass()"><field-multienum-checkbox disabled="true" class="slds-checkbox" *ngFor="let option of row" [fieldname]="fieldname" [option]="option"></field-multienum-checkbox></div></div></field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-grid slds-grid--align-spread"><div class="slds-form-element__control" *ngFor="let row of options" [ngClass]="getFieldClass()"><field-multienum-checkbox class="slds-checkbox" *ngFor="let option of row" [fieldname]="fieldname" [option]="option"></field-multienum-checkbox></div></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldMultienum)}(fieldGeneric);exports.fieldMultienum=fieldMultienum;var fieldMultienumCheckBox=function(){function e(e,t,s,i){this.model=e,this.view=t,this.language=s,this.metadata=i,this.fieldname="",this.option="",this.disabled=!1,this.fieldid="",this.fieldid=this.model.generateGuid()}return e.prototype.getValueArray=function(){return this.model.data[this.fieldname]?this.model.data[this.fieldname].substring(1,this.model.data[this.fieldname].length-1).split("^,^"):[]},Object.defineProperty(e.prototype,"checked",{get:function(){if(this.model.data[this.fieldname]){var e=!1;return this.model.data[this.fieldname]==this.option.value&&(e=!0),-1<this.model.data[this.fieldname].indexOf("^"+this.option.value+"^")&&(e=!0),e}return!1},set:function(e){var t=this.getValueArray(),s=t.indexOf(this.option.value);-1===s?t.push(this.option.value):t.splice(s,1),this.model.data[this.fieldname]="^"+t.join("^,^")+"^"},enumerable:!0,configurable:!0}),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldname",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"option",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"disabled",void 0),e=__decorate([core_1.Component({selector:"field-multienum-checkbox",template:'<input [disabled]="disabled" type="checkbox" [id]="fieldid + option.value" [(ngModel)]="checked"> <label class="slds-checkbox__label" [attr.for]="fieldid + option.value"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label">{{option.display}}</span></label>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata])],e)}();exports.fieldMultienumCheckBox=fieldMultienumCheckBox;var fieldEnumAlternate=function(e){function fieldEnumAlternate(){return null!==e&&e.apply(this,arguments)||this}return __extends(fieldEnumAlternate,e),fieldEnumAlternate.prototype.setValue=function(e){this.value=e},fieldEnumAlternate=__decorate([core_1.Component({selector:"field-enum-alternate",template:'<div *ngIf="!isEditMode()" class="slds-text-body--regular slds-truncate slds-m-vertical--small spicecrm-fieldbody"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><span>{{getValue()}}</span> <button *ngIf="view.isEditable" style="float: right" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></ng-template></div><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control"><div class="slds-radio--button-group"><div *ngFor="let o of getOptions()" class="slds-button slds-radio--button" (click)="setValue(o.value)"><input type="radio" [name]="fieldname" [value]="o.value" [checked]="o.value === value"> <label class="slds-radio--button__label"><span class="slds-radio--faux">{{o.display}}</span></label></div></div></div></div>'})],fieldEnumAlternate)}(fieldEnum);exports.fieldEnumAlternate=fieldEnumAlternate;var fieldBool=function(e){function fieldBool(){return null!==e&&e.apply(this,arguments)||this}return __extends(fieldBool,e),fieldBool=__decorate([core_1.Component({selector:"field-bool",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><system-checkbox disabled [(ngModel)]="value"></system-checkbox></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-p-vertical--x-small"><system-checkbox [(ngModel)]="value"></system-checkbox></div><field-messages [fieldname]="fieldname"></field-messages></div>'})],fieldBool)}(fieldGeneric);exports.fieldBool=fieldBool;var fieldParent=function(u){function fieldParent(e,t,s,i,l,o,a,d,n,r){var c=u.call(this,e,t,l,o,a)||this;return c.model=e,c.view=t,c.popup=s,c.broadcast=i,c.language=l,c.metadata=o,c.router=a,c.elementRef=d,c.renderer=n,c.modal=r,c.parentTypeSelectOpen=!1,c.parentSearchOpen=!1,c.parentSearchTerm="",c.recentItems=[],c.popup.closePopup$.subscribe(function(){return c.closePopups()}),c.broadcast.message$.subscribe(function(e){return c.handleMessage(e)}),c}return __extends(fieldParent,u),Object.defineProperty(fieldParent.prototype,"parentIdField",{get:function(){return this.fieldconfig.parentIdField?this.fieldconfig.parentIdField:"parent_id"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldParent.prototype,"parentTypeField",{get:function(){return this.fieldconfig.parentTypeField?this.fieldconfig.parentTypeField:"parent_type"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldParent.prototype,"parentName",{get:function(){return this.model.getField(this.fieldname)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldParent.prototype,"parentType",{get:function(){return this.model.getField(this.parentTypeField)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldParent.prototype,"parentId",{get:function(){return this.model.getField(this.parentIdField)},enumerable:!0,configurable:!0}),fieldParent.prototype.ngOnInit=function(){this.model.data[this.parentTypeField]&&""!=this.model.data[this.parentTypeField]||(this.model.data[this.parentTypeField]=this.parentTypes[0])},Object.defineProperty(fieldParent.prototype,"parentTypes",{get:function(){var e=["Contacts","Accounts","Leads"];return this.fieldconfig.parenttypes&&(e=this.fieldconfig.parenttypes.replace(/\s/g,"").split(",")),e},enumerable:!0,configurable:!0}),fieldParent.prototype.handleMessage=function(e){if(e.messagedata.reference)switch(e.messagetype){case"model.save":this.fieldid===e.messagedata.reference&&(this.parentSearchTerm="",this.model.data[this.parentIdField]=e.messagedata.data.id,this.model.data[this.fieldname]=e.messagedata.data.summary_text)}},fieldParent.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},fieldParent.prototype.closePopups=function(){this.model.data[this.parentIdField]&&(this.parentSearchTerm=""),this.parentSearchOpen=!1,this.parentTypeSelectOpen=!1,this.clickListener()},fieldParent.prototype.setParent=function(e){this.model.setField(this.fieldname,e.text),this.model.setField(this.parentIdField,e.id)},fieldParent.prototype.toggleParentTypeSelect=function(){this.parentTypeSelectOpen=!this.parentTypeSelectOpen,this.parentSearchOpen=!1},fieldParent.prototype.setParentType=function(e){this.parentSearchTerm="",this.model.setField(this.parentTypeField,e),this.parentTypeSelectOpen=!1},fieldParent.prototype.clearParent=function(){this.model.setField(this.fieldname,""),this.model.setField(this.parentIdField,"")},fieldParent.prototype.openParentTypes=function(){var t=this;this.parentTypeSelectOpen=!0,this.parentSearchOpen=!1,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},fieldParent.prototype.onFocusParent=function(){var t=this;this.parentTypeSelectOpen=!1,this.parentSearchOpen=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},fieldParent.prototype.goParent=function(){this.router.navigate(["/module/"+this.model.getField(this.parentTypeField)+"/"+this.model.getField(this.parentIdField)])},fieldParent.prototype.searchWithModal=function(){var t=this;this.parentSearchOpen=!1,this.modal.openModal("ObjectModalModuleLookup").subscribe(function(e){e.instance.module=t.parentType,e.instance.multiselect=!1,e.instance.selectedItems.subscribe(function(e){e.length&&t.setParent({id:e[0].id,text:e[0].summary_text,data:e[0]})}),e.instance.searchTerm=t.parentSearchTerm})},fieldParent=__decorate([core_1.Component({selector:"field-parent",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><a href="javascript:void(0);" modelPopOver [module]="parentType" [id]="parentId">{{value}}</a></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-form-element"><div *ngIf="model.data[parentIdField]" class="slds-form-element__control slds-p-around--xx-small"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="model.data[parentTypeField]" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{parentName}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clearParent()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!model.data[parentIdField]" class="slds-combobox-group slds-p-around--xx-small"><div *ngIf="parentTypes.length > 1" class="slds-combobox_object-switcher slds-combobox-addon_start"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': parentTypeSelectOpen}" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon--right" (click)="openParentTypes()"><input type="text" readonly class="slds-input slds-combobox__input slds-combobox__input-value" autoComplete="off" role="textbox" [value]="language.getModuleName(parentType)"><system-icon icon="down" sprite="utility" addclasses="slds-input__icon slds-input__icon_right"></system-icon></div><div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_x-small slds-dropdown_left" role="listbox"><ul class="slds-listbox slds-listbox_vertical" role="group" aria-label="Suggested for you"><li *ngFor="let thisParentType of parentTypes" role="presentation" class="slds-listbox__item" (click)="setParentType(thisParentType)"><div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><div class="slds-grid slds-grid--vertical-align-center"><system-icon [module]="thisParentType" size="x-small"></system-icon><div class="slds-truncate">{{language.getModuleName(thisParentType)}}</div></div></div></li></ul></div></div></div></div></div></div><div class="slds-combobox_container slds-combobox-addon_end"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': parentSearchOpen}" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><input #focus type="text" class="slds-input slds-combobox__input" aria-autocomplete="list" (focus)="onFocusParent()" autoComplete="off" role="textbox" [(ngModel)]="parentSearchTerm" [placeholder]="\'Search \' + language.getModuleName(parentType)"> <button (click)="searchWithModal()" class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"><system-button-icon [icon]="\'search\'"></system-button-icon></button></div><div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox"><field-lookup-recent *ngIf="parentSearchOpen && parentSearchTerm === \'\'" [module]="parentType" (selectedObject)="setParent($event)"></field-lookup-recent><field-lookup-search *ngIf="parentSearchOpen && parentSearchTerm !== \'\'" [module]="parentType" (selectedObject)="setParent($event)" (searchWithModal)="searchWithModal()" [fieldid]="fieldid" [searchterm]="parentSearchTerm"></field-lookup-search></div></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',providers:[services_1.popup],host:{}}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.popup,services_1.broadcast,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer,services_1.modal])],fieldParent)}(fieldGeneric);exports.fieldParent=fieldParent;var fieldModuleFilter=function(u){function fieldModuleFilter(e,t,s,i,l,o,a,d,n,r){var c=u.call(this,e,t,l,o,a)||this;return c.model=e,c.view=t,c.popup=s,c.broadcast=i,c.language=l,c.metadata=o,c.router=a,c.elementRef=d,c.renderer=n,c.modal=r,c.moduleSelectOpen=!1,c.modules=["Contacts","Accounts","Leads","Users"],c.popup.closePopup$.subscribe(function(){return c.closePopups()}),c.broadcast.message$.subscribe(function(e){return c.handleMessage(e)}),c}return __extends(fieldModuleFilter,u),Object.defineProperty(fieldModuleFilter.prototype,"moduleFilterName",{get:function(){var e=this.metadata.getModuleFilter(this.moduleFilter);return e?e.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModuleFilter.prototype,"module",{get:function(){return this.model.getField("module")||this.modules[0]},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModuleFilter.prototype,"value",{get:function(){return this.moduleFilterName},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModuleFilter.prototype,"moduleFilters",{get:function(){return this.metadata.getModuleFilters(this.module)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModuleFilter.prototype,"moduleFilter",{get:function(){return this.model.getField("module_filter")},set:function(e){this.model.setField("module_filter",e)},enumerable:!0,configurable:!0}),fieldModuleFilter.prototype.ngOnInit=function(){this.setModule(this.module)},fieldModuleFilter.prototype.setModule=function(e){this.model.setField("module",e),this.moduleSelectOpen=!1},fieldModuleFilter.prototype.clearFilter=function(){this.model.setField("module_filter","")},fieldModuleFilter.prototype.handleMessage=function(e){if(e.messagedata.reference)switch(e.messagetype){case"model.save":this.fieldid===e.messagedata.reference&&(this.model.data.module_filter=e.messagedata.data.id,this.model.data[this.fieldname]=e.messagedata.data.summary_text)}},fieldModuleFilter.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},fieldModuleFilter.prototype.openModules=function(){var t=this;this.moduleSelectOpen=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},fieldModuleFilter.prototype.closePopups=function(){this.model.data.module_filter,this.moduleSelectOpen=!1,this.clickListener()},fieldModuleFilter=__decorate([core_1.Component({selector:"field-modulefilter",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><a href="javascript:void(0)">{{value}}</a></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-form-element"><div *ngIf="model.data.module_filter" class="slds-form-element__control slds-p-around--xx-small"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="model.data.module" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{moduleFilterName}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clearFilter()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!model.data.module_filter" class="slds-combobox-group slds-p-around--xx-small"><div *ngIf="modules.length > 1" class="slds-combobox_object-switcher slds-combobox-addon_start"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': moduleSelectOpen}" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon--right" (click)="openModules()"><input type="text" readonly class="slds-input slds-combobox__input slds-combobox__input-value" autoComplete="off" role="textbox" [value]="language.getModuleName(module)"><system-icon icon="down" sprite="utility" addclasses="slds-input__icon slds-input__icon_right"></system-icon></div><div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_x-small slds-dropdown_left" role="listbox"><ul class="slds-listbox slds-listbox_vertical" role="group" aria-label="Suggested for you"><li *ngFor="let module of modules" role="presentation" class="slds-listbox__item" (click)="setModule(module)"><div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><div class="slds-grid slds-grid--vertical-align-center"><system-icon [module]="module" size="x-small"></system-icon><div class="slds-truncate">{{language.getModuleName(module)}}</div></div></div></li></ul></div></div></div></div></div></div><div class="slds-form-element slds-grow slds-m-left--small"><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [disabled]="!module || moduleFilters.length == 0" (click)="moduleSelectOpen = false" [(ngModel)]="moduleFilter"><option *ngFor="let moduleFilter of moduleFilters" [value]="moduleFilter.id">{{moduleFilter.name}}</option></select></div></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.popup,services_1.broadcast,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer,services_1.modal])],fieldModuleFilter)}(fieldGeneric);exports.fieldModuleFilter=fieldModuleFilter;var fieldRelate=function(c){function fieldRelate(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.elementRef=o,r.modal=a,r.backend=d,r.toast=n,r.relateIdField="",r.relateNameField="",r.relateType="",r.relateSearchOpen=!1,r.relateSearchTerm="",r}return __extends(fieldRelate,c),fieldRelate.prototype.ngOnInit=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);this.relateIdField=e.id_name,this.relateNameField=this.fieldname,this.relateType=e.module},Object.defineProperty(fieldRelate.prototype,"disableadd",{get:function(){return this.fieldconfig.disableadd},enumerable:!0,configurable:!0}),fieldRelate.prototype.closePopups=function(){this.model.getField(this.relateIdField)&&(this.relateSearchTerm=""),this.relateSearchOpen=!1},fieldRelate.prototype.clearField=function(){this.model.setField(this.relateNameField,""),this.model.setField(this.relateIdField,"")},fieldRelate.prototype.onFocus=function(){this.relateSearchOpen=!0},fieldRelate.prototype.setRelated=function(t){var s=this;this.model.setField(this.relateIdField,t.id),this.model.setField(this.relateNameField,t.text),2==this.fieldconfig.executeCopyRules?this.executeCopyRules(t.id):1==this.fieldconfig.executeCopyRules&&this.modal.confirm("Copy the data from related record?","Copy data?").subscribe(function(e){return e&&s.executeCopyRules(t.id)}),this.closePopups()},fieldRelate.prototype.executeCopyRules=function(e){var s=this,i=this.modal.await("LBL_LOADING");this.backend.get(this.relateType,e).subscribe(function(e){var t={module:s.relateType,id:e.id,data:e};s.model.executeCopyRulesParent(t),i.emit()},function(){s.toast.sendToast("ERR_LOADING_RECORD","error"),i.emit()})},fieldRelate.prototype.goRelated=function(){this.router.navigate(["/module/"+this.relateType+"/"+this.model.getField(this.relateIdField)])},fieldRelate.prototype.searchWithModal=function(){var t=this;this.relateSearchOpen=!1,this.modal.openModal("ObjectModalModuleLookup").subscribe(function(e){e.instance.module=t.relateType,e.instance.modulefilter=t.fieldconfig.modulefilter,e.instance.multiselect=!1,e.instance.selectedItems.subscribe(function(e){e.length&&t.setRelated({id:e[0].id,text:e[0].summary_text,data:e[0]})}),e.instance.searchTerm=t.relateSearchTerm})},fieldRelate=__decorate([core_1.Component({selector:"field-relate",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><a href="javascript:void(0);" modelPopOver [module]="relateType" [id]="model.data[relateIdField]">{{value}}</a></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-m-vertical--xx-small" [ngClass]="getFieldClass()"><div class="slds-combobox_container"><div class="slds-form-element slds-lookup"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': relateSearchOpen}" role="combobox"><div *ngIf="model.data[relateIdField]" class="slds-form-element__control"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="relateType" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{model.data[relateNameField]}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clearField()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!model.data[relateIdField]" class="slds-form-element__control slds-grid slds-box--border" [ngClass]="getFieldClass()"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><input #focus type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="relateSearchTerm" (blur)="closePopups()" (focus)="onFocus()" [placeholder]="language.getLabel(\'LBL_SEARCH\') + \' \' + language.getModuleName(relateType)" role="combobox"> <button (click)="searchWithModal()" class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"><system-button-icon [icon]="\'search\'"></system-button-icon></button></div></div><div class="slds-dropdown slds-dropdown_fluid" role="listbox"><field-lookup-recent *ngIf="relateSearchTerm === \'\' && !fieldconfig.modulefilter" [module]="relateType" (selectedObject)="setRelated($event)"></field-lookup-recent><field-lookup-search *ngIf="relateSearchTerm !== \'\' || fieldconfig.modulefilter" [module]="relateType" [modulefilter]="fieldconfig.modulefilter" [disableadd]="disableadd" (selectedObject)="setRelated($event)" (searchWithModal)="searchWithModal()" [searchterm]="relateSearchTerm"></field-lookup-search></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,services_1.modal,services_1.backend,services_1.toast])],fieldRelate)}(fieldGeneric);exports.fieldRelate=fieldRelate;var fieldRelateList=function(c){function fieldRelateList(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.elementRef=o,r.modal=a,r.backend=d,r.toast=n,r.relatedList=[],r.relateIdField="",r.relateNameField="",r.relateType="",r}return __extends(fieldRelateList,c),Object.defineProperty(fieldRelateList.prototype,"relatedFieldId",{get:function(){return this.model.getField(this.relateIdField)},set:function(t){var s=this,i=this.relatedList.find(function(e){return e.id==t});i&&(this.model.setField(this.relateIdField,i.id),this.model.setField(this.relateNameField,i.summary_text),this.relateType&&(2==this.fieldconfig.executeCopyRules?this.executeCopyRules(i.id):1==this.fieldconfig.executeCopyRules&&this.modal.confirm("Copy the data from related record?","Copy data?").subscribe(function(e){return e&&s.executeCopyRules(i.id)})))},enumerable:!0,configurable:!0}),fieldRelateList.prototype.ngOnInit=function(){this.setFieldDefs(),this.getRelatedList()},fieldRelateList.prototype.setFieldDefs=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);this.relateIdField=e.id_name,this.relateNameField=this.fieldname,this.relateType=e.module},fieldRelateList.prototype.getRelatedList=function(){var t=this;if(this.relateType){var e={limit:this.fieldconfig.limit||-1,modulefilter:this.fieldconfig.modulefilter};this.backend.getList(this.relateType,"name","ASC",["id","summary_text"],e).subscribe(function(e){e&&e.list&&(t.relatedList=e.list)})}},fieldRelateList.prototype.executeCopyRules=function(e){var s=this,i=this.modal.await("LBL_LOADING");this.backend.get(this.relateType,e).subscribe(function(e){var t={module:s.relateType,id:e.id,data:e};s.model.executeCopyRulesParent(t),i.emit()},function(){s.toast.sendToast("ERR_LOADING_RECORD","error"),i.emit()})},fieldRelateList.prototype.trackByFn=function(e,t){return t.id},fieldRelateList=__decorate([core_1.Component({selector:"field-relate-list",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><a href="javascript:void(0);" modelPopOver [module]="relateType" [id]="relatedFieldId">{{value}}</a></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element"><div class="slds-form-element__control"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="relatedFieldId"><option></option><option *ngFor="let related of relatedList; trackBy: trackByFn" [value]="related.id">{{language.getLabel(related.summary_text)}}</option></select></div></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,services_1.modal,services_1.backend,services_1.toast])],fieldRelateList)}(fieldGeneric);exports.fieldRelateList=fieldRelateList;var fieldModifiedBy=function(u){function fieldModifiedBy(e,t,s,i,l,o,a,d,n,r){var c=u.call(this,e,t,s,i,l,o,a,d,n)||this;return c.model=e,c.view=t,c.language=s,c.metadata=i,c.router=l,c.elementRef=o,c.modal=a,c.backend=d,c.toast=n,c.userpreferences=r,c}return __extends(fieldModifiedBy,u),Object.defineProperty(fieldModifiedBy.prototype,"datefield",{get:function(){return this.fieldconfig.field_date?this.fieldconfig.field_date:"date_modified"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModifiedBy.prototype,"displayDate",{get:function(){try{if(this.model.data[this.fieldname]){var e=this.model.getFieldValue(this.datefield);return e.isValid()?e.format(this.userpreferences.getDateFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldModifiedBy.prototype,"displayTime",{get:function(){try{if(this.model.data[this.fieldname]){var e=this.model.getFieldValue(this.datefield);return e.isValid()?e.format(this.userpreferences.getTimeFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),fieldModifiedBy=__decorate([core_1.Component({selector:"field-generic",template:'<field-generic-display [fielddisplayclass]="fielddisplayclass" [editable]="false" [fieldconfig]="fieldconfig"><div class="slds-grid slds-grid--vertical-align-center"><a href="javascript:void(0);" modelPopOver module="Users" [id]="model.data[relateIdField]">{{value}}</a> <span class="slds-p-right--xx-small">,</span> <span>{{displayDate}}</span> <span class="slds-p-left--xxx-small">{{displayTime}}</span></div></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,services_1.modal,services_1.backend,services_1.toast,services_1.userpreferences])],fieldModifiedBy)}(fieldRelate);exports.fieldModifiedBy=fieldModifiedBy;var fieldLookup=function(u){function fieldLookup(e,t,s,i,l,o,a,d,n,r){var c=u.call(this,e,t,l,o,a)||this;return c.model=e,c.view=t,c.popup=s,c.broadcast=i,c.language=l,c.metadata=o,c.router=a,c.elementRef=d,c.renderer=n,c.modal=r,c.lookupType=0,c.lookuplinkSelectOpen=!1,c.lookupSearchOpen=!1,c.lookupSearchTerm="",c.lookuplinks=[],c.popup.closePopup$.subscribe(function(){return c.closePopups()}),c.broadcast.message$.subscribe(function(e){return c.handleMessage(e)}),c}return __extends(fieldLookup,u),fieldLookup.prototype.ngOnInit=function(){this.lookuplinks=this.getLookuplinks()},Object.defineProperty(fieldLookup.prototype,"displayAssignedUser",{get:function(){return this.fieldconfig.displayassigneduser},enumerable:!0,configurable:!0}),Object.defineProperty(fieldLookup.prototype,"lookupTypeName",{get:function(){return this.language.getModuleName(this.lookuplinks[this.lookupType].module)},enumerable:!0,configurable:!0}),fieldLookup.prototype.getLookupmodules=function(){var e;return this.fieldconfig.lookupmodules&&(e=this.fieldconfig.lookupmodules.replace(/\s/g,"").split(",")),e||(e=["Contacts","Users"]),e},fieldLookup.prototype.getLookuplinks=function(){var e;if(this.fieldconfig.lookuplinks&&(e=this.fieldconfig.lookuplinks.replace(/\s/g,"").split(",")),!e){e=[];for(var t=0,s=this.getLookupmodules();t<s.length;t++){var i=s[t];e.push(i.toLowerCase())}}for(var l=[],o=0,a=e;o<a.length;o++){var d=a[o];l.push({name:d,module:this.metadata.getFieldDefs(this.model.module,d).module})}return l},Object.defineProperty(fieldLookup.prototype,"pills",{get:function(){for(var e=[],t=0,s=this.lookuplinks;t<s.length;t++){var i=s[t];if(this.model.data[i.name]&&this.model.data[i.name].beans)for(var l in this.model.data[i.name].beans){var o=this.model.data[i.name].beans[l];("Users"!=i.module||this.displayAssignedUser||l!=this.model.data.assigned_user_id)&&e.push({module:i.module,id:o.id,summary_text:o.summary_text,link:i.name})}}return e},enumerable:!0,configurable:!0}),fieldLookup.prototype.addItem=function(e){this.model.data[this.lookuplinks[this.lookupType].name]||(this.model.data[this.lookuplinks[this.lookupType].name]={beans:{}}),this.model.data[this.lookuplinks[this.lookupType].name].beans[e.id]={id:e.id,summary_text:e.text}},fieldLookup.prototype.handleMessage=function(e){if(e.messagedata.reference)switch(e.messagetype){case"model.save":this.fieldid===e.messagedata.reference&&(this.lookupSearchTerm="",this.addItem({id:e.messagedata.data.id,text:e.messagedata.data.summary_text}))}},fieldLookup.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},fieldLookup.prototype.closePopups=function(){this.lookupSearchOpen=!1,this.lookuplinkSelectOpen=!1,this.clickListener()},fieldLookup.prototype.toggleLookupTypeSelect=function(){this.lookuplinkSelectOpen=!this.lookuplinkSelectOpen,this.lookupSearchOpen=!1},fieldLookup.prototype.setLookupType=function(e){this.lookupSearchTerm="",this.lookupType=e,this.lookuplinkSelectOpen=!1},fieldLookup.prototype.removeItem=function(e){this.model.data[e.link].beans_relations_to_delete||(this.model.data[e.link].beans_relations_to_delete={}),this.model.data[e.link].beans_relations_to_delete[e.id]=e,delete this.model.data[e.link].beans[e.id]},fieldLookup.prototype.onFocus=function(){this.openSearchDropDown()},fieldLookup.prototype.onFieldClick=function(){this.openSearchDropDown()},fieldLookup.prototype.openSearchDropDown=function(){var t=this;this.lookuplinkSelectOpen=!1,this.lookupSearchOpen=!0,this.clickListener=this.renderer.listen("document","click",function(e){return t.onClick(e)})},fieldLookup.prototype.parentSearchStyle=function(){if(this.lookupSearchOpen)return{display:"block"}},fieldLookup.prototype.searchWithModal=function(){var t=this;this.modal.openModal("ObjectModalModuleLookup").subscribe(function(e){e.instance.module=t.lookupTypeName,e.instance.multiselect=!1,e.instance.selectedItems.subscribe(function(e){t.addItem({id:e[0].id,text:e[0].summary_text,data:e[0]})}),e.instance.usedSearchTerm.subscribe(function(e){t.lookupSearchTerm=e}),e.instance.searchTerm=t.lookupSearchTerm})},fieldLookup=__decorate([core_1.Component({selector:"field-lookup",template:'<div *ngIf="!isEditMode()" [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><span *ngFor="let pill of pills" class="slds-pill slds-m-right--xx-small slds-p-around--xx-small"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="pill.module" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{pill.summary_text}}</span></span> <button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></ng-template></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div *ngIf="!model.data[parentIdField]" class="slds-combobox-group slds-p-vertical--xx-small"><div *ngIf="lookuplinks.length > 1" class="slds-combobox_object-switcher slds-combobox-addon_start"><div class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': lookuplinkSelectOpen}" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon--right" (click)="toggleLookupTypeSelect()"><input type="text" readonly class="slds-input slds-combobox__input slds-combobox__input-value" autoComplete="off" role="textbox" [value]="lookupTypeName"><system-icon icon="down" sprite="utility" addclasses="slds-input__icon slds-input__icon_right"></system-icon></div><div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_x-small slds-dropdown_left" role="listbox"><ul class="slds-listbox slds-listbox_vertical" role="group" aria-label="Suggested for you"><li *ngFor="let lookuplink of lookuplinks; index as i" role="presentation" class="slds-listbox__item" (click)="setLookupType(i)"><div class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small" role="option"><div class="slds-grid slds-grid--vertical-align-center"><system-icon [module]="lookuplink.module" size="x-small"></system-icon><div class="slds-truncate">{{language.getModuleName(lookuplink.module)}}</div></div></div></li></ul></div></div></div></div></div></div><div class="slds-combobox_container slds-combobox-addon_end"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': lookupSearchOpen}" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><input type="text" class="slds-input" [ngClass]="{\'slds-combobox__input\':lookuplinks.length > 1}" aria-autocomplete="list" (focus)="onFocus()" (click)="onFieldClick()" autoComplete="off" role="textbox" [(ngModel)]="lookupSearchTerm" [placeholder]="language.getLabel(\'LBL_SEARCH\') + \' \' + language.getModuleName(lookuplinks[lookupType].module)"> <button (click)="searchWithModal()" class="slds-button slds-button_icon slds-input__icon slds-input__icon_right"><system-button-icon [icon]="\'search\'"></system-button-icon></button></div><div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox"><field-lookup-recent *ngIf="lookupSearchOpen && lookupSearchTerm === \'\'" [module]="lookuplinks[lookupType].module" (selectedObject)="addItem($event)"></field-lookup-recent><field-lookup-search *ngIf="lookupSearchOpen && lookupSearchTerm !== \'\'" [module]="lookuplinks[lookupType].module" (selectedObject)="addItem($event)" (searchWithModal)="searchWithModal()" [fieldid]="fieldid" [searchterm]="lookupSearchTerm"></field-lookup-search></div></div></div></div><ul *ngIf="pills.length > 0" class="slds-listbox slds-listbox_horizontal" role="group"><li *ngFor="let pill of pills" role="presentation" class="slds-listbox__item slds-p-top_xxx-small"><span class="slds-pill"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="pill.module" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{pill.summary_text}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="removeItem(pill)"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></li></ul><field-messages [fieldname]="fieldname"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.popup,services_1.broadcast,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer2,services_1.modal])],fieldLookup)}(fieldGeneric);exports.fieldLookup=fieldLookup;var fieldDate=function(c){function fieldDate(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.popup=o,r.renderer=a,r.elementRef=d,r.userpreferences=n,r.showDatePicker=!1,r.isValid=!0,r.errorMessage="",r.popupSubscription=void 0,r.clickListener=void 0,r}return __extends(fieldDate,c),Object.defineProperty(fieldDate.prototype,"displayDate",{get:function(){try{if(this.model.getField(this.fieldname)){var e=this.model.getField(this.fieldname);return e.isValid()?e.format(this.userpreferences.getDateFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDate.prototype,"highlightdate",{get:function(){return!!(this.fieldconfig.highlightpast&&this.value&&new moment>new moment(this.model.getField(this.fieldname)))},enumerable:!0,configurable:!0}),fieldDate=__decorate([core_1.Component({selector:"field-date",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><div *ngIf="!displayLink()" class="slds-truncate"><span [ngClass]="{\'slds-text-color_error\' : highlightdate}">{{displayDate}}</span></div><div *ngIf="displayLink()" class="slds-truncate"><a href="javascript:void(0);" (click)="goRecord()"><span [ngClass]="{\'slds-text-color_error\' : highlightdate}">{{displayDate}}</span></a></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" [ngClass]="getFieldClass()"><system-input-date [(ngModel)]="value"></system-input-date><field-messages [fieldname]="fieldname"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.popup,core_1.Renderer,core_1.ElementRef,services_1.userpreferences])],fieldDate)}(fieldGeneric);exports.fieldDate=fieldDate;var fieldTime=function(u){function fieldTime(e,t,s,i,l,o,a,d){var n=u.call(this,e,t,s,i,l)||this;n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.popup=o,n.renderer=a,n.elementRef=d,n.showDatePicker=!1,n.showTimePicker=!1,n.isValid=!0,n.clickListener=void 0,n.dropdownTimes=[],n.dateFormat="DD.MM.YYYY",n.timeFormat="HH:mm";for(var r=0;r<24;){var c="";r<10?c+="0"+r+":":c=r+":",n.dropdownTimes.push(c+"00"),n.dropdownTimes.push(c+"15"),n.dropdownTimes.push(c+"30"),n.dropdownTimes.push(c+"45"),r++}return n}return __extends(fieldTime,u),fieldTime.prototype.toggleTimePicker=function(){var t=this;this.showTimePicker=!this.showTimePicker,this.showTimePicker&&(this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)}))},fieldTime.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.clickListener(),this.showDatePicker=!1,this.showTimePicker=!1)},fieldTime.prototype.getFieldClass=function(){var e=[];return this.isValid||e.push("slds-has-error"),e},Object.defineProperty(fieldTime.prototype,"timefieldStyle",{get:function(){var e=this.timefield.element.nativeElement.getBoundingClientRect();return{left:e.left,top:e.top+e.height}},enumerable:!0,configurable:!0}),fieldTime.prototype.getNearestDropdownTime=function(){for(var e=0,t=this.dropdownTimes;e<t.length;e++){var s=t[e];if(s>=this.editTime)return s}},fieldTime.prototype.getNextDropdownTime=function(){var t=this.getNearestDropdownTime();return this.dropdownTimes[this.dropdownTimes.findIndex(function(e){return e==t})+1]},fieldTime.prototype.getBeforeDropdownTime=function(){var t=this.getNearestDropdownTime();return this.dropdownTimes[this.dropdownTimes.findIndex(function(e){return e==t})-1]},Object.defineProperty(fieldTime.prototype,"displayTime",{get:function(){try{if(this.model.data[this.fieldname]){var e=this.model.data[this.fieldname];return e.isValid()?e.format(this.timeFormat):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldTime.prototype,"editTime",{get:function(){try{if(this.value){var e=new moment(this.value);return e.isValid()?e.format("HH:mm"):e=""}return""}catch(e){return""}},set:function(e){var t=new moment(e,this.timeFormat,!0);if(t.second(0),t.isValid())this.model.data[this.fieldname]&&!isNaN(this.model.data[this.fieldname].year())&&(t.year(this.model.data[this.fieldname].year()),t.month(this.model.data[this.fieldname].month()),t.date(this.model.data[this.fieldname].date())),this.value=t,this.model.setFieldValue(this.fieldname,t),this.clearFieldError();else{if("string"==typeof e&&e.length<=2&&0<e.length)return parseInt(e)<10?e="0"+e+":00":e+=":00",void(this.editTime=e);this.setFieldError(e+" is not a valid time")}},enumerable:!0,configurable:!0}),fieldTime.prototype.setTime=function(e){this.editTime=e,this.showTimePicker=!1},__decorate([core_1.ViewChild("timefield",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldTime.prototype,"timefield",void 0),fieldTime=__decorate([core_1.Component({selector:"field-time",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><div *ngIf="!displayLink()" class="slds-truncate"><span class="slds-p-left--x-small" style="font-style: italic">{{displayTime}}</span></div></field-generic-display><div *ngIf="isEditable() && isEditMode()"><div class="slds-col slds-form-element__control slds-input-has-icon slds-input-has-icon--right" #timefield [ngClass]="getFieldClass()"><system-input-time [(ngModel)]="value"></system-input-time></div><field-messages fieldname="{{fieldname}}"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.popup,core_1.Renderer,core_1.ElementRef])],fieldTime)}(fieldGeneric);exports.fieldTime=fieldTime;var fieldDateTime=function(d){function fieldDateTime(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.userpreferences=o,a}return __extends(fieldDateTime,d),Object.defineProperty(fieldDateTime.prototype,"displayValue",{get:function(){try{if(this.model.getField(this.fieldname)){var e=this.model.getField(this.fieldname);return e.isValid()?this.fieldconfig.displayfromnow?e.fromNow():e.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTime.prototype,"displaySpan",{get:function(){try{if(this.model.getField(this.fieldname)){var e=this.model.getField(this.fieldname);return e.isValid()?e.fromNow():""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTime.prototype,"displayDate",{get:function(){try{if(this.model.getField(this.fieldname)){var e=this.model.getField(this.fieldname);return e.isValid()?e.format(this.userpreferences.getDateFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTime.prototype,"displayTime",{get:function(){try{if(this.model.getField(this.fieldname)){var e=this.model.getField(this.fieldname);return e.isValid()?e.format(this.userpreferences.getTimeFormat()):""}return""}catch(e){return""}},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTime.prototype,"highlightdate",{get:function(){return(1==this.fieldconfig.highlightpast||!0===this.fieldconfig.highlightpast)&&new moment>new moment(this.model.getField(this.fieldname))},enumerable:!0,configurable:!0}),fieldDateTime=__decorate([core_1.Component({selector:"field-date-time",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><span *ngIf="fieldconfig.displayfromnow">{{displaySpan}}</span> <span *ngIf="!fieldconfig.displayfromnow">{{displayDate}}</span> <span *ngIf="!fieldconfig.displayfromnow" class="slds-p-left--x-small" style="font-style: italic">{{displayTime}}</span></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-grid"><system-input-date [(ngModel)]="value" class="slds-size--1-of-2 slds-p-right--xxx-small"></system-input-date><system-input-time [(ngModel)]="value" class="slds-size--1-of-2 slds-p-left--xxx-small"></system-input-time></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.userpreferences])],fieldDateTime)}(fieldGeneric);exports.fieldDateTime=fieldDateTime;var fieldDateTimeDuration=function(d){function fieldDateTimeDuration(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.userpreferences=o,a.durationHours=["0","1","2","3","4","5","6","7","8","9","10","11","12"],a.durationMinutes=["0","15","30","45"],a.isValid=!0,a}return __extends(fieldDateTimeDuration,d),Object.defineProperty(fieldDateTimeDuration.prototype,"fieldstart",{get:function(){return this.fieldconfig.field_start?this.fieldconfig.field_start:"date_start"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"fieldend",{get:function(){return this.fieldconfig.field_end?this.fieldconfig.field_end:"date_end"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"fieldminutes",{get:function(){return this.fieldconfig.field_minutes?this.fieldconfig.field_minutes:"duration_minutes"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"fieldhours",{get:function(){return this.fieldconfig.field_hours?this.fieldconfig.field_hours:"duration_hours"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"minutes",{get:function(){var e=0;return this.model.data[this.fieldhours]&&(e+=60*parseInt(this.model.data[this.fieldhours],10)),this.model.data[this.fieldminutes]&&(e+=parseInt(this.model.data[this.fieldminutes],10)),e},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"editDurationHours",{get:function(){return this.model.data[this.fieldhours]},set:function(e){this.model.setField(this.fieldhours,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeDuration.prototype,"editDurationMinutes",{get:function(){return this.model.data[this.fieldminutes]},set:function(e){this.model.setField(this.fieldminutes,e)},enumerable:!0,configurable:!0}),fieldDateTimeDuration.prototype.getDisplay=function(){if(this.model.data.date_start)return this.model.data.date_end||(this.model.data[this.fieldend]=new moment(this.model.data.date_start).add(this.minutes,"m")),this.model.data.date_start.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat())+" - "+this.model.data.date_end.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat())},fieldDateTimeDuration=__decorate([core_1.Component({selector:"field-date-time-duration",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{getDisplay()}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-grid"><system-input-date [(ngModel)]="value"></system-input-date><system-input-time class="slds-p-left--x-small" [(ngModel)]="value"></system-input-time><div class="slds-form-element__control slds-p-left--x-small slds-size--1-of-6"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="editDurationHours"><option *ngFor="let duration of durationHours">{{duration}}</option></select></div></div><div class="slds-form-element__control slds-p-left--x-small slds-size--1-of-6"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="editDurationMinutes"><option *ngFor="let duration of durationMinutes">{{duration}}</option></select></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.userpreferences])],fieldDateTimeDuration)}(fieldGeneric);exports.fieldDateTimeDuration=fieldDateTimeDuration;var fieldDuration=function(r){function fieldDuration(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.popup=o,n.renderer=a,n.elementRef=d,n.isValid=!0,n.errorMessage="",n.durationHours=["00","01","02","03","04","05","06","07","08","09","10","11","12"],n.durationMinutes=["00","15","30","45"],n}return __extends(fieldDuration,r),Object.defineProperty(fieldDuration.prototype,"fieldminutes",{get:function(){return this.fieldconfig.field_minutes?this.fieldconfig.field_minutes:"duration_minutes"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDuration.prototype,"fieldhours",{get:function(){return this.fieldconfig.field_hours?this.fieldconfig.field_hours:"duration_hours"},enumerable:!0,configurable:!0}),fieldDuration.prototype.getDisplay=function(){if(this.model.data[this.fieldminutes]||this.model.data[this.fieldhours])return("00"+this.model.data[this.fieldhours]).slice(-2)+":"+("00"+this.model.data[this.fieldminutes]).slice(-2)},Object.defineProperty(fieldDuration.prototype,"editDurationHours",{get:function(){return this.model.data[this.fieldhours]},set:function(e){this.model.setField(this.fieldhours,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDuration.prototype,"editDurationMinutes",{get:function(){return this.model.data[this.fieldminutes]},set:function(e){this.model.setField(this.fieldminutes,e)},enumerable:!0,configurable:!0}),fieldDuration=__decorate([core_1.Component({selector:"field-duration",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{getDisplay()}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-p-around--xx-small" [ngClass]="css_classes"><div *ngIf="!fieldconfig.freeentry" class="slds-grid"><div class="slds-form-element__control slds-size--1-of-2"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="editDurationHours"><option *ngFor="let duration of durationHours">{{duration}}</option></select></div></div><div class="slds-form-element__control slds-m-left--x-small slds-size--1-of-2"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="editDurationMinutes"><option *ngFor="let duration of durationMinutes">{{duration}}</option></select></div></div></div><div *ngIf="fieldconfig.freeentry" class="slds-grid"><div class="slds-form-element slds-size--1-of-2"><div class="slds-form-element__control slds-input-has-fixed-addon"><input type="number" min="0" class="slds-input" title="hours" [(ngModel)]="editDurationHours" [ngModelOptions]="modelOptions" style="padding: 0 0.25rem 0 0.25rem"> <span class="slds-form-element__addon" id="fixed-text-addon-post">h</span></div></div><div class="slds-form-element slds-m-left--x-small slds-size--1-of-2"><div class="slds-form-element__control slds-input-has-fixed-addon"><input type="number" min="0" max="59" class="slds-input" title="minutes" [(ngModel)]="editDurationMinutes" [ngModelOptions]="modelOptions" style="padding: 0 0.25rem 0 0.25rem"> <span class="slds-form-element__addon" id="fixed-text-addon-post2">min</span></div></div></div><field-messages fieldname="{{fieldname}}"></field-messages></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.popup,core_1.Renderer,core_1.ElementRef])],fieldDuration)}(fieldGeneric);exports.fieldDuration=fieldDuration;var fieldDateTimeSpan=function(d){function fieldDateTimeSpan(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.userpreferences=o,a.isValid=!0,a.errorMessage="",a}return __extends(fieldDateTimeSpan,d),Object.defineProperty(fieldDateTimeSpan.prototype,"fieldstart",{get:function(){return this.fieldconfig.field_start?this.fieldconfig.field_start:"date_start"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"fieldend",{get:function(){return this.fieldconfig.field_end?this.fieldconfig.field_end:"date_end"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"fieldminutes",{get:function(){return this.fieldconfig.field_minutes?this.fieldconfig.field_minutes:"duration_minutes"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"fieldhours",{get:function(){return this.fieldconfig.field_hours?this.fieldconfig.field_hours:"duration_hours"},enumerable:!0,configurable:!0}),fieldDateTimeSpan.prototype.ngOnInit=function(){this.calculateEndDate()},Object.defineProperty(fieldDateTimeSpan.prototype,"duration",{get:function(){var e=this.model.getFieldValue(this.fieldhours),t=this.model.getFieldValue(this.fieldminutes);return 60*parseInt(e,10)+60*parseInt(t,10)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"formattedStartDate",{get:function(){return this.startDate?this.startDate.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat()):""},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"formattedEndDate",{get:function(){return this.endDate?this.endDate.format(this.userpreferences.getDateFormat()+" "+this.userpreferences.getTimeFormat()):""},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"startDate",{get:function(){return this.model.getField(this.fieldstart)},set:function(e){this.model.setField(this.fieldstart,e),this.calculateEndDate()},enumerable:!0,configurable:!0}),Object.defineProperty(fieldDateTimeSpan.prototype,"endDate",{get:function(){return this.model.getField(this.fieldend)},set:function(e){this.model.getFieldValue(this.fieldstart)||(this.startDate=new moment(e).subtract(this.duration,"minutes")),e.isBefore(this.model.getFieldValue(this.fieldstart))?(this.isValid=!1,this.errorMessage="enddate cannot be before startdate",this.model.setFieldMessage("error","enddate cannot be before startdate",this.fieldname,"sequencecheck")):(this.model.resetFieldMessages(this.fieldname,"error","sequencecheck"),this.model.setField(this.fieldend,e),this.calculateDuration(),this.isValid=!0)},enumerable:!0,configurable:!0}),fieldDateTimeSpan.prototype.calculateEndDate=function(){this.startDate&&this.duration&&(this.endDate=new moment(this.startDate).add(this.duration,"minutes"))},fieldDateTimeSpan.prototype.calculateDuration=function(){this.model.getFieldValue(this.fieldend).seconds(0),this.model.getFieldValue(this.fieldstart).seconds(0);var e=moment.duration(this.model.getFieldValue(this.fieldend).diff(this.model.getFieldValue(this.fieldstart))),t=Math.floor(e.asHours()),s=e.asMinutes()-60*t;this.model.setFieldValue(this.fieldhours,t),this.model.setFieldValue(this.fieldminutes,s)},fieldDateTimeSpan=__decorate([core_1.Component({selector:"field-date-time-span",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{formattedStartDate}}&nbsp;-&nbsp;{{formattedEndDate}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-p-around--xx-small" [ngClass]="css_classes"><fieldset class="slds-form--compound"><div class="slds-form-element__group"><div class="slds-form-element__row"><div class="slds-form-element slds-size--1-of-2"><label class="slds-form-element__label">{{language.getLabel(\'LBL_DATE_START\')}}</label><system-input-date [(ngModel)]="startDate"></system-input-date></div><div class="slds-form-element slds-size--1-of-2 slds-m-top--none"><label class="slds-form-element__label">{{language.getLabel(\'LBL_TIME_START\')}}</label><system-input-time [(ngModel)]="startDate"></system-input-time></div></div></div><div class="slds-form-element__group"><div class="slds-form-element__row"><div class="slds-form-element slds-size--1-of-2"><label class="slds-form-element__label">{{language.getLabel(\'LBL_DATE_END\')}}</label><system-input-date [(ngModel)]="endDate"></system-input-date></div><div class="slds-form-element slds-size--1-of-2 slds-m-top--none"><label class="slds-form-element__label">{{language.getLabel(\'LBL_TIME_END\')}}</label><system-input-time [(ngModel)]="endDate"></system-input-time></div></div></div></fieldset><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.userpreferences])],fieldDateTimeSpan)}(fieldGeneric);exports.fieldDateTimeSpan=fieldDateTimeSpan;var fieldAddress=function(e){function fieldAddress(){return null!==e&&e.apply(this,arguments)||this}return __extends(fieldAddress,e),Object.defineProperty(fieldAddress.prototype,"value",{get:function(){return this.buildAddress()},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"addresskey",{get:function(){return this.fieldconfig.key?this.fieldconfig.key+"_":""},enumerable:!0,configurable:!0}),fieldAddress.prototype.buildAddress=function(){var e="";return this.model.data[this.addresskey+"address_street"]&&(e+=this.model.data[this.addresskey+"address_street"]),this.model.data[this.addresskey+"address_postalcode"]&&(e+=", "+this.model.data[this.addresskey+"address_postalcode"]+" "+this.model.data[this.addresskey+"address_city"]),this.model.data[this.addresskey+"address_country"]&&(e+=", "+this.model.data[this.addresskey+"address_country"]),e},fieldAddress.prototype.addressSelected=function(e){this.street=e.street,this.city=e.city,this.postalcode=e.postalcode,this.state=e.state,this.country=e.country,this.latitude=e.latitude,this.longitude=e.longitude},fieldAddress.prototype.getAddressLabel=function(){return this.language.getLabel(this.model.module,this.fieldconfig.label)},Object.defineProperty(fieldAddress.prototype,"street",{get:function(){return this.model.data[this.addresskey+"address_street"]},set:function(e){this.model.setField(this.addresskey+"address_street",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"attn",{get:function(){return this.model.data[this.addresskey+"address_attn"]},set:function(e){this.model.setField(this.addresskey+"address_attn",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"city",{get:function(){return this.model.data[this.addresskey+"address_city"]},set:function(e){this.model.setField(this.addresskey+"address_city",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"postalcode",{get:function(){return this.model.data[this.addresskey+"address_postalcode"]},set:function(e){this.model.setField(this.addresskey+"address_postalcode",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"state",{get:function(){return this.model.data[this.addresskey+"address_state"]},set:function(e){this.model.setField(this.addresskey+"address_state",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"country",{get:function(){return this.model.data[this.addresskey+"address_country"]},set:function(e){this.model.setField(this.addresskey+"address_country",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"latitude",{get:function(){return this.model.data[this.addresskey+"address_latitude"]},set:function(e){this.model.setField(this.addresskey+"address_latitude",e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldAddress.prototype,"longitude",{get:function(){return this.model.data[this.addresskey+"address_longitude"]},set:function(e){this.model.setField(this.addresskey+"address_longitude",e)},enumerable:!0,configurable:!0}),fieldAddress=__decorate([core_1.Component({selector:"field-address",template:'<div *ngIf="!isEditMode()"><field-label fieldname="field" [fieldconfig]="fieldconfig"></field-label><field-generic-display [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()" [fieldid]="fieldid">{{value}}</field-generic-display></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><fieldset><legend class="slds-form-element__label slds-text-title--caps slds-p-bottom--x-small">{{getAddressLabel()}}</legend><div class="slds-form-element__group"><system-googleplaces-autocomplete (address)="addressSelected($event)"></system-googleplaces-autocomplete><div class="slds-form-element slds-size--1-of-1"><label class="slds-form-element__label">{{language.getLabel(\'LBL_ATTN\')}}</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="attn" [ngModelOptions]="modelOptions"></div></div><div class="slds-form-element slds-size--1-of-1"><label class="slds-form-element__label">{{language.getLabel(\'LBL_STREET\')}}</label><div class="slds-form-element__control"><input #focus type="text" class="slds-input" [(ngModel)]="street" [ngModelOptions]="modelOptions"></div></div><div class="slds-grid"><div class="slds-form-element slds-size--1-of-2 slds-p-right--xx-small"><label class="slds-form-element__label">{{language.getLabel(\'LBL_POSTALCODE\')}}</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="postalcode" [ngModelOptions]="modelOptions"></div></div><div class="slds-form-element slds-size--1-of-2 slds-p-left--xx-small"><label class="slds-form-element__label">{{language.getLabel(\'LBL_CITY\')}}</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="city" [ngModelOptions]="modelOptions"></div></div></div><div class="slds-grid"><div class="slds-form-element slds-size--1-of-2 slds-p-right--xx-small"><label class="slds-form-element__label">{{language.getLabel(\'LBL_STATE\')}}</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="state" [ngModelOptions]="modelOptions"></div></div><div class="slds-form-element slds-size--1-of-2 slds-p-left--xx-small"><label class="slds-form-element__label">{{language.getLabel(\'LBL_COUNTRY\')}}</label><div class="slds-form-element__control"><input type="text" class="slds-input" [(ngModel)]="country" [ngModelOptions]="modelOptions"></div></div></div></div></fieldset><field-messages [fieldname]="fieldname"></field-messages></div>'})],fieldAddress)}(fieldGeneric);exports.fieldAddress=fieldAddress;var fieldFullName=function(a){function fieldFullName(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.isValid=!0,o.errorMessage="",o}return __extends(fieldFullName,a),Object.defineProperty(fieldFullName.prototype,"fieldsalutation",{get:function(){return this.fieldconfig.field_salutation?this.fieldconfig.field_salutation:"salutation"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"fielddegree",{get:function(){return this.fieldconfig.field_degree?this.fieldconfig.field_degree:"degree1"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"fieldfirstname",{get:function(){return this.fieldconfig.field_firstname?this.fieldconfig.field_firstname:"first_name"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"fieldlastname",{get:function(){return this.fieldconfig.field_lastname?this.fieldconfig.field_lastname:"last_name"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"fieldlasttitle",{get:function(){return this.fieldconfig.field_lasttitle?this.fieldconfig.field_lasttitle:"degree2"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"salutationdisplay",{get:function(){return this.language.getFieldDisplayOptionValue(this.model.module,this.fieldsalutation,this.model.data[this.fieldsalutation])},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"value",{get:function(){return this.filterUndefined(this.language.getFieldDisplayOptionValue(this.model.module,this.fieldsalutation,this.model.data[this.fieldsalutation]))+" "+this.filterUndefined(this.model.data[this.fielddegree])+" "+this.filterUndefined(this.model.data[this.fieldfirstname])+" "+this.filterUndefined(this.model.data[this.fieldlastname])+" "+this.filterUndefined(this.model.data[this.fieldlasttitle])},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"salutation",{get:function(){return this.model.getField(this.fieldsalutation)},set:function(e){this.model.setField(this.fieldsalutation,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"degree1",{get:function(){return this.model.getField(this.fielddegree)},set:function(e){this.model.setField(this.fielddegree,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"first_name",{get:function(){return this.model.getField(this.fieldfirstname)},set:function(e){this.model.setField(this.fieldfirstname,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"last_name",{get:function(){return this.model.getField(this.fieldlastname)},set:function(e){this.model.setField(this.fieldlastname,e)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldFullName.prototype,"degree2",{get:function(){return this.model.getField(this.fieldlasttitle)},set:function(e){this.model.setField(this.fieldlasttitle,e)},enumerable:!0,configurable:!0}),fieldFullName.prototype.filterUndefined=function(e){return e||""},fieldFullName.prototype.getClassesForSubField=function(e){var t="";switch(e){case this.fieldsalutation:t="small"==this.view.size?"slds-size--1-of-3 slds-order--1":"slds-size--1-of-7";break;case this.fielddegree:t="small"==this.view.size?"slds-size--1-of-3 slds-order--2":"slds-size--1-of-7";break;case this.fieldlasttitle:t="small"==this.view.size?"slds-size--1-of-3 slds-order--3":"slds-size--1-of-7";break;case this.fieldfirstname:t="small"==this.view.size?"slds-size--1-of-2 slds-order--4":"slds-p-left--xx-small slds-size--2-of-7";break;case this.fieldlastname:t="small"==this.view.size?"slds-size--1-of-2 slds-order--5":"slds-size--2-of-7"}return this.getStati(e).invalid&&(t+=" slds-has-error"),t},fieldFullName.prototype.getSalutations=function(){var e=[],t=this.language.getFieldDisplayOptions(this.model.module,this.fieldconfig.field_salutation?this.fieldconfig.field_salutation:"salutation");for(var s in t)e.push({value:s,display:t[s]});return e},fieldFullName=__decorate([core_1.Component({selector:"field-full-name",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [title]="value" [fieldid]="fieldid">{{value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()"><div class="slds-grid slds-grid_vertical-align-center slds-wrap"><div class="slds-col slds-form-element__control slds-align-top" [ngClass]="getClassesForSubField(fieldsalutation)"><field-label [fieldname]="fieldsalutation"></field-label><div class="slds-select_container"><select class="slds-select" [(ngModel)]="salutation"><option *ngFor="let o of getSalutations()" [value]="o.value">{{o.display}}</option></select></div><field-messages [fieldname]="fieldsalutation"></field-messages></div><div class="slds-col slds-form-element__control slds-p-left--xx-small slds-align-top" [ngClass]="getClassesForSubField(fielddegree)"><field-label [fieldname]="fielddegree"></field-label><input class="slds-input" type="text" [(ngModel)]="degree1"><field-messages [fieldname]="fielddegree"></field-messages></div><div class="slds-col slds-form-element__control slds-align-top" [ngClass]="getClassesForSubField(fieldfirstname)"><field-label [fieldname]="fieldfirstname"></field-label><input class="slds-input" type="text" [(ngModel)]="first_name" [ngModelOptions]="{updateOn: \'blur\'}"><field-messages [fieldname]="fieldfirstname"></field-messages></div><div class="slds-col slds-form-element__control slds-p-left--xx-small slds-align-top" [ngClass]="getClassesForSubField(fieldlastname)"><field-label [fieldname]="fieldlastname"></field-label><input #focus class="slds-input" type="text" [(ngModel)]="last_name" [ngModelOptions]="{updateOn: \'blur\'}"><field-messages [fieldname]="fieldlastname"></field-messages></div><div class="slds-col slds-form-element__control slds-p-left--xx-small slds-align-top" [ngClass]="getClassesForSubField(fieldlasttitle)"><field-label [fieldname]="fieldlasttitle"></field-label><input class="slds-input" type="text" [(ngModel)]="degree2"><field-messages [fieldname]="fieldlasttitle"></field-messages></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldFullName)}(fieldGeneric);exports.fieldFullName=fieldFullName;var fieldTitle=function(a){function fieldTitle(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.isValid=!0,o.errorMessage="",o}return __extends(fieldTitle,a),Object.defineProperty(fieldTitle.prototype,"fielddd",{get:function(){return this.fieldconfig.field_dd?this.fieldconfig.field_dd:"title_dd"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldTitle.prototype,"fieldtxt",{get:function(){return this.fieldconfig.field_txt?this.fieldconfig.field_txt:"title"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldTitle.prototype,"titledddisplay",{get:function(){return this.language.getFieldDisplayOptionValue(this.model.module,this.fielddd,this.model.data[this.fielddd])},enumerable:!0,configurable:!0}),Object.defineProperty(fieldTitle.prototype,"value",{get:function(){return(this.model.data[this.fielddd]?this.language.getFieldDisplayOptionValue(this.model.module,this.fielddd,this.model.data[this.fielddd]):"")+(this.model.data[this.fieldtxt]?" "+this.model.data[this.fieldtxt]:"")},enumerable:!0,configurable:!0}),fieldTitle.prototype.getFieldClass=function(){var e=[];return this.isValid||e.push("slds-has-error"),e},fieldTitle.prototype.getTitles=function(){var e=[],t=this.language.getFieldDisplayOptions(this.model.module,this.fieldconfig.field_dd?this.fieldconfig.field_dd:"title_dd");for(var s in t)e.push({value:s,display:t[s]});return e},fieldTitle=__decorate([core_1.Component({selector:"field-title",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()"><div class="slds-grid slds-p-around--xx-small"><div class="slds-col slds-form-element__control slds-size--1-of-2" [ngClass]="getFieldClass()"><div class="slds-select_container"><select class="slds-select" [(ngModel)]="model.data[fielddd]"><option *ngFor="let o of getTitles()" [value]="o.value">{{o.display}}</option></select></div></div><div class="slds-col slds-form-element__control slds-size--1-of-2 slds-p-left--xx-small" [ngClass]="getFieldClass()"><input class="slds-input" type="text" [(ngModel)]="model.data[fieldtxt]"></div></div><div *ngIf="errorMessage !== \'\'" class="slds-form-element__help">{{errorMessage}}</div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldTitle)}(fieldGeneric);exports.fieldTitle=fieldTitle;var fieldFile=function(r){function fieldFile(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.configurationService=o,n.session=a,n.toast=d,n.showUploadModal=!1,n.theFile="",n.theProgress=0,n}return __extends(fieldFile,r),fieldFile.prototype.humanFileSize=function(e){var t=e;if(Math.abs(e)<1024)return t+" B";for(var s=["kB","MB","GB","TB","PB","EB","ZB","YB"],i=-1;t/=1024,++i,1024<=Math.abs(t)&&i<s.length-1;);return t.toFixed(1)+" "+s[i]},fieldFile.prototype.uploadFile=function(){var e=this.fileupload.element.nativeElement.files;this.doupload(e)},fieldFile.prototype.doupload=function(e){var t=this;this.showUploadModal=!0,this.theFile=e[0].name,this.uploadAttachmentsBase64(e).subscribe(function(e){e.progress?t.theProgress=e.progress.loaded/e.progress.total*100:e.complete&&(t.value=e.filename?e.filename:t.theFile,t.model.setField("file_mime_type",e.filetype))},function(e){t.closeUploadPopup()},function(){return t.closeUploadPopup()})},fieldFile.prototype.removeFile=function(){this.value="",this.model.setField("file_mime_type","")},fieldFile.prototype.closeUploadPopup=function(){this.showUploadModal=!1},fieldFile.prototype.uploadAttachmentsBase64=function(e){var l=this;if(0!==e.length){for(var o=new rxjs_1.Subject,t=this.configurationService.getSystemParamater("upload_maxsize"),s=function(i){if(t&&i.size>t)return a.toast.sendToast(a.language.getLabelFormatted("LBL_EXCEEDS_MAX_UPLOADFILESIZE",[i.name,a.humanFileSize(t)]),"error"),"continue";a.readFile(i).subscribe(function(e){var s=new XMLHttpRequest;s.onreadystatechange=function(e){if(void 0===e&&(e=l),4==s.readyState)try{var t=JSON.parse(s.response);o.next({complete:!0,filename:t.filename,filetype:t.filetype}),o.complete()}catch(e){({status:"error",data:"Unknown error occurred: ["+s.responseText+"]"})}},s.upload.addEventListener("progress",function(e){o.next({progress:{total:e.total,loaded:e.loaded}})},!1),s.open("POST",l.configurationService.getBackendUrl()+"/module/"+l.model.module+"/"+l.model.id+"/noteattachment",!0),s.setRequestHeader("OAuth-Token",l.session.authData.sessionId),s.setRequestHeader("Content-Type","application/json;charset=UTF-8");var t={file:i.filecontent,filename:i.name,filemimetype:i.type};s.send(JSON.stringify(t))})},a=this,i=0,d=e;i<d.length;i++){s(d[i])}return o.asObservable()}},fieldFile.prototype.readFile=function(e){var i=new rxjs_1.Subject,l=new FileReader;return l.file=e,l.onloadend=function(e){var t=l.result.toString();t=t.substring(t.indexOf("base64,")+7);var s=l.file;s.filecontent=t,i.next(s),i.complete()},l.readAsDataURL(e),i.asObservable()},fieldFile.prototype.getBarStyle=function(){return{width:this.theProgress+"%"}},fieldFile.prototype.downloadAttachment=function(e){var t=[];t.push("sessionid="+this.session.authData.sessionId),window.open(this.configurationService.getBackendUrl()+"/module/"+this.model.module+"/"+this.model.id+"/noteattachment/download?"+t.join("&"),"_blank")},fieldFile.prototype.preventdefault=function(e){(1==e.dataTransfer.items.length&&"file"===e.dataTransfer.items[0].kind||0<e.dataTransfer.files.length)&&(e.preventDefault(),e.stopPropagation())},fieldFile.prototype.onDrop=function(e){this.preventdefault(e);var t=e.dataTransfer.files;t&&1==t.length&&this.doupload(t)},fieldFile.prototype.determineFileIcon=function(){var e=this.model.getField("file_mime_type");if(e){var t=e.split("/");switch(t[0]){case"image":return"image";case"text":switch(t[1]){case"html":return"html";default:return"txt"}case"audio":return"audio";case"video":return"video"}switch(t[1]){case"xml":return"xml";case"pdf":return"pdf";case"vnd.ms-excel":case"vnd.openxmlformats-officedocument.spreadsheetml.sheet":return"excel";case"vnd.openxmlformats-officedocument.wordprocessingml.document":case"vnd.oasis.opendocument.text":return"word";case"vnd.oasis.opendocument.presentation":case"vnd.openxmlformats-officedocument.presentationml.presentation":return"ppt";case"x-zip-compressed":return"zip";case"x-msdownload":return"exe"}}return"unknown"},__decorate([core_1.ViewChild("fileupload",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldFile.prototype,"fileupload",void 0),fieldFile=__decorate([core_1.Component({selector:"field-file",template:'<script src="../components/fieldduration.ts"><\/script><div *ngIf="!isEditMode()" [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid slds-grid--vertical-align-center"><system-icon [icon]="determineFileIcon()" divClass="slds-p-right--xx-small" sprite="doctype" size="x-small"></system-icon><div class="slds-truncate slds-grow"><a href="javascript:void(0);" (click)="downloadAttachment()">{{value}}</a></div><button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" (click)="setEditMode()"><system-button-icon icon="edit"></system-button-icon></button></div></ng-template></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-vertical--xx-small" [ngClass]="getFieldClass()"><div *ngIf="value" class="slds-pill slds-pill_link slds-size--1-of-1"><span class="slds-pill__icon_container"><span class="slds-icon_container slds-icon-standard-account" title="Account"><system-icon [icon]="determineFileIcon()" divClass sprite="doctype" size="x-small"></system-icon></span></span> <a href="javascript:void(0);" class="slds-pill__action"><span class="slds-pill__label">{{value}}</span></a> <button class="slds-button slds-button_icon slds-button_icon slds-pill__remove" title="Remove" (click)="removeFile()"><system-button-icon icon="close"></system-button-icon></button></div><div *ngIf="!value" class="slds-file-selector slds-file-selector_files"><div class="slds-file-selector__dropzone" (dragover)="preventdefault($event)" (dragleave)="preventdefault($event)" (drop)="onDrop($event)"><input #fileupload type="file" class="slds-file-selector__input slds-assistive-text" [id]="fieldid" (change)="uploadFile()"> <label class="slds-file-selector__body" [attr.for]="fieldid"><span class="slds-file-selector__button slds-button slds-button_neutral"><system-button-icon [icon]="\'upload\'"></system-button-icon>Upload Files</span> <span class="slds-file-selector__text slds-medium-show">or Drop Files</span></label></div></div><field-messages [fieldname]="fieldname"></field-messages></div><div *ngIf="showUploadModal" role="dialog" class="slds-modal slds-fade-in-open"><div class="slds-modal__container"><div class="slds-modal__header slds-modal__header--empty"></div><div class="slds-modal__content slds-p-around--medium">uploading {{theFile}} ...<div class="uploadbar"><div class="uploadprogress" [ngStyle]="getBarStyle()"></div></div></div></div></div><div *ngIf="showUploadModal" class="slds-backdrop slds-backdrop--open"></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.configurationService,services_1.session,services_1.toast])],fieldFile)}(fieldGeneric);exports.fieldFile=fieldFile;var fieldUrl=function(a){function fieldUrl(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldUrl,a),Object.defineProperty(fieldUrl.prototype,"url",{get:function(){return this.model.data[this.fieldname]?this.model.data[this.fieldname].replace(/https?\:\/\//,""):""},enumerable:!0,configurable:!0}),fieldUrl.prototype.navigateTo=function(){""!=this.url&&window.open("//"+this.url,"_blank")},fieldUrl=__decorate([core_1.Component({selector:"field-url",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><div class="slds-grid slds-grid--vertical-align-center slds-text-link_reset" (click)="navigateTo()"><system-icon *ngIf="url" [icon]="\'web_link\'" [sprite]="\'action\'" [size]="\'x-small\'"></system-icon><div class="slds-truncate">{{url}}</div></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread" [ngClass]="getFieldClass()"><input #focus class="slds-input" type="text" [(ngModel)]="value" [ngModelOptions]="modelOptions"><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldUrl)}(fieldGeneric);exports.fieldUrl=fieldUrl;var fieldEmail=function(a){function fieldEmail(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.invalid=!1,o.validation=new RegExp('^(([^<>()\\[\\]\\\\.,;:\\s@"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@"]+)*)|(".+"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$'),o.mark=o.model.generateGuid(),o}return __extends(fieldEmail,a),Object.defineProperty(fieldEmail.prototype,"value",{get:function(){var e=this.model.getFieldValue("emailaddresses"),t=e?e.find(function(e){return 1==e.primary_address}):void 0;return t?t.email_address:void 0},set:function(e){var t=this.model.getFieldValue("emailaddresses"),s={id:"",email_address_id:"",primary_address:"1",email_address:e.toLowerCase(),email_address_caps:e.toUpperCase()};t=t&&0!=t.length?t.map(function(e){return 1==e.primary_address&&(e=s),e}):[s],this.model.setField("emailaddresses",t),this.model.setField(this.fieldname,e),this.model.resetFieldMessages(this.fieldname,"error",this.mark),this.invalid=!1,e&&0<e.length&&!this.validation.test(e)&&(this.model.setFieldMessage("error",this.language.getLabel("LBL_INPUT_INVALID"),this.fieldname,this.mark),this.invalid=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmail.prototype,"fieldClass",{get:function(){return this.invalid?this.css_classes.concat(["slds-has-error"]):this.css_classes},enumerable:!0,configurable:!0}),fieldEmail.prototype.sendEmail=function(){0<this.value.length&&window.location.assign("mailto:"+this.value)},fieldEmail=__decorate([core_1.Component({selector:"field-email",template:'<field-generic-display *ngIf="!isEditMode()" [fieldconfig]="fieldconfig" [editable]="isEditable()" [title]="value"><div class="slds-grid slds-grid--vertical-align-center"><div class="slds-truncate">{{value}}</div><system-icon *ngIf="value" icon="email" sprite="action" size="x-small" class="slds-text-link_reset slds-p-left--x-small" (click)="sendEmail()"></system-icon></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="fieldClass"><input class="slds-input" type="text" [(ngModel)]="value" [ngModelOptions]="modelOptions"><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldEmail)}(fieldGeneric);exports.fieldEmail=fieldEmail;var fieldEmailAddresses=function(a){function fieldEmailAddresses(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldEmailAddresses,a),fieldEmailAddresses.prototype.ngOnInit=function(){this.model.getField("emailaddresses")||this.model.setField("emailaddresses",[{id:this.model.generateGuid(),bean_id:this.model.id,bean_module:this.model.module,email_address:"",email_address_id:"",primary_address:"1"}])},Object.defineProperty(fieldEmailAddresses.prototype,"emailAddresses",{get:function(){return this.model.getField(this.fieldname)},enumerable:!0,configurable:!0}),fieldEmailAddresses.prototype.sendEmail=function(e){"1"!==e.invalid_email&&window.location.assign("mailto:"+e.email_address)},fieldEmailAddresses.prototype.trackByFn=function(e,t){return t.id},fieldEmailAddresses.prototype.setprimary=function(e){for(var t=0,s=this.model.data.emailaddresses;t<s.length;t++){var i=s[t];i.id==e?i.primary_address="1":i.primary_address="0"}},fieldEmailAddresses.prototype.addEmailAddress=function(){this.model.getField("emailaddresses").push({id:this.model.generateGuid(),bean_id:this.model.id,bean_module:this.model.module,email_address:"",email_address_id:"",primary_address:"0"})},fieldEmailAddresses.prototype.handleOnBlur=function(){var e=this.model.getField("emailaddresses").filter(function(e){return""!=e.email_address}),t="",s=e.find(function(e){return"1"==e.primary_address});s&&(t=s.email_address),this.model.setFields({emailAddresses:e,email1:t})},fieldEmailAddresses=__decorate([core_1.Component({selector:"field-email-addresses",template:'<div *ngIf="!isEditMode()"><field-generic-display *ngFor="let emailaddress of model.data.emailaddresses; trackBy: trackByFn" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><div class="slds-grid slds-wrap slds-gutters"><div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-p-vertical--xxx-small"><div class="slds-grid slds-grid--vertical-align-center"><button class="slds-button slds-button_icon slds-m-right--xx-small" [disabled]="emailaddress.invalid_email == \'1\'" (click)="sendEmail(emailaddress)"><system-button-icon icon="email" sprite="action"></system-button-icon></button><div class="slds-truncate" [ngStyle]="emailaddress.invalid_email == \'1\' ? {\'text-decoration\': \'line-through\'} : {}">{{emailaddress.email_address}}</div></div></div><div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-p-vertical--xxx-small"><div class="slds-grid slds-grid--align-spread"><div class="slds-truncate slds-form-element__control"><span class="slds-radio"><input type="radio" name="primaryemail" [id]="emailaddress.id + \'primary\'" [checked]="emailaddress.primary_address == \'1\'" disabled> <label class="slds-radio__label" [attr.for]="emailaddress.id + \'primary\'"><span class="slds-radio--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">primary</span></label></span></div><div class="slds-truncate slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" [id]="emailaddress.id + \'optout\'" [checked]="emailaddress.opt_out == \'1\'" disabled> <label class="slds-checkbox__label" [attr.for]="emailaddress.id + \'optout\'"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">opt out</span></label></span></div><div class="slds-truncate slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" [id]="emailaddress.id + \'invalid\'" [checked]="emailaddress.invalid_email == \'1\'" disabled> <label class="slds-checkbox__label" [attr.for]="emailaddress.id + \'invalid\'"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">invalid</span></label></span></div></div></div></div></field-generic-display></div><div *ngIf="isEditMode()"><div *ngFor="let emailaddress of model.data.emailaddresses; trackBy: trackByFn" class="slds-form-element__control slds-grid slds-grid--align-spread" [ngClass]="getFieldClass()"><div class="slds-size--1-of-1"><field-email-emailaddress class="slds-size--1-of-1" [emailaddress]="emailaddress" (primaryaddress)="setprimary(emailaddress.id)" (onBlur)="handleOnBlur()"></field-email-emailaddress></div></div><div class="slds-grid slds-align-content-center slds-p-vertical--x-small slds-border--top"><button class="slds-button slds-button--icon-small slds-button--icon-border" title="Add New Email" (click)="addEmailAddress()"><system-button-icon icon="add"></system-button-icon></button></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldEmailAddresses)}(fieldGeneric);exports.fieldEmailAddresses=fieldEmailAddresses;var fieldEmailEmailAddress=function(){function e(e){this.language=e,this.emailaddress={},this.primaryaddress=new core_1.EventEmitter,this.onBlur=new core_1.EventEmitter}return e.prototype.ngAfterViewInit=function(){""==this.emailaddress.email_address&&this.inputText.nativeElement.focus()},Object.defineProperty(e.prototype,"emailadr",{get:function(){return this.emailaddress.email_address},set:function(e){this.emailaddress.email_address=e,this.emailaddress.email_address_caps=e.toUpperCase()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"primary",{get:function(){return"1"==this.emailaddress.primary_address},set:function(e){1!=this.emailaddress.invalid_email&&""!=this.emailaddress.email_address&&(this.emailaddress.primary_address="1",this.primaryaddress.emit(!0))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"opt_out",{get:function(){return 1==this.emailaddress.opt_out},set:function(e){1!=this.emailaddress.invalid_email&&(this.emailaddress.opt_out=e?1:0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"invalid_email",{get:function(){return 1==this.emailaddress.invalid_email},set:function(e){this.emailaddress.invalid_email=e?1:0},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("inputText"),__metadata("design:type",core_1.ElementRef)],e.prototype,"inputText",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"emailaddress",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"primaryaddress",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"onBlur",void 0),e=__decorate([core_1.Component({selector:"field-email-emailaddress",template:'<div class="slds-grid slds-gutters slds-wrap slds-grid--vertical-align-center"><div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-m-bottom--x-small"><div class="slds-form-element slds-truncate"><div class="slds-form-element__control"><span *ngIf="invalid_email" class="slds-p-left--small" style="text-decoration: line-through">{{emailadr}}</span> <input #inputText *ngIf="!invalid_email" type="text" class="slds-input" [(ngModel)]="emailadr" (blur)="onBlur.emit()"></div></div></div><div class="slds-col slds-size--1-of-1 slds-large-size--1-of-2 slds-m-bottom--x-small"><div class="slds-grid slds-grid--align-spread"><div class="slds-truncate slds-form-element__control" (click)="primary = true"><span class="slds-radio"><input type="radio" name="primaryemail" [id]="emailaddress.id + \'primary\'" [checked]="primary" (change)="onBlur.emit()" [disabled]="invalid_email || this.emailaddress.email_address == \'\'"> <label class="slds-radio__label" [attr.for]="emailaddress.id + \'primary\'"><span class="slds-radio--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">primary</span></label></span></div><div class="slds-truncate slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" [id]="emailaddress.id + \'optout\'" [(ngModel)]="opt_out" [disabled]="invalid_email || this.emailaddress.email_address == \'\'"> <label class="slds-checkbox__label" [attr.for]="emailaddress.id + \'optout\'"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">opt out</span></label></span></div><div class="slds-truncate slds-form-element__control"><span class="slds-checkbox"><input type="checkbox" [id]="emailaddress.id + \'invalid\'" [ngModel]="invalid_email" disabled> <label class="slds-checkbox__label" [attr.for]="emailaddress.id + \'invalid\'"><span class="slds-checkbox--faux"></span> <span class="slds-form-element__label slds-p-left--xx-small slds-truncate">invalid</span></label></span></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.language])],e)}();exports.fieldEmailEmailAddress=fieldEmailEmailAddress;var fieldEmailRecipients=function(r){function fieldEmailRecipients(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.backend=o,n.renderer=a,n.elementRef=d,n.searchResults=[],n.isAdding=!1,n.addAddress="",n.searchTimeOut=void 0,n.showSearchResults=!1,n.searchResultsLoading=!1,n}return __extends(fieldEmailRecipients,r),Object.defineProperty(fieldEmailRecipients.prototype,"addresstype",{get:function(){return this.fieldconfig.addresstype?this.fieldconfig.addresstype:"from"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailRecipients.prototype,"inputSize",{get:function(){return 20<this.addAddress.length?this.addAddress.length<55?this.addAddress.length+5:55:20},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailRecipients.prototype,"addrArray",{get:function(){var e=[];if(this.model.data.recipient_addresses)for(var t=0,s=this.model.data.recipient_addresses;t<s.length;t++){var i=s[t];i.address_type==this.addresstype&&"1"!=i.deleted&&e.push(i)}return e},enumerable:!0,configurable:!0}),fieldEmailRecipients.prototype.closeSearchDialog=function(){this.clickListener&&this.clickListener(),this.searchResults=[],this.showSearchResults=!1},fieldEmailRecipients.prototype.onClick=function(){this.isAdding=!0},fieldEmailRecipients.prototype.onBlur=function(){""==this.addAddress&&(this.isAdding=!1)},fieldEmailRecipients.prototype.removeAddress=function(e,t){e.preventDefault(),e.stopPropagation();for(var s=0,i=this.model.data.recipient_addresses;s<i.length;s++){var l=i[s];if(l.id==t)return void(l.deleted="1")}},fieldEmailRecipients.prototype.onKeyUp=function(e){var t=this;switch(e.key){case"ArrowDown":case"ArrowUp":break;case"Enter":this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.validateEmail(this.addAddress)?(this.model.data.recipient_addresses||(this.model.data.recipient_addresses=[]),this.model.data.recipient_addresses.push({id:this.model.generateGuid(),address_type:this.addresstype,email_address:this.addAddress}),this.addAddress="",this.closeSearchDialog()):this.doSearch();break;default:this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout(function(){return t.doSearch()},1e3)}},fieldEmailRecipients.prototype.doSearch=function(){var t=this;""!==this.addAddress&&(this.searchResults=[],this.showSearchResults=!0,this.searchResultsLoading=!0,this.clickListener=this.renderer.listen("document","click",function(e){return t.handleClick(e)}),this.backend.postRequest("EmailAddresses/"+this.addAddress).subscribe(function(e){0<e.length?t.searchResults=e:t.closeSearchDialog(),t.searchResultsLoading=!1}))},fieldEmailRecipients.prototype.handleClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.closeSearchDialog(),this.addAddress="",this.isAdding=!1)},fieldEmailRecipients.prototype.selectAddress=function(e){this.model.data.recipient_addresses||(this.model.data.recipient_addresses=[]),this.model.data.recipient_addresses.push({id:this.model.generateGuid(),address_type:this.addresstype,email_address:e.email_address,email_address_id:e.email_address_id,parent_type:e.module,parent_id:e.id}),this.addAddress="",this.isAdding=!1,this.closeSearchDialog()},fieldEmailRecipients.prototype.validateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},__decorate([core_1.ViewChild("addAddressInput",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldEmailRecipients.prototype,"addAddressInput",void 0),fieldEmailRecipients=__decorate([core_1.Component({template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><div type="text" class="slds-pill_container" style="border:none;"><ul class="slds-listbox slds-listbox_horizontal" role="listbox"><li class="slds-pill slds-pill_link" *ngFor="let addr of addrArray"><a href="javascript:void(0);" class="slds-pill__action" style="padding-right:.125rem;"><span class="slds-pill__label">{{addr.email_address}}</span></a></li></ul></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-form-element__control slds-size--1-of-1"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" role="combobox" [ngClass]="{\'slds-is-open\':showSearchResults}"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><div class="slds-pill_container" (click)="onClick()"><ul class="slds-listbox slds-listbox_horizontal" role="listbox"><li class="slds-listbox-item" role="presentation" *ngFor="let addr of addrArray"><span class="slds-pill" role="option"><span *ngIf="addr.parent_id" class="slds-icon_container"><system-icon [module]="addr.parent_type" size="x-small" divClass="slds-p-right--x-small"></system-icon></span> <span class="slds-pill__label">{{addr.email_address}}</span> <span class="slds-icon_container slds-pill__remove"><system-button-icon [icon]="\'close\'" (click)="removeAddress($event, addr.id)"></system-button-icon></span></span></li><li class="slds-listbox-item" role="presentation"><input spoiceui-autofocus *ngIf="isAdding" type="text" [size]="inputSize" class="slds-p-horizontal--x-small" [(ngModel)]="addAddress" (blur)="onBlur()" (keyup)="onKeyUp($event)" [title]="language.getLabel(\'LBL_ADD_EMAILADDRESS\')" [placeholder]="language.getLabel(\'LBL_ADD_EMAILADDRESS\')"></li></ul></div></div><div class="slds-dropdown slds-dropdown_fluid" role="listbox"><system-spinner *ngIf="searchResultsLoading" size="12"></system-spinner><ul class="slds-listbox slds-listbox_vertical" role="presentation"><li role="presentation" class="slds-listbox__item" *ngFor="let searchResult of searchResults" (click)="selectAddress(searchResult)"><div class="slds-listbox__option slds-grid slds-grid--vertical-align-center slds-p-around--x-small"><system-icon class="slds-p-right--x-small" [module]="searchResult.module" size="x-small"></system-icon><div class="slds-media__body"><span class="slds-listbox__option-text slds-listbox__option-text_entity">{{searchResult.email_address}} • {{searchResult.summary_text}}</span></div></div></li></ul></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',styles:["input, input:focus { border: none; outline: none;}"]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,core_1.Renderer2,core_1.ElementRef])],fieldEmailRecipients)}(fieldGeneric);exports.fieldEmailRecipients=fieldEmailRecipients;var fieldEmailRecipientsShort=function(r){function fieldEmailRecipientsShort(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.backend=o,n.renderer=a,n.elementRef=d,n.isAdding=!1,n.addAddress="",n.searchTimeOut=void 0,n.showSearchResults=!1,n.searchResults=[],n.searchResultsLoading=!1,n}return __extends(fieldEmailRecipientsShort,r),Object.defineProperty(fieldEmailRecipientsShort.prototype,"firstAddress",{get:function(){return this.addrArray&&0<this.addrArray.length?this.addrArray[0].email_address:""},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailRecipientsShort.prototype,"addresstype",{get:function(){return this.fieldconfig.addresstype?this.fieldconfig.addresstype:"from"},enumerable:!0,configurable:!0}),Object.defineProperty(fieldEmailRecipientsShort.prototype,"addrArray",{get:function(){var e=[];if(this.model.data.recipient_addresses)for(var t=0,s=this.model.data.recipient_addresses;t<s.length;t++){var i=s[t];i.address_type==this.addresstype&&"1"!=i.deleted&&e.push(i)}return e},enumerable:!0,configurable:!0}),fieldEmailRecipientsShort.prototype.onClick=function(){this.isAdding=!0},fieldEmailRecipientsShort.prototype.onBlur=function(){""==this.addAddress&&(this.isAdding=!1)},fieldEmailRecipientsShort.prototype.removeAddress=function(e,t){e.preventDefault(),e.stopPropagation();for(var s=0,i=this.model.data.recipient_addresses;s<i.length;s++){var l=i[s];if(l.id==t)return void(l.deleted="1")}},fieldEmailRecipientsShort.prototype.onKeyUp=function(e){var t=this;switch(e.key){case"ArrowDown":case"ArrowUp":break;case"Enter":this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.validateEmail(this.addAddress)?(this.model.data.recipient_addresses||(this.model.data.recipient_addresses=[]),this.model.data.recipient_addresses.push({id:this.model.generateGuid(),address_type:this.addresstype,email_address:this.addAddress}),this.addAddress="",this.closeSearchDialog()):this.doSearch();break;default:this.searchTimeOut&&window.clearTimeout(this.searchTimeOut),this.searchTimeOut=window.setTimeout(function(){return t.doSearch()},1e3)}},fieldEmailRecipientsShort.prototype.closeSearchDialog=function(){this.clickListener(),this.searchResults=[],this.showSearchResults=!1},fieldEmailRecipientsShort.prototype.doSearch=function(){var t=this;""!==this.addAddress&&(this.searchResults=[],this.showSearchResults=!0,this.searchResultsLoading=!0,this.clickListener=this.renderer.listen("document","click",function(e){return t.handleClick(e)}),this.backend.postRequest("EmailAddresses/"+this.addAddress).subscribe(function(e){0<e.length?t.searchResults=e:t.closeSearchDialog(),t.searchResultsLoading=!1}))},fieldEmailRecipientsShort.prototype.handleClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.closeSearchDialog(),this.addAddress="",this.isAdding=!1)},fieldEmailRecipientsShort.prototype.selectAddress=function(e){this.model.data.recipient_addresses||(this.model.data.recipient_addresses=[]),this.model.data.recipient_addresses.push({id:this.model.generateGuid(),address_type:this.addresstype,email_address:e.email_address,email_address_id:e.email_address_id,parent_type:e.module,parent_id:e.id}),this.addAddress="",this.isAdding=!1,this.closeSearchDialog()},fieldEmailRecipientsShort.prototype.validateEmail=function(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(String(e).toLowerCase())},__decorate([core_1.ViewChild("addAddressInput",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldEmailRecipientsShort.prototype,"addAddressInput",void 0),fieldEmailRecipientsShort=__decorate([core_1.Component({template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><span>{{firstAddress}}</span></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-form-element__control slds-size--1-of-1"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" role="combobox" [ngClass]="{\'slds-is-open\':showSearchResults}"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><div class="slds-pill_container" (click)="onClick()"><ul class="slds-listbox slds-listbox_horizontal" role="listbox"><li class="slds-listbox-item" role="presentation" *ngFor="let addr of addrArray"><span class="slds-pill" role="option"><span *ngIf="addr.parent_id" class="slds-icon_container"><system-icon [module]="addr.parent_type" size="x-small" divClass="slds-p-right--x-small"></system-icon></span> <span class="slds-pill__label">{{addr.email_address}}</span> <span class="slds-icon_container slds-pill__remove"><system-button-icon [icon]="\'close\'" (click)="removeAddress($event, addr.id)"></system-button-icon></span></span></li><li class="slds-listbox-item" role="presentation"><input spoiceui-autofocus *ngIf="isAdding" type="text" style="min-width: 12rem;" class="slds-p-horizontal--x-small" [(ngModel)]="addAddress" (blur)="onBlur()" (keyup)="onKeyUp($event)" [title]="language.getLabel(\'LBL_ADD_EMAILADDRESS\')" [placeholder]="language.getLabel(\'LBL_ADD_EMAILADDRESS\')"></li></ul></div></div><div class="slds-dropdown slds-dropdown_fluid" role="listbox"><system-spinner *ngIf="searchResultsLoading" size="12"></system-spinner><ul class="slds-listbox slds-listbox_vertical" role="presentation"><li role="presentation" class="slds-listbox__item" *ngFor="let searchResult of searchResults" (click)="selectAddress(searchResult)"><div class="slds-listbox__option slds-grid slds-grid--vertical-align-center slds-p-around--x-small"><system-icon class="slds-p-right--x-small" [module]="searchResult.module" size="x-small"></system-icon><div class="slds-media__body"><span class="slds-listbox__option-text slds-listbox__option-text_entity">{{searchResult.email_address}} • {{searchResult.summary_text}}</span></div></div></li></ul></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',styles:["input, input:focus { border: none; outline: none;}"]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,core_1.Renderer2,core_1.ElementRef])],fieldEmailRecipientsShort)}(fieldGeneric);exports.fieldEmailRecipientsShort=fieldEmailRecipientsShort;var fieldCurrencies=function(d){function fieldCurrencies(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.currency=o,a.currencies=[],a.currencies=a.currency.getCurrencies(),a}return __extends(fieldCurrencies,d),fieldCurrencies.prototype.getCurrencySymbol=function(){var t="";if(!this.model.data[this.fieldname])return t;return this.fieldname&&this.model.data[this.fieldname],this.currencies.some(function(e){if(-99==e.id)return t=e.symbol,!0}),t},fieldCurrencies=__decorate([core_1.Component({selector:"field-currencies",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()">{{getCurrencySymbol()}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="value"><option *ngFor="let currency of currencies" [value]="currency.id">{{currency.iso}} ({{currency.symbol}})</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.currency])],fieldCurrencies)}(fieldGeneric);exports.fieldCurrencies=fieldCurrencies;var fieldCompanies=function(n){function fieldCompanies(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.backend=o,d.configurationService=a,d.companies=[],d}return __extends(fieldCompanies,n),fieldCompanies.prototype.ngOnInit=function(){var t=this,e=this.configurationService.getData("companies");!1===e?this.backend.getRequest("module/CompanyCodes").subscribe(function(e){t.configurationService.setData("companies",e.list),t.companies=e.list,t.setDefault()}):(this.companies=e,this.setDefault())},fieldCompanies.prototype.setDefault=function(){this.view.isEditMode()&&!this.model.data[this.fieldname]&&0<this.companies.length&&(this.value=this.companies[0].id)},Object.defineProperty(fieldCompanies.prototype,"companyName",{get:function(){var t=this,s="";return this.companies.some(function(e){if(e.id==t.model.data[t.fieldname])return s=e.name,!0}),s},enumerable:!0,configurable:!0}),fieldCompanies=__decorate([core_1.Component({selector:"field-companies",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()">{{companyName}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="value"><option *ngFor="let company of companies" [value]="company.id">{{company.name}}</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.configurationService])],fieldCompanies)}(fieldGeneric);exports.fieldCompanies=fieldCompanies;var fieldVat=function(n){function fieldVat(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.backend=o,d.toast=a,d.isvalidating=!1,d}return __extends(fieldVat,n),Object.defineProperty(fieldVat.prototype,"vatDetailsField",{get:function(){return this.fieldconfig.vatdetails?this.fieldconfig.vatdetails:"vat_details"},enumerable:!0,configurable:!0}),fieldVat.prototype.validate=function(){var t=this;this.isvalidating=!0,this.backend.getRequest("module/Accounts/VIES/"+this.model.data[this.fieldname]).subscribe(function(e){"success"==e.status?(!0!==e.data.valid&&t.toast.sendToast("VAT ID is not valid","error"),t.model.data.vat_details=JSON.stringify(e.data)):t.toast.sendToast("Error checking VAT","error"),t.isvalidating=!1})},Object.defineProperty(fieldVat.prototype,"cancheck",{get:function(){return!!(this.model.data[this.fieldname]&&3<this.model.data[this.fieldname].length)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldVat.prototype,"isvalid",{get:function(){return!!this.model.data[this.vatDetailsField]&&JSON.parse(this.model.data[this.vatDetailsField]).valid},enumerable:!0,configurable:!0}),Object.defineProperty(fieldVat.prototype,"vatInfo",{get:function(){var e=JSON.parse(this.model.data[this.vatDetailsField]);return e.name+"\n"+e.address},enumerable:!0,configurable:!0}),fieldVat=__decorate([core_1.Component({selector:"field-vat",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid"><div class="slds-grid slds-grid--vertical-align-center"><div class="slds-truncate">{{value}}</div><div class="slds-p-left--small"><system-tooltip class="slds-m-left--x-small" *ngIf="isvalid" [tooltiptext]="vatInfo"></system-tooltip></div></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread" [ngClass]="getFieldClass()"><div class="slds-grid slds-size--1-of-1"><ng-container *ngIf="!isvalidating; else validating"><input #focus class="slds-input" type="text" [(ngModel)]="value"><div class="slds-col_bump-left slds-grid slds-grid--vertical-align-center"><system-tooltip class="slds-m-left--x-small" *ngIf="isvalid" [tooltiptext]="vatInfo"></system-tooltip><button class="slds-button slds-button--neutral slds-m-left--x-small" [disabled]="!cancheck" (click)="validate()">check</button></div></ng-container><ng-template #validating><input #focus class="slds-input slds-size--1-of-1" type="text" value="validating" disabled></ng-template></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.toast])],fieldVat)}(fieldGeneric);exports.fieldVat=fieldVat;var fieldBarcode=function(a){function fieldBarcode(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldBarcode,a),fieldBarcode.prototype.isEditMode=function(){return this.view.isEditMode()&&this.isEditable()},fieldBarcode.prototype.isEditable=function(){return this.view.isEditable&&!this.fieldconfig.readonly},fieldBarcode=__decorate([core_1.Component({selector:"field-barcode",template:'<div class="slds-form-element__control slds-p-top--xx-small"><div class="slds-grid slds-grid--align-spread slds-grid_vertical-align-center"><div class="slds-size--1-of-2"><input *ngIf="isEditMode()" class="slds-input" type="text" [(ngModel)]="value"><div *ngIf="!isEditMode()" class="slds-truncate">{{value}}</div></div><div class="slds-size--1-of-2 slds-text-align--right"><field-barcode-renderer [code]="value" [fieldId]="\'id_\'+fieldid"></field-barcode-renderer></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldBarcode)}(fieldGeneric);exports.fieldBarcode=fieldBarcode;var fieldBarcodeRenderer=function(){function e(e){var t=this;this.metadata=e,this.code="",this.fieldId="",this.metadata.loadLibs("js-barcode").subscribe(function(e){JsBarcode("#"+t.fieldId,t.code,{width:1,height:15,displayValue:!1})})}return e.prototype.ngOnChanges=function(){if(!this.metadata.isLibLoaded("js-barcode"))return!1;document.getElementById(this.fieldId)&&JsBarcode("#"+this.fieldId,this.code,{width:1,height:15,displayValue:!1})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"code",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldId",void 0),e=__decorate([core_1.Component({selector:"field-barcode-renderer",template:'<svg [id]="fieldId"></svg>'}),__metadata("design:paramtypes",[services_1.metadata])],e)}();exports.fieldBarcodeRenderer=fieldBarcodeRenderer;var fieldRating=function(a){function fieldRating(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.options=["1","2","3","4","5"],o}return __extends(fieldRating,a),fieldRating.prototype.setRatingValue=function(e){this.value=e},Object.defineProperty(fieldRating.prototype,"ratingIcon",{get:function(){return 3==parseInt(this.value)?"sentiment_neutral":3<parseInt(this.value)?"smiley_and_people":parseInt(this.value)<3?"sentiment_negative":void 0},enumerable:!0,configurable:!0}),fieldRating=__decorate([core_1.Component({selector:"field-rating",template:'<div *ngIf="!isEditMode()" [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread"><div *ngIf="!displayLink()" class="slds-truncate"><system-utility-icon [icon]="ratingIcon" [size]="\'x-small\'"></system-utility-icon><span *ngIf="value">&nbsp;({{value}})</span></div><div *ngIf="displayLink()" class="slds-truncate"><a href="javascript:void(0);" (click)="goRecord()"><system-utility-icon [icon]="ratingIcon" [size]="\'x-small\'"></system-utility-icon><span *ngIf="value">&nbsp;({{value}})</span></a></div><button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></div></ng-template></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-grid slds-grid--vertical-align-center"><system-utility-icon [icon]="\'sentiment_negative\'" [size]="\'xx-small\'" class="slds-p-right--x-small"></system-utility-icon><div class="slds-form-element__control" *ngFor="let option of options"><div class="slds-radio" (click)="setRatingValue(option)"><input type="radio" id="fieldid + option" [checked]="option == value"> <label class="slds-radio__label" [attr.for]="fieldid + option"><span class="slds-radio_faux"></span></label></div></div><system-utility-icon [icon]="\'smiley_and_people\'" [size]="\'xx-small\'"></system-utility-icon></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldRating)}(fieldGeneric);exports.fieldRating=fieldRating;var fieldLookupRecent=function(){function e(e,t,s,i){this.model=e,this.popup=t,this.recent=s,this.language=i,this.module="",this.idfield="",this.namefield="",this.selectedObject=new core_1.EventEmitter,this.recentItems=[]}return e.prototype.ngOnInit=function(){this.getRecent()},e.prototype.setParent=function(e,t,s,i){e.preventDefault(),i||(i={id:t,summary_text:s}),this.selectedObject.emit({id:t,text:s,data:i}),this.popup.close()},e.prototype.getRecent=function(){var t=this;this.recentItems=[];this.recent.getModuleRecent(this.module).subscribe(function(e){t.recentItems=e})},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"idfield",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"namefield",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selectedObject",void 0),e=__decorate([core_1.Component({selector:"field-lookup-recent",template:'<div class="slds-lookup__item--label slds-text-body--small">{{language.getLabel(\'LBL_RECENTLYVIEWED\')}} {{language.getModuleName(module)}}</div><ul class="slds-lookup__list" role="listbox"><li *ngFor="let recentItem of recentItems" role="presentation" (mousedown)="setParent($event, recentItem.item_id, recentItem.item_summary)"><span class="slds-lookup__item-action slds-media" role="option"><system-icon [module]="module" [size]="\'small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{recentItem.item_summary}}</div><span class="slds-lookup__result-meta slds-text-body--small">{{language.getModuleName(module)}}</span></div></span></li></ul>'}),__metadata("design:paramtypes",[services_1.model,services_1.popup,services_1.recent,services_1.language])],e)}();exports.fieldLookupRecent=fieldLookupRecent;var fieldLookupSearch=function(){function e(e,t,s,i,l,o){this.metadata=e,this.model=t,this.popup=s,this.fts=i,this.language=l,this.modal=o,this.searchTerm="",this.searchTimeout={},this.module="",this.fieldid="",this.modulefilter="",this.disableadd=!1,this.selectedObject=new core_1.EventEmitter,this.searchWithModal=new core_1.EventEmitter,this.searchtermChange=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"searchterm",{set:function(e){var t=this;this.searchTerm=e,this.searchTimeout&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout(function(){return t.doSearch()},500)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"canAdd",{get:function(){return!this.disableadd&&this.metadata.checkModuleAcl(this.module,"edit")},enumerable:!0,configurable:!0}),e.prototype.doSearch=function(){""!==this.searchTerm&&this.searchTerm!==this.fts.searchTerm&&this.fts.searchByModules(this.searchTerm,[this.module],10,{},{},!1,this.modulefilter)},e.prototype.setParent=function(e,t,s){this.searchTerm="",this.searchtermChange.emit(this.searchTerm),this.selectedObject.emit({id:e,text:t,data:s}),this.popup.close()},e.prototype.recordAdded=function(e){this.setParent(e.id,e.text,e.data)},e.prototype.getSearchResults=function(){var t=this,s=[];return this.fts.moduleSearchresults.some(function(e){if(e.module===t.module)return s=e.data.hits,!0}),s},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldid",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"modulefilter",void 0),__decorate([core_1.Input(),__metadata("design:type",Boolean)],e.prototype,"disableadd",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selectedObject",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],e.prototype,"searchWithModal",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],e.prototype,"searchtermChange",void 0),__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],e.prototype,"searchterm",null),e=__decorate([core_1.Component({selector:"field-lookup-search",template:'<ul class="slds-lookup__list" role="listbox"><li role="presentation"><div class="slds-lookup__item-action slds-media" role="option" (mousedown)="searchWithModal.emit()"><system-icon [icon]="\'search\'" [sprite]="\'utility\'" [size]="\'x-small\'" [addclasses]="\'slds-m-vertical--xxx-small slds-m-horizontal--xx-small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text"><i>{{searchTerm}}</i> in {{language.getModuleName(module)}}</div></div></div></li><li *ngFor="let searchItem of getSearchResults()" role="presentation" (mousedown)="setParent(searchItem._id, searchItem._source.summary_text, searchItem._source)"><span class="slds-lookup__item-action slds-media" role="option"><system-icon [module]="module" [size]="\'small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{searchItem._source.summary_text}}</div></div></span></li><li *ngIf="canAdd" field-lookup-search-add role="presentation" [module]="module" [fieldid]="fieldid" (added)="recordAdded($event)"></li></ul>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.popup,services_1.fts,services_1.language,services_1.modal])],e)}();exports.fieldLookupSearch=fieldLookupSearch;var fieldLookupSearchAdd=function(){function e(e,t,s){this.model=e,this.language=t,this.popup=s,this.module="",this.fieldid="",this.added$=new core_1.EventEmitter}return e.prototype.ngOnInit=function(){this.model.module=this.module},e.prototype.addParent=function(){var t=this;this.model.addModel(this.fieldid,null,null,!0).subscribe(function(e){t.added$.emit({id:e.id,text:e.summary_text,data:e})})},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"module",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"fieldid",void 0),__decorate([core_1.Output("added"),__metadata("design:type",Object)],e.prototype,"added$",void 0),e=__decorate([core_1.Component({selector:"[field-lookup-search-add]",template:'<span class="slds-lookup__item-action slds-media" role="option" (mousedown)="addParent()"><system-icon [icon]="\'add\'" [sprite]="\'utility\'" [size]="\'x-small\'" [addclasses]="\'slds-m-vertical--xxx-small slds-m-horizontal--xx-small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{language.getLabel(\'LBL_CREATE\')}}: {{language.getModuleName(module, true)}}</div></div></span>',providers:[services_1.model]}),__metadata("design:paramtypes",[services_1.model,services_1.language,services_1.popup])],e)}();exports.fieldLookupSearchAdd=fieldLookupSearchAdd;var fieldModelFooterPopover=function(){function fieldModelFooterPopover(e,t,s){this.model=e,this.view=t,this.metadata=s,this.popovermodule="",this.popoverid="",this.popoverside="right",this.styles=null,this.mouseover=!1,this.hidePopoverTimeout={},this.parentElementRef=null,this.self=null,this.modelIsLoading=!1,this.fields=[]}return fieldModelFooterPopover.prototype.goDetail=function(){this.model.goDetail()},fieldModelFooterPopover.prototype.onMouseOver=function(){this.mouseover=!0,this.hidePopoverTimeout&&window.clearTimeout(this.hidePopoverTimeout)},fieldModelFooterPopover.prototype.onMouseOut=function(){this.mouseover=!1,this.self.destroy()},Object.defineProperty(fieldModelFooterPopover.prototype,"popoverStyle",{get:function(){var e=this.parentElementRef.nativeElement.getBoundingClientRect(),t=this.popover.element.nativeElement.getBoundingClientRect();return e.left<t.width?this.popoverside="right":this.popoverside="left",{top:e.top+(e.height-t.height)/2+"px",left:e.left<t.width?e.left+100+"px":e.left-t.width-15+"px"}},enumerable:!0,configurable:!0}),fieldModelFooterPopover.prototype.ngOnInit=function(){var e=this,t=this.metadata.getComponentConfig("fieldModelFooterPopover",this.popovermodule);t.fieldset?this.fields=this.metadata.getFieldSetFields(t.fieldset):(t=this.metadata.getComponentConfig("ObjectPageHeaderDetails",this.popovermodule)).fieldset&&(this.fields=this.metadata.getFieldSetFields(t.fieldset)),this.modelIsLoading=!0,this.model.module=this.popovermodule,this.model.id=this.popoverid,this.model.getData().subscribe(function(){e.modelIsLoading=!1}),this.styles=this.popoverStyle},fieldModelFooterPopover.prototype.getNubbinClass=function(){return"left"==this.popoverside?"slds-nubbin--right":"slds-nubbin--left"},fieldModelFooterPopover.prototype.closePopover=function(e){var t=this;void 0===e&&(e=!1),e?this.self.destroy():this.hidePopoverTimeout=window.setTimeout(function(){return t.self.destroy()},500)},__decorate([core_1.ViewChild("popover",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldModelFooterPopover.prototype,"popover",void 0),fieldModelFooterPopover=__decorate([core_1.Component({selector:"field-model-footer-popover",template:'<div class="slds-popover slds-popover_large slds-popover--panel slds-is-fixed" [ngStyle]="popoverStyle" [ngClass]="getNubbinClass()" role="dialog" (mouseenter)="onMouseOver()" (mouseleave)="onMouseOut()"><button class="slds-button slds-button_icon slds-button_icon slds-button_icon-small slds-float_right slds-popover__close" (click)="closePopover(true)"><system-button-icon icon="close"></system-button-icon></button><div #popover class="slds-popover__header"><div class="slds-media slds-m-bottom--small slds-media--center"><div class="slds-media__figure"><system-icon [module]="popovermodule"></system-icon></div><div class="slds-media__body slds-truncate"><system-spinner *ngIf="modelIsLoading"></system-spinner><p class="slds-text-heading--medium slds-hyphenate"><a href="javascript:void(0);" (click)="goDetail()">{{model.data.summary_text}}</a></p></div></div><div class="slds-grid slds-wrap slds-grid--pull-padded"><div class="slds-p-horizontal--small slds-size--1-of-2 slds-p-bottom--x-small" *ngFor="let field of fields"><dl><dt><field-label [fieldname]="field.field" [fieldconfig]="field.fieldconfig"></field-label></dt><dd><field-container [field]="field.field" [fieldconfig]="field.fieldconfig" [fielddisplayclass]="\'slds-truncate\'"></field-container></dd></dl></div></div></div></div>',providers:[services_1.model,services_1.view]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.metadata])],fieldModelFooterPopover)}();exports.fieldModelFooterPopover=fieldModelFooterPopover;var fieldMediaFileImage=function(m){function fieldMediaFileImage(e,t,s,i,l,o,a,d,n,r,c,u){var p=m.call(this,e,t,s,i,o)||this;return p.model=e,p.view=t,p.language=s,p.metadata=i,p.toast=l,p.router=o,p.elementRef=a,p.renderer=d,p.mediafiles=n,p.backend=r,p.elRef=c,p.changeDetRef=u,p.relateIdField="",p.relateNameField="",p.relateType="",p.enlarged=!1,p.lightboxOpen=!1,p.fieldIsEmpty=!0,p.lastValue="",p.height="",p}return __extends(fieldMediaFileImage,m),fieldMediaFileImage.prototype.ngOnInit=function(){"image"!==this.fieldconfig.format&&(this.fieldconfig.format="button")},fieldMediaFileImage.prototype.ngAfterViewInit=function(){var e=this;this.size1rem=this.getSize1rem(),this.thumbSize=2*this.size1rem-2,this.widthOfParent=this.getWidthOfParent(),this.fieldconfig.height&&(this.height="calc("+this.fieldconfig.height+" - 2px - 0.5rem )"),this.model.isLoading?this.model.data$.subscribe(function(){e.afterLoadingModel()}):this.afterLoadingModel()},fieldMediaFileImage.prototype.afterLoadingModel=function(){var e=this;this.lastValue=this.model.data[this.fieldname],this.loadImages(),this.model.data$.subscribe(function(){e.model.data[e.fieldname]!==e.lastValue&&(e.lastValue=e.model.data[e.fieldname],e.loadImages())})},fieldMediaFileImage.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.enlarged=!1)},fieldMediaFileImage.prototype.closePopups=function(){this.clickListener(),this.enlarged=!1},fieldMediaFileImage.prototype.openEnlarged=function(){var t=this;this.clickListener=this.renderer.listen("document","click",function(e){return t.onClick(e)}),this.enlarged=!0},fieldMediaFileImage.prototype.closeEnlarged=function(){this.enlarged=!1,this.buttonToEnlargement&&this.buttonToEnlargement.nativeElement.focus()},fieldMediaFileImage.prototype.loadImages=function(){var t=this;this.model.data[this.fieldname]?(this.fieldIsEmpty=!1,"button"===this.fieldconfig.format?(this.mediafiles.getImageVariant(this.model.data[this.fieldname],"th/"+this.thumbSize).subscribe(function(e){t.imageUrl=e}),this.mediafiles.getImageVariant(this.model.data[this.fieldname],"th/200").subscribe(function(e){t.imageUrlEnlarged=e})):this.mediafiles.getImageVariant(this.model.data[this.fieldname],"mw/"+this.determineWidthOfImage()).subscribe(function(e){t.imageUrl=e})):this.fieldIsEmpty=!0},fieldMediaFileImage.prototype.openLightbox=function(){this.enlarged=!1,alert("Lightbox (große Anzeige des Bildes) ist noch nicht implementiert.")},fieldMediaFileImage.prototype.closeLightbox=function(){},fieldMediaFileImage.prototype.clearField4button=function(){this.imageUrl=this.imageUrlEnlarged=this.value="",this.enlarged=!1,this.buttonToPicker&&this.buttonToPicker.nativeElement.focus(),this.fieldIsEmpty=!0},fieldMediaFileImage.prototype.clearField4image=function(){this.imageUrl=this.model.data[this.fieldname]="",this.fieldIsEmpty=!0},fieldMediaFileImage.prototype.getImage=function(){var t=this;this.mediafiles.getMediaFile(1,"",this.fieldconfig.noImagePicker||!1,this.fieldconfig.noMetaData||!1,this.fieldconfig.category).subscribe(function(e){e&&(t.value=e,t.loadImages())})},fieldMediaFileImage.prototype.getSize1rem=function(){return Math.ceil(Number(getComputedStyle(document.documentElement,null).fontSize.replace(/px$/,"")))},fieldMediaFileImage.prototype.getWidthOfParent=function(){return Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).width.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).paddingLeft.replace(/px$/,""))-Number(getComputedStyle(this.elRef.nativeElement.parentElement.parentElement,null).paddingRight.replace(/px$/,""))},fieldMediaFileImage.prototype.determineWidthOfImage=function(){return Math.round(this.widthOfParent)},Object.defineProperty(fieldMediaFileImage.prototype,"imageStyle",{get:function(){return{height:this.height}},enumerable:!0,configurable:!0}),__decorate([core_1.ViewChild("buttonToEnlargement"),__metadata("design:type",core_1.ElementRef)],fieldMediaFileImage.prototype,"buttonToEnlargement",void 0),__decorate([core_1.ViewChild("buttonToPicker"),__metadata("design:type",core_1.ElementRef)],fieldMediaFileImage.prototype,"buttonToPicker",void 0),fieldMediaFileImage=__decorate([core_1.Component({selector:"field-media-file-image",template:'<div [ngClass]="fielddisplayclass+\' format-\'+fieldconfig.format" style="position:relative"><ng-container [ngSwitch]="fieldconfig.format"><ng-container *ngSwitchCase="\'button\'"><button #buttonToPicker *ngIf="fieldIsEmpty" class="slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled withThumb" [disabled]="!isEditMode()" (click)="getImage()"><system-button-icon [icon]="\'image\'"></system-button-icon></button> <button #buttonToEnlargement *ngIf="!fieldIsEmpty" class="slds-button slds-button slds-button_icon slds-button_icon-border-filled slds-button_icon-container withThumb" (click)="openEnlarged()" style="padding:0;"><img *ngIf="imageUrl" [src]="imageUrl" class="{{class}} imgInButton"><span style="display:inline-block" class="slds-text-align_center"><system-button-icon [icon]="\'threedots\'" style="display: block; width: calc(2rem - 2px); height: calc(2rem - 4px)"></system-button-icon></span></button><div *ngIf="enlarged" class="field-media-file-image-popover"><img *ngIf="imageUrlEnlarged" [src]="imageUrlEnlarged" class="slds-image" width="160" height="160"> <button #closebutton class="slds-button slds-button_icon close" (click)="closeEnlarged()" title="Close"><system-button-icon [icon]="\'close\'" [size]="\'small\'"></system-button-icon></button> <button *ngIf="isEditMode()" class="slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled delete" title="Delete" (click)="clearField4button()"><system-button-icon [icon]="\'delete\'"></system-button-icon></button>{{closebutton.focus()}}</div></ng-container><ng-container *ngSwitchDefault><div class="slds-box--border slds-align_absolute-center" [ngStyle]="imageStyle"><img *ngIf="imageUrl" [src]="imageUrl" class="{{class}}"> <button #buttonToPicker *ngIf="fieldIsEmpty" class="slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled slds-align--absolute-center withThumb" [disabled]="!isEditMode()" (click)="getImage()"><system-button-icon [icon]="\'image\'"></system-button-icon></button> <button *ngIf="isEditMode() && !fieldIsEmpty" class="delete slds-button slds-button_icon slds-button_icon-container slds-button_icon-border-filled" title="Delete" (click)="clearField4image()"><system-button-icon [icon]="\'delete\'"></system-button-icon></button></div></ng-container></ng-container></div>',providers:[services_1.mediafiles],styles:["div.field-media-file-image-popover { position: absolute; width: 160px; height: 160px; left: calc(50% - 80px); top: calc(50% - 80px); z-index: 1; background-color: #ccc; border-radius: 0.25rem; background-color: #fdfdfd; box-shadow: 0 2px 3px 0 rgba(0,0,0,.16); border: 1px solid #d8dde6 }","div.field-media-file-image-popover img { border: 1px solid #999; }","div.left div.field-media-file-image-popover { left: calc(100% - 160px); }","div.bottom div.field-media-file-image-popover { top: 0; }","button.close { position: absolute; top: 0.25rem; right: 0.25rem; cursor: pointer; margin: 0; }","button.close svg { filter: drop-shadow( 0px 0px 3px #fff) }","div.format-button button.delete { position: absolute; bottom: 0.25rem; left: 0.25rem; margin: 0; }","button.toLightbox { position: absolute; bottom: 0.25rem; right: 0.25rem; margin: 0; }","div.formatButton { display: inline-block; }","div.format-image img { max-height:100%; display:block; margin:auto;padding:.25rem;top:0;bottom:0;left:0;right:0; }","div.format-image button.delete { position: absolute; bottom:0.25rem; right:0.25rem; margin:0; }","button.withThumb { width: 4rem; }","input { background-color: #54698d; }","div.format-button img.imgInButton { border-radius: 0.25rem 0 0 0.25rem; padding: 1px 0 1px 1px; height: calc(2rem - 2px); width: calc(2rem - 1px); }"]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,services_1.toast,router_1.Router,core_1.ElementRef,core_1.Renderer,services_1.mediafiles,services_1.backend,core_1.ElementRef,core_1.ChangeDetectorRef])],fieldMediaFileImage)}(fieldGeneric);exports.fieldMediaFileImage=fieldMediaFileImage;var FieldMessagesComponent=function(){function e(e,t,s,i){this.model=e,this.view=t,this.language=s,this.fielderrorgroup=i,this.fieldname="",this._messages=[],this.errors=[],this.warnings=[],this.notices=[]}return e.prototype.ngOnInit=function(){var e=this;this.model.messageChange$.subscribe(function(){e.updateMessages()})},e.prototype.ngOnChanges=function(){this.updateMessages()},e.prototype.updateMessages=function(){var e;e=0==this._messages.length&&this.fieldname?this.model.getFieldMessages(this.fieldname)||[]:this._messages,this.errors=this.filterMessages(e,"error"),this.warnings=this.filterMessages(e,"warning"),this.notices=this.filterMessages(e,"notice"),this.fielderrorgroup&&this.fielderrorgroup.setError(this.fieldname,0!==this.errors.length)},e.prototype.filterMessages=function(e,t){return e.filter(function(e){return!t||e.type==t})},e.prototype.ngOnDestroy=function(){this.fielderrorgroup&&this.fielderrorgroup.setError(this.fieldname,!1)},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"fieldname",void 0),__decorate([core_1.Input("messages"),__metadata("design:type",Object)],e.prototype,"_messages",void 0),e=__decorate([core_1.Component({selector:"field-messages",template:'<div *ngIf="errors.length > 0" class="slds-media slds-media-center slds-inline_icon_text slds-form-element__help"><div class="slds-media__figure"><span class="slds-icon_container"><system-utility-icon [icon]="\'error\'" [size]="\'x-small\'" [colorclass]="\'slds-icon-text-error\'"></system-utility-icon></span></div><div class="slds-media__body" *ngFor="let m of errors">{{m.message}}</div></div><div *ngIf="warnings.length > 0" class="slds-media slds-media-center slds-inline_icon_text slds-inline_icon_text--warning"><div class="slds-media__figure"><span class="slds-icon_container"><system-utility-icon [icon]="\'warning\'" [size]="\'x-small\'" [colorclass]="\'slds-icon-text-warning\'"></system-utility-icon></span></div><div class="slds-media__body" *ngFor="let m of warnings">{{m.message}}</div></div><div *ngIf="notices.length > 0" class="slds-media slds-media-center slds-inline_icon_text"><div class="slds-media__figure"><span class="slds-icon_container"><system-utility-icon [icon]="\'info\'" [size]="\'x-small\'"></system-utility-icon></span></div><div class="slds-media__body" *ngFor="let m of notices">{{m.message}}</div></div>'}),__param(3,core_1.Optional()),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.fielderrorgrouping])],e)}();exports.FieldMessagesComponent=FieldMessagesComponent;var FieldModuleLookupComponent=function(r){function e(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,i,l,o)||this;return n.model=e,n.view=t,n.popup=s,n.language=i,n.metadata=l,n.router=o,n.elementRef=a,n.renderer=d,n.relateIdField="",n.relateNameField="",n.module="",n._selected_item=null,n.show_search_results=!1,n.search_term="",n.select=new core_1.EventEmitter,n.popup.closePopup$.subscribe(function(){return n.closePopups()}),n}return __extends(e,r),e.prototype.ngOnInit=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);this.relateIdField=e.id_name,this.relateNameField=this.fieldname,this.module||(this.module=e.module)},e.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},e.prototype.closePopups=function(){this.clickListener(),this.model.data[this.relateIdField]&&(this.search_term=""),this.show_search_results=!1},e.prototype.onFocus=function(){var t=this;this.show_search_results=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},Object.defineProperty(e.prototype,"selected_item",{get:function(){return this._selected_item},set:function(e){e?(this._selected_item=e.data,this.relateNameField&&this.model.setField(this.relateNameField,e.text),this.relateIdField&&this.model.setField(this.relateIdField,e.id)):(this._selected_item=null,this.relateIdField&&this.model.setField(this.relateIdField,""),this.relateNameField&&this.model.setField(this.relateNameField,"")),this.select.emit(this.selected_item)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.selected_item&&this.selected_item.id?this.selected_item.id:this.relateIdField?this.model.data[this.relateIdField]:""},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"item_summary_text",{get:function(){return this.selected_item&&this.selected_item.summary_text?this.selected_item.summary_text:this.relateNameField?this.model.data[this.relateNameField]:""},enumerable:!0,configurable:!0}),e.prototype.goToDetail=function(){this.router.navigate(["/module/"+this.module+"/"+this.selected_item.id])},e.prototype.getSearchStyle=function(){if(this.show_search_results)return{width:this.elementRef.nativeElement.getBoundingClientRect().width+"px",display:"block"}},e.prototype.clear=function(){this.search_term="",this.selected_item=null},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"module",void 0),__decorate([core_1.Output(),__metadata("design:type",Object)],e.prototype,"select",void 0),e=__decorate([core_1.Component({selector:"field-module-lookup",template:'<div class="slds-truncate"><div *ngIf="!isEditMode()" [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><span><a href="javascript:void(0);" modelPopOver [module]="module" [id]="id" (click)="goToDetail()">{{value}}</a></span> <button *ngIf="isEditable()" style="float: right" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></ng-template></div><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-m-vertical--xx-small" [ngClass]="getFieldClass()"><div class="slds-form-element slds-lookup"><div *ngIf="id" class="slds-form-element__control"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon [module]="module" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{item_summary_text}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clear()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!id" class="slds-form-element__control slds-grid slds-box--border" [ngClass]="getFieldClass()"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="search_term" (blur)="closePopups()" (focus)="onFocus()" [placeholder]="\'Search \' + language.getModuleName(module)" role="combobox"></div></div></div><div *ngIf="show_search_results" class="slds-lookup__menu" [ngStyle]="getSearchStyle()"><field-lookup-recent *ngIf="!search_term" [module]="module" (selectedObject)="selected_item = $event"></field-lookup-recent><field-lookup-search *ngIf="search_term" [module]="module" [(searchterm)]="search_term" (selectedObject)="selected_item = $event"></field-lookup-search></div><field-messages [fieldname]="fieldname"></field-messages></div></div>',providers:[services_1.popup]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.popup,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer])],e)}(fieldGeneric);exports.FieldModuleLookupComponent=FieldModuleLookupComponent;var FieldSignatureComponent=function(a){function FieldSignatureComponent(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.signature_height=200,o.signature_width=400,o}return __extends(FieldSignatureComponent,a),FieldSignatureComponent.prototype.ngAfterViewInit=function(){var t=this;this.config&&(0<this.config.signature_width&&(this.signature_width=this.config.signature_width),0<this.config.signature_height&&(this.signature_height=this.config.signature_height),this.display_name_field=this.config.display_name_field),this.metadata.loadLibs("signature_pad").subscribe(function(e){t.pad=new SignaturePad(t.canvas.nativeElement,{backgroundColor:"rgb(255, 255, 255)"}),t.model.isLoading||!t.model.id?t.model.data$.subscribe(function(e){t.pad.fromDataURL(t.src)}):t.pad.fromDataURL(t.src)})},Object.defineProperty(FieldSignatureComponent.prototype,"config",{get:function(){return this.fieldconfig},enumerable:!0,configurable:!0}),Object.defineProperty(FieldSignatureComponent.prototype,"src",{get:function(){return this.value?"data:image/jpeg;base64,"+this.value:""},enumerable:!0,configurable:!0}),FieldSignatureComponent.prototype.undo=function(){var e=this.pad.toData();e&&(e.pop(),this.pad.fromData(e),this.convert())},FieldSignatureComponent.prototype.clear=function(){this.pad.clear(),this.convert()},FieldSignatureComponent.prototype.convert=function(){var e=this.pad.toDataURL("image/jpeg"),t=e.split("base64,");this.pad.isEmpty()?this.value="":2!=t.length?(console.warn("Failed to parse base64 code from data:",e),this.value=""):(e=t[1],this.value=e)},__decorate([core_1.ViewChild("canvas"),__metadata("design:type",core_1.ElementRef)],FieldSignatureComponent.prototype,"canvas",void 0),FieldSignatureComponent=__decorate([core_1.Component({selector:"field-signature",template:'<div *ngIf="!isEditMode()"><div style="position: relative; width: 400px;"><img *ngIf="value" [src]="src"><div style="position: absolute; top: 1px; right: 1px;"><button *ngIf="isEditable()" class="slds-button slds-button--icon" (click)="setEditMode()"><system-button-icon [icon]="\'edit\'"></system-button-icon></button></div></div></div><div [ngClass]="{\'slds-hide\': !isEditMode()}"><div [ngStyle]="{width: signature_width+\'px\'}"><div style="position: relative;"><canvas #canvas [width]="signature_width" [height]="signature_height" style="border: 1px solid;" (mouseup)="convert()" (touchend)="convert()"></canvas><div style="position: absolute; bottom: 3px; right: 3px;"><button class="slds-button slds-button--icon" (click)="undo()" title="undo"><system-button-icon [icon]="\'back\'"></system-button-icon></button> <button class="slds-button slds-button--icon" (click)="clear()" title="clear"><system-button-icon [icon]="\'close\'"></system-button-icon></button></div></div><div *ngIf="display_name_field" class="slds-text-align--center">{{model.data[display_name_field]}}</div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],FieldSignatureComponent)}(fieldGeneric);exports.FieldSignatureComponent=FieldSignatureComponent;var fieldServiceCategories=function(n){function fieldServiceCategories(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.backend=o,d.config=a,d.fields=["sysservicecategory_id1","sysservicecategory_id2","sysservicecategory_id3","sysservicecategory_id4"],d.show_tree=!1,d.show_search=!1,d.categories=[],d.config.getData("service_categories")?d.categories=d.config.getData("service_categories"):(d.config.setData("service_categories",[]),d.backend.getRequest("spiceui/core/servicecategories").subscribe(function(e){d.categories=e,d.config.setData("service_categories",e)})),d}return __extends(fieldServiceCategories,n),Object.defineProperty(fieldServiceCategories.prototype,"display_value",{get:function(){for(var e="",t=0,s=this.fields;t<s.length;t++){var i=s[t];if(!this.model.data[i]||!this.categories[this.model.data[i]])break;e+=this.language.getLabel(this.categories[this.model.data[i]].name)+"\\"}return e=e.substring(0,e.length-1)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldServiceCategories.prototype,"maxlevels",{get:function(){return this.fieldconfig.maxlevels?this.fieldconfig.maxlevels:3},enumerable:!0,configurable:!0}),fieldServiceCategories.prototype.checkUserAction=function(e){this.search?(this.show_tree=!1,this.show_search=!0):(this.show_tree=!0,this.show_search=!1)},fieldServiceCategories.prototype.chooseCategories=function(e){this.show_search=!1,this.show_tree=!1;for(var t=0;t<this.fields.length;t++)e[t]?this.model.setFieldValue(this.fields[t],e[t].id):this.model.setFieldValue(this.fields[t],"");this.search=null;for(t=e.length-1;0<=t;t--){var s=e[t];if(s.servicequeue_id){this.model.setFieldValue("servicequeue_id",s.servicequeue_id),this.model.setFieldValue("servicequeue_name",s.servicequeue_name);break}}},fieldServiceCategories.prototype.unchooseCategories=function(){for(var e=0;e<this.fields.length;e++)this.model.data[this.fields[e]]=""},fieldServiceCategories=__decorate([core_1.Component({selector:"field-service-categories",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()">{{display_value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-m-vertical--xx-small" [ngClass]="getFieldClass()"><div class="slds-form-element__control"><div class="slds-combobox_container slds-has-inline-listbox"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-combobox-lookup"><div *ngIf="display_value" class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-pill__label">{{display_value}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="unchooseCategories()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!display_value" class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"><input class="slds-input slds-combobox__input" type="search" placeholder="{{language.getLabel(\'LBL_SEARCH\')}}" [(ngModel)]="search" (click)="checkUserAction($event)" (keyup)="checkUserAction($event)"></div><div *ngIf="show_tree"><field-service-category-tree [maxlevels]="maxlevels" (choose)="chooseCategories($event)"></field-service-category-tree></div><div *ngIf="show_search"><field-service-category-search [search]="search" (choose)="chooseCategories($event)"></field-service-category-search></div></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.configurationService])],fieldServiceCategories)}(fieldGeneric);exports.fieldServiceCategories=fieldServiceCategories;var fieldServiceCategoryTree=function(){function e(e,t,s,i){var l=this;this.model=e,this.backend=t,this.config=s,this.language=i,this.category_tree=[],this.maxlevels=4,this.levels=[],this.selected_categorys=[],this.choose_emitter=new core_1.EventEmitter,this.loading=!0,this.resetLevels(),this.config.getData("service_category_tree")?(this.category_tree=this.config.getData("service_category_tree"),this.levels[0]=this.category_tree,this.loading=!1):this.backend.getRequest("spiceui/core/servicecategories/tree").subscribe(function(e){l.config.setData("service_category_tree",e),l.category_tree=e,l.levels[0]=l.category_tree,l.loading=!1})}return e.prototype.resetLevels=function(e){void 0===e&&(e=0);for(var t=e;t<this.maxlevels;t++)this.levels[t]=[];this.selected_categorys.splice(e,this.maxlevels-e)},e.prototype.select=function(e){(this.selected_categorys[e.level]=e).categories?(this.levels[e.level+1]=e.categories,this.resetLevels(e.level+2)):this.resetLevels(e.level+1)},e.prototype.choose=function(e){this.selected_categorys[e.level]=e,this.choose_emitter.emit(this.selected_categorys)},e.prototype.isCategorySelected=function(e){for(var t=0,s=this.selected_categorys;t<s.length;t++){if(s[t].id==e.id)return!0}return!1},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"maxlevels",void 0),__decorate([core_1.Output("choose"),__metadata("design:type",Object)],e.prototype,"choose_emitter",void 0),e=__decorate([core_1.Component({selector:"field-service-category-tree",template:'<div class="slds-listbox slds-listbox_vertical slds-dropdown_fluid slds-grid" role="listbox"><div *ngIf="loading" class="slds-p-around--small slds-align--absolute-center"><system-spinner></system-spinner></div><div *ngFor="let lvl of levels; let i = index" class="slds-col slds-size--1-of-{{maxlevels}}" [ngClass]="{\'slds-border--right\': i < max_levels -1}"><div *ngFor="let cat of lvl" [ngClass]="{\'slds-theme--shade\': isCategorySelected(cat)}"><div class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small" (mouseenter)="select(cat)"><span *ngIf="cat.selectable == 0 && cat.categories" class="slds-truncate" style="cursor: default;">{{language.getLabel(cat.name)}}</span> <span *ngIf="cat.selectable == 1 || !cat.categories" (click)="choose(cat)" class="slds-truncate" style="cursor: pointer; text-decoration: underline;">{{language.getLabel(cat.name)}}</span><system-utility-icon class="slds-m-left--small" *ngIf="cat.favorite == 1" [icon]="\'favorite\'" [size]="\'xx-small\'"></system-utility-icon><system-utility-icon class="slds-col--bump-left" *ngIf="cat.categories" [icon]="\'chevronright\'" [size]="\'xx-small\'"></system-utility-icon></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.backend,services_1.configurationService,services_1.language])],e)}();exports.fieldServiceCategoryTree=fieldServiceCategoryTree;var fieldServiceCategorySearch=function(){function e(e,t,s,i){var l=this;this.model=e,this.backend=t,this.config=s,this.language=i,this.categories=[],this.selected_categorys=[],this.choose_emitter=new core_1.EventEmitter,this.config.getData("service_category_tree")?this.flatteningOutCategoryTree(this.config.getData("service_category_tree")):this.backend.getRequest("spiceui/core/servicecategories/tree").subscribe(function(e){l.config.setData("service_category_tree",e),l.flatteningOutCategoryTree(e)})}return Object.defineProperty(e.prototype,"results",{get:function(){var t=this;return this.categories.filter(function(e){return e.display_name.includes(t.search)})},enumerable:!0,configurable:!0}),e.prototype.flatteningOutCategoryTree=function(e){for(var t=0,s=e;t<s.length;t++){var i=s[t];i.parents=[],this.loopThroughTree(i)}},e.prototype.loopThroughTree=function(e){if(e.display_name="",0<e.parents.length)for(var t=0,s=e.parents;t<s.length;t++){var i=s[t];e.display_name+=this.language.getLabel(i.name)+"\\"}if(e.display_name+=this.language.getLabel(e.name),this.categories.push(e),e.categories)for(var l=0,o=e.categories;l<o.length;l++){var a=o[l];a.parents=e.parents.slice(),a.parents.push(e),this.loopThroughTree(a)}},e.prototype.choose=function(e){var t=e.parents.slice();t.push(e),this.choose_emitter.emit(t)},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"search",void 0),__decorate([core_1.Output("choose"),__metadata("design:type",Object)],e.prototype,"choose_emitter",void 0),e=__decorate([core_1.Component({selector:"field-service-category-search",template:'<div role="listbox"><ul class="slds-listbox slds-dropdown_fluid" role="presentation"><li *ngFor="let cat of results" class="slds-listbox__item" role="presentation"><span class="slds-listbox__option slds-listbox__option_entity" role="option" (click)="choose(cat)"><span class="slds-p-left--medium slds-listbox__option-text slds-listbox__option-text_entity">{{language.getLabel(cat.display_name)}}</span></span></li><li *ngIf="results.length == 0" class="slds-listbox__item"><span class="slds-p-left--medium">No Matches found.</span></li></ul></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.backend,services_1.configurationService,services_1.language])],e)}();exports.fieldServiceCategorySearch=fieldServiceCategorySearch;var fieldWorklog=function(n){function fieldWorklog(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.session=o,d.userpreferences=a,d.origin_logs=[],d.view.isEditMode()&&d.view.mode$.subscribe(function(e){"edit"==e&&(d.origin_logs=d.logs)}),d}return __extends(fieldWorklog,n),fieldWorklog.prototype.ngOnInit=function(){n.prototype.ngOnInit.call(this),this.view.isEditMode()&&(this.origin_logs=this.logs)},Object.defineProperty(fieldWorklog.prototype,"logs",{get:function(){return this.value?"string"==typeof this.value?JSON.parse(this.value):this.value:[]},set:function(e){"json"!=this.field_defs.type?this.value=JSON.stringify(e):this.value=e},enumerable:!0,configurable:!0}),Object.defineProperty(fieldWorklog.prototype,"new_log_entry",{set:function(e){this._new_log_entry=e;var t=this.origin_logs.slice();t.unshift({timestamp:+new Date,user_name:this.session.authData.userName,user_id:this.session.authData.userId,text:e}),this.logs=t},enumerable:!0,configurable:!0}),Object.defineProperty(fieldWorklog.prototype,"styles",{get:function(){return{height:this.fieldconfig.height?this.fieldconfig.height+"px":"200px"}},enumerable:!0,configurable:!0}),fieldWorklog.prototype.formatTimestamp=function(e){var t=moment(e);return this.userpreferences.formatDateTime(t)},fieldWorklog=__decorate([core_1.Component({selector:"field-worklog",template:'<div *ngIf="!isEditMode()"><div class="slds-scrollable--y" [ngStyle]="styles"><div *ngFor="let log of logs" class="slds-p-around--x-small slds-border--bottom"><div class="slds-p-around--x-small slds-theme--shade">{{log.user_name}} • {{formatTimestamp(log.timestamp)}}</div><div class="slds-p-around--x-small" style="white-space: pre-line;">{{log.text}}</div></div></div></div><div *ngIf="isEditMode()"><div class="slds-grid"><div class="slds-form-element slds-size--1-of-2 slds-m-right--xx-small"><div class="slds-form-element__control"><textarea class="slds-textarea" placeholder="Write your log here..." [(ngModel)]="new_log_entry" [ngStyle]="styles"></textarea></div></div><div class="slds-size--1-of-2 slds-scrollable--y slds-m-left--xx-small" [ngStyle]="styles"><div *ngFor="let log of logs" class="slds-p-around--x-small slds-border--bottom"><div class="slds-p-around--x-small slds-theme--shade">{{log.user_name}} • {{formatTimestamp(log.timestamp)}}</div><div class="slds-p-around--x-small">{{log.text}}</div></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.session,services_1.userpreferences])],fieldWorklog)}(fieldGeneric);exports.fieldWorklog=fieldWorklog;var FieldModelInfoComponent=function(){function FieldModelInfoComponent(e,t){this.model=e,this.language=t}return FieldModelInfoComponent=__decorate([core_1.Component({selector:"field-model-info",template:'<div class="slds-icon_container" modelPopOver><system-utility-icon [icon]="\'info\'" [size]="\'x-small\'"></system-utility-icon></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.language])],FieldModelInfoComponent)}();exports.FieldModelInfoComponent=FieldModelInfoComponent;var FieldEnumModulesComponent=function(a){function FieldEnumModulesComponent(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(FieldEnumModulesComponent,a),FieldEnumModulesComponent.prototype.getValue=function(){return this.language.getModuleName(this.value,!0)},FieldEnumModulesComponent.prototype.ngOnInit=function(){this.getOptions()},FieldEnumModulesComponent.prototype.getOptions=function(){for(var e=0,t=this.metadata.getModules();e<t.length;e++){var s=t[e];this.options.push({value:s,display:this.language.getModuleName(s,!0)})}this.options.sort(function(e,t){return e.display>t.display?1:-1}),this.isEditMode()&&0<this.options.length&&!this.value&&(this.value=this.options[0].value)},FieldEnumModulesComponent=__decorate([core_1.Component({selector:"field-enum-modules",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [fieldid]="fieldid">{{getValue()}}</field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select #focus class="slds-select" [(ngModel)]="value"><option *ngFor="let o of options" [value]="o.value">{{o.display}}</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],FieldEnumModulesComponent)}(fieldEnum);exports.FieldEnumModulesComponent=FieldEnumModulesComponent;var FieldEnumOutputTemplates=function(d){function FieldEnumOutputTemplates(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.backend=o,a.isLoaded=!1,a.items=[],a.select$=new core_1.EventEmitter,a._selected_item=null,a}return __extends(FieldEnumOutputTemplates,d),Object.defineProperty(FieldEnumOutputTemplates.prototype,"subjectField",{get:function(){return this.fieldconfig.subject?this.fieldconfig.subject:"name"},enumerable:!0,configurable:!0}),Object.defineProperty(FieldEnumOutputTemplates.prototype,"bodyField",{get:function(){return this.fieldconfig.body?this.fieldconfig.body:"description_html"},enumerable:!0,configurable:!0}),Object.defineProperty(FieldEnumOutputTemplates.prototype,"isDisabled",{get:function(){return!this.isLoaded||!this.items},enumerable:!0,configurable:!0}),Object.defineProperty(FieldEnumOutputTemplates.prototype,"selected_item",{get:function(){return this._selected_item},set:function(e){this._selected_item=e,this.select$.emit(e),this.value=e.id},enumerable:!0,configurable:!0}),FieldEnumOutputTemplates.prototype.ngOnInit=function(){var l=this,e={searchfields:{join:"AND",conditions:[{field:"module_name",operator:"=",value:this.model.module}]}};this.backend.all("OutputTemplates",e).subscribe(function(e){if(l.items=e,!l.selected_item&&l.value)for(var t=0,s=l.items;t<s.length;t++){var i=s[t];l.value==i.id&&(l.selected_item=i)}}),this.isLoaded=!0},__decorate([core_1.Output("select"),__metadata("design:type",Object)],FieldEnumOutputTemplates.prototype,"select$",void 0),FieldEnumOutputTemplates=__decorate([core_1.Component({selector:"field-output-templates",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><ng-container *ngIf="selected_item">{{selected_item.name}} ({{selected_item.language}})</ng-container></field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [disabled]="isDisabled" [(ngModel)]="selected_item"><option *ngFor="let item of items" [ngValue]="item">{{item.name}} ({{item.language}})</option></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],FieldEnumOutputTemplates)}(fieldGeneric);exports.FieldEnumOutputTemplates=FieldEnumOutputTemplates;var fieldGDPR=function(n){function fieldGDPR(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.backend=o,d.modal=a,d.gdprData={},d.loaded=!1,d}return __extends(fieldGDPR,n),fieldGDPR.prototype.ngOnInit=function(){var t=this;this.backend.getRequest("gdpr/"+this.model.module+"/"+this.model.id).subscribe(function(e){t.gdprData=e,t.loaded=!0})},fieldGDPR.prototype.getDataStyle=function(){if(!this.loaded)return{};if("1"==this.model.data.gdpr_data_agreement)return{"background-color":"#009900",color:"white",cursor:"pointer"};if(this.gdprData&&this.gdprData.related)for(var e=0,t=this.gdprData.related;e<t.length;e++){if("1"==t[e].gdpr_data_agreement)return{"background-color":"#009900",color:"white",cursor:"pointer"}}return{"background-color":"#cc0000",color:"white",cursor:"pointer"}},fieldGDPR.prototype.getMarketingStyle=function(){if(!this.loaded)return{};if("g"==this.model.data.gdpr_marketing_agreement)return{"background-color":"#009900",color:"white",cursor:"pointer"};if("r"==this.model.data.gdpr_marketing_agreement)return{"background-color":"#cc0000",color:"white",cursor:"pointer"};if(this.gdprData.related)for(var e=0,t=this.gdprData.related;e<t.length;e++){if("1"==t[e].gdpr_marketing_agreement)return{"background-color":"#009900",color:"white",cursor:"pointer"}}return{"background-color":"#cc0000",color:"white",cursor:"pointer"}},fieldGDPR.prototype.showDetails=function(){var t=this;this.modal.openModal("ObjectGDPRModal").subscribe(function(e){e.instance.gdprLog=t.gdprData.related})},fieldGDPR=__decorate([core_1.Component({selector:"field-gdpr",template:'<div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread slds-p-vertical--xxx-small"><span class="slds-badge" [ngStyle]="getDataStyle()" (click)="showDetails()">{{language.getLabel(\'LBL_DATA\')}}</span> <span class="slds-badge" [ngStyle]="getMarketingStyle()" (click)="showDetails()">{{language.getLabel(\'LBL_MARKETING\')}}</span></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.modal])],fieldGDPR)}(fieldGeneric);exports.fieldGDPR=fieldGDPR;var fieldServiceQueue=function(d){function fieldServiceQueue(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.router=l,a.modal=o,a}return __extends(fieldServiceQueue,d),Object.defineProperty(fieldServiceQueue.prototype,"canChange",{get:function(){if(this.model.data.acl&&!this.model.data.acl.edit)return!1;var e=this.model.getField("resolve_date");return!(e&&e.isValid&&e.isValid())&&!this.model.isEditing},enumerable:!0,configurable:!0}),fieldServiceQueue.prototype.selectQueue=function(){var t=this;this.canChange&&this.modal.openModal("ServiceSelectQueueModal").subscribe(function(e){e.instance.parentqueue_id=t.model.getField(t.metadata.getFieldDefs(t.model.module,t.fieldname).id_name),e.instance.displaynote=!t.view.isEditMode(),e.instance.selectedqueue.subscribe(function(e){0!=e&&(t.model.setField(t.metadata.getFieldDefs(t.model.module,t.fieldname).id_name,e.servicequeue_id),t.model.setField(t.fieldname,e.servicequeue_name),t.model.isEditing||t.model.save())})})},fieldServiceQueue=__decorate([core_1.Component({selector:"field-servicequeue",template:'<div [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><div class="slds-grid slds-grid--vertical-align-center slds-grid--align-spread"><div class="slds-truncate" (click)="goRecord()" style="min-height: 20px;" [ngClass]="{\'slds-text-link_faux\': link}">{{value}}</div><button style="float: right" class="slds-button slds-button--icon slds-m-left--xx-small" [disabled]="!canChange" (click)="selectQueue()"><system-button-icon [icon]="\'change_record_type\'"></system-button-icon></button></div></ng-template></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.modal])],fieldServiceQueue)}(fieldGeneric);exports.fieldServiceQueue=fieldServiceQueue;var fieldTerritory=function(c){function fieldTerritory(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.elementRef=o,r.renderer=a,r.modal=d,r.territories=n,r.territorySearchOpen=!1,r.territorySearchTerm="",r}return __extends(fieldTerritory,c),fieldTerritory.prototype.ngOnInit=function(){this.metadata.getFieldDefs(this.model.module,this.fieldname)},fieldTerritory.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||this.closePopups()},fieldTerritory.prototype.closePopups=function(){this.clickListener(),this.value&&(this.territorySearchTerm=""),this.territorySearchOpen=!1},fieldTerritory.prototype.clearField=function(){this.value=""},fieldTerritory.prototype.onFocus=function(){var t=this;this.territorySearchOpen=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},Object.defineProperty(fieldTerritory.prototype,"territoryName",{get:function(){return this.model.getFieldValue(this.fieldname+"_name")},enumerable:!0,configurable:!0}),fieldTerritory.prototype.setTerritory=function(e){this.territorySearchOpen=!1,this.territorySearchTerm="",this.value=e.id,this.model.setField(this.fieldname+"_name",e.name)},fieldTerritory.prototype.openSearchModal=function(){this.territorySearchOpen=!1,this.clickListener()},fieldTerritory=__decorate([core_1.Component({selector:"field-territory",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{territoryName}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-m-vertical--xx-small" [ngClass]="getFieldClass()"><div class="slds-combobox_container"><div class="slds-form-element slds-lookup"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" [ngClass]="{\'slds-is-open\': territorySearchOpen && territorySearchTerm}" role="combobox"><div *ngIf="value" class="slds-form-element__control"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-icon_container slds-icon-standard-account slds-pill__icon_container"><system-icon icon="service_territory" [size]="\'small\'"></system-icon></span> <span class="slds-pill__label">{{territoryName}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="clearField()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!value" class="slds-form-element__control slds-grid slds-box--border" [ngClass]="getFieldClass()"><div class="slds-input-has-icon slds-input-has-icon--right slds-grow"><system-utility-icon [icon]="\'search\'" [addclasses]="\'slds-input__icon\'" (click)="openSearchModal()"></system-utility-icon><input type="search" class="slds-lookup__search-input slds-input--bare" [(ngModel)]="territorySearchTerm" (focus)="onFocus()" [placeholder]="\'Search Territories\'" role="combobox"></div></div><div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" role="listbox"><field-territory-search [searchterm]="territorySearchTerm" (selectedTerritory)="setTerritory($event)"></field-territory-search></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer,services_1.modal,services_1.territories])],fieldTerritory)}(fieldGeneric);exports.fieldTerritory=fieldTerritory;var fieldTerritorySearch=function(){function e(e,t,s,i,l,o){this.metadata=e,this.model=t,this.fts=s,this.language=i,this.modal=l,this.territories=o,this.searchTerm="",this.searchTimeout={},this.searchterritories=[],this.selectedTerritory=new core_1.EventEmitter}return Object.defineProperty(e.prototype,"searchterm",{set:function(e){var t=this;this.searchTerm=e,this.searchTimeout&&window.clearTimeout(this.searchTimeout),this.searchTimeout=window.setTimeout(function(){return t.doSearch()},500)},enumerable:!0,configurable:!0}),e.prototype.doSearch=function(){var e=[];e.push(this.model.getFieldValue("spiceacl_primary_territory"));for(var t=this.model.getFieldValue("spiceacl_secondary_territories"),s=0,i=JSON.parse(t||"[]");s<i.length;s++){var l=i[s];e.push(l.id)}this.searchterritories=this.territories.searchTerritories(this.model.module,this.searchTerm,5,e)},e.prototype.setTerritory=function(e){this.searchTerm="",this.selectedTerritory.emit(e)},__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],e.prototype,"selectedTerritory",void 0),__decorate([core_1.Input(),__metadata("design:type",Object),__metadata("design:paramtypes",[Object])],e.prototype,"searchterm",null),e=__decorate([core_1.Component({selector:"field-territory-search",template:'<ul class="slds-lookup__list" role="listbox"><li role="presentation"><div class="slds-lookup__item-action slds-media" role="option" (click)="openModal()"><div class="slds-grid slds-grid--vertical-align-center"><system-icon [icon]="\'search\'" [sprite]="\'utility\'" [size]="\'x-small\'" [addclasses]="\'slds-m-vertical--xxx-small slds-m-horizontal--xx-small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">"{{searchTerm}}" in {{language.getModuleName(\'SpiceACLTerritories\')}}</div></div></div></div></li><li *ngFor="let searchterritory of searchterritories" role="presentation" (click)="setTerritory(searchterritory)"><span class="slds-lookup__item-action slds-media" role="option"><system-icon icon="service_territory" [size]="\'small\'"></system-icon><div class="slds-media__body"><div class="slds-lookup__result-text">{{searchterritory.name}}</div></div></span></li></ul>'}),__metadata("design:paramtypes",[services_1.metadata,services_1.model,services_1.fts,services_1.language,services_1.modal,services_1.territories])],e)}();exports.fieldTerritorySearch=fieldTerritorySearch;var fieldSelectTree=function(c){function fieldSelectTree(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.backend=o,r.config=a,r.elementRef=d,r.renderer=n,r.fields=[],r.show_tree=!1,r.show_search=!1,r.sel_fields=[],r}return __extends(fieldSelectTree,c),fieldSelectTree.prototype.ngOnInit=function(){var t=this;this.fields.length<1&&(this.fields.push(this.fieldconfig.value1),this.fields.push(this.fieldconfig.value2),this.fields.push(this.fieldconfig.value3),this.fields.push(this.fieldconfig.value4)),this.config.getData("select_tree")?this.sel_fields=this.config.getData("select_tree"):(this.config.setData("select_tree",[]),this.backend.getRequest("spiceui/core/selecttree/list/"+this.fieldconfig.key).subscribe(function(e){t.sel_fields=e,t.config.setData("select_tree",e)}))},Object.defineProperty(fieldSelectTree.prototype,"display_value",{get:function(){for(var e="",t=0,s=this.fields;t<s.length;t++){var i=s[t];if(!this.model.data[i])break;e+=this.language.getLabel(this.model.data[i])+" \\ "}return e=e.substring(0,e.length-2)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldSelectTree.prototype,"maxlevels",{get:function(){return this.fieldconfig.maxlevels?this.fieldconfig.maxlevels:4},enumerable:!0,configurable:!0}),fieldSelectTree.prototype.checkUserAction=function(e){this.search?(this.show_tree=!1,this.show_search=!0):(this.show_tree=!0,this.show_search=!1)},fieldSelectTree.prototype.chooseSelField=function(e){this.show_search=!1,this.show_tree=!1;for(var t=0;t<this.fields.length;t++)e[t]?this.model.setFieldValue(this.fields[t],e[t].name):this.model.setFieldValue(this.fields[t],"");this.search=null},fieldSelectTree.prototype.unchooseSelField=function(){for(var e=0;e<this.fields.length;e++)this.model.data[this.fields[e]]=""},fieldSelectTree.prototype.onClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.show_tree=!1)},fieldSelectTree.prototype.onFocus=function(){var t=this;this.show_tree=!0,this.clickListener=this.renderer.listenGlobal("document","click",function(e){return t.onClick(e)})},fieldSelectTree=__decorate([core_1.Component({selector:"select-tree",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()">{{display_value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-m-vertical--xx-small" [ngClass]="getFieldClass()"><div class="slds-form-element__control"><div class="slds-combobox_container slds-has-inline-listbox"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click slds-combobox-lookup slds-size_2-of-2" aria-expanded="false" aria-haspopup="listbox" role="combobox"><div *ngIf="display_value" class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"><div class="slds-pill_container"><span class="slds-pill slds-size--1-of-1"><span class="slds-pill__label">{{display_value}}</span> <button class="slds-button slds-button--icon slds-pill__remove" (click)="unchooseSelField()"><system-button-icon [icon]="\'close\'"></system-button-icon></button></span></div></div><div *ngIf="!display_value" class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right"><input (focus)="onFocus()" class="slds-input slds-combobox__input" type="search" placeholder="{{language.getLabel(\'LBL_SEARCH\')}}" [(ngModel)]="search" (click)="checkUserAction($event)" (keyup)="checkUserAction($event)"></div><div *ngIf="show_tree" class="slds-dropdown dropdown-trigger_click slds-dropdown_length-with-icon-1 slds-dropdown_fluid" style="display: block"><select-tree-tree [treekey]="fieldconfig.key" [maxlevels]="maxlevels" (choose)="chooseSelField($event)"></select-tree-tree></div><div *ngIf="show_search" class="slds-dropdown dropdown-trigger_click slds-dropdown_length-with-icon-1 slds-dropdown_fluid" style="display: block"><select-tree-search [treekey]="fieldconfig.key" [search]="search" (choose)="chooseSelField($event)"></select-tree-search></div></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,services_1.configurationService,core_1.ElementRef,core_1.Renderer])],fieldSelectTree)}(fieldGeneric);exports.fieldSelectTree=fieldSelectTree;var fieldSelectTreeSearch=function(){function e(e,t,s,i){this.model=e,this.backend=t,this.config=s,this.language=i,this.sel_fields=[],this.selected_categorys=[],this.choose_emitter=new core_1.EventEmitter}return e.prototype.ngOnInit=function(){var t=this;this.config.getData("select_tree_tree")?this.flatteningOutCategoryTree(this.config.getData("select_tree_tree")):this.backend.getRequest("spiceui/core/selecttree/tree/"+this.treekey).subscribe(function(e){t.config.setData("select_tree_tree",e),t.flatteningOutCategoryTree(e)})},Object.defineProperty(e.prototype,"results",{get:function(){var t=this;return this.sel_fields.filter(function(e){return e.display_name.includes(t.search)})},enumerable:!0,configurable:!0}),e.prototype.flatteningOutCategoryTree=function(e){for(var t=0,s=e;t<s.length;t++){var i=s[t];i.parents=[],this.loopThroughTree(i)}},e.prototype.loopThroughTree=function(e){if(e.display_name="",0<e.parents.length)for(var t=0,s=e.parents;t<s.length;t++){var i=s[t];e.display_name+=this.language.getLabel(i.name)+"\\"}if(e.display_name+=this.language.getLabel(e.name),this.sel_fields.push(e),e.childs)for(var l=0,o=e.childs;l<o.length;l++){var a=o[l];a.parents=e.parents.slice(),a.parents.push(e),this.loopThroughTree(a)}},e.prototype.choose=function(e){var t=e.parents.slice();t.push(e),this.choose_emitter.emit(t)},__decorate([core_1.Input(),__metadata("design:type",String)],e.prototype,"search",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"treekey",void 0),__decorate([core_1.Output("choose"),__metadata("design:type",Object)],e.prototype,"choose_emitter",void 0),e=__decorate([core_1.Component({selector:"select-tree-search",template:'<div class="slds-dropdown_fluid" role="listbox"><ul class="slds-listbox slds-dropdown_fluid" role="presentation"><li *ngFor="let cat of results" class="slds-listbox__item" role="presentation"><span class="slds-listbox__option slds-listbox__option_entity" role="option" (click)="choose(cat)"><span class="slds-p-left--medium slds-listbox__option-text slds-listbox__option-text_entity">{{language.getLabel(cat.display_name)}}</span></span></li><li *ngIf="results.length == 0" class="slds-listbox__item"><span class="slds-p-left--medium">No Matches found.</span></li></ul></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.backend,services_1.configurationService,services_1.language])],e)}();exports.fieldSelectTreeSearch=fieldSelectTreeSearch;var fieldSelectTreeTree=function(){function e(e,t,s,i){this.model=e,this.backend=t,this.config=s,this.language=i,this.select_tree=[],this.maxlevels=4,this.levels=[],this.selected_fields=[],this.choose_emitter=new core_1.EventEmitter,this.loading=!0,this.resetLevels()}return e.prototype.ngOnInit=function(){var t=this;if(this.config.getData("select_tree_tree")){var e=this.config.getData("select_tree_tree");e.sort(function(e,t){var s=e.name.toLowerCase(),i=t.name.toLowerCase();return s<i?-1:i<s?1:0}),this.levels[0]=e,this.loading=!1}else this.backend.getRequest("spiceui/core/selecttree/tree/"+this.treekey).subscribe(function(e){t.config.setData("select_tree_tree",e),t.select_tree=e,t.select_tree.sort(function(e,t){var s=e.name.toLowerCase(),i=t.name.toLowerCase();return s<i?-1:i<s?1:0}),t.levels[0]=t.select_tree,t.loading=!1})},e.prototype.resetLevels=function(e){void 0===e&&(e=0);for(var t=e;t<this.maxlevels;t++)this.levels[t]=[];this.selected_fields.splice(e,this.maxlevels-e)},e.prototype.select=function(e){(this.selected_fields[e.level]=e).childs?(this.levels[e.level+1]=e.childs,this.resetLevels(e.level+2)):this.resetLevels(e.level+1)},e.prototype.choose=function(e){this.selected_fields[e.level]=e,this.choose_emitter.emit(this.selected_fields)},e.prototype.isCategorySelected=function(e){for(var t=0,s=this.selected_fields;t<s.length;t++){if(s[t].id==e.id)return!0}return!1},__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"maxlevels",void 0),__decorate([core_1.Input(),__metadata("design:type",Object)],e.prototype,"treekey",void 0),__decorate([core_1.Output("choose"),__metadata("design:type",Object)],e.prototype,"choose_emitter",void 0),e=__decorate([core_1.Component({selector:"select-tree-tree",template:'<div class="slds-dropdown_fluid" role="listbox"><div *ngIf="loading" class="slds-p-around--small slds-align--absolute-center"><system-spinner></system-spinner></div><div *ngFor="let lvl of levels; let i = index" class="slds-col slds-size--1-of-{{maxlevels}}" [ngClass]="{\'slds-border--right\': i < maxlevels -1}"><div *ngFor="let cat of lvl" [ngClass]="{\'slds-theme--shade\': isCategorySelected(cat)}"><div class="slds-grid slds-grid--vertical-align-center slds-p-around--xx-small" (mouseenter)="select(cat)"><span *ngIf="cat.selectable == 0 && cat.childs" class="slds-truncate" style="cursor: default;">{{language.getLabel(cat.name)}}</span> <span *ngIf="cat.selectable == 1 || !cat.childs" (click)="choose(cat)" class="slds-truncate" style="cursor: pointer; text-decoration: underline;">{{language.getLabel(cat.name)}}</span><system-utility-icon class="slds-m-left--small" *ngIf="cat.favorite == 1" [icon]="\'favorite\'" [size]="\'xx-small\'"></system-utility-icon><system-utility-icon class="slds-col--bump-left" *ngIf="cat.childs" [icon]="\'chevronright\'" [size]="\'xx-small\'"></system-utility-icon></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.backend,services_1.configurationService,services_1.language])],e)}();exports.fieldSelectTreeTree=fieldSelectTreeTree;var fieldTerritorySecondaryPipe=function(){function e(){}return e.prototype.transform=function(e,t){for(var s=[],i=0,l=e;i<l.length;i++){var o=l[i];o.id!=t&&s.push(o)}return s},e=__decorate([core_1.Pipe({name:"fieldterritorysecondarypipe",pure:!1})],e)}();exports.fieldTerritorySecondaryPipe=fieldTerritorySecondaryPipe;var fieldTerritorySecondary=function(c){function fieldTerritorySecondary(e,t,s,i,l,o,a,d,n){var r=c.call(this,e,t,s,i,l)||this;return r.model=e,r.view=t,r.language=s,r.metadata=i,r.router=l,r.backend=o,r.renderer=a,r.elementRef=d,r.territoriesService=n,r.isAdding=!1,r.territorySearchOpen=!1,r.territorySearchTerm="",r.currentHash="",r}return __extends(fieldTerritorySecondary,c),Object.defineProperty(fieldTerritorySecondary.prototype,"primary_territory_id",{get:function(){return this.model.getFieldValue("spiceacl_primary_territory")},enumerable:!0,configurable:!0}),Object.defineProperty(fieldTerritorySecondary.prototype,"territories",{get:function(){try{return JSON.parse(this.model.data.spiceacl_secondary_territories)}catch(e){return[]}},set:function(e){this.model.data.spiceacl_secondary_territories=JSON.stringify(e||[])},enumerable:!0,configurable:!0}),fieldTerritorySecondary.prototype.onClick=function(){this.isAdding=!0},fieldTerritorySecondary.prototype.onBlur=function(){""==this.territorySearchTerm&&(this.isAdding=!1)},fieldTerritorySecondary.prototype.removeTerritory=function(e,s){e.preventDefault(),e.stopPropagation();var i=this.territories;i.some(function(e,t){if(e.id==s)return i.splice(t,1),!0}),this.territories=i},fieldTerritorySecondary.prototype.closeSearchDialog=function(){this.clickListener(),this.territorySearchOpen=!1},fieldTerritorySecondary.prototype.handleClick=function(e){this.elementRef.nativeElement.contains(e.target)||(this.closeSearchDialog(),this.territorySearchTerm="",this.isAdding=!1)},fieldTerritorySecondary.prototype.addTerritory=function(e){var t=this.territories;""==t&&(t=[]),t.push(e),this.territories=t,this.territorySearchTerm="",this.isAdding=!1},fieldTerritorySecondary=__decorate([core_1.Component({template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><ul class="slds-list_horizontal slds-has-dividers_left"><li *ngFor="let territory of territories|fieldterritorysecondarypipe:primary_territory_id" class="slds-item">{{territory.name}}</li></ul></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-grid slds-grid--align-spread slds-p-around--xx-small" [ngClass]="css_classes"><div class="slds-form-element__control slds-size--1-of-1"><div class="slds-combobox_container"><div class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" role="combobox" [ngClass]="{\'slds-is-open\':isAdding && territorySearchTerm}"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><div class="slds-pill_container" (click)="onClick()"><ul class="slds-listbox slds-listbox_horizontal" role="listbox"><li class="slds-listbox-item" role="presentation" *ngFor="let territory of territories|fieldterritorysecondarypipe:primary_territory_id"><span class="slds-pill" role="option"><span class="slds-icon_container"><system-icon icon="service_territory" size="x-small" divClass="slds-p-right--x-small"></system-icon></span> <span class="slds-pill__label">{{territory.name}}</span> <span class="slds-icon_container slds-pill__remove"><system-button-icon [icon]="\'close\'" (click)="removeTerritory($event, territory.id)"></system-button-icon></span></span></li><li class="slds-listbox-item" role="presentation"><input spoiceui-autofocus *ngIf="isAdding" type="text" style="min-width: 12rem;" class="slds-p-horizontal--x-small" [(ngModel)]="territorySearchTerm" (blur)="onBlur()" [placeholder]="language.getLabel(\'LBL_ADD_TERRITORY\')"></li></ul></div></div><div class="slds-dropdown slds-dropdown_fluid" role="listbox"><field-territory-search [searchterm]="territorySearchTerm" (selectedTerritory)="addTerritory($event)"></field-territory-search></div></div></div></div><field-messages [fieldname]="fieldname"></field-messages></div>',styles:["input, input:focus { border: none; outline: none;}"]}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend,core_1.Renderer2,core_1.ElementRef,services_1.territories])],fieldTerritorySecondary)}(fieldGeneric);exports.fieldTerritorySecondary=fieldTerritorySecondary;var fieldColorEnum=function(a){function fieldColorEnum(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.longOptions=[],o.options=[],o.colors=[],o}return __extends(fieldColorEnum,a),fieldColorEnum.prototype.getValue=function(){for(var e=0,t=this.options;e<t.length;e++){var s=t[e];if(s.value==this.value)return s.display}},fieldColorEnum.prototype.getColor=function(){if(this.colors)return this.colors[this.value]?this.colors[this.value]:"transparent"},fieldColorEnum.prototype.ngOnInit=function(){this.getOptions()},fieldColorEnum.prototype.getOptions=function(){this.longOptions=this.language.getFieldDisplayOptions(this.model.module,this.fieldname);var e=__assign({},this.longOptions);e&&!this.fieldconfig.useShort||(e=this.language.getDisplayOptions(this.fieldconfig.shortEnum)),this.colors=this.language.getDisplayOptions(this.fieldconfig.colorEnum);var t=[];for(var s in e)t.push({value:s,color:this.colors[s],display:e[s],long:this.longOptions[s]});this.options=t},fieldColorEnum=__decorate([core_1.Component({selector:"field-enum",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><div style="float: left; width: 10px; height: 10px; border-radius: 5px; margin-top: 5px; margin-right: 5px;" [ngStyle]="{\'background-color\': getColor()}"></div>{{getValue()}}</field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control" [ngClass]="getFieldClass()"><div class="slds-select_container slds-m-vertical--xx-small"><select class="slds-select" [(ngModel)]="value"><ng-container *ngFor="let o of options"><option [value]="o.value">{{o.long}}</option></ng-container></select></div><field-messages [fieldname]="fieldname"></field-messages></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldColorEnum)}(fieldGeneric);exports.fieldColorEnum=fieldColorEnum;var fieldBase64=function(n){function fieldBase64(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.footer=o,d.modalservice=a,d.speechRecognition=!1,d}return __extends(fieldBase64,n),Object.defineProperty(fieldBase64.prototype,"value",{get:function(){try{return decodeURIComponent(window.atob(this.model.getField(this.fieldname)))}catch(e){return""}},set:function(e){this.model.setField(this.fieldname,window.btoa(e))},enumerable:!0,configurable:!0}),fieldBase64.prototype.getTextAreaStyle=function(){var e={};return this.fieldconfig.minheight&&(e["min-height"]=this.fieldconfig.minheight),this.fieldconfig.maxheight&&(e["max-height"]=this.fieldconfig.maxheight),e},__decorate([core_1.ViewChild("textField",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldBase64.prototype,"textField",void 0),fieldBase64=__decorate([core_1.Component({selector:"field-base64",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><span style="white-space: normal;">{{value}}</span></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()" style="position:relative;"><textarea #textField class="slds-textarea slds-scrollable--y slds-m-vertical--xx-small" [(ngModel)]="value" [ngStyle]="getTextAreaStyle()"></textarea><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.footer,services_1.modal])],fieldBase64)}(fieldGeneric);exports.fieldBase64=fieldBase64;var fieldNotAuthorized=function(a){function fieldNotAuthorized(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldNotAuthorized,a),fieldNotAuthorized=__decorate([core_1.Component({selector:"field-not-authorized",template:'<field-generic-display [fielddisplayclass]="fielddisplayclass"><span class="slds-text-color_inverse-weak">{{language.getLabel(\'LBL_NOTAUTHORIZED\')}}</span></field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldNotAuthorized)}(fieldGeneric);exports.fieldNotAuthorized=fieldNotAuthorized;var fieldModuleIcon=function(a){function fieldModuleIcon(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o}return __extends(fieldModuleIcon,a),fieldModuleIcon=__decorate([core_1.Component({selector:"field-module-icon",template:'<div [ngClass]="fielddisplayclass"><system-stencil *ngIf="model.isLoading; else displaycontent"></system-stencil><ng-template #displaycontent><system-icon [module]="value" size="xx-small"></system-icon></ng-template></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldModuleIcon)}(fieldGeneric);exports.fieldModuleIcon=fieldModuleIcon;var fieldRichText=function(r){function fieldRichText(e,t,s,i,l,o,a,d){var n=r.call(this,e,t,s,i,l)||this;return n.model=e,n.view=t,n.language=s,n.metadata=i,n.router=l,n.zone=o,n.sanitized=a,n.modal=d,n.stylesheetField="",n.stylesheetToUse="",n.stylesheets=n.metadata.getHtmlStylesheetNames(),n}return __extends(fieldRichText,r),fieldRichText.prototype.ngOnInit=function(){var e=this.metadata.getFieldDefs(this.model.module,this.fieldname);_.isEmpty(e.stylesheet_id_field)||(this.stylesheetField=e.stylesheet_id_field),this.useStylesheets=!_.isEmpty(this.stylesheetField)&&!_.isEmpty(this.stylesheets),this.useStylesheets&&(1===this.stylesheets.length?this.stylesheetToUse=this.stylesheets[0].id:_.isEmpty(this.fieldconfig.stylesheetId)?this.stylesheetToUse=this.metadata.getHtmlStylesheetToUse(this.model.module,this.fieldname):this.stylesheetToUse=this.fieldconfig.stylesheetId),this.useStylesheetSwitcher=this.useStylesheets&&_.isEmpty(this.stylesheetToUse)},Object.defineProperty(fieldRichText.prototype,"htmlValue",{get:function(){return this.sanitized.bypassSecurityTrustHtml(this.value)},enumerable:!0,configurable:!0}),Object.defineProperty(fieldRichText.prototype,"stylesheetId",{get:function(){return _.isEmpty(this.model.data[this.stylesheetField])?this.stylesheetId=this.stylesheetToUse:this.model.data[this.stylesheetField]},set:function(e){e&&this.model.setField(this.stylesheetField,e)},enumerable:!0,configurable:!0}),fieldRichText.prototype.updateStylesheet=function(e){!_.isEmpty(this.stylesheetField)&&_.isString(e)&&this.model.setField(this.stylesheetField,e)},fieldRichText.prototype.getLabel=function(){if(this.fieldconfig.label){if(0<this.fieldconfig.label.indexOf(":")){var e=this.fieldconfig.label.split(":");return this.language.getLabel(e[1],e[0],this.view.labels)}return this.language.getLabel(this.fieldconfig.label,this.model.module,this.view.labels)}return this.language.getFieldDisplayName(this.model.module,this.fieldname,this.fieldconfig,this.view.labels)},__decorate([core_1.ViewChild("printframe",{read:core_1.ViewContainerRef}),__metadata("design:type",core_1.ViewContainerRef)],fieldRichText.prototype,"printframe",void 0),fieldRichText=__decorate([core_1.Component({selector:"field-richtext",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><div class="slds-size--1-of-1 slds-rich-text-editor__output" [innerHTML]="htmlValue" style="white-space: normal; height: 300px; resize: vertical; overflow-y: auto;"></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="getFieldClass()"><system-richtext-editor [(ngModel)]="value"></system-richtext-editor><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.NgZone,platform_browser_1.DomSanitizer,services_1.modal])],fieldRichText)}(fieldGeneric);exports.fieldRichText=fieldRichText;var fieldEnumMulti=function(n){function fieldEnumMulti(e,t,s,i,l,o,a){var d=n.call(this,e,t,s,i,l)||this;return d.model=e,d.view=t,d.language=s,d.metadata=i,d.router=l,d.elementRef=o,d.renderer=a,d.options=[],d.selectedValues=[],d.showSelect=!1,d}return __extends(fieldEnumMulti,n),fieldEnumMulti.prototype.ngOnInit=function(){var t=this;this.model.data$.subscribe(function(e){t.buildOptions()})},fieldEnumMulti.prototype.getValue=function(){for(var e=[],t=0,s=this.selectedValues;t<s.length;t++){var i=s[t];e.push(this.options[i])}return e.join(", ")},fieldEnumMulti.prototype.getValues=function(){var e=[];this.getValueArray();for(var t in this.options){for(var s=!1,i=0,l=this.selectedValues;i<l.length;i++){t==l[i]&&(s=!0)}e.push({id:this.model.generateGuid(),value:t,display:this.options[t],selected:s})}return e},fieldEnumMulti.prototype.getValueArray=function(){try{return this.model.data[this.fieldname].substring(1,this.model.data[this.fieldname].length-1).split("^,^")}catch(e){return[]}},fieldEnumMulti.prototype.buildOptions=function(){this.options=[],this.selectedValues=this.getValueArray(),this.options=this.language.getFieldDisplayOptions(this.model.module,this.fieldname)},fieldEnumMulti.prototype.clickedItem=function(e,t){t.stopPropagation(),""==this.selectedValues[0]&&(this.selectedValues=[]);var s=this.selectedValues.indexOf(e.value);-1==s?0<this.selectedValues.length?this.selectedValues.push(e.value):this.selectedValues=[e.value]:this.selectedValues.splice(s,1);var i=Object.assign([],this.selectedValues),l="";0<i.length&&(l="^"+i.join("^,^")+"^"),this.model.setFieldValue(this.fieldname,l)},fieldEnumMulti=__decorate([core_1.Component({selector:"field-enummulti",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig"><span>{{getValue()}}</span></field-generic-display><div *ngIf="isEditMode()" class="slds-form-element"><div class="slds-form-element__control"><div class="slds-combobox_container"><div tabindex="-1" class="slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click" dropdowntrigger aria-expanded="true" aria-haspopup="listbox" role="combobox"><div class="slds-combobox__form-element slds-input-has-icon slds-input-has-icon_right" role="none"><input type="text" class="slds-input slds-combobox__input-value" role="textbox" placeholder="Select an Option" [value]="getValue()"><system-icon icon="down" sprite="utility" addclasses="slds-input__icon slds-input__icon_right"></system-icon></div><div class="slds-dropdown slds-dropdown_length-5 slds-dropdown_fluid" role="listbox"><ul class="slds-listbox slds-listbox_vertical" role="presentation"><li *ngFor="let val of getValues()" (click)="clickedItem(val, $event)" role="presentation" class="slds-listbox__item"><div id="option1" class="slds-media slds-listbox__option slds-listbox__option_plain slds-media_small slds-is-selected" role="option"><span *ngIf="val.selected" class="slds-media__figure slds-listbox__option-icon"><span class="slds-icon_container slds-icon-utility-check slds-current-color"><system-icon icon="check" size="xx-small" sprite="utility" addclasses="slds-input__icon slds-input__icon_right"></system-icon></span></span> <span class="slds-media__body"><span class="slds-truncate" title="Accounts"><span class="slds-assistive-text"></span> {{val.display}}</span></span></div></li></ul></div></div></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,core_1.ElementRef,core_1.Renderer2])],fieldEnumMulti)}(fieldGeneric);exports.fieldEnumMulti=fieldEnumMulti;var fieldPhone=function(d){function fieldPhone(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,l)||this;return a.model=e,a.view=t,a.l=s,a.metadata=i,a.router=l,a.backend=o,a.invalid=!1,a}return __extends(fieldPhone,d),fieldPhone.prototype.makeCall=function(){""!=this.model.data[this.fieldname]&&this.backend.postRequest("asterisk/outgoingcall",{},{msisdn:this.value}).subscribe(function(e){console.log(e)})},fieldPhone=__decorate([core_1.Component({selector:"field-phone",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [editable]="isEditable()"><div class="slds-grid slds-grid--vertical-align-center"><div class="slds-truncate"><a [href]="\'tel:\'+value">{{value}}</a></div><system-icon class="slds-text-link_reset slds-p-left--x-small" *ngIf="value" [icon]="\'call\'" [sprite]="\'utility\'" [size]="\'x-small\'" (click)="makeCall()"></system-icon></div></field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control slds-p-around--xx-small" [ngClass]="css_classes"><input type="text" class="slds-input" [(ngModel)]="value" required minlength="3" [maxlength]="fieldlength" [ngModelOptions]="modelOptions"><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router,services_1.backend])],fieldPhone)}(fieldGeneric);exports.fieldPhone=fieldPhone;var fieldCronInterval=function(a){function fieldCronInterval(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.fieldDescription={min:"(0-59) allowed values; 0 is the top of the hour.\n(*) first-last (every minute).\n(,) a list of minutes; ie. 0,30 would be the 0 AND 30th minutes.\n(-) a range of minutes; ie. 0-5 would be minutes 0, 1, 2, 3, 4, and 5 (you can also specify a list of ranges 0-5,30-35).\n(/) step values will skip the specified number within a range; ie */5 is every 5 minutes, and 0-30/2 is every 2 minutes between 0 and 30 minutes.",hrs:"(0-23) allowed values; 0 is midnight.\n(*) first-last (every hour).\n(,) a list of hours; ie. 0,12 would be the 0 AND 12th hours.\n(-) a range of hours; ie. 19-23 would be hours 19, 20, 21, 22, and 23 (you can also specify a list of ranges 0-5,12-16).\n(/) step values will skip the specified number within a range; ie */4 is every 4 hours, and 0-20/2 is every 2 hours between 0 and the 20th hour.",date:"1-31) allowed values.\n(*) first-last (every day of the month).\n(,) a list of days; ie. 1,15 would be the 1st AND 15th day of the month.\n(-) a range of days; ie. 1-5 would be days 1, 2, 3, 4, and 5 (you can also specify a list of ranges 1-5,14-30).\n(/) step values will skip the specified number within a range; ie */4 is every 4 days, and 1-20/2 is every 2 days between 1st and the 20th day of the month.",mo:"(1-12) allowed values.\n(JAN-DEC) allowed values.\n(*) first-last (every month).\n(,) a list of months; ie. 1,6 would be the jan AND jun.\n(-) a range of months; ie. 1-3 would be jan, feb, and mar (you can also specify a list of ranges 1-4,8-12).\n(/) step values will skip the specified number within a range; ie */4 is every 4 months, and 1-8/2 is every 2 months between jan and aug.",day:"(0-6) allowed values; 0=Sunday, 1=Monday, 2=Tuesday, 3=Wednesday, 4=Thursday, 5=Friday, 6=Saturday.\nSUN-SAT) allowed values.\n(*) first-last (every day of the week).\n(,) a list of days; ie. 1,5 would be the mon AND fri.\n(-) a range of days; ie. 1-5 would be mon, tue, wed, thu, and fri (you can also specify a list of ranges 0-2,4-6).\n(/) step values will skip the specified number within a range; ie */4 is every 4 days, and 1-5/2 is every 2 days between mon and fri."},o}return __extends(fieldCronInterval,a),Object.defineProperty(fieldCronInterval.prototype,"min",{get:function(){return(this.value?this.value.split("::"):[])[0]||""},set:function(e){this.value=e+"::"+this.hrs+"::"+this.date+"::"+this.mo+"::"+this.day},enumerable:!0,configurable:!0}),Object.defineProperty(fieldCronInterval.prototype,"hrs",{get:function(){return(this.value?this.value.split("::"):[])[1]||""},set:function(e){this.value=this.min+"::"+e+"::"+this.date+"::"+this.mo+"::"+this.day},enumerable:!0,configurable:!0}),Object.defineProperty(fieldCronInterval.prototype,"date",{get:function(){return(this.value?this.value.split("::"):[])[2]||""},set:function(e){this.value=this.min+"::"+this.hrs+"::"+e+"::"+this.mo+"::"+this.day},enumerable:!0,configurable:!0}),Object.defineProperty(fieldCronInterval.prototype,"mo",{get:function(){return(this.value?this.value.split("::"):[])[3]||""},set:function(e){this.value=this.min+"::"+this.hrs+"::"+this.date+"::"+e+"::"+this.day},enumerable:!0,configurable:!0}),Object.defineProperty(fieldCronInterval.prototype,"day",{get:function(){return(this.value?this.value.split("::"):[])[4]||""},set:function(e){this.value=this.min+"::"+this.hrs+"::"+this.date+"::"+this.mo+"::"+e},enumerable:!0,configurable:!0}),fieldCronInterval=__decorate([core_1.Component({selector:"field-cron-interval",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig">{{model.data.job_interval_read}}</field-generic-display><div *ngIf="isEditMode() && isEditable()" class="slds-grid"><div class="slds-form-element slds-p-horizontal--xx-small"><label class="slds-form-element__label slds-grid slds-p-right--none slds-grid--align-spread" for="min"><span class="slds-truncate" [title]="language.getLabel(\'LBL_MINUTES\')">{{language.getLabel(\'LBL_MINUTES\')}}</span><system-utility-icon icon="info_alt" size="xx-small" class="slds-m-left--xxx-small" [title]="fieldDescription.min"></system-utility-icon></label><div class="slds-form-element__control"><input id="min" type="text" class="slds-input" [(ngModel)]="min"></div></div><div class="slds-form-element slds-p-horizontal--xx-small"><label class="slds-form-element__label slds-grid slds-p-right--none slds-grid--align-spread" for="hrs"><span class="slds-truncate" [title]="language.getLabel(\'LBL_HOURS\')">{{language.getLabel(\'LBL_HOURS\')}}</span><system-utility-icon icon="info_alt" size="xx-small" class="slds-m-left--xxx-small" [title]="fieldDescription.hrs"></system-utility-icon></label><div class="slds-form-element__control"><input id="hrs" type="text" class="slds-input" [(ngModel)]="hrs"></div></div><div class="slds-form-element slds-p-horizontal--xx-small"><label class="slds-form-element__label slds-grid slds-p-right--none slds-grid--align-spread" for="date"><span class="slds-truncate" [title]="language.getLabel(\'LBL_DAY_OF_MONTH\')">{{language.getLabel(\'LBL_DAY_OF_MONTH\')}}</span><system-utility-icon icon="info_alt" size="xx-small" class="slds-m-left--xxx-small" [title]="fieldDescription.date"></system-utility-icon></label><div class="slds-form-element__control"><input id="date" type="text" class="slds-input" [(ngModel)]="date"></div></div><div class="slds-form-element slds-p-horizontal--xx-small"><label class="slds-form-element__label slds-grid slds-p-right--none slds-grid--align-spread" for="mo"><span class="slds-truncate" [title]="language.getLabel(\'LBL_MONTH\')">{{language.getLabel(\'LBL_MONTH\')}}</span><system-utility-icon icon="info_alt" size="xx-small" class="slds-m-left--xxx-small" [title]="fieldDescription.mo"></system-utility-icon></label><div class="slds-form-element__control"><input id="mo" type="text" class="slds-input" [(ngModel)]="mo"></div></div><div class="slds-form-element slds-p-horizontal--xx-small"><label class="slds-form-element__label slds-grid slds-p-right--none slds-grid--align-spread" for="day"><span class="slds-truncate" [title]="language.getLabel(\'LBL_DAY_OF_WEEK\')">{{language.getLabel(\'LBL_DAY_OF_WEEK\')}}</span><system-utility-icon icon="info_alt" size="xx-small" class="slds-m-left--xxx-small" [title]="fieldDescription.day"></system-utility-icon></label><div class="slds-form-element__control"><input id="day" type="text" class="slds-input" [(ngModel)]="day"></div></div></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldCronInterval)}(fieldGeneric);exports.fieldCronInterval=fieldCronInterval;var fieldGooglePlacesSearch=function(a){function fieldGooglePlacesSearch(e,t,s,i,l){var o=a.call(this,e,t,s,i,l)||this;return o.model=e,o.view=t,o.language=s,o.metadata=i,o.router=l,o.options=[],o}return __extends(fieldGooglePlacesSearch,a),fieldGooglePlacesSearch.prototype.setDetails=function(e){var t={};this.fieldconfig.formatted_phone_number&&e.formatted_phone_number&&(t[this.fieldconfig.formatted_phone_number]=e.formatted_phone_number),this.fieldconfig.international_phone_number&&e.international_phone_number&&(t[this.fieldconfig.international_phone_number]=e.international_phone_number),this.fieldconfig.website&&e.website&&(t[this.fieldconfig.website]=e.website),e.address&&(this.fieldconfig.city&&e.address.city&&(t[this.fieldconfig.city]=e.address.city),this.fieldconfig.country&&e.address.country&&(t[this.fieldconfig.country]=e.address.country),this.fieldconfig.postalcode&&e.address.postalcode&&(t[this.fieldconfig.postalcode]=e.address.postalcode),this.fieldconfig.state&&e.address.state&&(t[this.fieldconfig.state]=e.address.state),this.fieldconfig.street&&e.address.street&&(t[this.fieldconfig.street]=e.address.street),this.fieldconfig.location_lat&&e.address.latitude&&(t[this.fieldconfig.location_lat]=e.address.latitude),this.fieldconfig.location_long&&e.address.longitude&&(t[this.fieldconfig.location_long]=e.address.longitude)),_.isEmpty(t)||this.model.setFields(t)},fieldGooglePlacesSearch=__decorate([core_1.Component({selector:"field-google-places-search",template:'<field-generic-display *ngIf="!isEditMode()" [fielddisplayclass]="fielddisplayclass" [editable]="isEditable()" [fieldconfig]="fieldconfig" [title]="value" [fieldid]="fieldid">{{value}}</field-generic-display><div *ngIf="isEditable() && isEditMode()" class="slds-form-element__control" [ngClass]="css_classes"><system-googleplaces-search #focus [(ngModel)]="value" (details)="setDetails($event)"></system-googleplaces-search><field-messages [fieldname]="fieldname"></field-messages></div>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,router_1.Router])],fieldGooglePlacesSearch)}(fieldGeneric);exports.fieldGooglePlacesSearch=fieldGooglePlacesSearch;var fieldTextID=function(d){function fieldTextID(e,t,s,i,l,o){var a=d.call(this,e,t,s,i,o)||this;return a.model=e,a.view=t,a.language=s,a.metadata=i,a.configurationService=l,a.router=o,a}return __extends(fieldTextID,d),Object.defineProperty(fieldTextID.prototype,"textName",{get:function(){var e=this.configurationService.getData("systextids"),t=e?e[this.value]:void 0;return t&&t.label?this.language.getLabel(t.label):this.value},enumerable:!0,configurable:!0}),fieldTextID=__decorate([core_1.Component({selector:"field-textid",template:'<field-generic-display [editable]="false" [fielddisplayclass]="fielddisplayclass" [fieldconfig]="fieldconfig" [title]="value" [fieldid]="fieldid">{{textName}}</field-generic-display>'}),__metadata("design:paramtypes",[services_1.model,services_1.view,services_1.language,services_1.metadata,services_1.configurationService,router_1.Router])],fieldTextID)}(fieldGeneric);exports.fieldTextID=fieldTextID;var ObjectFields=function(){function ObjectFields(e,t){this.metadata=e,this.vms=t,this.version="1.0",this.build_date="2019-04-10",this.vms.registerModule(this)}return ObjectFields=__decorate([core_1.NgModule({imports:[common_1.CommonModule,forms_1.FormsModule,systemcomponents_1.SystemComponents,directives_1.DirectivesModule],declarations:[fieldSet,field,fieldBlank,fieldNotAuthorized,fieldLabel,fieldContainer,fieldGeneric,fieldGenericDisplay,fieldText,fieldNumber,fieldHtml,fieldHtmlEditor,fieldWYSIWYGEditor,fieldFloat,fieldCurrency,fieldWeightedAmount,fieldTotalAmount,fieldCurrencies,fieldCompanies,fieldEnum,fieldLanguage,fieldMailboxes,fieldEmailTo,fieldEmailTemplates,fieldMailRelais,fieldMultienum,fieldMultienumCheckBox,fieldEnumAlternate,fieldBool,fieldDate,fieldTime,fieldDateTime,fieldDateTimeDuration,fieldDuration,fieldDateTimeSpan,fieldParent,fieldModuleFilter,fieldRelate,fieldRelateList,fieldModifiedBy,fieldLookup,fieldLookupRecent,fieldLookupSearch,fieldLookupSearchAdd,fieldAddress,fieldModelFooterPopover,fieldFullName,fieldTitle,fieldFile,fieldUrl,fieldEmail,fieldEmailAddresses,fieldEmailRecipients,fieldEmailRecipientsShort,fieldEmailEmailAddress,fieldVat,fieldBarcode,fieldBarcodeRenderer,fieldRating,fieldMediaFileImage,FieldMessagesComponent,FieldModuleLookupComponent,FieldSignatureComponent,fieldServiceCategories,fieldServiceCategoryTree,fieldServiceCategorySearch,fieldWorklog,FieldModelInfoComponent,FieldEnumModulesComponent,FieldEnumOutputTemplates,FieldModelInfoComponent,fieldGDPR,fieldServiceQueue,fieldTerritory,fieldTerritorySearch,fieldTerritorySecondary,fieldTerritorySecondaryPipe,fieldSelectTree,fieldSelectTreeSearch,fieldSelectTreeTree,fieldColorEnum,fieldBase64,fieldModuleIcon,fieldRichText,fieldEnumMulti,fieldPhone,fieldCronInterval,fieldGooglePlacesSearch,fieldTextID],exports:[fieldSet,field,fieldLabel,fieldContainer,fieldGeneric,fieldGenericDisplay,fieldHtml,fieldMediaFileImage,FieldMessagesComponent,FieldModuleLookupComponent,FieldEnumOutputTemplates]}),__metadata("design:paramtypes",[services_1.metadata,services_1.VersionManagerService])],ObjectFields)}();exports.ObjectFields=ObjectFields;